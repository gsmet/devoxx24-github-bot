{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/38157",
  "id": 2078731316,
  "node_id": "I_kwDOCFbutM575uw0",
  "number": 38157,
  "title": "Unable to build native project depending on \"quarkus-cache\" without Vert.x dependency since 3.5.2",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1320737519,
      "node_id": "MDU6TGFiZWwxMzIwNzM3NTE5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/vertx",
      "name": "area/vertx",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1808747697,
      "node_id": "MDU6TGFiZWwxODA4NzQ3Njk3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/cache",
      "name": "area/cache",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/298",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/298",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/298/labels",
    "id": 10421397,
    "node_id": "MI_kwDOCFbutM4AnwSV",
    "number": 298,
    "title": "3.6.6",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 15,
    "state": "closed",
    "created_at": "2024-01-15T16:21:58Z",
    "updated_at": "2024-03-25T08:19:02Z",
    "due_on": null,
    "closed_at": "2024-01-16T12:29:07Z"
  },
  "comments": 1,
  "created_at": "2024-01-12T12:21:52Z",
  "updated_at": "2024-01-15T16:36:11Z",
  "closed_at": "2024-01-15T07:51:06Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nSince quarkus 3.5.2 I'm unable to build without the \"quarkus-vertx\" dependency when using \"quarkus-cache\" and some of its caching features.\r\n\r\nJust have a look at my demo class here or see my reproducer project, if you want ( https://github.com/wglanzer/quarkus-vertx-native-reproducer/tree/main ) :\r\n```java\r\npackage com.github.wglanzer.reproducer;\r\n\r\nimport io.quarkus.cache.CacheResult;\r\nimport io.quarkus.runtime.Startup;\r\nimport jakarta.enterprise.context.ApplicationScoped;\r\n\r\n/**\r\n * @author w.glanzer, 12.01.2024\r\n */\r\n@ApplicationScoped\r\npublic class DemoApp\r\n{\r\n\r\n  @CacheResult(cacheName = \"demo\")\r\n  public String run()\r\n  {\r\n    return \"cache\" + System.currentTimeMillis();\r\n  }\r\n\r\n  @Startup\r\n  public void start()\r\n  {\r\n    System.out.println(run());\r\n    System.out.println(run());\r\n    System.out.println(run());\r\n  }\r\n\r\n}\r\n```\r\n\r\nThe pom.xml file looks something like this\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\r\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n  <modelVersion>4.0.0</modelVersion>\r\n\r\n  <groupId>com.github.wglanzer</groupId>\r\n  <artifactId>quarkus-vertx-native-reproducer</artifactId>\r\n  <version>1.0-SNAPSHOT</version>\r\n\r\n  <properties>\r\n    <quarkus.platform.version>3.5.2</quarkus.platform.version>\r\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n    <maven.compiler.source>11</maven.compiler.source>\r\n    <maven.compiler.target>11</maven.compiler.target>\r\n  </properties>\r\n\r\n  <dependencyManagement>\r\n    <dependencies>\r\n      <!-- Quarkus Universe -->\r\n      <dependency>\r\n        <groupId>io.quarkus.platform</groupId>\r\n        <artifactId>quarkus-bom</artifactId>\r\n        <version>${quarkus.platform.version}</version>\r\n        <type>pom</type>\r\n        <scope>import</scope>\r\n      </dependency>\r\n    </dependencies>\r\n  </dependencyManagement>\r\n\r\n  <dependencies>\r\n    <!-- Quarkus In-Memory Cache -->\r\n    <dependency>\r\n      <groupId>io.quarkus</groupId>\r\n      <artifactId>quarkus-cache</artifactId>\r\n    </dependency>\r\n  </dependencies>\r\n\r\n  <build>\r\n    <finalName>${project.artifactId}</finalName>\r\n    <plugins>\r\n      <plugin>\r\n        <groupId>org.apache.maven.plugins</groupId>\r\n        <artifactId>maven-compiler-plugin</artifactId>\r\n        <version>3.8.1</version>\r\n      </plugin>\r\n\r\n      <plugin>\r\n        <groupId>io.quarkus.platform</groupId>\r\n        <artifactId>quarkus-maven-plugin</artifactId>\r\n        <version>${quarkus.platform.version}</version>\r\n        <executions>\r\n          <execution>\r\n            <goals>\r\n              <goal>build</goal>\r\n            </goals>\r\n          </execution>\r\n        </executions>\r\n      </plugin>\r\n    </plugins>\r\n  </build>\r\n\r\n  <profiles>\r\n    <profile>\r\n      <id>native</id>\r\n      <activation>\r\n        <property>\r\n          <name>native</name>\r\n        </property>\r\n      </activation>\r\n      <properties>\r\n        <quarkus.package.type>native</quarkus.package.type>\r\n      </properties>\r\n    </profile>\r\n  </profiles>\r\n</project>\r\n```\n\n### Expected behavior\n\nThe native build should compile successfully without the need of the internal used Vert.x dependency. Someone from outside should not need to consider including internal used parts, because .. they should stay internal, as long as the developer does not \"really need it\"\n\n### Actual behavior\n\nThe main exception is the following:\r\n\r\n```\r\ncom.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Discovered unresolved type during parsing: io.vertx.core.Vertx. This error is reported at image build time because class io.quarkus.cache.runtime.CacheResultInterceptor is registered for linking at image build time by command line and command line.\r\nError encountered while parsing io.quarkus.cache.runtime.CacheResultInterceptor.intercept(CacheResultInterceptor.java:39) \r\nParsing context:\r\n   at io.quarkus.cache.runtime.CacheResultInterceptor_Bean.intercept(Unknown Source)\r\n   at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)\r\n   at io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:30)\r\n   at com.github.wglanzer.reproducer.DemoApp_Subclass.run(Unknown Source)\r\n   at root method.(Unknown Source)\r\n```\n\n### How to Reproduce?\n\n1. Clone the reproducer or create a new project with the pom.xml and the class from above\r\n2. Execute a native compile with the \"native\" build profile\r\n3. An exception should appear on the console\n\n### Output of `uname -a` or `ver`\n\nDarwin wglanzer-mb.home.lan 23.2.0 Darwin Kernel Version 23.2.0: Wed Nov 15 21:54:10 PST 2023; root:xnu-10002.61.3~2/RELEASE_X86_64 x86_64\n\n### Output of `java -version`\n\nJava version: 21.0.1+12, vendor version: GraalVM CE 21.0.1+12.1\n\n### Quarkus version or git rev\n\n3.5.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38157/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
