{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/32037",
  "id": 1635788639,
  "node_id": "I_kwDOCFbutM5hgCdf",
  "number": 32037,
  "title": "Set-Cookie Header is Split when using OIDC together with AWS Lambda",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1326073020,
      "node_id": "MDU6TGFiZWwxMzI2MDczMDIw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/amazon-lambda",
      "name": "area/amazon-lambda",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/242",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/242",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/242/labels",
    "id": 9206140,
    "node_id": "MI_kwDOCFbutM4AjHl8",
    "number": 242,
    "title": "2.16.6.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 31,
    "state": "closed",
    "created_at": "2023-03-25T14:05:42Z",
    "updated_at": "2023-04-04T08:25:31Z",
    "due_on": null,
    "closed_at": "2023-04-04T08:25:31Z"
  },
  "comments": 7,
  "created_at": "2023-03-22T13:41:08Z",
  "updated_at": "2023-04-02T16:23:17Z",
  "closed_at": "2023-03-28T21:35:09Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI think I have a similar problem to #25580. I am trying to use the quarkus-oidc extension together with an AWS Lambda deployment using quarkus-amazon-lambda-http. When I remove the quarkus-amazon-lambda-http dependency from the project, everything works fine. However when it is included in the dependencies so the Mock Lambda Event Server is used in dev mode, the q_auth-Cookie breaks (in two parts).\r\n\r\nThis is part of the headers that Quarkus responds with:\r\n```\r\n< set-cookie: q_auth=6b6a7588-802f-49ea-a276-64e6bac263d1|/auth/authenticateAndRedirect?url=http%3A%2F%2Flocalhost%3A3000%2F; Max-Age=1800; Expires=Wed\r\n< set-cookie: 22 Mar 2023 13:44:01 GMT; Path=/; HTTPOnly\r\n```\r\n\r\nAs you can see, the comma that is used within the expiration value now is interpreted by the AWS Lambda Mock Server (and probably also the real one) as the separating character between two header values.\r\n\r\n\r\n### Expected behavior\r\n\r\n_No response_\r\n\r\n### Actual behavior\r\n\r\n_No response_\r\n\r\n### How to Reproduce?\r\n\r\nSteps to reproduce:\r\n1. Go to https://code.quarkus.io, select \"AWS Lambda HTTP\" as well as \"OpenID Connect\" and download and extract the ZIP\r\n2. Change maven.compiler.release to 11 (probably not necessary, I just did not have the required java version installed)\r\n3. Add the following to the `application.properties`:\r\n```\r\nquarkus.oidc.application-type=web_app\r\n# Enforce OIDC usage for all paths\r\nquarkus.http.auth.permission.authenticated.paths=/*\r\nquarkus.http.auth.permission.authenticated.policy=authenticated\r\n```\r\n4. Run `./mvnw quarkus:dev`\r\n5. Execute `curl localhost:8080 -v`\r\n\r\nNow you can see two set-cookie headers, of which at least the second one looks broken\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n_No response_\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n(edited to add missing reproduction step)",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32037/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
