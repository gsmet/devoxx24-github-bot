{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27831",
  "id": 1367594491,
  "node_id": "I_kwDOCFbutM5Rg9X7",
  "number": 27831,
  "title": "Redis GEO related error: ERR unsupported unit provided. please use m, km, ft, mi",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2184343143,
      "node_id": "MDU6TGFiZWwyMTg0MzQzMTQz",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/redis",
      "name": "area/redis",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/205",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/205",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/205/labels",
    "id": 8414394,
    "node_id": "MI_kwDOCFbutM4AgGS6",
    "number": 205,
    "title": "2.12.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 21,
    "state": "closed",
    "created_at": "2022-09-12T15:37:17Z",
    "updated_at": "2023-01-13T11:07:32Z",
    "due_on": null,
    "closed_at": "2022-09-13T12:10:57Z"
  },
  "comments": 9,
  "created_at": "2022-09-09T10:04:51Z",
  "updated_at": "2022-09-14T02:33:29Z",
  "closed_at": "2022-09-13T05:27:13Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI tried to use redis GEO commands geoadd/geodist/geosearch via Quarks v2.12 but got the below error which is nearly the same with the one I mistake to operate redis via redis-cli.\r\n\r\n```java\r\nSep 09, 2022 8:52:54 AM org.jboss.resteasy.reactive.server.core.ResteasyReactiveRequestContext handleUnrecoverableError\r\nERROR: Request failed\r\njava.util.concurrent.CompletionException: ERR unsupported unit provided. please use m, km, ft, mi\r\n\tat io.smallrye.mutiny.operators.uni.UniBlockingAwait.await(UniBlockingAwait.java:79)\r\n\tat io.smallrye.mutiny.groups.UniAwait.atMost(UniAwait.java:65)\r\n\tat io.quarkus.redis.runtime.datasource.BlockingGeoCommandsImpl.geosearch(BlockingGeoCommandsImpl.java:155)\r\n\tat com.edwin.quarkus.service.RedisTool.geoSearch(RedisTool.java:65)\r\n\tat com.edwin.quarkus.service.RedisTool_Subclass.geoSearch$$superforward1(Unknown Source)\r\n\tat com.edwin.quarkus.service.RedisTool_Subclass$$function$$3.apply(Unknown Source)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:53)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor.proceed(InvocationInterceptor.java:62)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor.monitor(InvocationInterceptor.java:49)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor_Bean.intercept(Unknown Source)\r\n\tat io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:41)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:40)\r\n\tat io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:32)\r\n\tat com.edwin.quarkus.service.RedisTool_Subclass.geoSearch(Unknown Source)\r\n\tat com.edwin.quarkus.service.RedisTool_ClientProxy.geoSearch(Unknown Source)\r\n\tat com.edwin.quarkus.controller.RestController.fetchAcceList(RestController.java:43)\r\n\tat com.edwin.quarkus.controller.RestController_Subclass.fetchAcceList$$superforward1(Unknown Source)\r\n\tat com.edwin.quarkus.controller.RestController_Subclass$$function$$1.apply(Unknown Source)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:53)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor.proceed(InvocationInterceptor.java:62)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor.monitor(InvocationInterceptor.java:49)\r\n\tat io.quarkus.arc.runtime.devconsole.InvocationInterceptor_Bean.intercept(Unknown Source)\r\n\tat io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:41)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:40)\r\n\tat io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:32)\r\n\tat com.edwin.quarkus.controller.RestController_Subclass.fetchAcceList(Unknown Source)\r\n\tat com.edwin.quarkus.controller.RestController$quarkusrestinvoker$fetchAcceList_0ac711ca01189983132bf14b86d98a463c50a566.invoke(Unknown Source)\r\n\tat org.jboss.resteasy.reactive.server.handlers.InvocationHandler.handle(InvocationHandler.java:29)\r\n\tat io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:108)\r\n\tat org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:140)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:557)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:829)\r\nCaused by: ERR unsupported unit provided. please use m, km, ft, mi\r\n```\r\n```bash\r\n10.18.222.16:7000> GEOADD Sicily 13.361389 38.115556 \"Palermo\" 15.087269 37.502669 \"Catania\"\r\n-> Redirected to slot [10713] located at 10.18.222.16:7003\r\n(integer) 2\r\n10.18.222.16:7003> GEOADD Sicily 13.361389 38.115556 \"Palermo\" 15.087269 37.502669 \"Catania\"\r\n(integer) 0\r\n10.18.222.16:7003> GEODIST Sicily Palermo Catania\r\n\"166274.1516\"\r\n10.18.222.16:7003> GEORADIUS Sicily 15 37 100 km\r\n1) \"Catania\"\r\n10.18.222.16:7003> GEORADIUS Sicily 15 37 200 km\r\n1) \"Palermo\"\r\n2) \"Catania\"\r\n10.18.222.16:7003> GEORADIUS Sicily 15 37 100 KM\r\n(error) ERR unsupported unit provided. please use m, km, ft, mi\r\n10.18.222.16:7003> GEORADIUS Sicily 15 37 100 km\r\n1) \"Catania\"\r\n10.18.222.16:7003>\r\n```\r\n#### My code:\r\n#### RedisTool\r\n```java\r\npackage com.edwin.quarkus.service;\r\n\r\nimport io.quarkus.redis.datasource.RedisDataSource;\r\nimport io.quarkus.redis.datasource.geo.GeoCommands;\r\nimport io.quarkus.redis.datasource.geo.GeoSearchArgs;\r\nimport io.quarkus.redis.datasource.geo.GeoUnit;\r\nimport io.quarkus.redis.datasource.geo.GeoValue;\r\nimport io.quarkus.redis.datasource.keys.KeyCommands;\r\nimport io.quarkus.redis.datasource.string.StringCommands;\r\n\r\nimport javax.annotation.PostConstruct;\r\nimport javax.enterprise.context.ApplicationScoped;\r\nimport javax.inject.Inject;\r\nimport java.util.List;\r\nimport java.util.OptionalDouble;\r\n\r\n@ApplicationScoped\r\npublic class RedisTool {\r\n    @Inject\r\n    RedisDataSource redisDataSource;\r\n\r\n    private KeyCommands<String> keyCommands;\r\n    private StringCommands<String, String> stringCommands;\r\n\r\n    private GeoCommands<String, String> geoCommands;\r\n\r\n    @PostConstruct\r\n    void init(){\r\n        keyCommands = redisDataSource.key();\r\n        stringCommands = redisDataSource.string(String.class);\r\n        geoCommands = redisDataSource.geo(String.class, String.class);\r\n    }\r\n\r\n    public void del(String key) {\r\n        keyCommands.del(key);\r\n    }\r\n\r\n    public String get(String key) {\r\n        return stringCommands.get(key);\r\n    }\r\n\r\n    public void set(String key, String value) {\r\n        stringCommands.set(key, value);\r\n    }\r\n\r\n    public void geoAdd(String key, double longitude, double latitude, String memberName){\r\n        geoCommands.geoadd(key, longitude, latitude, memberName);\r\n    }\r\n\r\n    public double geoDist(String key, String memberNameFrom, String memberNameTo){\r\n        OptionalDouble result = geoCommands.geodist(key, memberNameFrom, memberNameTo, GeoUnit.KM);\r\n        if(result.isPresent()){\r\n            return result.getAsDouble();\r\n        }else{\r\n            return 0.0;\r\n        }\r\n    }\r\n\r\n    public List<GeoValue<String>> geoSearch(String key, String memberName, double radius){\r\n        GeoSearchArgs args = new GeoSearchArgs<>();\r\n        args.fromMember(memberName);\r\n        args.byRadius(radius, GeoUnit.KM);\r\n        args.count(10);\r\n        args.ascending();\r\n        List<GeoValue<String>> nearList = geoCommands.geosearch(key, args);\r\n        return nearList;\r\n    }\r\n}\r\n```\r\n```java\r\n    @POST\r\n    @Path(value=\"/v1/zzz\")\r\n    @Produces(MediaType.APPLICATION_JSON+\";charset=UTF-8\")\r\n    @Consumes(MediaType.APPLICATION_JSON+\";charset=UTF-8\")\r\n    public String fetchAcceList(FetchAcceListParam fetchAcceListParam,\r\n                                @Context io.vertx.core.http.HttpServerRequest httpRequest) throws Exception {\r\n        redisTool.geoAdd(\"zzz\", 13.361389, 38.115556, \"Palermo\");\r\n        redisTool.geoAdd(\"zzz\", 15.087269, 37.502669, \"Catania\");\r\n\r\n        System.out.println(redisTool.geoDist(\"zzz\", \"Palermo\", \"Catania\"));\r\n        System.out.println(redisTool.geoSearch(\"zzz\", \"Palermo\", 500.0));\r\n\r\n        return \"\";\r\n    }\r\n```\r\n### application.yml\r\n```yaml\r\nquarkus:\r\n  http:\r\n    port: 18087\r\n    root-path: /\r\n  redis:\r\n    hosts: redis://xxx.yyy.zzz.ab:7000,redis://xxx.yyy.zzz.ab7001,redis://xxx.yyy.zzz.ab:7002,redis://xxx.yyy.zzz.ab:7003,redis://xxx.yyy.zzz.ab7004,redis://xxx.yyy.zzz.ab:7005\r\n    password: ******\r\n    timeout: 10s\r\n    client-type: cluster\r\n    replicas: share\r\n    max-pool-size: 20\r\n    max-pool-waiting: 24\r\n    pool-cleaner-interval: 5s\r\n    pool-recycle-timeout: 15s\r\n    max-waiting-handlers: 2048\r\n    max-nested-arrays: 16\r\n    reconnect-interval: 30s\r\n```\r\n\r\n### Expected behavior\r\n\r\nReturn the nearist member in the given key.\r\n\r\n### Actual behavior\r\n\r\nReturn error:\r\nCaused by: ERR unsupported unit provided. please use m, km, ft, mi\r\n\r\n### How to Reproduce?\r\n\r\nJust run the code I offered.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nLinux a176656f74a6 5.4.0-117-generic\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"11.0.11\" 2021-04-20\r\n\r\n### GraalVM version (if different from Java)\r\n\r\ngraalvm-ce-java11-21.3.0\r\n\r\n### Quarkus version or git rev\r\n\r\n2.12.0.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n3.8.1\r\n\r\n### Additional information\r\n\r\nI guess the unit of io.quarkus.redis.datasource.geo.GeoUnit should be lower case?\r\n```java\r\npackage io.quarkus.redis.datasource.geo;\r\n\r\npublic enum GeoUnit {\r\n\r\n    /**\r\n     * meter.\r\n     */\r\n    M, // Should all be lower case?\r\n\r\n    /**\r\n     * kilometer.\r\n     */\r\n    KM,\r\n\r\n    /**\r\n     * feet.\r\n     */\r\n    FT,\r\n\r\n    /**\r\n     * mile.\r\n     */\r\n    MI;\r\n}\r\n\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27831/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
