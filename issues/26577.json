{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/26577",
  "id": 1295802478,
  "node_id": "I_kwDOCFbutM5NPGBu",
  "number": 26577,
  "title": "Quarkus oidc proxy host expects protocol",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/196",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/196",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/196/labels",
    "id": 8208830,
    "node_id": "MI_kwDOCFbutM4AfUG-",
    "number": 196,
    "title": "2.10.3.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 33,
    "state": "closed",
    "created_at": "2022-07-18T13:45:45Z",
    "updated_at": "2023-01-13T10:37:02Z",
    "due_on": null,
    "closed_at": "2022-07-19T11:12:20Z"
  },
  "comments": 7,
  "created_at": "2022-07-06T12:55:24Z",
  "updated_at": "2022-07-18T14:03:42Z",
  "closed_at": "2022-07-12T10:09:40Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nHi guys I think you have a problem in your quarkus, keycloak oidc  implementation. \r\n\r\nDuring initialization of a quarkus application which is configured with keycloak as previously mentioned during load time the method `configureProxyForAuthServerIfProvided` is called. On line 409 this expects a protocol, such as http:// or https:// \r\nhttps://github.com/keycloak/keycloak/blob/main/adapters/oidc/adapter-core/src/main/java/org/keycloak/adapters/HttpClientBuilder.java \r\n\r\nWithout this protocol the application will fail at initialization with: \" Host name may not be null\"\r\n\r\nSecondly, in https://github.com/quarkusio/quarkus/blob/main/extensions/oidc-common/runtime/src/main/java/io/quarkus/oidc/common/runtime/OidcCommonUtils.java the method toProxyOptions expects a proxy host without a protocol in front of it. \r\nThis method is called at runtime. Due to the fact that one sets one value only, the two are conflicting: \r\nquarkus.oidc.\"tenant\".proxy.host\r\n\r\nFor instance, by setting a value with a protocol to satisfy the adapter check all the calls at runtime will be failling with an error such as \"unknow host exception\" du to the the fact that OidcCommonUtils will configure a proxy host with http:// in front of it. \r\n\r\n\n\n### Expected behavior\n\nThat the proxy configuration works both at runtime and startup time.\n\n### Actual behavior\n\nIs not working with unknown host exception for the proxy host value\n\n### How to Reproduce?\n\nConfigure and application with keycloak and proxy set on it. \r\nRoot your trafic to the keycloak instance through a proxy.\n\n### Output of `uname -a` or `ver`\n\nMINGW64_NT-10.0-19044 vd15474 3.1.7-340.x86_64 2021-03-26 22:17 UTC x86_64 Msys\n\n### Output of `java -version`\n\njava version \"11.0.8\" 2020-07-14 LTS\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.10.0.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26577/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
