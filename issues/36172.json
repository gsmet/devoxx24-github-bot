{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36172",
  "id": 1913916347,
  "node_id": "I_kwDOCFbutM5yFAu7",
  "number": 36172,
  "title": "@ConsumeEvent does not work in native when returning a Uni<Set<String>>",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1320737519,
      "node_id": "MDU6TGFiZWwxMzIwNzM3NTE5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/vertx",
      "name": "area/vertx",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/280",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/280",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/280/labels",
    "id": 10034258,
    "node_id": "MI_kwDOCFbutM4AmRxS",
    "number": 280,
    "title": "3.6.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 185,
    "state": "closed",
    "created_at": "2023-10-11T07:34:36Z",
    "updated_at": "2024-01-14T09:44:21Z",
    "due_on": null,
    "closed_at": "2023-11-15T12:08:43Z"
  },
  "comments": 21,
  "created_at": "2023-09-26T16:47:03Z",
  "updated_at": "2023-10-11T18:54:27Z",
  "closed_at": "2023-10-11T18:54:23Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nQuarkus 3.4.1\r\nRedis 7.2.1\r\n\r\nI use event bus consumer to run the redis client logic.\r\nIn JVM mode, the following piece of code works fine but with native executable, it fails with a timeout (30s default value I guess) at event bus sender side.\r\nThanks to the redis MONITOR command, I can see the command processed by redis.\r\n\r\nI did some tests with Quarkus 3.2.6.Final. I have the same behavior.\r\n\r\n\r\n\r\n    @Inject\r\n    private ReactiveRedisDataSource rds;\r\n\r\n      return Optional.ofNullable(nfType)\r\n                    .map(t -> {\r\n                        final ReactiveSetCommands<String,String> setCommands = rds.set(String.class);\r\n                        return setCommands.smembers(toNfTypesKey(t));\r\n                    }).orElseGet(() -> {\r\n                        final ReactiveKeyCommands<String> keyCommands = rds.key(String.class);\r\n                        final ReactiveKeyScanCursor<String> scanCursor = keyCommands.scan(new KeyScanArgs().match(NF_PROFILES_NAMESPACE + '*').count(Long.MAX_VALUE));\r\n                        final boolean hasNext = scanCursor.hasNext();\r\n                        return hasNext ? scanCursor.next() : Uni.createFrom().item(() -> Collections.emptySet());\r\n                    }).onItem().transformToMulti(s -> Multi.createFrom().items(s::stream))\r\n                    .select().first(limit)\r\n                    .onItem().transform(s -> nfType != null ? s : s.substring(NF_PROFILES_NAMESPACE.length()))\r\n                    .collect().asSet()\r\n                    ;\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nThe code should work in native executable as for JVM mode.\r\n\r\n### Actual behavior\r\n\r\nThe code works in JVM mode but fails with native executable.\r\n\r\n### How to Reproduce?\r\n\r\n_No response_\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n```\r\njava -version\r\nopenjdk version \"17.0.5\" 2022-10-18\r\nOpenJDK Runtime Environment GraalVM CE 22.3.0 (build 17.0.5+8-jvmci-22.3-b08)\r\nOpenJDK 64-Bit Server VM GraalVM CE 22.3.0 (build 17.0.5+8-jvmci-22.3-b08, mixed mode, sharing)\r\n```\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.4.1\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n```\r\n./mvnw --version\r\nApache Maven 3.9.1 (2e178502fcdbffc201671fb2537d0cb4b4cc58f8)\r\nMaven home: C:\\Users\\mvsz7559\\.m2\\wrapper\\dists\\apache-maven-3.9.1-bin\\320285b4\\apache-maven-3.9.1\r\nJava version: 17.0.5, vendor: GraalVM Community, runtime: D:\\Liberkey\\MyApps\\graalvm\\graalvm-ce-java17-22.3.0\r\nDefault locale: en_GB, platform encoding: Cp1252\r\nOS name: \"windows 10\", version: \"10.0\", arch: \"amd64\", family: \"windows\"\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36172/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
