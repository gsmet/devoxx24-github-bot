{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/31032",
  "id": 1577646620,
  "node_id": "I_kwDOCFbutM5eCPoc",
  "number": 31032,
  "title": "resteasy-reactive-jaxb does not seperate RootElements by endpoint",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1683744663,
      "node_id": "MDU6TGFiZWwxNjgzNzQ0NjYz",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/jaxb",
      "name": "area/jaxb",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/235",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/235",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/235/labels",
    "id": 9025446,
    "node_id": "MI_kwDOCFbutM4Aibem",
    "number": 235,
    "title": "3.0.0.Alpha5",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 253,
    "state": "closed",
    "created_at": "2023-02-09T14:26:03Z",
    "updated_at": "2023-11-12T17:44:08Z",
    "due_on": null,
    "closed_at": "2023-03-08T15:10:59Z"
  },
  "comments": 3,
  "created_at": "2023-02-09T10:41:20Z",
  "updated_at": "2023-02-22T11:10:26Z",
  "closed_at": "2023-02-22T11:10:22Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nIn my app I have multiple endpoints.\r\nThey each return jaxb.\r\n\r\nSome of the JAXB Types accidently got the same name over the last few years.\r\n\r\nWith resteasy classic this works, however with resteasy reactive it does not.\r\n\r\nOn each POST request I get the exception from below.\r\n\r\nI believe this happens becase every found XMLRoot is put into the same JAXBContext.\r\nhttps://github.com/quarkusio/quarkus/blob/89fcdc9331f9857606ea9cf89666c73be3c1b16a/extensions/jaxb/runtime/src/main/java/io/quarkus/jaxb/runtime/JaxbContextProducer.java#L26-L46\r\n\r\nWith resteasy classic, each endpoint got its own (cached) JAXBContext, so that problem did not happen.\r\nEntry point is, I believe, this interface:\r\nhttps://github.com/resteasy/resteasy/blob/main/providers/jaxb/src/main/java/org/jboss/resteasy/plugins/providers/jaxb/JAXBContextFinder.java\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nproperly create separate JAXBContext for each endpoint and cache each of them.\r\n\r\n### Actual behavior\r\n\r\n```\r\n2023-02-09 11:25:47,780 ERROR [org.jbo.res.rea.com.cor.AbstractResteasyReactiveContext] (executor-thread-0) Request failed: java.lang.RuntimeException: com.sun.xml.bind.v2.runtime.IllegalAnnotationsException: 2 counts of IllegalAnnotationExceptions\r\nZwei Klassen haben denselben XML-Typnamen\"enum\". Verwenden Sie @XmlType.name und @XmlType.namespace, um ihnen unterschiedliche Namen zuzuweisen.\r\n        this problem is related to the following location:\r\n                at org.acme.model2.Enum\r\n                at public org.acme.model2.Enum org.acme.model2.Root.getEnum2()\r\n                at org.acme.model2.Root\r\n        this problem is related to the following location:\r\n                at org.acme.model1.Enum\r\n                at public org.acme.model1.Enum org.acme.model1.Root.getEnum1()\r\n                at org.acme.model1.Root\r\nZwei Klassen haben denselben XML-Typnamen\"root\". Verwenden Sie @XmlType.name und @XmlType.namespace, um ihnen unterschiedliche Namen zuzuweisen.\r\n        this problem is related to the following location:\r\n                at org.acme.model2.Root\r\n        this problem is related to the following location:\r\n                at org.acme.model1.Root\r\n\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer.jaxbContext(JaxbContextProducer.java:44)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_jaxbContext_bd8f21cf3f403916a32bb5db1dc1007aab351487_Bean.create(Unknown Source)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_jaxbContext_bd8f21cf3f403916a32bb5db1dc1007aab351487_Bean.create(Unknown Source)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:113)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:37)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:34)\r\n        at io.quarkus.arc.impl.LazyValue.get(LazyValue.java:26)\r\n        at io.quarkus.arc.impl.ComputingCache.computeIfAbsent(ComputingCache.java:69)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:34)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_jaxbContext_bd8f21cf3f403916a32bb5db1dc1007aab351487_Bean.get(Unknown Source)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_jaxbContext_bd8f21cf3f403916a32bb5db1dc1007aab351487_Bean.get(Unknown Source)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_unmarshaller_35a6e3c7bcfff544e73a054dc57f75665b05075c_Bean.create(Unknown Source)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer_ProducerMethod_unmarshaller_35a6e3c7bcfff544e73a054dc57f75665b05075c_Bean.create(Unknown Source)\r\n        at io.quarkus.arc.impl.RequestContext.getIfActive(RequestContext.java:74)\r\n        at io.quarkus.arc.impl.ClientProxies.getDelegate(ClientProxies.java:30)\r\n        at javax.xml.bind.JaxbContextProducer_ProducerMethod_unmarshaller_35a6e3c7bcfff544e73a054dc57f75665b05075c_ClientProxy.arc$delegate(Unknown Source)\r\n        at javax.xml.bind.JaxbContextProducer_ProducerMethod_unmarshaller_35a6e3c7bcfff544e73a054dc57f75665b05075c_ClientProxy.unmarshal(Unknown Source)\r\n        at io.quarkus.resteasy.reactive.jaxb.runtime.serialisers.ServerJaxbMessageBodyReader.unmarshal(ServerJaxbMessageBodyReader.java:64)\r\n        at io.quarkus.resteasy.reactive.jaxb.runtime.serialisers.ServerJaxbMessageBodyReader.doReadFrom(ServerJaxbMessageBodyReader.java:76)\r\n        at io.quarkus.resteasy.reactive.jaxb.runtime.serialisers.ServerJaxbMessageBodyReader.readFrom(ServerJaxbMessageBodyReader.java:36)\r\n        at org.jboss.resteasy.reactive.server.handlers.RequestDeserializeHandler.readFrom(RequestDeserializeHandler.java:122)\r\n        at org.jboss.resteasy.reactive.server.handlers.RequestDeserializeHandler.handle(RequestDeserializeHandler.java:81)\r\n        at io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:108)\r\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:145)\r\n        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:576)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: com.sun.xml.bind.v2.runtime.IllegalAnnotationsException: 2 counts of IllegalAnnotationExceptions\r\nZwei Klassen haben denselben XML-Typnamen\"enum\". Verwenden Sie @XmlType.name und @XmlType.namespace, um ihnen unterschiedliche Namen zuzuweisen.\r\n        this problem is related to the following location:\r\n                at org.acme.model2.Enum\r\n                at public org.acme.model2.Enum org.acme.model2.Root.getEnum2()\r\n                at org.acme.model2.Root\r\n        this problem is related to the following location:\r\n                at org.acme.model1.Enum\r\n                at public org.acme.model1.Enum org.acme.model1.Root.getEnum1()\r\n                at org.acme.model1.Root\r\nZwei Klassen haben denselben XML-Typnamen\"root\". Verwenden Sie @XmlType.name und @XmlType.namespace, um ihnen unterschiedliche Namen zuzuweisen.\r\n        this problem is related to the following location:\r\n                at org.acme.model2.Root\r\n        this problem is related to the following location:\r\n                at org.acme.model1.Root\r\n\r\n        at com.sun.xml.bind.v2.runtime.IllegalAnnotationsException$Builder.check(IllegalAnnotationsException.java:76)\r\n        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.getTypeInfoSet(JAXBContextImpl.java:441)\r\n        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.<init>(JAXBContextImpl.java:273)\r\n        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.<init>(JAXBContextImpl.java:109)\r\n        at com.sun.xml.bind.v2.runtime.JAXBContextImpl$JAXBContextBuilder.build(JAXBContextImpl.java:1126)\r\n        at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:135)\r\n        at com.sun.xml.bind.v2.JAXBContextFactory.createContext(JAXBContextFactory.java:35)\r\n        at javax.xml.bind.ContextFinder.find(ContextFinder.java:393)\r\n        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:691)\r\n        at io.quarkus.jaxb.runtime.JaxbContextProducer.jaxbContext(JaxbContextProducer.java:42)\r\n        ... 30 more\r\n\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nReproducer: \r\n[rr-jaxb-multi.zip](https://github.com/quarkusio/quarkus/files/10696175/rr-jaxb-multi.zip)\r\n\r\n\r\n1. mvn clean compile quarkus:dev \r\n2.` curl -X POST http://localhost:8080/hello/root2 -H \"Content-Type: application/xml\" -d '<root></root>'  `\r\n3. Look in the terminal where quarkus was started, the exception happend\r\n4. Stop quarkus. Change the dependencies from quarkus-resteasy-reactive-jaxb to quarkus-resteasy-jaxb\r\n5. mvn clean compile quarkus:dev \r\n6. curl -X POST http://localhost:8080/hello/root2 -H \"Content-Type: application/xml\" -d '<root></root>'  \r\n7. No exception\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nMINGW64_NT-10.0-19044 NANBCHL9NG3 3.3.6-341.x86_64 2022-09-05 20:28 UTC x86_64 Msys\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk 17.0.4 2022-07-19 OpenJDK Runtime Environment Temurin-17.0.4+8 (build 17.0.4+8) OpenJDK 64-Bit Server VM Temurin-17.0.4+8 (build 17.0.4+8, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.16.2.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: C:\\eclipse\\tools\\java\\maven Java version: 17.0.4, vendor: Eclipse Adoptium, runtime: C:\\eclipse\\tools\\java\\17 Default locale: de_DE, platform encoding: Cp1252 OS name: \"windows 10\", version: \"10.0\", arch: \"amd64\", family: \"windows\"\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31032/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
