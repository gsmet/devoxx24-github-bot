{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/26009",
  "id": 1264917102,
  "node_id": "I_kwDOCFbutM5LZRpu",
  "number": 26009,
  "title": "2.8.0 YAML config no longer working in 2.9.2",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/190",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/190",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/190/labels",
    "id": 8076540,
    "node_id": "MI_kwDOCFbutM4Aezz8",
    "number": 190,
    "title": "2.10.0.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 23,
    "state": "closed",
    "created_at": "2022-06-13T14:23:46Z",
    "updated_at": "2023-01-13T10:01:39Z",
    "due_on": null,
    "closed_at": "2022-06-15T16:54:24Z"
  },
  "comments": 6,
  "created_at": "2022-06-08T15:16:43Z",
  "updated_at": "2022-06-15T07:31:04Z",
  "closed_at": "2022-06-15T07:25:33Z",
  "active_lock_reason": null,
  "body": "The below works in 2.8.0 but not in 2.9.2. \r\nHere are the respective configs in memory. \r\nYou will notice that. in the 2.9.2 - the map keys are messed up. It appears that the keys for the Map<String, MessageUtilConfiguration> messageUtilConfigurations() in the config file have also been used for the key for the Map<String, Map<String, MessageUtilConfiguration>> messageUtilConfigsMap(); \r\nI've highlighted the map keys which are different in the 2 versions.\r\n\r\ncorrect config with 2.8.0 top map key should be \"filter\"\r\n```\r\nmessageHandlerConfigurations\tMessageUtilConfigurations249831481Impl  (id=264)\t\r\n\tenableDataswapDetection\tOptional<T>  (id=275)\t\r\n\tmessageUtilConfigsMap\tHashMap<K,V>  (id=277)\t\r\n\t\t[0]\tHashMap$Node<K,V>  (id=295)\t\r\n\t\t\tkey\t\"**filter**\" (id=299)\t\r\n\t\t\tvalue\tHashMap<K,V>  (id=300)\t\r\n\t\t\t\t[0]\tHashMap$Node<K,V>  (id=314)\t\r\n\t\t\t\t\tkey\t\"**default**\" (id=316)\t\r\n\t\t\t\t\tvalue\tMessageUtilConfigurations$MessageUtilConfiguration-464514824Impl  (id=317)\t\r\n\t\t\t\t[1]\tHashMap$Node<K,V>  (id=315)\t\r\n\t\t[1]\tHashMap$Node<K,V>  (id=296)\t\r\n\t\t\tkey\t\"client\" (id=301)\t\r\n\t\t\tvalue\tHashMap<K,V>  (id=302)\t\r\n\t\t\t\t[0]\tHashMap$Node<K,V>  (id=310)\t\r\n\t\t\t\t\tkey\t\"reaction-api\" (id=312)\t\r\n\t\t\t\t\tvalue\tMessageUtilConfigurations$MessageUtilConfiguration-464514824Impl  (id=313)\t\r\n\t\t\t\t[1]\tHashMap$Node<K,V>  (id=311)\t\r\n\tmessageUtilConfigurations\tCollections$EmptyMap<K,V>  (id=283)\t\r\n\treturnDetailedError\tOptional<T>  (id=285)\t\r\nrequestScopedContext\tRequestScopedContext_ClientProxy  (id=268)\t\r\n```\r\n\r\nbad Config with 2.9.2 (no code changes) top map key seems to be the key for the contained map \"default \"rather than \"filter\"\r\n\r\n```\r\nmessageHandlerConfigurations\tMessageUtilConfigurations249831481Impl  (id=225)\t\r\n\tenableDataswapDetection\tOptional<T>  (id=250)\t\r\n\tmessageUtilConfigsMap\tHashMap<K,V>  (id=251)\t\r\n\t\t[0]\tHashMap$Node<K,V>  (id=280)\t\r\n\t\t\tkey\t\"**default**\" (id=297)\t\r\n\t\t\tvalue\tHashMap<K,V>  (id=298)\t\r\n\t\t\t\t[0]\tHashMap$Node<K,V>  (id=336)\t\r\n\t\t\t\t\tkey\t\"**default**\" (id=346)\t\r\n\t\t\t\t\tvalue\tMessageUtilConfigurations$MessageUtilConfiguration-464514824Impl  (id=347)\t\r\n\t\t[1]\tHashMap$Node<K,V>  (id=281)\t\r\n\t\t\tkey\t\"reaction-api\" (id=299)\t\r\n\t\t\tvalue\tHashMap<K,V>  (id=300)\t\r\n\t\t\t\t[0]\tHashMap$Node<K,V>  (id=348)\t\r\n\t\t\t\t\tkey\t\"reaction-api\" (id=359)\t\r\n\t\t\t\t\tvalue\tMessageUtilConfigurations$MessageUtilConfiguration-464514824Impl  (id=360)\t\r\n\t\t[2]\tHashMap$Node<K,V>  (id=282)\t\r\n\t\t[3]\tHashMap$Node<K,V>  (id=283)\t\r\n\tmessageUtilConfigurations\tCollections$EmptyMap<K,V>  (id=262)\t\r\n\treturnDetailedError\tOptional<T>  (id=264)\t\r\nrequestScopedContext\tRequestScopedContext_ClientProxy  (id=229)\t\r\n```\r\nConfig interface:\r\n\r\n```java\r\n@ConfigMapping(prefix = \"message-util-configurations\", namingStrategy = ConfigMapping.NamingStrategy.KEBAB_CASE)\r\npublic interface MessageUtilConfigurations {\r\n\r\n    Optional<Boolean> enableDataswapDetection();\r\n\r\n    Optional<Boolean> returnDetailedError();\r\n\r\n    Map<String, Map<String, MessageUtilConfiguration>> messageUtilConfigsMap();\r\n    Map<String, MessageUtilConfiguration> messageUtilConfigurations();\r\n\r\n    interface MessageUtilConfiguration {\r\n    \tOptional<Boolean> enableDataswapDetection();\r\n        //Includes 'default'\r\n        List<MessageUtilInstruction> messageUtilInstructions();\r\n\r\n        interface MessageUtilInstruction {\r\n            String name(); //x-correlationId\r\n\r\n            String instructionType(); // REQUEST, RESPONSE\r\n\r\n            String matchStrategy(); // REQUIRED\r\n\r\n            Optional<String> groomAction(); // null, REPLACE\r\n\r\n            String location(); //HDR\r\n\r\n            String type(); //VALUE\r\n\r\n            Optional<String> expression();  //null\r\n\r\n            Optional<Boolean> loggable(); //true, false\r\n\r\n            Optional<String> errorCode(); //515\r\n\r\n            Optional<String> errorMsg(); // x-correlationId is required\r\n\r\n            Optional<String> associatedInstruction(); // \"x-correlationId\" or whatever is in the 'name'\r\n        }\r\n\r\n    }\r\n    \r\n}\r\n```\r\nAssociated Snippet from YAML file:\r\n\r\n```yaml\r\n#====================================================================\r\n# Messagehandler config\r\n#====================================================================\r\nmessage-util-configurations:\r\n  enable-dataswap-detection: true\r\n  message-util-configs-map:\r\n    filter:\r\n      default:\r\n        enable-dataswap-detection: false\r\n      get-jokes-uni:\r\n        enable-dataswap-detection: true\r\n        message-util-instructions:\r\n          - name: x-correlationId\r\n            instruction-type: REQUEST\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n\r\n          - name: x-correlationId\r\n            associated-instruction: x-correlationId\r\n            instruction-type: RESPONSE\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n\r\n    client:\r\n      reaction-api:\r\n        enable-dataswap-detection: true\r\n        message-util-instructions:\r\n          - name: x-correlationId\r\n            instruction-type: REQUEST\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n\r\n          - name: x-correlationId\r\n            associated-instruction: x-correlationId\r\n            instruction-type: RESPONSE\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n\r\n      setup-api:\r\n        enable-dataswap-detection: true\r\n        message-util-instructions:\r\n          - name: x-correlationId\r\n            instruction-type: REQUEST\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n\r\n          - name: x-correlationId\r\n            associated-instruction: x-correlationId\r\n            instruction-type: RESPONSE\r\n            match-strategy: REQUIRED\r\n            groom-action: ''\r\n            location: HDR\r\n            type: VALUE\r\n            loggable: true\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26009/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
