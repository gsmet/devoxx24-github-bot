{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/22218",
  "id": 1080044286,
  "node_id": "I_kwDOCFbutM5AYCr-",
  "number": 22218,
  "title": "Cannot download a large file using RESTEasy Reactive",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/164",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/164",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/164/labels",
    "id": 7483985,
    "node_id": "MI_kwDOCFbutM4AcjJR",
    "number": 164,
    "title": "2.5.3.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 22,
    "state": "closed",
    "created_at": "2021-12-13T21:40:25Z",
    "updated_at": "2021-12-15T15:37:49Z",
    "due_on": null,
    "closed_at": "2021-12-15T15:37:49Z"
  },
  "comments": 1,
  "created_at": "2021-12-14T17:44:20Z",
  "updated_at": "2021-12-15T08:33:52Z",
  "closed_at": "2021-12-15T07:00:07Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI recently switched to resteasy-reactive for my application, and I'm now unable to download large files.\r\nIf I try to create a response with the following syntax:\r\n\r\n```java\r\nresponse = Response.ok(file);\r\n```\r\n\r\nIt fails for files larger than 2GB because it tries to buffer them but it is not possible to instantiate a ByteArrayOutputStream larger than MAX_INT (there is basically an integer overflow when calling the constructor and I end up with `Request failed: java.lang.IllegalArgumentException: Negative initial size`).\r\n\r\nWhen I try to pass a FileInputStream as the response entity, it does work but my application maxes one of my CPU core during the download, and if the download gets interrupted the inputstream is never closed.\n\n### Expected behavior\n\nIt should be possible to send large files as response entities using resteasy-reactive without maxing CPU usage.\n\n### Actual behavior\n\nUsing a File type leads to integer overflow when instantiating the response outputstream, using an inputstream maxes a CPU core and never closes the file descriptor if interrupted.\n\n### How to Reproduce?\n\n1. Use resteasy-reactive\r\n2. Build a service that sends a file\r\n3. Request a file larger than Integer.MAX_INT bytes\n\n### Output of `uname -a` or `ver`\n\nLinux 5.13.13-arch1-1 #1 SMP PREEMPT Thu, 26 Aug 2021 19:14:36 +0000 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk 11.0.12 2021-07-20\n\n### GraalVM version (if different from Java)\n\nGraalVM 21.3.0 Java 11 CE (Java Version 11.0.13+7-jvmci-21.3-b05)\n\n### Quarkus version or git rev\n\n2.5.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22218/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
