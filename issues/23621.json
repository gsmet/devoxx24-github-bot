{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/23621",
  "id": 1132889530,
  "node_id": "I_kwDOCFbutM5DhoW6",
  "number": 23621,
  "title": "DefaultConfigurationFactory not found in Quarkus 2.7.1.Final native application with quarkus-spring-security",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1282139374,
      "node_id": "MDU6TGFiZWwxMjgyMTM5Mzc0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/security",
      "name": "area/security",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1552233747,
      "node_id": "MDU6TGFiZWwxNTUyMjMzNzQ3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/spring",
      "name": "area/spring",
      "color": "0366d6",
      "default": false,
      "description": "Issues relating to the Spring integration"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/175",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175/labels",
    "id": 7698730,
    "node_id": "MI_kwDOCFbutM4AdXkq",
    "number": 175,
    "title": "2.7.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 159,
    "state": "closed",
    "created_at": "2022-02-21T12:59:08Z",
    "updated_at": "2022-05-12T16:40:04Z",
    "due_on": null,
    "closed_at": "2022-02-22T17:21:05Z"
  },
  "comments": 2,
  "created_at": "2022-02-11T17:26:45Z",
  "updated_at": "2022-02-21T16:31:01Z",
  "closed_at": "2022-02-13T14:26:22Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI have a project which is on Quarkus 1.11.5.Final and uses quarkus-spring-web and quarkus-spring-security. When I tried upgrading the application to Quarkus 2.7.1.Final, it works in JVM mode but fails in native mode.\r\n\r\nTo reproduce, download the [bug reproducer project](https://github.com/bkzoller/quarkus-quickstarts/tree/bug/quarkus-spring-web/spring-web-quickstart).\r\n\r\n1. mvn clean quarkus:dev\r\n2. http://localhost:8080/greeting/world -> works normally and returns `{\"message\": \"HELLO WORLD!\"}`\r\n3. pass a JWT header or JWT cookie to the request and it returns the user in the message `{\"message\": \"HELLO USER@DOMAIN.COM!\"}`\r\n\r\nNow build using the native image:\r\n1. mvn clean verify -Pnative\r\n2. ./target/spring-web-quickstart-1.0.0-SNAPSHOT-runner\r\n3. http://localhost:8080/greeting/world -> results in exception below\r\n\r\n```\r\n[io.quarkus] INFO  spring-web-quickstart 1.0.0-SNAPSHOT native (powered by Quarkus 2.7.1.Final) started in 0.041s. Listening on: http://0.0.0.0:8080\r\n[io.quarkus] INFO  Profile prod activated. \r\n[io.quarkus] INFO  Installed features: [cdi, resteasy, resteasy-jackson, security, smallrye-context-propagation, spring-di, spring-security, spring-web, vertx]\r\n[io.qua.ver.htt.run.QuarkusErrorHandler] ERROR HTTP Request to /greeting/world failed, error id: 9e7f1917-38a8-41ad-b7e1-752e7725be89-1: java.util.ServiceConfigurationError: org.jboss.resteasy.spi.config.ConfigurationFactory: Provider org.jboss.resteasy.core.config.DefaultConfigurationFactory not found\r\n\tat java.util.ServiceLoader.fail(ServiceLoader.java:589)\r\n\tat java.util.ServiceLoader$LazyClassPathLookupIterator.nextProviderClass(ServiceLoader.java:1212)\r\n\tat java.util.ServiceLoader$LazyClassPathLookupIterator.hasNextService(ServiceLoader.java:106)\r\n\tat java.util.ServiceLoader$LazyClassPathLookupIterator.hasNext(ServiceLoader.java:1265)\r\n\tat java.util.ServiceLoader$2.hasNext(ServiceLoader.java:1300)\r\n\tat java.util.ServiceLoader$3.hasNext(ServiceLoader.java:1385)\r\n\tat org.jboss.resteasy.spi.config.ConfigurationFactory.getInstance(ConfigurationFactory.java:46)\r\n\tat org.jboss.resteasy.plugins.providers.jackson.WhiteListPolymorphicTypeValidatorBuilder.<init>(WhiteListPolymorphicTypeValidatorBuilder.java:17)\r\n\tat org.jboss.resteasy.plugins.providers.jackson.ResteasyJackson2Provider.writeTo(ResteasyJackson2Provider.java:237)\r\n\tat org.jboss.resteasy.core.messagebody.AsyncBufferedMessageBodyWriter.asyncWriteTo(AsyncBufferedMessageBodyWriter.java:24)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.ServerWriterInterceptorContext.writeTo(ServerWriterInterceptorContext.java:87)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.AbstractWriterInterceptorContext.asyncProceed(AbstractWriterInterceptorContext.java:203)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.AbstractWriterInterceptorContext.getStarted(AbstractWriterInterceptorContext.java:166)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.ServerWriterInterceptorContext.lambda$getStarted$0(ServerWriterInterceptorContext.java:73)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.ServerWriterInterceptorContext.aroundWriteTo(ServerWriterInterceptorContext.java:93)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.ServerWriterInterceptorContext.getStarted(ServerWriterInterceptorContext.java:73)\r\n\tat org.jboss.resteasy.core.ServerResponseWriter.lambda$writeNomapResponse$3(ServerResponseWriter.java:163)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.ContainerResponseContextImpl.filter(ContainerResponseContextImpl.java:404)\r\n\tat org.jboss.resteasy.core.ServerResponseWriter.executeFilters(ServerResponseWriter.java:252)\r\n\tat org.jboss.resteasy.core.ServerResponseWriter.writeNomapResponse(ServerResponseWriter.java:101)\r\n\tat org.jboss.resteasy.core.ServerResponseWriter.writeNomapResponse(ServerResponseWriter.java:74)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.writeResponse(SynchronousDispatcher.java:594)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:524)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.lambda$invoke$4(SynchronousDispatcher.java:261)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.lambda$preprocess$0(SynchronousDispatcher.java:161)\r\n\tat org.jboss.resteasy.core.interception.jaxrs.PreMatchContainerRequestContext.filter(PreMatchContainerRequestContext.java:364)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.preprocess(SynchronousDispatcher.java:164)\r\n\tat org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:247)\r\n\tat io.quarkus.resteasy.runtime.standalone.RequestDispatcher.service(RequestDispatcher.java:73)\r\n\tat io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.dispatch(VertxRequestHandler.java:151)\r\n\tat io.quarkus.resteasy.runtime.standalone.VertxRequestHandler$1.run(VertxRequestHandler.java:91)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$13.runWith(VertxCoreRecorder.java:543)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:829)\r\n\tat com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:597)\r\n\tat com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:194)\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe application should work in native mode the same as JVM mode.\r\n\r\n### Actual behavior\r\n\r\nThe exception in ServiceLoader.java points to the ConfigurationFactory class not being registered for reflection in native mode, which is why DefaultConfigurationFactory could not be found.\r\n\r\n```\r\n            try {\r\n                return Class.forName(cn, false, loader);\r\n            } catch (ClassNotFoundException x) {\r\n                fail(service, \"Provider \" + cn + \" not found\");\r\n                return null;\r\n            }\r\n```\r\n\r\n\r\n### How to Reproduce?\r\n\r\nReproducer: https://github.com/bkzoller/quarkus-quickstarts/tree/bug/quarkus-spring-web/spring-web-quickstart\r\n\r\nSee description above for the steps to reproduce the bug.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin Brians-MBP.fios-router.home 21.2.0 Darwin Kernel Version 21.2.0: Sun Nov 28 20:28:54 PST 2021; root:xnu-8019.61.5~1/RELEASE_X86_64 x86_64\r\n\r\n### Output of `java -version`\r\n\r\nOpenJDK 64-Bit Server VM Temurin-11.0.14+9 (build 11.0.14+9, mixed mode)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n22.0.0.2 or 21.3.1\r\n\r\n### Quarkus version or git rev\r\n\r\n2.7.1.Final, 2.6.3.Final and main branch\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: /usr/local/Cellar/maven/3.8.4/libexec Java version: 11.0.14, vendor: Eclipse Adoptium, runtime: /Library/Java/JavaVirtualMachines/temurin-11.jdk/Contents/Home Default locale: en_US, platform encoding: UTF-8 OS name: \"mac os x\", version: \"12.1\", arch: \"x86_64\", family: \"mac\"\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23621/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
