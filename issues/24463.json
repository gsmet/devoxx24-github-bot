{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/24463",
  "id": 1176324180,
  "node_id": "I_kwDOCFbutM5GHUhU",
  "number": 24463,
  "title": "bootstrap config with Map field does not pick system properties if not defined in application.properties",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/181",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/181",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/181/labels",
    "id": 7864289,
    "node_id": "MI_kwDOCFbutM4Ad__h",
    "number": 181,
    "title": "2.8.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 78,
    "state": "closed",
    "created_at": "2022-04-11T09:08:46Z",
    "updated_at": "2023-01-25T08:58:43Z",
    "due_on": null,
    "closed_at": "2022-04-19T12:20:18Z"
  },
  "comments": 2,
  "created_at": "2022-03-22T06:27:35Z",
  "updated_at": "2022-04-11T09:12:54Z",
  "closed_at": "2022-04-04T10:12:35Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIf a property in an extension bootstrap config is defined only as a system property (i.e. it is not defined in the application properties), then it will not be taken into account.\n\n### Expected behavior\n\nThe system properties should contribute to mapping, even if properties are not defined in application.properties.\n\n### Actual behavior\n\nThe system property is picked up to override the value defined in the application.properties if it is there.\r\nIf the property is not defined in the application.properties, the system property will be ignored.\r\nIf the config object is `RUN_TIME` instead of `BOOTSTRAP` everything works normally.\n\n### How to Reproduce?\n\nFirst create an extension, with the following config object:\r\n\r\n```\r\n@ConfigRoot(name = \"hello\", phase = ConfigPhase.BOOTSTRAP)\r\npublic class HelloConfig {\r\n\r\n    /**\r\n     * doc\r\n     */\r\n    @ConfigItem(name = \"map\")\r\n    public Map<String, MapConfig> map;\r\n\r\n    @Override\r\n    public String toString() {\r\n        return \"HelloConfig{\" + \"map=\" + map + '}';\r\n    }\r\n\r\n    @ConfigGroup\r\n    public static class MapConfig {\r\n\r\n        /**\r\n         * doc\r\n         */\r\n        @ConfigItem(name = ConfigItem.PARENT)\r\n        String value;\r\n\r\n        public MapConfig(String value) {\r\n            this.value = value;\r\n        }\r\n\r\n        public MapConfig() {\r\n            value = \"\";\r\n        }\r\n\r\n        @Override\r\n        public String toString() {\r\n            return \"MapConfig{\" + \"value=\" + value + '}';\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThen define a recorder:\r\n\r\n\r\n```\r\n@Recorder\r\npublic class HelloRecorder {\r\n\r\n    private final HelloConfig config;\r\n\r\n    public HelloRecorder(HelloConfig config) {\r\n        this.config = config;\r\n    }\r\n\r\n    public void sayHello(String name) {\r\n        System.out.println(\"==> Hello\" + name+\" with config \" + config);\r\n    }\r\n}\r\n```\r\n\r\n and a build step:\r\n\r\n```\r\n    @Record(ExecutionTime.RUNTIME_INIT)\r\n    @BuildStep\r\n    public void helloBuildStep(HelloRecorder recorder) {\r\n        recorder.sayHello(\"World\");\r\n    }\r\n```\r\n\r\nIn the application.yaml define:\r\n\r\n```\r\nquarkus:\r\n  hello:\r\n    map:\r\n      mytest: foo\r\n```\r\n\r\nCompile and start the application:\r\n\r\n```\r\n$ java -Dquarkus.hello.map.mytest=bar -jar target/quarkus-app/quarkus-run.jar\r\n==> HelloWorld with config HelloConfig{map={mytest=MapConfig{value=bar}}}\r\n```\r\n\r\nThis works as expected. Now remove the configuration from the application.yaml and restart:\r\n\r\n```\r\n$ java -Dquarkus.hello.map.mytest=bar -jar target/quarkus-app/quarkus-run.jar\r\n==> HelloWorld with config HelloConfig{map={}}\r\n```\r\n\r\nYou can see that the value `bar` is not mapped anymore.\r\n\r\nChange the config phase to `RUN_TIME` and compile/relaunch:\r\n\r\n```\r\n$ java -Dquarkus.hello.map.mytest=bar -jar target/quarkus-app/quarkus-run.jar\r\n==> HelloWorld with config HelloConfig{map={mytest=MapConfig{value=bar}}}\r\n```\r\n\r\nIt is working again.\r\n\r\n\r\n\n\n### Output of `uname -a` or `ver`\n\nMINGW64_NT-10.0-19042 DEVPC028554 3.1.4-340.x86_64 2020-05-19 12:55 UTC x86_64 Msys\n\n### Output of `java -version`\n\nOpenJDK 64-Bit Server VM (build 17.0.2+8-86, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.7.3.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.2 (ea98e05a04480131370aa0c110b8c54cf726c06f)\n\n### Additional information\n\nhttps://quarkusio.zulipchat.com/#narrow/stream/294206-smallrye/topic/Map.20config.20env.20variable.20override",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24463/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
