{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/35126",
  "id": 1830534693,
  "node_id": "I_kwDOCFbutM5tG74l",
  "number": 35126,
  "title": "Rest client 307 redirect doesn't keep original request headers",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/335",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335/labels",
    "id": 11174659,
    "node_id": "MI_kwDOCFbutM4AqoMD",
    "number": 335,
    "title": "3.13.0.CR1",
    "description": "",
    "creator": {
      "login": "quarkusbot",
      "id": 61254497,
      "node_id": "MDQ6VXNlcjYxMjU0NDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/61254497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quarkusbot",
      "html_url": "https://github.com/quarkusbot",
      "followers_url": "https://api.github.com/users/quarkusbot/followers",
      "following_url": "https://api.github.com/users/quarkusbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/quarkusbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quarkusbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quarkusbot/subscriptions",
      "organizations_url": "https://api.github.com/users/quarkusbot/orgs",
      "repos_url": "https://api.github.com/users/quarkusbot/repos",
      "events_url": "https://api.github.com/users/quarkusbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quarkusbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 241,
    "state": "closed",
    "created_at": "2024-06-12T08:02:47Z",
    "updated_at": "2024-07-19T11:47:06Z",
    "due_on": null,
    "closed_at": "2024-07-17T11:55:13Z"
  },
  "comments": 17,
  "created_at": "2023-08-01T06:11:46Z",
  "updated_at": "2024-07-08T12:29:38Z",
  "closed_at": "2024-06-30T16:50:11Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nThe bug is following issue https://github.com/quarkusio/quarkus/issues/34644\r\n\r\nWith Quarkus v3.2.1+, a POST request done on an endpoint responding HTTP 307 now sends a POST request on the new URL. The problem now is that the original request headers are lost and not sent to the new URL.\r\n\r\nIt works fine with curl and Postman. Unfortunately I couldn't find any documentation about headers after redirect in the RFCs.\r\n\r\n\r\n### Expected behavior\r\n\r\nWhen sending the new request after a redirect, the HTTP method and the headers must be kept from the original request (method is OK since https://github.com/quarkusio/quarkus/issues/34644 but headers are lost).\r\n\r\n```\r\n-> POST /token, headers=[H1, H2]\r\n<- HTTP 307, Location=/token2\r\n-> POST /token2, headers=[H1, H2]\r\n```\r\n\r\n### Actual behavior\r\n\r\nThe headers are not sent in the request after the redirect.\r\n\r\n```\r\n-> POST /token, headers=[H1, H2]\r\n<- HTTP 307, Location=/token2\r\n-> POST /token2, headers=[]\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nReproducer: https://github.com/jdussouillez/quarkus-rest-client-post-redirect-post/tree/missing-headers\r\n\r\n*Same as https://github.com/quarkusio/quarkus/issues/34644 but use `missing-headers` branch*.\r\n\r\nThe server requires \"X-Api-Version\" header or will fail with \"Bad request\". Using curl it works fine:\r\n\r\n![curl](https://github.com/quarkusio/quarkus/assets/5428355/01ceab64-b09f-46ea-89f6-e665cf47baae)\r\n\r\nUsing Quarkus Rest client it fails with 400 because the \"X-Api-Version\" header wasn't sent in the second request.\r\n\r\n![quarkus-rest-client](https://github.com/quarkusio/quarkus/assets/5428355/7b28c73a-7c10-4d50-9ec2-c72bc156c21b)\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"17.0.7\"\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.2.2.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35126/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
