{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/37939",
  "id": 2056209919,
  "node_id": "I_kwDOCFbutM56j0X_",
  "number": 37939,
  "title": "Add an Option to Bypass Exception for Invalid Kubernetes Config",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 5085228218,
      "node_id": "LA_kwDOCFbutM8AAAABLxpsug",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/triage/needs-feedback",
      "name": "triage/needs-feedback",
      "color": "FDE078",
      "default": false,
      "description": "We are waiting for feedback."
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/288",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288/labels",
    "id": 10189838,
    "node_id": "MI_kwDOCFbutM4Am3wO",
    "number": 288,
    "title": "3.7.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 432,
    "state": "closed",
    "created_at": "2023-11-15T08:06:53Z",
    "updated_at": "2024-05-17T12:27:49Z",
    "due_on": null,
    "closed_at": "2024-01-17T13:52:08Z"
  },
  "comments": 14,
  "created_at": "2023-12-26T09:14:43Z",
  "updated_at": "2024-01-22T07:25:42Z",
  "closed_at": "2024-01-22T07:25:31Z",
  "active_lock_reason": null,
  "body": "### Description\n\nContext: Our application uses the Kubernetes extension, leveraging SSO for cluster authentication.\r\n\r\nIssue: When executing unit tests locally, should the SSO session be outdated, the unit tests fail, generating the following errors:\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Cannot construct instance of `io.fabric8.kubernetes.client.Config$ExecCredential` (although at least one Creator exists): no String-argument constructor/factory method to deserialize from String value ('The SSO session associated with this profile has expired or is otherwise invalid. To refresh this SSO session run aws sso login with the corresponding profile.')\r\n at [Source: UNKNOWN; byte offset: #UNKNOWN]\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._convert(ObjectMapper.java:4544)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.convertValue(ObjectMapper.java:4485)\r\n\tat io.fabric8.kubernetes.client.utils.KubernetesSerialization.parseYaml(KubernetesSerialization.java:276)\r\n\tat io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal(KubernetesSerialization.java:252)\r\n\tat io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal(KubernetesSerialization.java:342)\r\n\tat io.fabric8.kubernetes.client.utils.KubernetesSerialization.unmarshal(KubernetesSerialization.java:327)\r\n\tat io.fabric8.kubernetes.client.utils.Serialization.unmarshal(Serialization.java:185)\r\n\tat io.fabric8.kubernetes.client.Config.getExecCredentialFromExecConfig(Config.java:817)\r\n\tat io.fabric8.kubernetes.client.Config.mergeKubeConfigExecCredential(Config.java:784)\r\n\tat io.fabric8.kubernetes.client.Config.mergeKubeConfigAuthInfo(Config.java:763)\r\n\tat io.fabric8.kubernetes.client.Config.mergeKubeConfigContents(Config.java:733)\r\n\tat io.fabric8.kubernetes.client.Config.loadFromKubeconfig(Config.java:707)\r\n\tat io.fabric8.kubernetes.client.Config.tryKubeConfig(Config.java:669)\r\n\tat io.fabric8.kubernetes.client.Config.autoConfigure(Config.java:290)\r\n\tat io.fabric8.kubernetes.client.Config.autoConfigure(Config.java:286)\r\n\tat io.quarkus.kubernetes.client.runtime.KubernetesClientUtils.createConfig(KubernetesClientUtils.java:21)\r\n\tat io.quarkus.kubernetes.client.runtime.KubernetesClientUtils.createClient(KubernetesClientUtils.java:54)\r\n\tat io.quarkus.kubernetes.config.runtime.KubernetesConfigSourceFactoryBuilder$KubernetesConfigFactory.getConfigSources(KubernetesConfigSourceFactoryBuilder.java:31)\r\n\tat io.quarkus.kubernetes.config.runtime.KubernetesConfigSourceFactoryBuilder$KubernetesConfigFactory.getConfigSources(KubernetesConfigSourceFactoryBuilder.java:22)\r\n\tat io.smallrye.config.ConfigSourceFactory$ConfigurableConfigSourceFactory.getConfigSources(ConfigSourceFactory.java:58)\r\n\tat io.smallrye.config.ConfigurableConfigSource.getConfigSources(ConfigurableConfigSource.java:50)\r\n\tat io.smallrye.config.SmallRyeConfig$ConfigSources.mapLateSources(SmallRyeConfig.java:687)\r\n\tat io.smallrye.config.SmallRyeConfig$ConfigSources.<init>(SmallRyeConfig.java:577)\r\n\tat io.smallrye.config.SmallRyeConfig.<init>(SmallRyeConfig.java:68)\r\n\tat io.smallrye.config.SmallRyeConfigBuilder.build(SmallRyeConfigBuilder.java:698)\r\n\tat io.quarkus.runtime.generated.Config.readConfig(Unknown Source)\r\n\tat io.quarkus.runtime.generated.Config.createRunTimeConfig(Unknown Source)\r\n\tat io.quarkus.deployment.steps.RuntimeConfigSetup.deploy(Unknown Source)\r\n\t... 8 more\r\n```\r\nThough the issue resolves once we log in through SSO, it poses an inconvenience as unit tests ideally should not necessitate a Kubernetes setup.\r\n\r\nProposal: Could we possibly introduce an option that prevents this error from being thrown during unit testing?\r\n\r\nAdditional Note: I've attempted using the '@WithKubernetesServer' annotation, and it made the unit test working as expected. But it heavily consumes memory and leads to OOM errors.\n\n### Implementation ideas\n\nPossible Solution: We could consider modifying this line: https://github.com/quarkusio/quarkus/blob/main/extensions/kubernetes-client/runtime-internal/src/main/java/io/quarkus/kubernetes/client/runtime/KubernetesClientUtils.java#L21\r\n\r\nIn case any errors are thrown and an option such as allow-empty-config is specified, we could then resort to using:\r\n```\r\nConfig base = Config.empty();\r\n```\r\n\r\nThis approach would enable us to bypass the error during unit tests when the configuration is invalid.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37939/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
