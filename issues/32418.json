{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/32418",
  "id": 1655066858,
  "node_id": "I_kwDOCFbutM5iplDq",
  "number": 32418,
  "title": "Native build with jib and gradle fails on quarkus 3.0.0.CR1",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026591,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTkx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/gradle",
      "name": "area/gradle",
      "color": "0366d6",
      "default": false,
      "description": "Gradle"
    },
    {
      "id": 1891982257,
      "node_id": "MDU6TGFiZWwxODkxOTgyMjU3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/container-image",
      "name": "area/container-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2260340367,
      "node_id": "MDU6TGFiZWwyMjYwMzQwMzY3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/mandrel",
      "name": "area/mandrel",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/244",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/244",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/244/labels",
    "id": 9248154,
    "node_id": "MI_kwDOCFbutM4AjR2a",
    "number": 244,
    "title": "3.0.0.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 69,
    "state": "closed",
    "created_at": "2023-04-05T07:44:54Z",
    "updated_at": "2023-06-01T22:54:36Z",
    "due_on": null,
    "closed_at": "2023-04-12T12:23:31Z"
  },
  "comments": 9,
  "created_at": "2023-04-05T07:12:30Z",
  "updated_at": "2023-04-07T19:57:22Z",
  "closed_at": "2023-04-07T19:57:17Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nTrying to build a simple quarkus app with jib fails with following exception:\r\n\r\nOn my windows developer system:\r\n```\r\nStarting Gradle Daemon...\r\nGradle Daemon started in 1 s 520 ms\r\n\r\n> Task :processResources UP-TO-DATE\r\n> Task :quarkusGenerateCode UP-TO-DATE\r\n> Task :quarkusGenerateCodeDev UP-TO-DATE\r\n> Task :compileJava UP-TO-DATE\r\n> Task :classes UP-TO-DATE\r\n> Task :jar\r\n> Task :quarkusGenerateCodeTests UP-TO-DATE\r\n> Task :compileTestJava UP-TO-DATE\r\n> Task :processTestResources NO-SOURCE\r\n> Task :testClasses UP-TO-DATE\r\n> Task :compileIntegrationTestJava UP-TO-DATE\r\n> Task :processIntegrationTestResources NO-SOURCE\r\n> Task :integrationTestClasses UP-TO-DATE\r\n22.3.0.1-Final-java17: Pulling from quarkus/ubi-quarkus-mandrel\r\n...\r\nDigest: sha256:5f24fe7559dd5ed8f5765ea44de42395c7ae13f8ea48f75dd4ca3a67c3a91486\r\nStatus: Downloaded newer image for quay.io/quarkus/ubi-quarkus-mandrel:22.3.0.1-Final-java17\r\nquay.io/quarkus/ubi-quarkus-mandrel:22.3.0.1-Final-java17\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'health-server-undefined-runner' (executable)...\r\n========================================================================================================================\r\n[1/7] Initializing...                                                                                   (17.8s @ 0.31GB)\r\n Version info: 'GraalVM 22.3.0.1-Final Java 17 Mandrel Distribution'\r\n Java version info: '17.0.5+8'\r\n C compiler: gcc (redhat, x86_64, 8.5.0)\r\n Garbage collector: Serial GC\r\n 2 user-specific feature(s)\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n[2/7] Performing analysis...  [*******]                                                                 (46.7s @ 2.16GB)\r\n  12,258 (89.78%) of 13,653 classes reachable\r\n  17,695 (59.23%) of 29,876 fields reachable\r\n  62,061 (56.41%) of 110,018 methods reachable\r\n     585 classes,   136 fields, and 2,960 methods registered for reflection\r\n      63 classes,    68 fields, and    55 methods registered for JNI access\r\n       4 native libraries: dl, pthread, rt, z\r\n[3/7] Building universe...                                                                               (6.3s @ 4.51GB)\r\n[4/7] Parsing methods...      [**]                                                                       (4.2s @ 4.65GB)\r\n[5/7] Inlining methods...     [***]                                                                      (2.2s @ 2.83GB)\r\n[6/7] Compiling methods...    [******]                                                                  (32.5s @ 2.81GB)\r\n[7/7] Creating image...                                                                                  (5.2s @ 1.10GB)\r\n  22.93MB (47.92%) for code area:    40,468 compilation units\r\n  24.60MB (51.41%) for image heap:  303,638 objects and 17 resources\r\n 327.06KB ( 0.67%) for other data\r\n  47.84MB in total\r\n------------------------------------------------------------------------------------------------------------------------\r\nTop 10 packages in code area:                               Top 10 object types in image heap:\r\n   1.64MB sun.security.ssl                                     5.16MB byte[] for code metadata\r\n   1.05MB java.util                                            2.93MB java.lang.Class\r\n 741.65KB java.lang.invoke                                     2.77MB java.lang.String\r\n 718.51KB com.sun.crypto.provider                              2.52MB byte[] for general heap data\r\n 491.66KB io.netty.buffer                                      2.30MB byte[] for java.lang.String\r\n 472.69KB java.lang                                            1.03MB com.oracle.svm.core.hub.DynamicHubCompanion\r\n 450.59KB sun.security.x509                                  689.06KB java.util.HashMap$Node\r\n 422.53KB java.util.concurrent                               674.94KB byte[] for reflection metadata\r\n 413.01KB io.vertx.core.http.impl                            560.07KB byte[] for embedded resources\r\n 395.60KB java.io                                            546.27KB java.lang.String[]\r\n  15.93MB for 462 more packages                                4.72MB for 3029 more object types\r\n------------------------------------------------------------------------------------------------------------------------\r\n                        4.8s (3.9% of total time) in 36 GCs | Peak RSS: 5.86GB | CPU load: 5.79\r\n------------------------------------------------------------------------------------------------------------------------\r\nProduced artifacts:\r\n /project/health-server-undefined-runner (executable)\r\n /project/health-server-undefined-runner-build-output-stats.json (json)\r\n /project/health-server-undefined-runner-timing-stats.json (raw)\r\n /project/health-server-undefined-runner.build_artifacts.txt (txt)\r\n========================================================================================================================\r\nFinished generating 'health-server-undefined-runner' in 2m 0s.\r\nLOCALAPPDATA environment is invalid or missing\r\n> Task :quarkusAppPartsBuild FAILED\r\nFAILURE: Build failed with an exception.\r\n* What went wrong:\r\nExecution failed for task ':quarkusAppPartsBuild'.\r\n> There was a failure while executing work items\r\n   > A failure occurred while executing io.quarkus.gradle.tasks.worker.BuildWorker\r\n      > io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n        \t[error]: Build step io.quarkus.container.image.jib.deployment.JibProcessor#buildFromNative threw an exception: java.lang.RuntimeException: Unable to create container image\r\n        \tat io.quarkus.container.image.jib.deployment.JibProcessor.containerize(JibProcessor.java:255)\r\n        \tat io.quarkus.container.image.jib.deployment.JibProcessor.buildFromNative(JibProcessor.java:221)\r\n        \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n        \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n        \tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:909)\r\n        \tat io.quarkus.builder.BuildContext.run(BuildContext.java:282)\r\n        \tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n        \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n        \tat java.base/java.lang.Thread.run(Thread.java:833)\r\n        \tat org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\n        Caused by: com.google.cloud.tools.jib.api.CacheDirectoryCreationException: Could not create cache directory\r\n        \tat com.google.cloud.tools.jib.api.Containerizer.getApplicationLayersCacheDirectory(Containerizer.java:366)\r\n        \tat com.google.cloud.tools.jib.api.JibContainerBuilder.toBuildContext(JibContainerBuilder.java:728)\r\n        \tat com.google.cloud.tools.jib.api.JibContainerBuilder.containerize(JibContainerBuilder.java:604)\r\n        \tat io.quarkus.container.image.jib.deployment.JibProcessor.containerize(JibProcessor.java:248)\r\n        \t... 12 more\r\n        Caused by: java.nio.file.AccessDeniedException: C:\\WINDOWS\\jib-core-application-layers-cache\r\n        \tat java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:89)\r\n        \tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103)\r\n        \tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108)\r\n        \tat java.base/sun.nio.fs.WindowsFileSystemProvider.createDirectory(WindowsFileSystemProvider.java:521)\r\n        \tat java.base/java.nio.file.Files.createDirectory(Files.java:700)\r\n        \tat java.base/java.nio.file.Files.createAndCheckIsDirectory(Files.java:807)\r\n        \tat java.base/java.nio.file.Files.createDirectories(Files.java:793)\r\n        \tat com.google.cloud.tools.jib.api.Containerizer.getApplicationLayersCacheDirectory(Containerizer.java:364)\r\n        \t... 15 more\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n* Get more help at https://help.gradle.org\r\nBUILD FAILED in 3m 10s\r\n9 actionable tasks: 2 executed, 7 up-to-date\r\n\r\n```\r\n\r\nOn the github runners:\r\n```\r\nStarting a Gradle Daemon (subsequent builds will be faster)\r\n> Task :processResources\r\n> Task :quarkusGenerateCode\r\n> Task :quarkusGenerateCodeDev\r\n> Task :compileJava\r\n> Task :classes\r\n> Task :jar\r\n> Task :quarkusGenerateCodeTests\r\n> Task :compileTestJava\r\n> Task :processTestResources NO-SOURCE\r\n> Task :testClasses\r\n> Task :compileIntegrationTestJava\r\n> Task :processIntegrationTestResources NO-SOURCE\r\n> Task :integrationTestClasses\r\n22.3.0.1-Final-java17: Pulling from quarkus/ubi-quarkus-mandrel\r\nDigest: sha256:5f24fe7559dd5ed8f5765ea44de42395c7ae13f8ea[48](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:50)f75dd4ca3a67c3a91486\r\nStatus: Image is up to date for quay.io/quarkus/ubi-quarkus-mandrel:22.3.0.1-Final-java17\r\nquay.io/quarkus/ubi-quarkus-mandrel:22.3.0.1-Final-java17\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'health-server-undefined-runner' (executable)...\r\n========================================================================================================================\r\n[1/7] Initializing...                                                                                   (10.3s @ 0.32GB)\r\n Version info: 'GraalVM 22.3.0.1-Final Java 17 Mandrel Distribution'\r\n Java version info: '17.0.5+8'\r\n C compiler: gcc (redhat, x86_64, 8.5.0)\r\n Garbage collector: Serial GC\r\n 2 user-specific feature(s)\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n> Task :quarkusAppPartsBuild\r\n\r\n[2/7] Performing analysis...  [******]                                                                 (116.3s @ 2.22GB)\r\n  12,252 (89.78%) of 13,647 classes reachable\r\n  17,695 (59.23%) of 29,876 fields reachable\r\n  62,0[49](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:51) (56.41%) of 110,001 methods reachable\r\n     579 classes,   136 fields, and 2,954 methods registered for reflection\r\n      63 classes,    68 fields, and    55 methods registered for JNI access\r\n       4 native libraries: dl, pthread, rt, z\r\n[3/7] Building universe...                                                                              (15.8s @ 1.65GB)\r\n[4/7] Parsing methods...      [****]                                                                    (13.4s @ 2.46GB)\r\n[5/7] Inlining methods...     [***]                                                                      (7.3s @ 1.31GB)\r\n[6/7] Compiling methods...    [**********]                                                              (98.7s @ 1.36GB)\r\n[7/7] Creating image...                                                                                  (6.9s @ 2.11GB)\r\n  22.92MB (47.92%) for code area:    40,462 compilation units\r\n  24.59MB (51.41%) for image heap:  302,027 objects and 17 resources\r\n 328.64KB ( 0.67%) for other data\r\n  47.84MB in total\r\n------------------------------------------------------------------------------------------------------------------------\r\nTop 10 packages in code area:                               Top 10 object types in image heap:\r\n   1.64MB sun.security.ssl                                     5.16MB byte[] for code metadata\r\n   1.05MB java.util                                            2.92MB java.lang.Class\r\n 740.89KB java.lang.invoke                                     2.76MB java.lang.String\r\n 718.[50](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:52)KB com.sun.crypto.provider                              2.[51](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:53)MB byte[] for general heap data\r\n 491.83KB io.netty.buffer                                      2.29MB byte[] for java.lang.String\r\n 472.72KB java.lang                                            1.03MB com.oracle.svm.core.hub.DynamicHubCompanion\r\n 450.59KB sun.security.x509                                  697.92KB java.util.HashMap$Node\r\n 422.44KB java.util.concurrent                               674.[54](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:56)KB byte[] for reflection metadata\r\n 412.95KB io.vertx.core.http.impl                            560.07KB byte[] for embedded resources\r\n 395.58KB java.io                                            540.70KB java.lang.String[]\r\n  15.93MB for 462 more packages                                4.68MB for 3028 more object types\r\n------------------------------------------------------------------------------------------------------------------------\r\n                        13.5s (4.9% of total time) in [55](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:57) GCs | Peak RSS: 3.38GB | CPU load: 1.[92](https://github.com/QUMEA/health-server/actions/runs/4609842386/jobs/8147536859?pr=45#step:7:94)\r\n------------------------------------------------------------------------------------------------------------------------\r\nProduced artifacts:\r\n /project/health-server-undefined-runner (executable)\r\n /project/health-server-undefined-runner-build-output-stats.json (json)\r\n /project/health-server-undefined-runner-timing-stats.json (raw)\r\n /project/health-server-undefined-runner.build_artifacts.txt (txt)\r\n========================================================================================================================\r\nFinished generating 'health-server-undefined-runner' in 4m 36s.\r\nBase image 'quay.io/quarkus/quarkus-micro-image:2.0' does not use a specific image digest - build may not be reproducible\r\n\r\n> Task :quarkusAppPartsBuild FAILED\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':quarkusAppPartsBuild'.\r\n> There was a failure while executing work items\r\n   > A failure occurred while executing io.quarkus.gradle.tasks.worker.BuildWorker\r\n      > java.lang.NullPointerException (no error message)\r\n\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n```\n\n### Expected behavior\n\nJust works as with quarkus 2.x\n\n### Actual behavior\n\n_No response_\n\n### How to Reproduce?\n\nTry to build and run native quarkusIntTest together with the `io.quarkus:quarkus-container-image-jib` extension\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n17\n\n### GraalVM version (if different from Java)\n\n22.3.0.1\n\n### Quarkus version or git rev\n\n3.0.0.CR1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nGradle 8.0\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32418/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
