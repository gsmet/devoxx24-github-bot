{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41315",
  "id": 2362720763,
  "node_id": "I_kwDOCFbutM6M1EH7",
  "number": 41315,
  "title": "Accessing a management endpoint after a live reload leads to an exception (when Hibernate Search Standalone mapper is used)",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1664142960,
      "node_id": "MDU6TGFiZWwxNjY0MTQyOTYw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-search",
      "name": "area/hibernate-search",
      "color": "0366d6",
      "default": false,
      "description": "Hibernate Search / Elasticsearch"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/335",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335/labels",
    "id": 11174659,
    "node_id": "MI_kwDOCFbutM4AqoMD",
    "number": 335,
    "title": "3.13.0.CR1",
    "description": "",
    "creator": {
      "login": "quarkusbot",
      "id": 61254497,
      "node_id": "MDQ6VXNlcjYxMjU0NDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/61254497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quarkusbot",
      "html_url": "https://github.com/quarkusbot",
      "followers_url": "https://api.github.com/users/quarkusbot/followers",
      "following_url": "https://api.github.com/users/quarkusbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/quarkusbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quarkusbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quarkusbot/subscriptions",
      "organizations_url": "https://api.github.com/users/quarkusbot/orgs",
      "repos_url": "https://api.github.com/users/quarkusbot/repos",
      "events_url": "https://api.github.com/users/quarkusbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quarkusbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 241,
    "state": "closed",
    "created_at": "2024-06-12T08:02:47Z",
    "updated_at": "2024-07-19T11:47:06Z",
    "due_on": null,
    "closed_at": "2024-07-17T11:55:13Z"
  },
  "comments": 3,
  "created_at": "2024-06-19T16:04:37Z",
  "updated_at": "2024-06-26T13:47:33Z",
  "closed_at": "2024-06-26T13:47:30Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nAccessing a management endpoint after a live reload leads to an exception. This issue occurs with https://github.com/quarkusio/search.quarkus.io, it was discovered while working on https://github.com/quarkusio/search.quarkus.io/pull/286.\n\n### Expected behavior\n\nAfter an app is reloaded -- management endpoints can be accessed without any issues.\n\n### Actual behavior\n\nAn exception occurs:\r\n\r\n```java\r\njava.lang.IllegalStateException: Failed to create indexes: Error creating synthetic bean [A3Pwpzj6LZ1U3ryq007Z-Hp-28Q]: java.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"m\" is null\r\n\tat io.quarkus.search.app.indexing.IndexingService.createIndexes(IndexingService.java:213)\r\n\tat io.quarkus.search.app.indexing.IndexingService.reindex(IndexingService.java:170)\r\n\tat io.quarkus.search.app.indexing.IndexingService_Subclass.reindex$$superforward(Unknown Source)\r\n\tat io.quarkus.search.app.indexing.IndexingService_Subclass$$function$$1.apply(Unknown Source)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:73)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:62)\r\n\tat io.quarkus.arc.impl.ActivateRequestContextInterceptor.invoke(ActivateRequestContextInterceptor.java:129)\r\n\tat io.quarkus.arc.impl.ActivateRequestContextInterceptor.aroundInvoke(ActivateRequestContextInterceptor.java:33)\r\n\tat io.quarkus.arc.impl.ActivateRequestContextInterceptor_Bean.intercept(Unknown Source)\r\n\tat io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:42)\r\n\tat io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:30)\r\n\tat io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:27)\r\n\tat io.quarkus.search.app.indexing.IndexingService_Subclass.reindex(Unknown Source)\r\n\tat io.quarkus.search.app.indexing.IndexingService.lambda$registerManagementRoutes$0(IndexingService.java:57)\r\n\tat io.vertx.ext.web.impl.BlockingHandlerDecorator.lambda$handle$0(BlockingHandlerDecorator.java:48)\r\n\tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$1(ContextImpl.java:191)\r\n\tat io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:279)\r\n\tat io.vertx.core.impl.ContextImpl.lambda$internalExecuteBlocking$2(ContextImpl.java:210)\r\n\tat io.vertx.core.impl.TaskQueue.run(TaskQueue.java:76)\r\n\tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2516)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2495)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1495)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:11)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:11)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:840)\r\nCaused by: jakarta.enterprise.inject.CreationException: Error creating synthetic bean [A3Pwpzj6LZ1U3ryq007Z-Hp-28Q]: java.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"m\" is null\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.doCreate(Unknown Source)\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.create(Unknown Source)\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.create(Unknown Source)\r\n\tat io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:119)\r\n\tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:38)\r\n\tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:35)\r\n\tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.c29(Unknown Source)\r\n\tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.computeIfAbsent(Unknown Source)\r\n\tat io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:35)\r\n\tat io.quarkus.arc.impl.ClientProxies.getApplicationScopedDelegate(ClientProxies.java:21)\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_ClientProxy.arc$delegate(Unknown Source)\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_ClientProxy.scope(Unknown Source)\r\n\tat io.quarkus.search.app.indexing.IndexingService.createIndexes(IndexingService.java:191)\r\n\t... 26 more\r\n\tSuppressed: jakarta.enterprise.inject.CreationException: Error creating synthetic bean [A3Pwpzj6LZ1U3ryq007Z-Hp-28Q]: java.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"m\" is null\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.doCreate(Unknown Source)\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.create(Unknown Source)\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.create(Unknown Source)\r\n\t\tat io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:119)\r\n\t\tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:38)\r\n\t\tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:35)\r\n\t\tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.c29(Unknown Source)\r\n\t\tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.computeIfAbsent(Unknown Source)\r\n\t\tat io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:35)\r\n\t\tat io.quarkus.arc.impl.ClientProxies.getApplicationScopedDelegate(ClientProxies.java:21)\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_ClientProxy.arc$delegate(Unknown Source)\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_ClientProxy.backend(Unknown Source)\r\n\t\tat io.quarkus.search.app.indexing.Rollover.client(Rollover.java:105)\r\n\t\tat io.quarkus.search.app.indexing.Rollover.recoverInconsistentAliases(Rollover.java:92)\r\n\t\tat io.quarkus.search.app.indexing.IndexingService.createIndexes(IndexingService.java:205)\r\n\t\t... 26 more\r\n\tCaused by: java.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"m\" is null\r\n\t\tat java.base/java.util.HashMap.putMapEntries(HashMap.java:495)\r\n\t\tat java.base/java.util.LinkedHashMap.<init>(LinkedHashMap.java:385)\r\n\t\tat io.quarkus.hibernate.search.standalone.elasticsearch.runtime.HibernateSearchStandaloneRecorder$1.apply(HibernateSearchStandaloneRecorder.java:110)\r\n\t\tat io.quarkus.hibernate.search.standalone.elasticsearch.runtime.HibernateSearchStandaloneRecorder$1.apply(HibernateSearchStandaloneRecorder.java:103)\r\n\t\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.createSynthetic(Unknown Source)\r\n\t\t... 41 more\r\nCaused by: java.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"m\" is null\r\n\tat java.base/java.util.HashMap.putMapEntries(HashMap.java:495)\r\n\tat java.base/java.util.LinkedHashMap.<init>(LinkedHashMap.java:385)\r\n\tat io.quarkus.hibernate.search.standalone.elasticsearch.runtime.HibernateSearchStandaloneRecorder$1.apply(HibernateSearchStandaloneRecorder.java:110)\r\n\tat io.quarkus.hibernate.search.standalone.elasticsearch.runtime.HibernateSearchStandaloneRecorder$1.apply(HibernateSearchStandaloneRecorder.java:103)\r\n\tat org.hibernate.search.mapper.pojo.standalone.mapping.SearchMapping_A3Pwpzj6LZ1U3ryq007Z-Hp-28Q_Synthetic_Bean.createSynthetic(Unknown Source)\r\n\t... 39 more\r\n```\n\n### How to Reproduce?\n\n1. Run a Quarkus app in dev mode\r\n2. Make some changes and save them so that the app is reloaded\r\n3. After the app is reloaded, trying to access a management endpoint results in an exception.\n\n### Output of `uname -a` or `ver`\n\nLinux fedora 6.8.11-200.fc39.x86_64 #1 SMP PREEMPT_DYNAMIC Sun May 26 20:05:41 UTC 2024 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"17.0.10\" 2024-01-16 OpenJDK Runtime Environment Temurin-17.0.10+7 (build 17.0.10+7) OpenJDK 64-Bit Server VM Temurin-17.0.10+7 (build 17.0.10+7, mixed mode, sharing)\n\n### Quarkus version or git rev\n\n3.11.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.3 (21122926829f1ead511c958d89bd2f672198ae9f)\n\n### Additional information\n\nI'm opening the issue as is so that we don't forget to investigate it. If someone else picks it up and has questions about reproducing it or running search.quarkus.io, feel free to ping me.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41315/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
