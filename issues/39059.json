{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/39059",
  "id": 2159166685,
  "node_id": "I_kwDOCFbutM6AskTd",
  "number": 39059,
  "title": "Exception in blocking graphql query is wrapped",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283619446,
      "node_id": "MDU6TGFiZWwxMjgzNjE5NDQ2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye",
      "name": "area/smallrye",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2234509819,
      "node_id": "MDU6TGFiZWwyMjM0NTA5ODE5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/graphql",
      "name": "area/graphql",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/313",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/313",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/313/labels",
    "id": 10643439,
    "node_id": "MI_kwDOCFbutM4Aomfv",
    "number": 313,
    "title": "3.8.2",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 43,
    "state": "closed",
    "created_at": "2024-03-05T18:50:21Z",
    "updated_at": "2024-03-07T12:48:57Z",
    "due_on": null,
    "closed_at": "2024-03-07T12:48:57Z"
  },
  "comments": 8,
  "created_at": "2024-02-28T14:57:19Z",
  "updated_at": "2024-03-05T18:53:16Z",
  "closed_at": "2024-03-01T08:38:33Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWith a blocking graphql query throwing an exception, the exception gets wrapped in an additional exception. Graphql specfic features do not work with this wrapped exception. For example, the error code is wrong and changed to `execution`.\r\n\r\nThe exception is thrown here, and we probably need to get the real exception somewhere around here.\r\n\r\nhttps://github.com/quarkusio/quarkus/blob/9f7a2cd79658cc0f303f27d2e431d5a8d108ef7c/extensions/smallrye-graphql/runtime/src/main/java/io/quarkus/smallrye/graphql/runtime/spi/datafetcher/QuarkusUniDataFetcher.java#L57\n\n### Expected behavior\n\nNon wrapped exception and correct error code in graphql response.\n\n### Actual behavior\n\nException from application gets wrapped in other exception, disabling graphql specific features like error code.\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n```\r\n{\r\n  \"timestamp\":\"2024-02-28T14:36:37.817379492Z\",\r\n  \"sequence\":68739,\r\n  \"loggerClassName\":\"io.smallrye.graphql.SmallRyeGraphQLServerLogging_$logger\",\r\n  \"loggerName\":\"io.smallrye.graphql\",\r\n  \"level\":\"ERROR\",\r\n  \"message\":\"SRGQL012000: Data Fetching Error\",\r\n  \"threadName\":\"vert.x-eventloop-thread-4\",\r\n  \"threadId\":48,\r\n  \"mdc\":{ },\r\n  \"ndc\":\"\",\r\n  \"hostName\":\"product-service-8544bdc687-dqhgt\",\r\n  \"processName\":\"quarkus-run.jar\",\r\n  \"processId\":1,\r\n  \"exception\":{\r\n    \"refId\":1,\r\n    \"exceptionType\":\"java.util.concurrent.ExecutionException\",\r\n    \"message\":\"de.mobilexag.serviceplatform.permission.PermissionException: Permissions not sufficient\",\r\n    \"frames\":[\r\n      {\r\n        \"class\":\"java.util.concurrent.CompletableFuture\",\r\n        \"method\":\"reportGet\",\r\n        \"line\":396\r\n      },\r\n      {\r\n        \"class\":\"java.util.concurrent.CompletableFuture\",\r\n        \"method\":\"get\",\r\n        \"line\":2073\r\n      },\r\n      {\r\n        \"class\":\"io.smallrye.context.CompletableFutureWrapper\",\r\n        \"method\":\"get\",\r\n        \"line\":148\r\n      },\r\n      {\r\n        \"class\":\"io.quarkus.smallrye.graphql.runtime.spi.datafetcher.QuarkusUniDataFetcher\",\r\n        \"method\":\"lambda$handleUserMethodCallBlocking$0\",\r\n        \"line\":57\r\n      },\r\n      {\r\n        \"class\":\"io.smallrye.context.impl.wrappers.SlowContextualCallable\",\r\n        \"method\":\"call\",\r\n        \"line\":21\r\n      },\r\n      {\r\n        \"class\":\"io.vertx.core.impl.ContextImpl\",\r\n        \"method\":\"lambda$executeBlocking$0\",\r\n        \"line\":177\r\n      },\r\n      {\r\n        \"class\":\"io.vertx.core.impl.ContextInternal\",\r\n        \"method\":\"dispatch\",\r\n        \"line\":276\r\n      },\r\n      {\r\n        \"class\":\"io.vertx.core.impl.ContextImpl\",\r\n        \"method\":\"lambda$internalExecuteBlocking$2\",\r\n        \"line\":209\r\n      },\r\n      {\r\n        \"class\":\"io.vertx.core.impl.TaskQueue\",\r\n        \"method\":\"run\",\r\n        \"line\":76\r\n      },\r\n      {\r\n        \"class\":\"io.quarkus.vertx.core.runtime.VertxCoreRecorder$14\",\r\n        \"method\":\"runWith\",\r\n        \"line\":582\r\n      },\r\n      {\r\n        \"class\":\"org.jboss.threads.EnhancedQueueExecutor$Task\",\r\n        \"method\":\"run\",\r\n        \"line\":2513\r\n      },\r\n      {\r\n        \"class\":\"org.jboss.threads.EnhancedQueueExecutor$ThreadBody\",\r\n        \"method\":\"run\",\r\n        \"line\":1538\r\n      },\r\n      {\r\n        \"class\":\"org.jboss.threads.DelegatingRunnable\",\r\n        \"method\":\"run\",\r\n        \"line\":29\r\n      },\r\n      {\r\n        \"class\":\"org.jboss.threads.ThreadLocalResettingRunnable\",\r\n        \"method\":\"run\",\r\n        \"line\":29\r\n      },\r\n      {\r\n        \"class\":\"io.netty.util.concurrent.FastThreadLocalRunnable\",\r\n        \"method\":\"run\",\r\n        \"line\":30\r\n      },\r\n      {\r\n        \"class\":\"java.lang.Thread\",\r\n        \"method\":\"run\",\r\n        \"line\":1583\r\n      }\r\n    ],\r\n    \"causedBy\":{\r\n      \"exception\":{\r\n        \"refId\":2,\r\n        \"exceptionType\":\"de.mobilexag.serviceplatform.permission.PermissionException\",\r\n        \"message\":\"Permissions not sufficient\",\r\n      ...\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39059/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
