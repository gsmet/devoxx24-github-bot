{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/37463",
  "id": 2021344482,
  "node_id": "I_kwDOCFbutM54e0Ti",
  "number": 37463,
  "title": "Docs: security-oidc-bearer-token-authentication guide",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1218486975,
      "node_id": "MDU6TGFiZWwxMjE4NDg2OTc1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/documentation",
      "name": "area/documentation",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1282139374,
      "node_id": "MDU6TGFiZWwxMjgyMTM5Mzc0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/security",
      "name": "area/security",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/288",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288/labels",
    "id": 10189838,
    "node_id": "MI_kwDOCFbutM4Am3wO",
    "number": 288,
    "title": "3.7.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 432,
    "state": "closed",
    "created_at": "2023-11-15T08:06:53Z",
    "updated_at": "2024-05-17T12:27:49Z",
    "due_on": null,
    "closed_at": "2024-01-17T13:52:08Z"
  },
  "comments": 4,
  "created_at": "2023-12-01T17:57:12Z",
  "updated_at": "2023-12-21T16:46:18Z",
  "closed_at": "2023-12-21T16:46:14Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nGoing through the [security-oidc-bearer-token-authentication](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication) guide I found some issues.\r\n1. Links:\r\n  \\- `OIDC authorization code flow authentication` should be https://quarkus.io/version/main/guides/security-oidc-code-flow-authentication-tutorial\r\n  \\- Reference `Protect service applications by using OIDC Bearer token authentication` is there 2 times and one link show 404\r\n2. It would be nice to mention that some of the snippets are from quickstart or Quarkus tests. As this can be for user nicer to just look if they are not sure what all should be set. I will mention this in some points in this issue. My point on this is that if we have it somewhere in Quarkus managed repository it can be linked.  And part of this point is that it can be said here is quickstart and you can extend by some of these snippets.\r\n3. [Token Claims And SecurityIdentity Roles\r\n](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#token-claims-and-security-identity-roles) Would be nice to have some showcase for example with existing quickstart. How would the `application.properties` would look with token claims.\r\n4. [Token scopes And SecurityIdentity permissions](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#token-scopes-and-security-identity-permissions) code snippet missing the import of List. Also missing where is the Order class , how it should look. Search it in `quarkusio` organisation and didn't find anything. [Search](https://github.com/search?q=org%3Aquarkusio+%22listOrders%22&type=code). Maybe it's not needed in this snippet at all.\r\n5. [JSON Web Token Claim Verification](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#jwt-claim-verification) snippet missing import of `jakarta.ws.rs.core.Response`\r\n6. [Single page applications](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#single-page-applications) snippet no longer work with keycloak 22+ see [this](https://github.com/keycloak/keycloak/blob/main/docs/documentation/release_notes/topics/22_0_0.adoc#legacy-promise-api-removed)\r\n7. [Testing](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing) In general I would move part of the testing to [security-oidc-bearer-token-authentication-tutorial](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication-tutorial) as some of the showcase is part of the solution for that tutorial ([quickstart for it](https://github.com/quarkusio/quarkus-quickstarts/tree/main/security-openid-connect-quickstart/src/test/java/org/acme/security/openid/connect)). Specifically  [Dev Services for Keycloak](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-keycloak-devservices) section. Think it base on this quickstart.\r\n8. [Wiremock](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-wiremock)\r\n\\- `BearerTokenAuthorizationTest` missing static import `org.hamcrest.Matchers.equalTo`.\r\n\\- In this section can be said that it can extended the quickstart with some modification as `application.properties`\r\n10. [OidcTestClient](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-oidc-test-client) missing definition of `client`. Probably it should be `oidcTestClient`. After that modification I have been unable to still run this test but probably some misconfiguration on my side. Error was `io.vertx.core.json.DecodeException: Failed to decode:Unexpected character ('<' (code 60)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false')`. \r\n11. [KeycloakTestResourceLifecycleManager](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-keycloak)\r\n\\- Unused import `org.hamcrest.Matchers`. \r\n\\- The `RestAssured.given().auth().oauth2(getAccessToken(\"alice\"))))` have more bracket then expected should be 2 less bracket at the end.\r\n\\- how should be `/api/users/preferredUserName` setup. There would be nice to have link to the [UserResource](https://github.com/quarkusio/quarkus/blob/main/integration-tests/oidc/src/main/java/io/quarkus/it/keycloak/UsersResource.java) where it is setup.\r\n12. [Local Public Key](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-public-key) for showcase purpose it would be nice to add link to [privateKey.pem](https://github.com/quarkusio/quarkus/tree/main/integration-tests/oidc-tenancy/src/main/resources) as it say to get it from `integration-tests/oidc-tenancy`.\r\n13. [TestSecurity annotation](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#integration-testing-security-annotation)\r\n\\- In `TestSecurityAuthTest` snippet is import `io.quarkus.test.security.oidc.ConfigMetadata`. It's not exist, looking on older Quarkus version probably this never exist + this import is never used in snippet. \r\n\\- Both `ProtectedResource` snippets missing some imports [1].\r\n14. [Authentication after HTTP request has completed](https://quarkus.io/version/main/guides/security-oidc-bearer-token-authentication#authentication-after-http-request-has-completed)\r\n\\- `OrderResource` missing `jakarta.ws.rs.HeaderParam` import\r\n\\- In both snippets is Product class. Not exactly know what structure should this class have. It should be [this one](https://github.com/quarkusio/quarkus/blob/main/integration-tests/oidc-wiremock/src/main/java/io/quarkus/it/keycloak/Product.java) so maybe some link to this class or link to this set of test for more info would be nice.\r\n\\- `OrderService` missing the variable name for `SecurityIdentity`.\r\n\r\nPersonally thinking that the import should be there or the snippets shouldn't have any imports. Missing them is not a big deal but mention them here. For the point number 6. there should be probably decision which keycloak to mention in docs as in some guides is mention keycloak 17+ which will be working but for example the point 6 won't be working.\r\n\r\n\r\n[1] Missing imports\r\n```\r\nimport io.quarkus.security.Authenticated;\r\nimport jakarta.inject.Inject;\r\nimport jakarta.ws.rs.GET;\r\nimport jakarta.ws.rs.Path;\r\n```\n\n### Expected behavior\n\n_No response_\n\n### Actual behavior\n\n_No response_\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37463/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
