{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/35866",
  "id": 1891979432,
  "node_id": "I_kwDOCFbutM5wxVCo",
  "number": 35866,
  "title": "Automatic TLS support in new Vert.x based open telemetry implementation",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2236031412,
      "node_id": "MDU6TGFiZWwyMjM2MDMxNDEy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/tracing",
      "name": "area/tracing",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/273",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/273",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/273/labels",
    "id": 9889573,
    "node_id": "MI_kwDOCFbutM4Alucl",
    "number": 273,
    "title": "3.4.0",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 19,
    "state": "closed",
    "created_at": "2023-09-06T06:54:11Z",
    "updated_at": "2023-10-31T13:25:07Z",
    "due_on": null,
    "closed_at": "2023-09-13T15:14:57Z"
  },
  "comments": 2,
  "created_at": "2023-09-12T08:40:15Z",
  "updated_at": "2023-09-22T11:49:48Z",
  "closed_at": "2023-09-12T11:04:22Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWe have a quarkus application with open telemetry enabled, using an https OLTP endpoint for exporting traces. \r\nUp until Quarkus 3.2.x, the OkHttp-based implementation was handling TLS connections automatically without requiring any special configuration.\r\nOnce we upgraded to the 3.3.x branch, we started getting the following error when otel was attempting to export the traces:\r\n\r\n```\r\nFailed to export spans. The request could not be executed. Full error message: Failed to create SSL connection: javax.net.ssl.SSLHandshakeException: Failed to create SSL connection\r\n        at io.vertx.core.net.impl.ChannelProvider$1.userEventTriggered(ChannelProvider.java:127)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeUserEventTriggered(AbstractChannelHandlerContext.java:400)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeUserEventTriggered(AbstractChannelHandlerContext.java:376)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireUserEventTriggered(AbstractChannelHandlerContext.java:368)\r\n        at io.netty.handler.ssl.SslHandler.handleUnwrapThrowable(SslHandler.java:1270)\r\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1251)\r\n        at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1295)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: java.lang.RuntimeException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\r\n        at java.base/sun.security.validator.PKIXValidator.<init>(PKIXValidator.java:101)\r\n        at java.base/sun.security.validator.Validator.getInstance(Validator.java:181)\r\n        at java.base/sun.security.ssl.X509TrustManagerImpl.getValidator(X509TrustManagerImpl.java:309)\r\n        at java.base/sun.security.ssl.X509TrustManagerImpl.checkTrustedInit(X509TrustManagerImpl.java:183)\r\n        at java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:255)\r\n        at java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:144)\r\n        at java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.checkServerCerts(CertificateMessage.java:1335)\r\n        at java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.onConsumeCertificate(CertificateMessage.java:1232)\r\n        at java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.consume(CertificateMessage.java:1175)\r\n        at java.base/sun.security.ssl.SSLHandshake.consume(SSLHandshake.java:396)\r\n        at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:480)\r\n        at java.base/sun.security.ssl.SSLEngineImpl$DelegatedTask$DelegatedAction.run(SSLEngineImpl.java:1277)\r\n        at java.base/sun.security.ssl.SSLEngineImpl$DelegatedTask$DelegatedAction.run(SSLEngineImpl.java:1264)\r\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:712)\r\n        at java.base/sun.security.ssl.SSLEngineImpl$DelegatedTask.run(SSLEngineImpl.java:1209)\r\n        at io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1559)\r\n        at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1405)\r\n        at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1246)\r\n        ... 20 more\r\nCaused by: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\r\n        at java.base/java.security.cert.PKIXParameters.setTrustAnchors(PKIXParameters.java:200)\r\n        at java.base/java.security.cert.PKIXParameters.<init>(PKIXParameters.java:120)\r\n        at java.base/java.security.cert.PKIXBuilderParameters.<init>(PKIXBuilderParameters.java:104)\r\n        at java.base/sun.security.validator.PKIXValidator.<init>(PKIXValidator.java:98)\r\n        ... 37 more\r\n```\r\n\r\n(also reported in https://github.com/quarkusio/quarkus/issues/35786, but it turns out it was a different issue)\r\n\r\nI don't know if this is a bug report or a feature request, but Quarkus should be able to handle simple https OLTP endpoints without extra configuration.\n\n### Expected behavior\n\n_No response_\n\n### Actual behavior\n\n_No response_\n\n### How to Reproduce?\n\nUse the quick start project for OTEL: https://github.com/quarkusio/quarkus-quickstarts/tree/main/opentelemetry-quickstart\r\nset a dummy https OTLP endpoint, e.g.\r\n```\r\nquarkus.otel.exporter.otlp.traces.endpoint=https://github.com\r\n```\r\nhit `http://localhost:8080/hello` and you will get the error log\n\n### Output of `uname -a` or `ver`\n\nDarwin K4V32WY17P 22.6.0 Darwin Kernel Version 22.6.0: Wed Jul  5 22:22:05 PDT 2023; root:xnu-8796.141.3~6/RELEASE_ARM64_T6000 arm64\n\n### Output of `java -version`\n\nopenjdk version \"17.0.5\" 2022-10-18 LTS OpenJDK Runtime Environment Corretto-17.0.5.8.1 (build 17.0.5+8-LTS) OpenJDK 64-Bit Server VM Corretto-17.0.5.8.1 (build 17.0.5+8-LTS, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.3.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35866/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
