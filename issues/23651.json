{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/23651",
  "id": 1135994208,
  "node_id": "I_kwDOCFbutM5DteVg",
  "number": 23651,
  "title": "Kubernetes deploy deletes load-balancer when service-type=load-balancer",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/239",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/239",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/239/labels",
    "id": 9130453,
    "node_id": "MI_kwDOCFbutM4Ai1HV",
    "number": 239,
    "title": "3.0.0.Alpha6",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 112,
    "state": "closed",
    "created_at": "2023-03-07T18:05:13Z",
    "updated_at": "2023-05-11T07:01:41Z",
    "due_on": null,
    "closed_at": "2023-03-15T12:48:12Z"
  },
  "comments": 7,
  "created_at": "2022-02-13T15:14:54Z",
  "updated_at": "2023-03-10T13:20:52Z",
  "closed_at": "2023-03-10T13:20:48Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nUp to quarkus 2.1.1, when  deploying to gke  with \r\n`quarkus.kubernetes.service-type=load-balancer`  the behaviour was as expected but after upgrading to 2.7.1 it started deleting already deployed services and load-balancers\r\n\r\nif no workload service is defined then the service is created and a load-balancer gets configured with a  new IP address\r\n\r\nWhen moving to quarkus 2.7.1 (and likely earlier versions) then the behaviour is this\r\n\r\nif a service was defined then delete the service.\r\n\r\nThis leaves the deploy without a load-balancer. To get one you have to deploy twice. However, completely deleting the service now causes a new IP to get assigned (because deploying twice does work), albeit with a warning saying that it couldn't find anything to delete. \r\n\r\n\r\n\r\n\n\n### Expected behavior\n\nDeploy to kubernetes with  `quarkus.kubernetes.service-type=load-balancer` and \r\ncrete service and load-balancer only if it's not available (and don't delete existing ones)\n\n### Actual behavior\n\nThe latest version deletes deployed services and loadbalancers causing the application to be unavailable during redeploys and also causing the newly deployed loadbalancer to acquire an new ip address. This happens because GKE thinks that this is a completely fresh service (and lb) since everything was deleted. \r\n\r\nThe behaviour for  node-port  however, `quarkus.kubernetes.service-type=node-port' ,  seems to be still OK\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23651/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
