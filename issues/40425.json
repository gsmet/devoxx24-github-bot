{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/40425",
  "id": 2276645131,
  "node_id": "I_kwDOCFbutM6HstkL",
  "number": 40425,
  "title": "Hibernate bumps to leads to NPE when using identity generation and batching inserts",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026509,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/persistence",
      "name": "area/persistence",
      "color": "FBCA04",
      "default": false,
      "description": "OBSOLETE, DO NOT USE"
    },
    {
      "id": 2122256208,
      "node_id": "MDU6TGFiZWwyMTIyMjU2MjA4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-reactive",
      "name": "area/hibernate-reactive",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/329",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/329",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/329/labels",
    "id": 11056804,
    "node_id": "MI_kwDOCFbutM4AqLak",
    "number": 329,
    "title": "3.12.0.CR1",
    "description": "",
    "creator": {
      "login": "quarkusbot",
      "id": 61254497,
      "node_id": "MDQ6VXNlcjYxMjU0NDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/61254497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quarkusbot",
      "html_url": "https://github.com/quarkusbot",
      "followers_url": "https://api.github.com/users/quarkusbot/followers",
      "following_url": "https://api.github.com/users/quarkusbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/quarkusbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quarkusbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quarkusbot/subscriptions",
      "organizations_url": "https://api.github.com/users/quarkusbot/orgs",
      "repos_url": "https://api.github.com/users/quarkusbot/repos",
      "events_url": "https://api.github.com/users/quarkusbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quarkusbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 195,
    "state": "closed",
    "created_at": "2024-05-15T09:27:54Z",
    "updated_at": "2024-07-04T18:19:16Z",
    "due_on": null,
    "closed_at": "2024-06-12T11:16:44Z"
  },
  "comments": 22,
  "created_at": "2024-05-02T23:08:07Z",
  "updated_at": "2024-06-03T10:56:03Z",
  "closed_at": "2024-06-03T10:56:03Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nAfter https://github.com/quarkusio/quarkus/pull/40102 our app has NPEs and constrain validation failures for values that are clearly within limit.\n\n### Expected behavior\n\nNo NPE, no validation failure.\n\n### Actual behavior\n\n```\r\n00:44:00,489 INFO  [app] org.hibernate.HibernateException: java.lang.NullPointerException: Cannot invoke \"java.util.concurrent.CompletionStage.toCompletableFuture()\" because the return value of \"java.util.function.Function.apply(Object)\" is null\r\n00:44:00,490 INFO  [app] \tat org.hibernate.reactive.session.impl.ReactiveExceptionConverter.convert(ReactiveExceptionConverter.java:28)\r\n00:44:00,490 INFO  [app] \tat org.hibernate.reactive.session.impl.ReactiveSessionImpl.lambda$doFlush$27(ReactiveSessionImpl.java:988)\r\n00:44:00,491 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:934)\r\n00:44:00,491 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:911)\r\n00:44:00,492 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\n00:44:00,492 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2194)\r\n00:44:00,493 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline$TrampolineInternal.lambda$unroll$0(AsyncTrampoline.java:123)\r\n00:44:00,494 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\r\n00:44:00,494 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\r\n00:44:00,495 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\n00:44:00,495 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179)\r\n00:44:00,496 INFO  [app] \tat io.vertx.core.Future.lambda$toCompletionStage$3(Future.java:581)\r\n00:44:00,496 INFO  [app] \tat io.vertx.core.impl.future.FutureImpl$4.onSuccess(FutureImpl.java:176)\r\n00:44:00,497 INFO  [app] \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:66)\r\n00:44:00,497 INFO  [app] \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:259)\r\n00:44:00,498 INFO  [app] \tat io.vertx.sqlclient.impl.QueryResultBuilder.tryComplete(QueryResultBuilder.java:88)\r\n00:44:00,498 INFO  [app] \tat io.vertx.sqlclient.impl.QueryResultBuilder.tryComplete(QueryResultBuilder.java:32)\r\n00:44:00,498 INFO  [app] \tat io.vertx.core.Promise.complete(Promise.java:66)\r\n00:44:00,499 INFO  [app] \tat io.vertx.core.Promise.handle(Promise.java:51)\r\n00:44:00,499 INFO  [app] \tat io.vertx.core.Promise.handle(Promise.java:29)\r\n00:44:00,500 INFO  [app] \tat io.vertx.core.impl.future.FutureImpl$4.onSuccess(FutureImpl.java:176)\r\n00:44:00,500 INFO  [app] \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:66)\r\n00:44:00,501 INFO  [app] \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:259)\r\n00:44:00,501 INFO  [app] \tat io.vertx.core.impl.future.PromiseImpl.onSuccess(PromiseImpl.java:49)\r\n00:44:00,501 INFO  [app] \tat io.vertx.core.impl.future.PromiseImpl.handle(PromiseImpl.java:41)\r\n00:44:00,502 INFO  [app] \tat io.vertx.sqlclient.impl.TransactionImpl.lambda$wrap$0(TransactionImpl.java:72)\r\n00:44:00,502 INFO  [app] \tat io.vertx.core.impl.future.FutureImpl$4.onSuccess(FutureImpl.java:176)\r\n00:44:00,503 INFO  [app] \tat io.vertx.core.impl.future.FutureBase.lambda$emitSuccess$0(FutureBase.java:60)\r\n00:44:00,503 INFO  [app] \tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\r\n00:44:00,504 INFO  [app] \tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\r\n00:44:00,504 INFO  [app] \tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n00:44:00,504 INFO  [app] \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n00:44:00,505 INFO  [app] \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n00:44:00,505 INFO  [app] \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n00:44:00,506 INFO  [app] \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n00:44:00,506 INFO  [app] \tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n00:44:00,507 INFO  [app] Caused by: java.lang.NullPointerException: Cannot invoke \"java.util.concurrent.CompletionStage.toCompletableFuture()\" because the return value of \"java.util.function.Function.apply(Object)\" is null\r\n00:44:00,507 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150)\r\n00:44:00,508 INFO  [app] \t... 27 more\r\n```\r\n\r\n```\r\n00:41:52,230 INFO  [app] Caused by: jakarta.validation.ConstraintViolationException: Validation failed for classes [io.quarkus.ts.hibernate.reactive.database.Author] during persist time for groups [jakarta.validation.groups.Default, ]\r\n00:41:52,230 INFO  [app] List of constraint violations:[\r\n00:41:52,230 INFO  [app] \tConstraintViolationImpl{interpolatedMessage='size must be between 0 and 10', propertyPath=name, rootBeanClass=class io.quarkus.ts.hibernate.reactive.database.Author, messageTemplate='{jakarta.validation.constraints.Size.message}'}\r\n00:41:52,230 INFO  [app] ]\r\n00:41:52,230 INFO  [app] \tat org.hibernate.boot.beanvalidation.BeanValidationEventListener.validate(BeanValidationEventListener.java:151)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.boot.beanvalidation.BeanValidationEventListener.onPreInsert(BeanValidationEventListener.java:81)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.action.internal.EntityInsertAction.preInsert(EntityInsertAction.java:251)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.engine.impl.ReactiveEntityRegularInsertAction.reactiveExecute(ReactiveEntityRegularInsertAction.java:59)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.engine.impl.ReactiveEntityInsertActionHolder.reactiveExecute(ReactiveEntityInsertActionHolder.java:62)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.engine.ReactiveActionQueue.lambda$executeActions$9(ReactiveActionQueue.java:631)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.util.impl.CompletionStages.lambda$loop$7(CompletionStages.java:410)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.util.impl.CompletionStages$ArrayLoop.next(CompletionStages.java:484)\r\n00:41:52,230 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline.lambda$asyncWhile$1(AsyncTrampoline.java:215)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline$TrampolineInternal.unroll(AsyncTrampoline.java:121)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline$TrampolineInternal.trampoline(AsyncTrampoline.java:102)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline.asyncWhile(AsyncTrampoline.java:197)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.async.impl.AsyncTrampoline.asyncWhile(AsyncTrampoline.java:215)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.impl.CompletionStages.loop(CompletionStages.java:411)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.util.impl.CompletionStages.loop(CompletionStages.java:382)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.engine.ReactiveActionQueue.executeActions(ReactiveActionQueue.java:628)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.engine.ReactiveActionQueue.lambda$executeActions$7(ReactiveActionQueue.java:526)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:144)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.engine.ReactiveActionQueue.executeActions(ReactiveActionQueue.java:526)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.event.impl.AbstractReactiveFlushingEventListener.performExecutions(AbstractReactiveFlushingEventListener.java:63)\r\n00:41:52,231 INFO  [app] \tat org.hibernate.reactive.event.impl.DefaultReactiveFlushEventListener.lambda$reactiveOnFlush$0(DefaultReactiveFlushEventListener.java:42)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\r\n00:41:52,231 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:144)\r\n00:41:52,232 INFO  [app] \tat org.hibernate.reactive.event.impl.DefaultReactiveFlushEventListener.reactiveOnFlush(DefaultReactiveFlushEventListener.java:42)\r\n00:41:52,232 INFO  [app] \tat org.hibernate.event.service.internal.EventListenerGroupImpl.lambda$fireEventOnEachListener$0(EventListenerGroupImpl.java:153)\r\n00:41:52,232 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\r\n00:41:52,232 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\r\n00:41:52,232 INFO  [app] \tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:144)\r\n00:41:52,232 INFO  [app] \tat org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:153)\r\n00:41:52,232 INFO  [app] \tat org.hibernate.reactive.session.impl.ReactiveSessionImpl.doFlush(ReactiveSessionImpl.java:982)\r\n00:41:52,232 INFO  [app] \t... 117 more\r\n```\n\n### How to Reproduce?\n\n```\r\ngit clone git@github.com:quarkus-qe/quarkus-test-suite.git\r\ncd quarkus-test-suite/sql-db/hibernate-reactive\r\nmvn clean verify -Dreruns=0\r\n```\r\nThe app code transforms errors to 400, so you might need to tweak it for debugging.\n\n### Output of `uname -a` or `ver`\n\nFedora 38\n\n### Output of `java -version`\n\nOpenJDK 17\n\n### Quarkus version or git rev\n\n999-SNAPSHOT\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.4\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40425/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
