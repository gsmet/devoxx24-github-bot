{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41115",
  "id": 2346174243,
  "node_id": "I_kwDOCFbutM6L18cj",
  "number": 41115,
  "title": "Hibernate batch-fetching seems to be broken in some situations where it works with pure Hibernate",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026509,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/persistence",
      "name": "area/persistence",
      "color": "FBCA04",
      "default": false,
      "description": "OBSOLETE, DO NOT USE"
    },
    {
      "id": 1425555736,
      "node_id": "MDU6TGFiZWwxNDI1NTU1NzM2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-orm",
      "name": "area/hibernate-orm",
      "color": "0366d6",
      "default": false,
      "description": "Hibernate ORM"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/335",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335/labels",
    "id": 11174659,
    "node_id": "MI_kwDOCFbutM4AqoMD",
    "number": 335,
    "title": "3.13.0.CR1",
    "description": "",
    "creator": {
      "login": "quarkusbot",
      "id": 61254497,
      "node_id": "MDQ6VXNlcjYxMjU0NDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/61254497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quarkusbot",
      "html_url": "https://github.com/quarkusbot",
      "followers_url": "https://api.github.com/users/quarkusbot/followers",
      "following_url": "https://api.github.com/users/quarkusbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/quarkusbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quarkusbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quarkusbot/subscriptions",
      "organizations_url": "https://api.github.com/users/quarkusbot/orgs",
      "repos_url": "https://api.github.com/users/quarkusbot/repos",
      "events_url": "https://api.github.com/users/quarkusbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quarkusbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 241,
    "state": "closed",
    "created_at": "2024-06-12T08:02:47Z",
    "updated_at": "2024-07-19T11:47:06Z",
    "due_on": null,
    "closed_at": "2024-07-17T11:55:13Z"
  },
  "comments": 7,
  "created_at": "2024-06-11T11:29:16Z",
  "updated_at": "2024-06-19T07:29:45Z",
  "closed_at": "2024-06-18T16:14:02Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIt seems that any database query executed after the one that loads the entity makes \r\nthe entity no longer eligible for batch fetching of lazy associations or element collections.\n\n### Expected behavior\n\nBatch fetching should apply regardless of other queries being issued.\n\n### Actual behavior\n\nBatch fetching is not applied if a query - even an unrelated one - is issued after the entity is loaded.\n\n### How to Reproduce?\n\nClone https://github.com/lbilger/quarkus-hibernate-batch-fetch-reproducer and run `./mvnw test`. \r\n\r\nWatch the console output. The `ExampleEntityQuarkusTest` will fetch\r\nthe `anElementCollection` of each `ExampleEntity` individually, while the `ExampleEntityStandaloneTest` will\r\nfetch all in one batch.\n\n### Output of `uname -a` or `ver`\n\nDarwin xyz 22.6.0 Darwin Kernel Version 22.6.0: Tue Nov  7 21:42:24 PST 2023; root:xnu-8796.141.3.702.9~2/RELEASE_ARM64_T6020 arm64\n\n### Output of `java -version`\n\nopenjdk version \"21.0.2\" 2024-01-16 OpenJDK Runtime Environment GraalVM CE 21.0.2+13.1 (build 21.0.2+13-jvmci-23.1-b30) OpenJDK 64-Bit Server VM GraalVM CE 21.0.2+13.1 (build 21.0.2+13-jvmci-23.1-b30, mixed mode, sharing)\n\n### Quarkus version or git rev\n\n3.11.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.6 (bc0240f3c744dd6b6ec2920b3cd08dcc295161ae) Maven home: /Users/xyz/.m2/wrapper/dists/apache-maven-3.9.6-bin/3311e1d4/apache-maven-3.9.6 Java version: 21.0.2, vendor: GraalVM Community, runtime: /Library/Java/JavaVirtualMachines/graalvm-community-openjdk-21/Contents/Home Default locale: de_DE, platform encoding: UTF-8 OS name: \"mac os x\", version: \"13.6.3\", arch: \"aarch64\", family: \"mac\"\n\n### Additional information\n\nThis is _not_ related to native build. I'm not sure if the problem is in Quarkus or in Hibernate itself, but as the test shows, a pure Hibernate setup works. The only difference I can see except for Quarkus being involved is the transaction management (JTA in Quarkus vs. resource-local in the pure Hibernate setup).",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41115/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
