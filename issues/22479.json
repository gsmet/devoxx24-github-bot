{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/22479",
  "id": 1086978700,
  "node_id": "I_kwDOCFbutM5AyfqM",
  "number": 22479,
  "title": "Quarkus Quartz: Quarkus 1.13.x scheduler is not updated in DB when updated after upgrading to Quarkus 2.x",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1321590926,
      "node_id": "MDU6TGFiZWwxMzIxNTkwOTI2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/scheduler",
      "name": "area/scheduler",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/175",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175/labels",
    "id": 7698730,
    "node_id": "MI_kwDOCFbutM4AdXkq",
    "number": 175,
    "title": "2.7.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 159,
    "state": "closed",
    "created_at": "2022-02-21T12:59:08Z",
    "updated_at": "2022-05-12T16:40:04Z",
    "due_on": null,
    "closed_at": "2022-02-22T17:21:05Z"
  },
  "comments": 11,
  "created_at": "2021-12-22T16:14:22Z",
  "updated_at": "2022-02-21T17:01:03Z",
  "closed_at": "2022-02-21T08:57:58Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nHi everyone!\r\nSome months ago, some schedulers were created using Quarkus 1.13.x and were deployed to production. Everything worked fine. Some weeks ago, we had the need to update the cron job of one of the scheduler but found out that the scheduler was updated in local tests but not in production. Currently we're running Quarkus 2.5.1.\r\n\r\nAfter some digging in Quartz scheduler code, we found out that Quartz is not able to find the trigger because trigger name has changed from Quarkus 1.13.x to 2.x. \r\n\r\nThe query performed by Quartz is (from org.quartz.impl.jdbcjobstore.StdJDBCDelegate#selectTrigger)\r\n`\"SELECT * FROM QUARTZ_TRIGGERS WHERE SCHED_NAME = 'QuarkusQuartzScheduler' AND TRIGGER_NAME = ? AND TRIGGER_GROUP = ?\"`\r\n\r\nBelow one can see that the column `trigger_name` from `QUARTZ_TRIGGERS` table has different values when the schedulers are created in Quarkus 1.13.x and 2.5.1: _trigger was added to the identity of the scheduler \r\n\r\nQuarkus 1.13.7\r\n| sched_name             | trigger_name          | trigger_group                  | job_name              |\r\n|------------------------|-----------------------|--------------------------------|-----------------------|\r\n| QuarkusQuartzScheduler | executeDataRemoverJob_trigger | io.quarkus.scheduler.Scheduler | executeDataRemoverJob |\r\n| QuarkusQuartzScheduler | executeCalculationJob_trigger | io.quarkus.scheduler.Scheduler | executeCalculationJob |\r\n\r\nQuarkus 2.5.1\r\n| sched_name             | trigger_name          | trigger_group                  | job_name              |\r\n|------------------------|-----------------------|--------------------------------|-----------------------|\r\n| QuarkusQuartzScheduler | executeDataRemoverJob | io.quarkus.scheduler.Scheduler | executeDataRemoverJob |\r\n| QuarkusQuartzScheduler | executeCalculationJob | io.quarkus.scheduler.Scheduler | executeCalculationJob |\r\n\r\nWhen doing the query to find the trigger, none is found and no update is done. Since the job_name is the same, no new scheduler is created. Also we deleted one of the scheduler from the code but the trigger is still in the table. I think it's not deleted due to the same problem.\r\n\r\nI checked the migration guide to 2.x and I didn't see any mention about this changes in Quartz.\r\nCan you tell me if this is a known issue?\r\n\r\nI didn't yet try any workaround but I will try some solution and post it here. \n\n### Expected behavior\n\nSchedulers created with Quarkus 1.13.x should be updated when the update is done running the app with Quarkus 2.x.\n\n### Actual behavior\n\nSchedulers are not updated\n\n### How to Reproduce?\n\n1. create a Scheduler using Quarkus 1.13.x\r\n2. upgrade the app to Quarkus 2.5.1\r\n3. update the scheduler cron in the code\r\n4. start the app: scheduler still runs using the old cron (DB is not updated)\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\nopenjdk 11.0.11 2021-04-20 OpenJDK Runtime Environment AdoptOpenJDK-11.0.11+9 (build 11.0.11+9) OpenJDK 64-Bit Server VM AdoptOpenJDK-11.0.11+9 (build 11.0.11+9, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.5.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22479/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
