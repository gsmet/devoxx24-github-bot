{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/34448",
  "id": 1782714446,
  "node_id": "I_kwDOCFbutM5qQhBO",
  "number": 34448,
  "title": "Failure to pull non-cached deps during test launch with proxy private repository",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1520022286,
      "node_id": "MDU6TGFiZWwxNTIwMDIyMjg2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/bootstrap",
      "name": "area/bootstrap",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/261",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261/labels",
    "id": 9620417,
    "node_id": "MI_kwDOCFbutM4AksvB",
    "number": 261,
    "title": "3.2.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 137,
    "state": "closed",
    "created_at": "2023-07-05T15:27:44Z",
    "updated_at": "2023-08-07T13:21:27Z",
    "due_on": null,
    "closed_at": "2023-07-19T13:26:50Z"
  },
  "comments": 5,
  "created_at": "2023-06-30T15:19:51Z",
  "updated_at": "2023-07-05T15:41:51Z",
  "closed_at": "2023-07-04T03:27:19Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nQuarkus (3.x) fails to pull dependencies from a private repository during tests, with this error:\r\n\r\n```\r\nCaused by: org.apache.http.client.HttpResponseException: status code: 401, reason phrase: Unauthorized (401)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.handleStatus(HttpTransporter.java:527)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.execute(HttpTransporter.java:396)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.implGet(HttpTransporter.java:343)\r\n        at org.eclipse.aether.spi.connector.transport.AbstractTransporter.get(AbstractTransporter.java:64)\r\n        at org.eclipse.aether.connector.basic.BasicRepositoryConnector$GetTaskRunner.runTask(BasicRepositoryConnector.java:482)\r\n        at org.eclipse.aether.connector.basic.BasicRepositoryConnector$TaskRunner.run(BasicRepositoryConnector.java:414)\r\n        ... 67 more\r\n```\r\n\r\nThis happens if during the test launch, quarkus needs some extra dependency that maven couldn't resolve and cache (typically the `*-deployment` libraries).\r\n\r\nThe problem is because it tries to pull dependencies from repository defined in the settings.xml; but somehow misses the settings-security.xml setup. If explicitly providing such setup to maven, it works (similar problem can also be replicated in the IDEs)\r\n\r\nThe error is pretty obscure, because success or failure depends on having the dependency locally cached or not by just mere chance. So upgrading to a newer Quarkus version might make it fail (because of transitive dependency changes). This tipically hits pipelines quite hard and make usage of maven args or parameters mandatory in CI/CD and cumbersome for local dev. In CI/CD this can be overcome with workarounds such as `MAVEN_ARGS = \"-Dsettings.security=~/.m2/settings-security.xml\"` (if using maven >= 3.9).\r\n\r\nUsing pom.xml-> surefire config -> systemPropertyVariables -> `<settings.security>${settings.security}</settings.security>` doesn't work (looks like no system property used there works but /shrug)\r\n\r\nLink to reproducer that's just a copy of the `quarkus-quickstarts/getting-started:3.1.3.Final` [project ](https://github.com/quarkusio/quarkus-quickstarts/tree/main/getting-started).\r\n\r\nhttps://github.com/agseijas/maven-security-quarkus/blob/master/README.md\r\n\r\n\r\n### Expected behavior\r\n\r\nThe `GreetingResourceTest` test passes and the build ends successfully with maven\r\n\r\n### Actual behavior\r\n\r\nError pulling dependencies during test launch:\r\n\r\n```text\r\nCaused by: org.apache.http.client.HttpResponseException: status code: 401, reason phrase: Unauthorized (401)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.handleStatus(HttpTransporter.java:527)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.execute(HttpTransporter.java:396)\r\n        at org.eclipse.aether.transport.http.HttpTransporter.implGet(HttpTransporter.java:343)\r\n        at org.eclipse.aether.spi.connector.transport.AbstractTransporter.get(AbstractTransporter.java:64)\r\n        at org.eclipse.aether.connector.basic.BasicRepositoryConnector$GetTaskRunner.runTask(BasicRepositoryConnector.java:482)\r\n        at org.eclipse.aether.connector.basic.BasicRepositoryConnector$TaskRunner.run(BasicRepositoryConnector.java:414)\r\n        ... 67 more\r\n```\r\n\r\n\r\n### How to Reproduce?\r\n\r\nCheck the README file that explains the steps and tools setup needed to reproduce the issue:\r\n\r\nhttps://github.com/agseijas/maven-security-quarkus/blob/master/README.md\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"20.0.1\" 2023-04-18\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.1.3.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.3 (21122926829f1ead511c958d89bd2f672198ae9f)\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34448/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
