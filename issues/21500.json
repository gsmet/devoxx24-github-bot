{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21500",
  "id": 1055405809,
  "node_id": "I_kwDOCFbutM4-6Dbx",
  "number": 21500,
  "title": "OIDC `CodeAuthenticationMechanism` should not fail silently",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/158",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/158",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/158/labels",
    "id": 7346869,
    "node_id": "MI_kwDOCFbutM4AcBq1",
    "number": 158,
    "title": "2.6.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 238,
    "state": "closed",
    "created_at": "2021-11-10T17:24:12Z",
    "updated_at": "2022-01-01T18:29:17Z",
    "due_on": null,
    "closed_at": "2021-12-08T10:39:04Z"
  },
  "comments": 5,
  "created_at": "2021-11-16T21:57:18Z",
  "updated_at": "2021-11-18T13:15:04Z",
  "closed_at": "2021-11-18T13:15:01Z",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nWhen users are [redirected](https://quarkus.io/guides/security-openid-connect-web-authentication#redirection) back to Quarkus  after authentication, it's possible for their request to 'fail silently' (return a 401 with no body) if there's an issue calling the token endpoint. Because no body is returned, and errors are logged at `debug` level, it can be difficult to troubleshoot the 401.\r\n\r\nOne could argue that this doesn't need to be logged, but in my experience it's confusing to see a \"401\" and not be able to tell if it's coming from the application or the IdP.  I encountered this issue after following the [\"Using OpenID Connect (OIDC) to Protect Web Applications...\"](https://quarkus.io/guides/security-openid-connect-web-authentication) and accidentally setting `quarkus.oidc.secret` instead of `quarkus.oidc.credentials.secret`; it wasn't obvious that \"401\" mean \"error trying to authenticate because of invalid credentials\".\r\n```\r\n2021-11-16 16:29:25,837 DEBUG [io.qua.oid.run.OidcProviderClient] (vert.x-eventloop-thread-1) Request has failed: status: 401, error message: {\"error_description\":\"Invalid client or client credentials.\",\"error\":\"invalid_client\"}\r\n2021-11-16 16:29:25,837 DEBUG [io.qua.oid.run.CodeAuthenticationMechanism] (vert.x-eventloop-thread-1) Exception during the code to token exchange: {\"error_description\":\"Invalid client or client credentials.\",\"error\":\"invalid_client\"}\r\n```\r\n\r\n\r\n### Implementation ideas\r\n\r\nTwo potential ways to make this more obvious:\r\n1. Log failures at the `WARN` level instead of `DEBUG`\r\nhttps://github.com/quarkusio/quarkus/blob/2e8c6a869788339f4018779dbdd36867a6be4bd1/extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/CodeAuthenticationMechanism.java#L300\r\n2. (Any security concerns?) Include the body when an unexpected error occurs (not sure if there are security concerns for this)\r\n3. (May not be practical) Validate the quarkus configuration to check for a client secret... assuming all IdPs require one. :)\r\n4. (May not be practical) Return a `5xx` error if there's an unexpected authentication error. For example, Quarkus throws an error if you provide an invalid `auth-server-url`:\r\n    > io.quarkus.oidc.OIDCException: OIDC server is not available at the '...' URL. Please make sure it is correct.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21500/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
