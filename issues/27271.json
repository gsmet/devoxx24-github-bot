{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27271",
  "id": 1337531149,
  "node_id": "I_kwDOCFbutM5PuRsN",
  "number": 27271,
  "title": "org.graalvm.compiler.java.BytecodeParser$BytecodeParserError: java.lang.NullPointerException with SQLite",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-12T17:43:20Z",
  "updated_at": "2024-08-21T17:03:41Z",
  "closed_at": "2024-08-21T17:03:41Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nSmall application using Quarkus and SQLite causes a NPE in `org.graalvm.compiler.java.BytecodeParser ` and native application cannot be built.\r\n\r\nThis occurs on Windows 10. I found similar issues for Mac and Linux but they appear to have been resolved now.\r\n\r\n```\r\nC:\\work\\quarkus-sqlite-test>gradlew build -Dquarkus.package.type=native\r\nUber JAR strategy is used for native image source JAR generation on Windows. This is done for the time being to work around a current GraalVM limitation on Windows concerning the maximum command length (see https://github.com/oracle/graal/issues/2387).\r\nDependencies with duplicate files detected. The dependencies [org.glassfish:jakarta.el::jar:3.0.4[paths: C:\\Users\\Martyn\\.gradle\\caches\\modules-2\\files-2.1\\org.glassfish\\jakarta.el\\3.0.4\\f48473482c0e3e714f87186d9305bcae30b7f5cb\\jakarta.el-3.0.4.jar;], jakarta.el:jakarta.el-api::jar:3.0.3[paths: C:\\Users\\Martyn\\.gradle\\caches\\modules-2\\files-2.1\\jakarta.el\\jakarta.el-api\\3.0.3\\f311ab94bb1d4380690a53d737226a6b879dd4f1\\jakarta.el-api-3.0.3.jar;]] contain duplicate files, e.g. javax/el/StaticFieldELResolver.class\r\nDependencies with duplicate files detected. The dependencies [com.sun.activation:jakarta.activation::jar:1.2.1[paths: C:\\Users\\Martyn\\.gradle\\caches\\modules-2\\files-2.1\\com.sun.activation\\jakarta.activation\\1.2.1\\8013606426a73d8ba6b568370877251e91a38b89\\jakarta.activation-1.2.1.jar;], javax.activation:javax.activation-api::jar:1.2.0[paths: C:\\Users\\Martyn\\.gradle\\caches\\modules-2\\files-2.1\\javax.activation\\javax.activation-api\\1.2.0\\85262acf3ca9816f9537ca47d5adeabaead7cb16\\javax.activation-api-1.2.0.jar;]] contain duplicate files, e.g. javax/activation/ActivationDataFlavor.class\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'quarkus-sqlite-1.0-SNAPSHOT-runner'...\r\n========================================================================================================================\r\n[1/7] Initializing...                                                                                    (8.4s @ 0.26GB)\r\n Version info: 'GraalVM 22.0.0.2 Java 11 CE'\r\n 3 user-provided feature(s)\r\n  - io.quarkus.runner.AutoFeature\r\n  - io.quarkus.runtime.graal.DisableLoggingAutoFeature\r\n  - io.quarkus.runtime.graal.ResourcesFeature\r\n[2/7] Performing analysis...  [********]                                                                (41.2s @ 3.98GB)\r\n17:52:20,488 INFO  [org.joo.Constants]\r\n\r\njOOQ tip of the day: You don't have to register your Converters or Bindings with the code generator. You can use ad-hoc converters on any Field expression: https://www.jooq.org/doc/latest/manual/sql-execution/fetching/ad-hoc-converter/\r\n\r\n  18,982 (90.33%) of 21,015 classes reachable\r\n  30,737 (68.62%) of 44,796 fields reachable\r\n 104,829 (54.96%) of 190,731 methods reachable\r\n   1,046 classes,   521 fields, and 6,198 methods registered for reflection\r\n      94 classes,   104 fields, and   292 methods registered for JNI access\r\n[3/7] Building universe...                                                                               (2.8s @ 1.85GB)\r\n[4/7] Parsing methods...      [***]                                                                      (5.1s @ 1.97GB)\r\n\r\nFatal error: org.graalvm.compiler.java.BytecodeParser$BytecodeParserError: java.lang.NullPointerException\r\n        at parsing org.sqlite.BusyHandler.<init>(BusyHandler.java:10)\r\n        at method: void org.sqlite.BusyHandler.<init>()\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.throwParserError(BytecodeParser.java:2660)\r\n        at com.oracle.svm.hosted.phases.SharedGraphBuilderPhase$SharedBytecodeParser.throwParserError(SharedGraphBuilderPhase.java:106)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3521)\r\n        at com.oracle.svm.hosted.phases.HostedBytecodeParser.iterateBytecodesForBlock(HostedGraphBuilderPhase.java:196)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.handleBytecodeBlock(BytecodeParser.java:3473)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBlock(BytecodeParser.java:3318)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.build(BytecodeParser.java:1149)\r\n        at com.oracle.svm.hosted.phases.HostedBytecodeParser.build(HostedGraphBuilderPhase.java:140)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.buildRootMethod(BytecodeParser.java:1041)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.GraphBuilderPhase$Instance.run(GraphBuilderPhase.java:84)\r\n        at com.oracle.svm.hosted.phases.SharedGraphBuilderPhase.run(SharedGraphBuilderPhase.java:80)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.run(Phase.java:49)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.BasePhase.apply(BasePhase.java:214)\r\n------------------------------------------------------------------------------------------------------------------------\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:42)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:38)\r\n        at com.oracle.svm.hosted.code.CompileQueue.defaultParseFunction(CompileQueue.java:1030)\r\n        at com.oracle.svm.hosted.code.CompileQueue.doParse(CompileQueue.java:762)\r\n        at com.oracle.svm.hosted.code.CompileQueue$ParseTask.run(CompileQueue.java:337)\r\n        at com.oracle.graal.pointsto.util.CompletionExecutor.executeCommand(CompletionExecutor.java:195)\r\n        at com.oracle.graal.pointsto.util.CompletionExecutor.lambda$executeService$0(CompletionExecutor.java:179)\r\n        at java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1426)\r\n        at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)\r\n        at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)\r\n        at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)\r\n        at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)\r\n        at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:183)\r\nCaused by: java.lang.NullPointerException\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.nodes.java.RegisterFinalizerNode.mayHaveFinalizer(RegisterFinalizerNode.java:105)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.replacements.StandardGraphBuilderPlugins$34.apply(StandardGraphBuilderPlugins.java:996)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugin.execute(InvocationPlugin.java:168)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.applyInvocationPlugin(BytecodeParser.java:2261)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.tryInvocationPlugin(BytecodeParser.java:2201)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.appendInvoke(BytecodeParser.java:1886)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genInvokeSpecial(BytecodeParser.java:1775)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genInvokeSpecial(BytecodeParser.java:1767)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBytecode(BytecodeParser.java:5408)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3513)\r\n        ... 23 more\r\n                        6.9s (10.6% of total time) in 30 GCs | Peak RSS: 6.74GB | CPU load: 4.62\r\n------------------------------------------------------------------------------------------------------------------------\r\nProduced artifacts:\r\n C:\\work\\quarkus-sqlite-test\\build\\quarkus-sqlite-1.0-SNAPSHOT-native-image-source-jar\\quarkus-sqlite-1.0-SNAPSHOT-runner.build_artifacts.txt\r\n========================================================================================================================\r\nFailed generating 'quarkus-sqlite-1.0-SNAPSHOT-runner' after 1m 4s.\r\nError: Image build request failed with exit status 1\r\n> Task :quarkusBuild FAILED\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':quarkusBuild'.\r\n> io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n        [error]: Build step io.quarkus.deployment.pkg.steps.NativeImageBuildStep#build threw an exception: io.quarkus.deployment.pkg.steps.NativeImageBuildStep$ImageGenerationFailureException: Image generation failed. Exit code: 1\r\n        at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.imageGenerationFailed(NativeImageBuildStep.java:400)\r\n        at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build(NativeImageBuildStep.java:240)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:944)\r\n        at io.quarkus.builder.BuildContext.run(BuildContext.java:277)\r\n        at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n        at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\n\r\n\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n\r\n* Get more help at https://help.gradle.org\r\n\r\nBUILD FAILED in 1m 29s\r\n6 actionable tasks: 6 executed\r\n```\n\n### Expected behavior\n\nNative application\n\n### Actual behavior\n\nNullPointerException thrown\n\n### How to Reproduce?\n\nClone https://github.com/martinhutton/quarkus-sqlite-test\r\n\r\nRun `gradlew build -Dquarkus.package.type=native`\n\n### Output of `uname -a` or `ver`\n\nMicrosoft Windows [Version 10.0.19044.1889]\n\n### Output of `java -version`\n\nopenjdk version \"11.0.14\" 2022-01-18 OpenJDK Runtime Environment GraalVM CE 22.0.0.2 (build 11.0.14+9-jvmci-22.0-b05) OpenJDK 64-Bit Server VM GraalVM CE 22.0.0.2 (build 11.0.14+9-jvmci-22.0-b05, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.10.0.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n------------------------------------------------------------ Gradle 7.4.2 ------------------------------------------------------------   Build time:   2022-03-31 15:25:29 UTC Revision:     540473b8118064efcc264694cbcaa4b677f61041   Kotlin:       1.5.31 Groovy:       3.0.9 Ant:          Apache Ant(TM) version 1.10.11 compiled on July 10 2021 JVM:          11.0.14 (GraalVM Community 11.0.14+9-jvmci-22.0-b05) OS:           Windows 10 10.0 amd64\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27271/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
