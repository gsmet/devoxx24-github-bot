{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21310",
  "id": 1048515637,
  "node_id": "I_kwDOCFbutM4-fxQ1",
  "number": 21310,
  "title": "OIDC client needs extra flexibility",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/157",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/157",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/157/labels",
    "id": 7320620,
    "node_id": "MI_kwDOCFbutM4Ab7Qs",
    "number": 157,
    "title": "2.4.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 40,
    "state": "closed",
    "created_at": "2021-11-03T11:17:28Z",
    "updated_at": "2021-11-25T07:41:47Z",
    "due_on": null,
    "closed_at": "2021-11-12T08:45:43Z"
  },
  "comments": 14,
  "created_at": "2021-11-09T11:51:13Z",
  "updated_at": "2021-11-15T19:55:44Z",
  "closed_at": "2021-11-10T09:31:28Z",
  "active_lock_reason": null,
  "body": "### Description\n\nI am attempting to authenticate with an NHS service that uses an idiosyncratic Microsoft OAuth implementation and I have hit an edge case that suggests some extra flexibility may be needed. \r\nTheir service only has one endpoint which is the token endpoint. There is no auto-discovery. Due to this lack of auto-discovery, I have to set the token-path so I took the last part of the server URL and added that to token-path. However, the service insists that the JWT audience is the entire path to the token endpoint. When the JWT is signed however only the auth server URL is used for the audience.\r\nMy configuration is \r\n```\r\nquarkus.oidc-client.client-enabled=true\r\nquarkus.oidc-client.grant.type=client\r\nquarkus.oidc-client.auth-server-url=https://dev.api.service.nhs.uk/oauth2\r\nquarkus.oidc-client.client-id=<my_cid>\r\nquarkus.oidc-client.discovery-enabled=false # token path MUST be set\r\nquarkus.oidc-client.token-path=/token\r\nquarkus.oidc-client.credentials.jwt.key-file=pk.pem\r\nquarkus.oidc-client.credentials.jwt.token-key-id=<my-kid>\r\nquarkus.oidc-client.credentials.jwt.signature-algorithm=RS512 # works as I am using the snapshot build\r\n```\r\nThis means that in the OidcCommonUtils class in the signJwtWithKey method the JWT audience is set to `https://dev.api.service.nhs.uk/oauth2` where the service insists on `https://dev.api.service.nhs.uk/oauth2/token`. \n\n### Implementation ideas\n\nMaybe some configuration options could be added to override the default JWT values for these restricted OIDC implementations.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21310/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
