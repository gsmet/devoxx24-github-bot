{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/31476",
  "id": 1603116700,
  "node_id": "I_kwDOCFbutM5fjZ6c",
  "number": 31476,
  "title": "io.quarkus.kubernetes.deployment.OpenshiftDeployer throws java.io.IOException: Failed to resolve <host> but evidently did reach the host",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/235",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/235",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/235/labels",
    "id": 9025446,
    "node_id": "MI_kwDOCFbutM4Aibem",
    "number": 235,
    "title": "3.0.0.Alpha5",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 253,
    "state": "closed",
    "created_at": "2023-02-09T14:26:03Z",
    "updated_at": "2023-11-12T17:44:08Z",
    "due_on": null,
    "closed_at": "2023-03-08T15:10:59Z"
  },
  "comments": 3,
  "created_at": "2023-02-28T13:52:42Z",
  "updated_at": "2023-03-03T09:19:29Z",
  "closed_at": "2023-03-03T09:19:23Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nSince recently, with Quarkus 3.0.Alpha4, using `quarkus.kubernetes.deploy=true` leads to an error:\r\n\r\n```\r\nError:  Failed to execute goal io.quarkus:quarkus-maven-plugin:3.0.0.Alpha4:build (default) on project quarkus-github-lottery: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\nError: [ERROR] \t[error]: Build step io.quarkus.kubernetes.deployment.OpenshiftDeployer#checkEnvironment threw an exception: java.lang.RuntimeException: Failed to configure OpenShift. Make sure you have the Quarkus OpenShift extension.\r\nError:  \tat io.quarkus.kubernetes.deployment.OpenshiftDeployer.lambda$checkEnvironment$0(OpenshiftDeployer.java:35)\r\nError:  \tat java.base/java.util.Optional.ifPresent(Optional.java:178)\r\nError:  \tat io.quarkus.kubernetes.deployment.OpenshiftDeployer.checkEnvironment(OpenshiftDeployer.java:22)\r\nError:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\nError:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\nError:  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\nError:  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\nError:  \tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:909)\r\nError:  \tat io.quarkus.builder.BuildContext.run(BuildContext.java:282)\r\nError:  \tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\nError:  \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\nError:  \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\nError:  \tat java.base/java.lang.Thread.run(Thread.java:833)\r\nError:  \tat org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nError:  Caused by: io.fabric8.kubernetes.client.KubernetesClientException: An error has occurred.\r\nError:  \tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:129)\r\nError:  \tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:122)\r\nError:  \tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.restCall(OperationSupport.java:791)\r\nError:  \tat io.fabric8.kubernetes.client.impl.BaseClient.getApiGroups(BaseClient.java:241)\r\nError:  \tat io.fabric8.kubernetes.client.impl.BaseClient.hasApiGroup(BaseClient.java:164)\r\nError:  \tat io.fabric8.openshift.client.impl.OpenShiftClientImpl.isSupported(OpenShiftClientImpl.java:742)\r\nError:  \tat io.quarkus.kubernetes.deployment.OpenshiftDeployer.lambda$checkEnvironment$0(OpenshiftDeployer.java:28)\r\nError:  \t... 13 more\r\nError:  Caused by: java.io.IOException: Failed to resolve 'api.ospo-osci.z3b1.p1.openshiftapps.com' and search domain query for configured domains failed as well: [lxlrj1mao4menpo2mo3udeoyab.bx.internal.cloudapp.net]\r\nError:  \tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.waitForResult(OperationSupport.java:535)\r\nError:  \tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.handleResponse(OperationSupport.java:558)\r\nError:  \tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.restCall(OperationSupport.java:784)\r\nError:  \t... 17 more\r\nError:  Caused by: io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Failed to resolve 'api.ospo-osci.z3b1.p1.openshiftapps.com' and search domain query for configured domains failed as well: [lxlrj1mao4menpo2mo3udeoyab.bx.internal.cloudapp.net]\r\nError:  \tat io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1069)\r\nError:  \tat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:1022)\r\nError:  \tat io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:418)\r\nError:  \tat io.netty.resolver.dns.DnsResolveContext.access$600(DnsResolveContext.java:66)\r\nError:  \tat io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:489)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)\r\nError:  \tat io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:118)\r\nError:  \tat io.netty.resolver.dns.DnsQueryContext.tryFailure(DnsQueryContext.java:256)\r\nError:  \tat io.netty.resolver.dns.DnsQueryContext.onQueryWriteCompletion(DnsQueryContext.java:193)\r\nError:  \tat io.netty.resolver.dns.DnsQueryContext.access$200(DnsQueryContext.java:43)\r\nError:  \tat io.netty.resolver.dns.InflightNameResolver.resolve(InflightNameResolver.java:66)\r\nError:  \tat io.netty.resolver.dns.InflightNameResolver.resolve(InflightNameResolver.java:51)\r\nError:  \tat io.netty.resolver.InetSocketAddressResolver.doResolve(InetSocketAddressResolver.java:55)\r\nError:  \tat io.netty.resolver.InetSocketAddressResolver.doResolve(InetSocketAddressResolver.java:31)\r\nError:  \tat io.netty.resolver.AbstractAddressResolver.resolve(AbstractAddressResolver.java:106)\r\nError:  \tat io.netty.bootstrap.Bootstrap.doResolveAndConnect0(Bootstrap.java:206)\r\nError:  \tat io.netty.bootstrap.Bootstrap.doResolveAndConnect(Bootstrap.java:162)\r\nError:  \tat io.netty.bootstrap.Bootstrap.connect(Bootstrap.java:139)\r\nError:  \tat io.vertx.core.net.impl.ChannelProvider.handleConnect(ChannelProvider.java:155)\r\nError:  \tat io.vertx.core.net.impl.ChannelProvider.connect(ChannelProvider.java:106)\r\nError:  \tat io.vertx.core.net.impl.ChannelProvider.connect(ChannelProvider.java:92)\r\nError:  \tat io.vertx.core.net.impl.NetClientImpl.connectInternal2(NetClientImpl.java:273)\r\nError:  \tat io.vertx.core.net.impl.NetClientImpl.lambda$connectInternal$1(NetClientImpl.java:240)\r\nError:  \tat io.vertx.core.impl.future.FutureImpl$3.onSuccess(FutureImpl.java:141)\r\nError:  \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:60)\r\nError:  \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:211)\r\nError:  \tat io.vertx.core.impl.future.PromiseImpl.tryComplete(PromiseImpl.java:23)\r\nError:  \tat io.vertx.core.impl.future.PromiseImpl.onSuccess(PromiseImpl.java:49)\r\nError:  \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:60)\r\nError:  \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:211)\r\nError:  \tat io.vertx.core.impl.future.FixedMapping.onSuccess(FixedMapping.java:31)\r\nError:  \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:60)\r\nError:  \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:211)\r\nError:  \tat io.vertx.core.impl.future.PromiseImpl.tryComplete(PromiseImpl.java:23)\r\nError:  \tat io.vertx.core.impl.future.PromiseImpl.onSuccess(PromiseImpl.java:49)\r\nError:  \tat io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:60)\r\nError:  \tat io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:211)\r\nError:  \tat io.vertx.core.impl.future.Composition$1.onSuccess(Composition.java:62)\r\nError:  \tat io.vertx.core.impl.future.FutureBase.lambda$emitSuccess$0(FutureBase.java:54)\r\nError:  \tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\nError:  \tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\nError:  \tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\nError:  \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\nError:  \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\nError:  \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nError:  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nError:  \tat java.base/java.lang.Thread.run(Thread.java:833): Unknown host Failed to resolve 'api.ospo-osci.z3b1.p1.openshiftapps.com' and search domain query for configured domains failed as well: [lxlrj1mao4menpo2mo3udeoyab.bx.internal.cloudapp.net]\r\nError:  -> [Help 1]\r\nError:  \r\nError:  To see the full stack trace of the errors, re-run Maven with the -e switch.\r\nError:  Re-run Maven using the -X switch to enable full debug logging.\r\nError:  \r\nError:  For more information about the errors and possible solutions, please read the following articles:\r\nError:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\r\nError: Process completed with exit code 1.\r\n```\r\n\r\nSee https://github.com/quarkusio/quarkus-github-lottery/actions/runs/4290767409/jobs/7479679333#step:6:30555\r\n\r\nOpenShift seems to be reachable though, since I can see the deployment causes changes in OpenShift (a build is triggered and the pod restarts). It's stuck on an older version of my application, though.\r\n\r\nIt's probably a coincidence, but this failure started started to appear right after I upgraded to Maven Compiler Plugin 3.11.0: https://github.com/quarkusio/quarkus-github-lottery/commit/2f75ba23b8d19547eb5ba94fb461adc2e3e699d6\r\n\n\n### Expected behavior\n\n_No response_\n\n### Actual behavior\n\n_No response_\n\n### How to Reproduce?\n\nI don't have a reproducer but here is the project: https://github.com/quarkusio/quarkus-github-lottery/\r\n\r\nCommand:\r\n\r\n```\r\nmvn clean package -Dquarkus.kubernetes.deploy=true -Dquarkus.native.container-build=true -Dnative -Drevision=${{ github.sha }}\r\n```\r\n\r\nSee https://github.com/quarkusio/quarkus-github-lottery/blob/4a0f8d6655025fffa099396854de89d2fc3c1d73/.github/workflows/deploy.yml#L36-L43\r\n\r\nConfiguration:\r\n\r\n```\r\nquarkus.application.name=quarkus-github-lottery\r\nquarkus.application.version=${buildNumber:999-SNAPSHOT}\r\n\r\nquarkus.qute.suffixes=md\r\nquarkus.qute.content-types.\"md\"=text/markdown\r\n\r\n%test.quarkus.scheduler.enabled=false\r\n%test.quarkus.log.category.\"io.quarkus.github.lottery\".level=DEBUG\r\n\r\n%dev.quarkus.scheduler.enabled=false\r\n%dev.quarkus.log.category.\"io.quarkus.github.lottery\".level=DEBUG\r\n\r\n%prod.quarkus.openshift.labels.\"app\"=quarkus-github-lottery\r\n# renew the SSL certificate automatically\r\n%prod.quarkus.openshift.annotations.\"kubernetes.io/tls-acme\"=true\r\n%prod.quarkus.openshift.env.configmaps=quarkus-github-lottery-config\r\n%prod.quarkus.openshift.env.secrets=quarkus-github-lottery-secrets\r\n```\r\n\r\nSee https://github.com/quarkusio/quarkus-github-lottery/blob/4a0f8d6655025fffa099396854de89d2fc3c1d73/src/main/resources/application.properties\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.0.0.Alpha4\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31476/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
