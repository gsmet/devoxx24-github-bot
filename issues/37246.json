{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/37246",
  "id": 2004215447,
  "node_id": "I_kwDOCFbutM53deaX",
  "number": 37246,
  "title": "DeletedElementException: Unsupported type java.util.JapaneseImperialCalendar is reachable when building native executable",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 4,
  "created_at": "2023-11-21T12:48:15Z",
  "updated_at": "2023-11-21T14:10:51Z",
  "closed_at": "2023-11-21T12:55:40Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWhen I try to build my native image, I get an `com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported type java.util.JapaneseImperialCalendar is reachable` error.\r\nThe image creation worked fine before. I just updated from Quarkus 3.1.2 to 3.5.2, maybe that could be causing the issue, but I can't find a useful hint in the migration guides.\r\n\r\nI am not even using the JapaneseImperialCalendar! No idea how that came up there\n\n### Expected behavior\n\nNative image builds fine.\n\n### Actual behavior\n\nNative build fails with the given exceptions (see attached stacktrace)\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\nDarwin USER.local 23.1.0 Darwin Kernel Version 23.1.0: Mon Oct  9 21:28:31 PDT 2023; root:xnu-10002.41.9~6/RELEASE_ARM64_T8112 arm64\n\n### Output of `java -version`\n\n_No response_\n\n### Mandrel or GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.5.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nmwnv\n\n### Additional information\n\n```\r\n[1/7] Initializing...                                                                                   (14.1s @ 0.92GB)\r\n Version info: 'GraalVM 22.3.0 Java 17 CE'\r\n Java version info: '17.0.5+8-jvmci-22.3-b08'\r\n C compiler: cc (apple, arm64, 14.0.3)\r\n Garbage collector: Serial GC\r\n 12 user-specific feature(s)\r\n - com.google.api.gax.grpc.nativeimage.GrpcNettyFeature\r\n - com.google.api.gax.nativeimage.GoogleJsonClientFeature\r\n - com.google.api.gax.nativeimage.OpenCensusFeature\r\n - com.oracle.svm.thirdparty.gson.GsonFeature\r\n - io.quarkus.caffeine.runtime.graal.CacheConstructorsFeature\r\n - io.quarkus.hibernate.orm.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n - io.quarkus.hibernate.validator.runtime.DisableLoggingFeature: Disables INFO logging during the analysis phase for the [org.hibernate.validator.internal.util.Version] categories\r\n - io.quarkus.jdbc.postgresql.runtime.graal.SQLXMLFeature\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n - org.eclipse.angus.activation.nativeimage.AngusActivationFeature\r\n - org.hibernate.graalvm.internal.GraalVMStaticFeature: Hibernate ORM's static reflection registrations for GraalVM\r\n13:27:25,106 WARNING [com.goo.api.gax.nat.NativeImageUtils] Failed to find io.grpc.netty.shaded.io.netty.channel.ProtocolNegotiators on the classpath for reflection.\r\n[2/7] Performing analysis...  [13:27:27,120 WARN  [org.hib.orm.deprecation] HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)\r\n13:27:37,234 WARN  [io.net.res.dns.DnsServerAddressStreamProviders] Can not find io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider in the classpath, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'\r\nWarning: RecomputeFieldValue.FieldOffset automatic substitution failed. The automatic substitution registration was attempted because a call to sun.misc.Unsafe.objectFieldOffset(Field) was detected in the static initializer of com.google.protobuf.UnsafeUtil. Detailed failure reason(s): The argument of Unsafe.objectFieldOffset(Field) is not a constant field., Could not determine the field where the value produced by the call to sun.misc.Unsafe.objectFieldOffset(Field) for the field offset computation is stored. The call is not directly followed by a field store or by a sign extend node followed directly by a field store. \r\n[2/7] Performing analysis...  []                                                                        (30.0s @ 4.08GB)\r\n  22’932 (94.35%) of 24’306 classes reachable\r\n  30’837 (65.43%) of 47’131 fields reachable\r\n 100’080 (82.75%) of 120’943 methods reachable\r\n   1’601 classes,     0 fields, and     0 methods registered for reflection\r\n       1 native library: -framework CoreServices\r\n\r\nFatal error: com.oracle.graal.pointsto.util.AnalysisError$ParsingError: Error encountered while parsing java.util.Calendar$Builder.build() \r\nParsing context:\r\n   at java.util.Calendar$Builder.build(Calendar.java:1474)\r\n   at io.smallrye.graphql.transformation.CalendarTransformer.in(CalendarTransformer.java:32)\r\n   at io.smallrye.graphql.transformation.CalendarTransformer.in(CalendarTransformer.java:13)\r\n   at io.smallrye.graphql.execution.datafetcher.helper.ArgumentHelper.transformInput(ArgumentHelper.java:240)\r\n   at io.smallrye.graphql.execution.datafetcher.helper.ArgumentHelper.singleTransform(ArgumentHelper.java:136)\r\n   at io.smallrye.graphql.execution.datafetcher.helper.AbstractHelper.recursiveTransform(AbstractHelper.java:170)\r\n   at io.smallrye.graphql.execution.datafetcher.helper.AbstractHelper.transformOrAdapt(AbstractHelper.java:89)\r\n   at io.smallrye.graphql.execution.datafetcher.helper.FieldHelper.transformOrAdaptResponse(FieldHelper.java:40)\r\n   at io.smallrye.graphql.execution.datafetcher.FieldDataFetcher.get(FieldDataFetcher.java:68)\r\n   at graphql.execution.ExecutionStrategy.invokeDataFetcher(ExecutionStrategy.java:311)\r\n   at graphql.execution.ExecutionStrategy.fetchField(ExecutionStrategy.java:287)\r\n   at graphql.execution.ExecutionStrategy.resolveFieldWithInfo(ExecutionStrategy.java:213)\r\n   at graphql.execution.AsyncExecutionStrategy.execute(AsyncExecutionStrategy.java:55)\r\n   at graphql.execution.Execution.executeOperation(Execution.java:161)\r\n   at graphql.execution.Execution.execute(Execution.java:103)\r\n   at graphql.GraphQL.execute(GraphQL.java:565)\r\n   at graphql.GraphQL.lambda$parseValidateAndExecute$12(GraphQL.java:484)\r\n   at graphql.GraphQL$$Lambda$2697/0x0000000303d1b950.apply(Unknown Source)\r\n   at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\r\n   at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\r\n   at graphql.GraphQL.handleAbortException(GraphQL.java:456)\r\n   at graphql.GraphQL.executeAsync(GraphQL.java:447)\r\n   at graphql.GraphQL.execute(GraphQL.java:365)\r\n   at io.smallrye.graphql.execution.ExecutionService.writeSync(ExecutionService.java:236)\r\n   at io.smallrye.graphql.execution.ExecutionService.execute(ExecutionService.java:187)\r\n   at io.smallrye.graphql.execution.ExecutionService.executeAsync(ExecutionService.java:121)\r\n   at io.smallrye.graphql.websocket.AbstractGraphQLWebsocketHandler.onOperationRequest(AbstractGraphQLWebsocketHandler.java:102)\r\n   at io.smallrye.graphql.websocket.graphqltransportws.GraphQLTransportWSSubprotocolHandler.onMessage(GraphQLTransportWSSubprotocolHandler.java:54)\r\n   at io.smallrye.graphql.websocket.AbstractGraphQLWebsocketHandler.onMessage(AbstractGraphQLWebsocketHandler.java:63)\r\n   at io.quarkus.smallrye.graphql.runtime.SmallRyeGraphQLOverWebSocketHandler$$Lambda$2277/0x0000000303c8c6b0.handle(Unknown Source)\r\n   at io.vertx.core.impl.future.FutureImpl$3.onFailure(FutureImpl.java:153)\r\n   at io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:75)\r\n   at io.vertx.core.impl.future.FutureImpl.addListener(FutureImpl.java:191)\r\n   at io.vertx.core.impl.future.PromiseImpl.addListener(PromiseImpl.java:23)\r\n   at io.vertx.core.impl.future.FutureImpl.onComplete(FutureImpl.java:164)\r\n   at io.vertx.core.impl.future.PromiseImpl.onComplete(PromiseImpl.java:23)\r\n   at io.vertx.core.impl.VertxImpl.initClustered(VertxImpl.java:221)\r\n   at io.vertx.core.impl.VertxBuilder.clusteredVertx(VertxBuilder.java:261)\r\n   at io.quarkus.vertx.core.runtime.VertxCoreRecorder.initialize(VertxCoreRecorder.java:230)\r\n   at io.quarkus.vertx.core.runtime.VertxCoreRecorder$VertxSupplier.get(VertxCoreRecorder.java:619)\r\n   at io.quarkus.vertx.core.runtime.VertxCoreRecorder$VertxSupplier.get(VertxCoreRecorder.java:598)\r\n   at org.apache.camel.impl.engine.DefaultContextPluginManager.getContextPlugin(DefaultContextPluginManager.java:47)\r\n   at org.apache.camel.impl.engine.DefaultCamelContextExtension.getContextPlugin(DefaultCamelContextExtension.java:586)\r\n   at org.apache.camel.support.PluginHelper.getInternalProcessorFactory(PluginHelper.java:364)\r\n   at org.apache.camel.support.PluginHelper.getInternalProcessorFactory(PluginHelper.java:357)\r\n   at org.apache.camel.support.cache.DefaultProducerCache.<init>(DefaultProducerCache.java:86)\r\n   at org.apache.camel.impl.engine.DefaultProducerTemplate.doBuild(DefaultProducerTemplate.java:775)\r\n   at org.apache.camel.support.service.BaseService.build(BaseService.java:60)\r\n   at org.apache.camel.support.service.BaseService.init(BaseService.java:75)\r\n   at org.apache.camel.support.service.BaseService.start(BaseService.java:105)\r\n   at org.apache.camel.support.service.ServiceHelper.startService(ServiceHelper.java:126)\r\n   at org.apache.camel.impl.engine.InternalServiceManager.deferStartService(InternalServiceManager.java:177)\r\n   at org.apache.camel.impl.engine.InternalServiceManager.doAddService(InternalServiceManager.java:150)\r\n   at org.apache.camel.impl.engine.InternalServiceManager.addService(InternalServiceManager.java:82)\r\n   at org.apache.camel.impl.engine.InternalServiceManager.addService(InternalServiceManager.java:77)\r\n\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.AnalysisError.parsingError(AnalysisError.java:153)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.createFlowsGraph(MethodTypeFlow.java:104)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.ensureFlowsGraphCreated(MethodTypeFlow.java:83)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.getOrCreateMethodFlowsGraph(MethodTypeFlow.java:65)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.typestate.DefaultVirtualInvokeTypeFlow.onObservedUpdate(DefaultVirtualInvokeTypeFlow.java:109)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.TypeFlow.update(TypeFlow.java:562)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.PointsToAnalysis$1.run(PointsToAnalysis.java:488)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.executeCommand(CompletionExecutor.java:193)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.lambda$executeService$0(CompletionExecutor.java:177)\r\n        at java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1395)\r\n        at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373)\r\n        at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)\r\n        at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)\r\n        at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)\r\n        at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)\r\nCaused by: org.graalvm.compiler.java.BytecodeParser$BytecodeParserError: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported type java.util.JapaneseImperialCalendar is reachable\r\nTo diagnose the issue, you can add the option --report-unsupported-elements-at-runtime. The unsupported element is then reported at run time when it is accessed the first time.\r\n        at parsing java.util.Calendar$Builder.build(Calendar.java:1506)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.throwParserError(BytecodeParser.java:2518)\r\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase$SharedBytecodeParser.throwParserError(SharedGraphBuilderPhase.java:110)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3393)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.handleBytecodeBlock(BytecodeParser.java:3345)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBlock(BytecodeParser.java:3190)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.build(BytecodeParser.java:1138)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.buildRootMethod(BytecodeParser.java:1030)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.GraphBuilderPhase$Instance.run(GraphBuilderPhase.java:97)\r\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase.run(SharedGraphBuilderPhase.java:84)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.run(Phase.java:49)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.BasePhase.apply(BasePhase.java:446)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:42)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:38)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.AnalysisParsedGraph.parseBytecode(AnalysisParsedGraph.java:135)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisMethod.ensureGraphParsed(AnalysisMethod.java:685)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.parse(MethodTypeFlowBuilder.java:171)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.apply(MethodTypeFlowBuilder.java:349)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.createFlowsGraph(MethodTypeFlow.java:93)\r\n        ... 13 more\r\nCaused by: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported type java.util.JapaneseImperialCalendar is reachable\r\nTo diagnose the issue, you can add the option --report-unsupported-elements-at-runtime. The unsupported element is then reported at run time when it is accessed the first time.\r\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.substitute.AnnotationSubstitutionProcessor.lookup(AnnotationSubstitutionProcessor.java:140)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.infrastructure.SubstitutionProcessor$ChainedSubstitutionProcessor.lookup(SubstitutionProcessor.java:125)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.infrastructure.SubstitutionProcessor$ChainedSubstitutionProcessor.lookup(SubstitutionProcessor.java:125)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisUniverse.lookupAllowUnresolved(AnalysisUniverse.java:210)\r\n        at org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.infrastructure.WrappedConstantPool.lookupType(WrappedConstantPool.java:244)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.lookupType(BytecodeParser.java:4199)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genNewInstance(BytecodeParser.java:4493)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBytecode(BytecodeParser.java:5291)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3385)\r\n        ... 28 more\r\n------------------------------------------------------------------------------------------------------------------------\r\n                        5.8s (12.7% of total time) in 28 GCs | Peak RSS: 3.50GB | CPU load: 3.73\r\n========================================================================================================================\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37246/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
