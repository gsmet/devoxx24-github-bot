{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36614",
  "id": 1955727956,
  "node_id": "I_kwDOCFbutM50kgpU",
  "number": 36614,
  "title": "3.0 - BuildException when using jakarta.ws.rs.client.ClientBuilder",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-22T02:04:46Z",
  "updated_at": "2023-10-23T22:19:05Z",
  "closed_at": "2023-10-23T22:19:02Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI'm trying to upgrade our system from Quarkus 2 to 3. We are slowly working to migrate to the Rest Client interfaces that Quarkus recommends, but as of now we have too many to do right away, so as of now we inject `jakarta.ws.rs.client.Client` which is generated by the producer below. But there is a `BuildException`  when I `quarkusBuild` in Quarkus 3.\r\n\r\n### Expected behavior\r\n\r\n```\r\nFailed to index org.jboss.resteasy.plugins.providers.AbstractPatchMethodFilter: Class does not exist in ClassLoader QuarkusClassLoader:Deployment Class Loader: PROD@77a8b83f\r\n> Task :my-project:quarkusAppPartsBuild FAILED\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':my-project:quarkusAppPartsBuild'.\r\n> There was a failure while executing work items\r\n   > A failure occurred while executing io.quarkus.gradle.tasks.worker.BuildWorker\r\n      > io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n                [error]: Build step io.quarkus.arc.deployment.ArcProcessor#registerBeans threw an exception: java.lang.NullPointerException: Cannot invoke \"org.jboss.jandex.ClassInfo.name()\" because \"currentClazz\" is null\r\n                at io.quarkus.resteasy.reactive.server.deployment.ResteasyReactiveProcessor.createTypedAnnotationInstance(ResteasyReactiveProcessor.java:872)\r\n                at io.quarkus.resteasy.reactive.server.deployment.ResteasyReactiveProcessor$6.transform(ResteasyReactiveProcessor.java:854)\r\n                at io.quarkus.arc.processor.AnnotationStore.transform(AnnotationStore.java:108)\r\n                at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1708)\r\n                at io.quarkus.arc.processor.AnnotationStore.getAnnotations(AnnotationStore.java:61)\r\n                at io.quarkus.arc.processor.AnnotationStore.hasAnnotation(AnnotationStore.java:85)\r\n                at io.quarkus.arc.processor.BeanDeployment.isVetoed(BeanDeployment.java:1278)\r\n                at io.quarkus.arc.processor.BeanDeployment.findBeans(BeanDeployment.java:1001)\r\n                at io.quarkus.arc.processor.BeanDeployment.registerBeans(BeanDeployment.java:272)\r\n                at io.quarkus.arc.processor.BeanProcessor.registerBeans(BeanProcessor.java:144)\r\n                at io.quarkus.arc.deployment.ArcProcessor.registerBeans(ArcProcessor.java:419)\r\n                at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n                at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n                at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n                at java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n                at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:858)\r\n                at io.quarkus.builder.BuildContext.run(BuildContext.java:282)\r\n                at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n                at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n                at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n                at java.base/java.lang.Thread.run(Thread.java:833)\r\n                at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\n\r\n```\r\n\r\n### Actual behavior\r\n\r\nSuccessful build\r\n\r\n### How to Reproduce?\r\n\r\n```sh\r\ngradlew my-project:quarkusBuild\r\n```\r\n\r\nClass using client\r\n```java\r\n@Inject\r\nClient client;\r\n\r\npublic void doSoemthing(String url, long param) {\r\n    final Response r = client.target(url).queryParam(\"my-param\", param)\r\n            .request(MediaType.APPLICATION_JSON).get();\r\n    // use response\r\n}\r\n```\r\n\r\nClient producer\r\n```java\r\npublic class RestClientProducer {\r\n\r\n    @Produces\r\n    @ApplicationScoped\r\n    public Client produceClient(\r\n            @ConfigProperty(name = \"quarkus.rest-client.connect-timeout\", defaultValue = \"30000\") final int connectTimeout,\r\n            @ConfigProperty(name = \"quarkus.rest-client.read-timeout\", defaultValue = \"30000\") final int readTimeout) {\r\n        try {\r\n            TrustManager[] trustManagers = { new NullX509TrustManager() };\r\n            SSLContext context = SSLContext.getInstance(\"TLSv1\");\r\n            context.init(null, trustManagers, null);\r\n            ClientBuilder clientBuilder = ClientBuilder.newBuilder();\r\n            return clientBuilder\r\n                    .sslContext(context) //\r\n                    .connectTimeout(connectTimeout, TimeUnit.MILLISECONDS) //\r\n                    .readTimeout(readTimeout, TimeUnit.MILLISECONDS) //\r\n                    .register(JwtClientFilter.class) //\r\n                    .register(MyCustomObjectMapperContextResolver.class).build();\r\n        }\r\n        catch (KeyManagementException | NoSuchAlgorithmException e) {\r\n            throw new RuntimeException(e);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\nTemurin JDK 17\r\n\r\n### Quarkus version or git rev\r\n\r\n3.4.3\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nGradle 8.3\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36614/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
