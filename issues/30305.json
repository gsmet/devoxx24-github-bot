{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/30305",
  "id": 1528915513,
  "node_id": "I_kwDOCFbutM5bIWY5",
  "number": 30305,
  "title": "Hibernate-orm batch not bulk inserting entities",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026509,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/persistence",
      "name": "area/persistence",
      "color": "FBCA04",
      "default": false,
      "description": "OBSOLETE, DO NOT USE"
    },
    {
      "id": 1425555736,
      "node_id": "MDU6TGFiZWwxNDI1NTU1NzM2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-orm",
      "name": "area/hibernate-orm",
      "color": "0366d6",
      "default": false,
      "description": "Hibernate ORM"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 17,
  "created_at": "2023-01-11T12:02:46Z",
  "updated_at": "2024-08-21T23:30:18Z",
  "closed_at": "2023-01-11T12:24:05Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\n### Description\r\nWhen trying to insert several entities in the Database using hibernate-orm, I can't make the insertion to be in batch.\r\n\r\nFrom the documentation [Using Hibernate ORM and JPA](https://quarkus.io/guides/hibernate-orm#quarkus-hibernate-orm_quarkus.hibernate-orm.jdbc.statement-batch-size) I see the option for batch insert is available at runtime (**quarkus.hibernate-orm.jdbc.statement-batch-size**). \r\n\r\nHowever, I don't see it working (or at least how I think it should work).\r\n\r\nBelow, you can see the code and properties I used as well as the database logs\r\n\r\n### Dependencies\r\n- implementation(\"io.quarkus:quarkus-hibernate-orm-panache:2.15.2.Final\")\r\n- implementation(\"io.quarkus:quarkus-jdbc-postgresql:2.15.2.Final\")\r\n\r\n### Entity\r\n```\r\npackage database.entities;\r\n\r\n\r\nimport javax.persistence.*;\r\nimport java.util.List;\r\nimport java.util.UUID;\r\n\r\n@Entity\r\npublic class School {\r\n\r\n    @Id\r\n    private UUID id = UUID.randomUUID();\r\n\r\n    private String name;\r\n\r\n    public UUID getId() {\r\n        return id;\r\n    }\r\n\r\n    public void setId(UUID id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public String getName() {\r\n        return name;\r\n    }\r\n\r\n    public void setName(String name) {\r\n        this.name = name;\r\n    }\r\n}\r\n```\r\n### Repository\r\n\r\n```\r\npackage database.repositories;\r\n\r\nimport database.entities.School;\r\nimport io.quarkus.hibernate.orm.panache.PanacheRepository;\r\n\r\nimport javax.enterprise.context.ApplicationScoped;\r\n\r\n\r\n@ApplicationScoped\r\npublic class SchoolRepository implements PanacheRepository<School> {}\r\n```\r\n\r\n### Test\r\n\r\n```\r\npackage com.database;\r\n\r\nimport database.entities.School;\r\nimport database.repositories.SchoolRepository;\r\nimport io.quarkus.test.junit.QuarkusTest;\r\nimport org.junit.jupiter.api.Assertions;\r\nimport org.junit.jupiter.api.Test;\r\n\r\nimport javax.inject.Inject;\r\nimport javax.transaction.*;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport static helper.TestObjectHelper.createSchool;\r\n\r\n\r\n@QuarkusTest\r\npublic class Tests {\r\n\r\n    @Inject\r\n    SchoolRepository schoolRepository;\r\n\r\n    @Transactional\r\n    @Test\r\n    public void whenNotConfigured_ThenSendsInsertsSeparately() {\r\n        List<School> schools = new ArrayList<>();\r\n        for (int i = 0; i < 50; i++) {\r\n            schools.add(createSchool(i));\r\n        }\r\n        schoolRepository.persist(schools);\r\n        schoolRepository.flush();\r\n    }\r\n\r\n}\r\n```\r\n\r\n### application.properties\r\n```\r\n\r\n\r\n# Configuring datasource\r\nquarkus.datasource.db-kind = postgresql\r\nquarkus.datasource.username = core-db\r\nquarkus.datasource.password = masterpassword\r\nquarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/core-db\r\nquarkus.datasource.jdbc.max-size=15\r\n\r\n\r\n# drop and create the database at startup (use `update` to only update the schema)\r\nquarkus.hibernate-orm.database.generation = drop-and-create\r\n\r\nquarkus.hibernate-orm.jdbc.statement-batch-size=5\r\n\r\nquarkus.hibernate-orm.log.jdbc-warnings=true\r\n# quarkus.hibernate-orm.log.sql=true\r\n#quarkus.hibernate-orm.log.bind-parameters=false\r\n```\r\n\r\n### Expected behavior\r\n\r\nAs in the properties above I put \"batch-size=5\", I expected there to be multiple inserts with multiple values:\r\n\r\n```\r\n\"batch\":true, \"querySize\":1, \"batchSize\":5, \"query\":[\"insert into school (name, id) values (?, ?)\"], \r\n  \"params\":[[\"School1\",\"1\"],[\"School2\",\"2\"],[\"School3\",\"3\"],[\"School4\",\"4\"],[\"School5\",\"5\"]]\r\n\"batch\":true, \"querySize\":1, \"batchSize\":5, \"query\":[\"insert into school (name, id) values (?, ?)\"], \r\n  \"params\":[[\"School6\",\"6\"],[\"School7\",\"7\"],[\"School8\",\"8\"],[\"School9\",\"9\"],[\"School10\",\"10\"]]\r\n```\r\n\r\n### Actual Behavior\r\n\r\nFrom the logs below, the insert is being done on a single transaction with **multiple individual inserts**.\r\n\r\n### Logs\r\n\r\n```\r\n2023-01-11 11:23:38.120 UTC [149] DETAIL:  parameters: $1 = '\"$user\", public'\r\n2023-01-11 11:23:38.121 UTC [149] LOG:  execute S_1: COMMIT\r\n2023-01-11 11:23:38.259 UTC [149] LOG:  execute S_3: BEGIN\r\n2023-01-11 11:23:38.266 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.266 UTC [149] DETAIL:  parameters: $1 = 'School1', $2 = '65baf811-7366-4267-b866-66375d467479'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School2', $2 = '20fb8361-f219-4f0a-a0ba-4b5d093396db'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School3', $2 = 'bcb63bbb-fc42-4772-9cef-36f0f0e35c79'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School4', $2 = '2466d7be-11ee-4ea7-9702-945db301c89c'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School5', $2 = 'ca9b7732-ac26-4477-a081-5d310e10b5cd'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School6', $2 = '6b420d1f-3b32-44bc-84f8-5fe6fca9a3de'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School7', $2 = '4c47427f-024c-4803-8dfc-8f52993d6df6'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School8', $2 = '7ce3dddb-f344-43a7-b76e-31a47d0adb44'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School9', $2 = '70645a87-c7d5-49ec-9391-528e206d6661'\r\n2023-01-11 11:23:38.283 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.283 UTC [149] DETAIL:  parameters: $1 = 'School10', $2 = 'c512506e-c86d-4845-be95-517e0b0be5f6'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School11', $2 = 'dba4cf15-8167-40a0-be45-b3ecf971a766'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School12', $2 = '351a4f05-512c-4434-b7df-c352f91cbe27'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School13', $2 = '1be8db42-0c48-4711-961d-c55d01a1ee1f'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School14', $2 = 'b49b778d-c4cc-4af3-bfd8-ca3c1e899ab9'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School15', $2 = '01d1002c-fda8-40f8-afaa-bfdcb3a8b5d4'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School16', $2 = '239782f9-de83-4cab-b5fe-19042449c1c6'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School17', $2 = 'aa2e0509-7030-473f-ae69-be952b589b66'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School18', $2 = '41b5f5c6-d6af-41bf-bd35-d2861c186b11'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School19', $2 = '2f0f8ef6-a9ba-4433-8eee-c19320547fb4'\r\n2023-01-11 11:23:38.287 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.287 UTC [149] DETAIL:  parameters: $1 = 'School20', $2 = 'f2da3d63-4bed-4316-8ab9-21eb3e82cb01'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School21', $2 = '77d8c544-d53c-46ed-b286-595ad7768f82'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School22', $2 = 'fb6bf550-3674-4785-a814-9092a9e77cbb'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School23', $2 = '14535602-4046-4e23-926a-223376295542'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School24', $2 = '93dc6692-4688-4061-8343-dbb4efdba8cb'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School25', $2 = 'c493b329-9811-40a7-93e0-87d17ae98223'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School26', $2 = '52b14795-b1ea-43e1-b15e-39f94aa01887'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School27', $2 = 'b8ed7cce-8093-4125-8da7-5f34521d3750'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School28', $2 = '16c154c4-3422-49c6-bbc0-3f56c62dcdf1'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School29', $2 = '04b79c54-c8ec-4c3a-aeda-49907db22297'\r\n2023-01-11 11:23:38.290 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.290 UTC [149] DETAIL:  parameters: $1 = 'School30', $2 = 'd0e4b2e5-c80a-4502-b582-e12dfa8e2486'\r\n2023-01-11 11:23:38.295 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.295 UTC [149] DETAIL:  parameters: $1 = 'School31', $2 = 'ec782062-4d07-485d-9bc7-f920b7958de1'\r\n2023-01-11 11:23:38.295 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.295 UTC [149] DETAIL:  parameters: $1 = 'School32', $2 = '46eb0b30-ac20-4e08-a2d9-bcd5d47f44d3'\r\n2023-01-11 11:23:38.295 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.295 UTC [149] DETAIL:  parameters: $1 = 'School33', $2 = '88d9176c-07f9-4a2e-b1d4-f7e890dd4166'\r\n2023-01-11 11:23:38.295 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.295 UTC [149] DETAIL:  parameters: $1 = 'School34', $2 = '9c566e70-c242-4da9-ab0e-4bad9191bace'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School35', $2 = 'b9ef5cc3-16ec-4dcd-8acc-5a183a6478b8'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School36', $2 = 'ce38f893-ddf4-478e-b272-949dcfd2d45e'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School37', $2 = '22134a01-109f-457c-8c0f-f12fcb5ce06e'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School38', $2 = 'e066b430-5c6d-4ba4-8d3a-405d783bdbcf'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School39', $2 = '9398ced2-97b7-4fa7-802e-1e3094544c65'\r\n2023-01-11 11:23:38.296 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.296 UTC [149] DETAIL:  parameters: $1 = 'School40', $2 = 'ef152096-d533-45ed-817e-1aadbac63302'\r\n2023-01-11 11:23:38.297 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.297 UTC [149] DETAIL:  parameters: $1 = 'School41', $2 = '09b547fb-faf2-47bc-b4c6-e3f05bea59dc'\r\n2023-01-11 11:23:38.297 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.297 UTC [149] DETAIL:  parameters: $1 = 'School42', $2 = '101fd478-40bb-46a0-85d7-8daeac131a91'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School43', $2 = 'd6bc82c7-f20f-4364-82ca-f73992dcb759'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School44', $2 = '9187a86e-e9fc-48f4-b4fa-1a48f5e9d222'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School45', $2 = '70a721f4-edee-4ddf-8e4b-539493ece7b0'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School46', $2 = '44e28ffd-32c0-47a3-b408-bf27f52228cf'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School47', $2 = 'f0b36ace-4274-4200-bd0c-a772631fb5d5'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School48', $2 = '4ff6b91b-a224-4228-b046-f91941555c04'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School49', $2 = 'dce2b886-818f-4e45-a1a1-1eda09756833'\r\n2023-01-11 11:23:38.298 UTC [149] LOG:  execute S_4: insert into school (name, id) values ($1, $2)\r\n2023-01-11 11:23:38.298 UTC [149] DETAIL:  parameters: $1 = 'School50', $2 = '3f21ab8a-23dc-433a-838d-c2f8889ae1b1'\r\n2023-01-11 11:23:38.313 UTC [149] LOG:  execute S_1: COMMIT\r\n\r\n```\r\n\r\n### How to Reproduce?\r\n\r\n_No response_\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin MBP.Home 21.1.0 Darwin Kernel Version 21.1.0: Wed Oct 13 17:33:01 PDT 2021; root:xnu-8019.41.5~1/RELEASE_ARM64_T6000 arm64\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk-17 (17.0.1)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.15.2.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nGradle 7.5.1\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/30305/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
