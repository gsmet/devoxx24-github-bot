{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25225",
  "id": 1218669736,
  "node_id": "I_kwDOCFbutM5Io2yo",
  "number": 25225,
  "title": "`Forwarded` header is not parsed as expected",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/183",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183/labels",
    "id": 7917759,
    "node_id": "MI_kwDOCFbutM4AeNC_",
    "number": 183,
    "title": "2.10.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 253,
    "state": "closed",
    "created_at": "2022-04-27T08:14:38Z",
    "updated_at": "2023-01-13T10:46:24Z",
    "due_on": null,
    "closed_at": "2022-06-09T16:06:42Z"
  },
  "comments": 1,
  "created_at": "2022-04-28T12:39:35Z",
  "updated_at": "2022-04-28T17:34:35Z",
  "closed_at": "2022-04-28T17:34:32Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nAccording to [RFC7239](https://www.rfc-editor.org/rfc/rfc7239#section-4), the `Forwarded` header can have a comma-separated list of values. It is used to indicate the string of proxies (including the client that initiated the request).\r\n\r\nThe ForwardedParser class splits this header by comma and later considers only the first element. This element will be the one that will determine each property of the request (protocol, host, etc). This is not the expected behavior as it will discard the remaining information in the header, as you will see in the next sections. \n\n### Expected behavior\n\nWhen a client does a HTTP request with the following header, `Forwarded: by=proxy;for=backend:4444,for=backend2:5555;host=somehost;proto=https`, the quarkus server must consider `host` and `proto` properties defined by the header.\r\n\n\n### Actual behavior\n\nThe properties `host` and `proto` are not considered, and eventually discarded.\n\n### How to Reproduce?\n\n\r\n```\r\n    @Test\r\n    public void testForwardedForWithSequenceOfProxies() {\r\n        assertThat(RestAssured.get(\"/forward\").asString()).startsWith(\"http|\");\r\n\r\n        RestAssured.given()\r\n                .header(\"Forwarded\", \"by=proxy;for=backend:4444,for=backend2:5555;host=somehost;proto=https\")\r\n                .get(\"/forward\")\r\n                .then()\r\n                .body(Matchers.equalTo(\"https|somehost|backend:4444\"));\r\n    }\r\n\r\n```\n\n### Output of `uname -a` or `ver`\n\nDarwin dibss-MacBook-Pro.local 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:45:05 PDT 2022; root:xnu-8020.101.4~15/RELEASE_X86_64 x86_64\n\n### Output of `java -version`\n\nopenjdk version \"11.0.15\" 2022-04-19 OpenJDK Runtime Environment Temurin-11.0.15+10 (build 11.0.15+10) OpenJDK 64-Bit Server VM Temurin-11.0.15+10 (build 11.0.15+10, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537)\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25225/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
