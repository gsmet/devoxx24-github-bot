{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/35637",
  "id": 1873789776,
  "node_id": "I_kwDOCFbutM5vr8NQ",
  "number": 35637,
  "title": "Quarkus outputs messages with un-substituted %s strings on shutdown",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283428650,
      "node_id": "MDU6TGFiZWwxMjgzNDI4NjUw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/logging",
      "name": "area/logging",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/284",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/284",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/284/labels",
    "id": 10103752,
    "node_id": "MI_kwDOCFbutM4AmivI",
    "number": 284,
    "title": "3.2.8.Final",
    "description": "",
    "creator": {
      "login": "aloubyansky",
      "id": 323379,
      "node_id": "MDQ6VXNlcjMyMzM3OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/323379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aloubyansky",
      "html_url": "https://github.com/aloubyansky",
      "followers_url": "https://api.github.com/users/aloubyansky/followers",
      "following_url": "https://api.github.com/users/aloubyansky/following{/other_user}",
      "gists_url": "https://api.github.com/users/aloubyansky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aloubyansky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aloubyansky/subscriptions",
      "organizations_url": "https://api.github.com/users/aloubyansky/orgs",
      "repos_url": "https://api.github.com/users/aloubyansky/repos",
      "events_url": "https://api.github.com/users/aloubyansky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aloubyansky/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 129,
    "state": "closed",
    "created_at": "2023-10-25T07:58:05Z",
    "updated_at": "2023-11-15T14:06:19Z",
    "due_on": "2023-11-15T08:00:00Z",
    "closed_at": "2023-11-08T14:04:29Z"
  },
  "comments": 1,
  "created_at": "2023-08-30T14:21:43Z",
  "updated_at": "2023-10-25T16:50:09Z",
  "closed_at": "2023-08-31T06:16:05Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nThis is a weird one. It looks like the String Formatter substitution in our logger is not working, on at least some code paths.\r\n\r\nThat means that if the Quarkus code does something like  this\r\n\r\n```\r\n                LOGGER.warnf(\"Failed to index %s: Class does not exist in ClassLoader %s\", className, classLoader);\r\n```\r\n\r\nThe following pops up in the log: \r\n\r\n```\r\nFailed to index %s: Class does not exist in ClassLoader %s\r\n```\r\n\r\nThis is Surprising, since [the JBoss Logger](https://docs.jboss.org/jbosslogging/latest/org/jboss/logging/Logger.html#warnf(java.lang.String,%20java.lang.Object)) `warnf `claims to use the normal Java String Formatter, and the [docs for that](https://docs.oracle.com/javase/6/docs/api/java/util/Formatter.html#syntax) confirm that `%s` would work. If I take the same log message and send it to `System.out.printf` instead of `LOGGER.warnf`, it's printed as expected. \r\n\r\nThe problem seems reasonably widespread. I checked the logs of our builds, and I can see 26 instances of `%s` in recent JVM builds. \r\n\r\nFor example, in a recent [Java 20 build](https://github.com/quarkusio/quarkus/actions/runs/6020197713/job/16332476627, ), there's 26 %ses, such as\r\n\r\n```\r\n2023-08-30T05:23:11.3734542Z 2023-08-30 05:23:11,361 ERROR [io.qua.arc.imp.DefaultAsyncObserverExceptionHandler] (executor-thread-1) Failure occurred while notifying an async %s for event of type %s\r\n2023-08-30T05:23:11.3735721Z - please enable debug logging to see the full stack trace [Error Occurred After Shutdown],\r\n```\r\n\r\n I can find see the same malformed output popping up in a few issue reports, such as https://github.com/quarkusio/quarkus/issues/32853 and https://stackoverflow.com/questions/63998501/how-to-load-configmaps-using-kubernetes-config-extension. So it's not just me.\r\n\r\n### Expected behavior\r\n\r\nWe should not have un-substituted parameters in our log messages.\r\n\r\n### Actual behavior\r\n\r\nExample bad output: \r\n\r\n```\r\n2023-08-25T18:13:13.2360940Z 2023-08-25 18:13:13,182 ERROR [io.qua.arc.imp.AbstractInstanceHandle] (Quarkus Main Thread) Error occurred while destroying instance of bean [%s]: %s [Error Occurred After Shutdown]`\r\n````\r\n\r\n### How to Reproduce?\r\n\r\nThese messages mostly happen on the error path, which is perhaps why we didn't notice them. There's also some extra condition which must be needed to hit the issue; in my reproducer I can see both 'good' and 'bad' messages of the same type. \r\n\r\nFor example, I get both of these at different points in the output:\r\n```\r\nUnrecognized configuration key \"%s\" was provided; it will be ignored; verify that the dependency extension for this configuration is set or that you did not make a typo\r\n    2023-08-30 14:33:49,285 WARN  [io.qua.config] (Test worker) Unrecognized configuration key \"quarkus.http.host\" was provided; it will be ignored; verify that the dependency extension for this configuration is set or that you did not make a typo\r\n\r\n```\r\nThe build logs are a good place to check for occurrences. I can see the issue on mac, and the builds are showing the issue on Linux.\r\n\r\nI checked Java 20, Java 17, 3.3, 3.2, and 2.16.x, and all show the problem. \r\n\r\nNo one wants my local reproducer where I spotted the problem. :) For a very small reproducer, I think we'd want to look at the 26 occurrences in the build and choose one that's in a test path that's easy to run. \r\n\r\n### Additional information\r\n\r\n@dmlloyd suggests \"the most likely possibility that occurs to me is that JBoss Logging thinks it's talking to JBoss LogManager, but somehow it actually isn't\"",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35637/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
