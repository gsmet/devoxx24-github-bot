{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25108",
  "id": 1212550826,
  "node_id": "I_kwDOCFbutM5IRg6q",
  "number": 25108,
  "title": "Test fails when run without docker or podman, even if `-Dstart-containers` is not set",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/183",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183/labels",
    "id": 7917759,
    "node_id": "MI_kwDOCFbutM4AeNC_",
    "number": 183,
    "title": "2.10.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 253,
    "state": "closed",
    "created_at": "2022-04-27T08:14:38Z",
    "updated_at": "2023-01-13T10:46:24Z",
    "due_on": null,
    "closed_at": "2022-06-09T16:06:42Z"
  },
  "comments": 1,
  "created_at": "2022-04-22T16:21:01Z",
  "updated_at": "2022-04-29T16:34:40Z",
  "closed_at": "2022-04-29T16:34:37Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIt looks like a `-Dstart-containers` guard is missing on `NativeImageBuildContainerRunnerTest` in `quarkus/core/deployment`. It's necessary to install Docker or Podman for the test to pass, even without `-Dstart-containers`; otherwise the test fails and breaks the build. This isn't consistent with [CONTRIBUTING.md](https://github.com/quarkusio/quarkus/blob/main/CONTRIBUTING.md): \r\n\r\n> Docker is not strictly necessary: it is used to run the MariaDB and PostgreSQL tests which are not enabled by default. \r\n\r\nIt may be that containers are now required for too much of the core function, and maybe we should decide to make a container runtime a requirement. If we do, we should be intentional and update the documentation.\n\n### Expected behavior\n\nDocker shouldn't be necessary for a normal build with the default set of tests to run cleanly. \n\n### Actual behavior\n\nThe build fails:\r\n\r\n```\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD FAILURE\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time:  01:28 min\r\n[INFO] Finished at: 2022-04-22T16:51:47+01:00\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M5:test (default-test) on project quarkus-core-deployment: There are test failures.\r\n[ERROR] \r\n[ERROR] Please refer to /Users/holly/Code/quarkus/main/quarkus/core/deployment/target/surefire-reports for the individual test results.\r\n```\r\n\r\nThe failure is:\r\n\r\n```\r\n-------------------------------------------------------------------------------\r\nTest set: io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunnerTest\r\n-------------------------------------------------------------------------------\r\nTests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.008 s <<< FAILURE! - in io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunnerTest\r\nio.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunnerTest.testBuilderImageBeingPickedUp  Time elapsed: 0.007 s  <<< ERROR!\r\njava.lang.IllegalStateException: No container runtime was found to. Make sure you have Docker or Podman installed in your environment.\r\n\tat io.quarkus.runtime.util.ContainerRuntimeUtil.detectContainerRuntime(ContainerRuntimeUtil.java:38)\r\n\tat java.base/java.util.Optional.orElseGet(Optional.java:364)\r\n\tat io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner.<init>(NativeImageBuildContainerRunner.java:32)\r\n\tat io.quarkus.deployment.pkg.steps.NativeImageBuildLocalContainerRunner.<init>(NativeImageBuildLocalContainerRunner.java:20)\r\n\tat io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunnerTest.testBuilderImageBeingPickedUp(NativeImageBuildContainerRunnerTest.java:24)\r\n\tat java.base/\r\n```\n\n### How to Reproduce?\n\n1. Uninstall docker and podman (or start on a fresh machine image)\r\n1. ./mvnw -Dquickly -DskipTests=false\n\n### Output of `uname -a` or `ver`\n\nDarwin hcummins-mac 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:46:32 PDT 2022; root:xnu-8020.101.4~15/RELEASE_ARM64_T6000 arm64\n\n### Output of `java -version`\n\nopenjdk version \"18\" 2022-03-22 OpenJDK Runtime Environment Temurin-18+36 (build 18+36) OpenJDK 64-Bit Server VM Temurin-18+36 (build 18+36, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\ncommit 3ec92db4753163d97a7af10fa122bcdeab1dc53e (HEAD -> main, origin/main, origin/HEAD)\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: /Users/holly/.m2/wrapper/dists/apache-maven-3.8.4-bin/52ccbt68d252mdldqsfsn03jlf/apache-maven-3.8.4 Java version: 18, vendor: Eclipse Adoptium, runtime: /Library/Java/JavaVirtualMachines/temurin-18.jdk/Contents/Home Default locale: en_GB, platform encoding: UTF-8 OS name: \"mac os x\", version: \"12.3.1\", arch: \"aarch64\", family: \"mac\"\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25108/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
