{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/32328",
  "id": 1650469489,
  "node_id": "I_kwDOCFbutM5iYCpx",
  "number": 32328,
  "title": "native sources build step should tell the GraalVM version to use",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/243",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/243",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/243/labels",
    "id": 9220584,
    "node_id": "MI_kwDOCFbutM4AjLHo",
    "number": 243,
    "title": "3.0.0.CR2",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 70,
    "state": "closed",
    "created_at": "2023-03-29T07:10:43Z",
    "updated_at": "2023-07-20T16:42:53Z",
    "due_on": null,
    "closed_at": "2023-04-05T13:49:57Z"
  },
  "comments": 0,
  "created_at": "2023-04-01T13:13:30Z",
  "updated_at": "2023-04-03T11:28:50Z",
  "closed_at": "2023-04-03T11:28:45Z",
  "active_lock_reason": null,
  "body": "### Description\n\nWhen separating Java and native image compilation, I would like to know which GraalVM version is compatible.\r\n\r\nCurrently, we need to manually follow the version as described in the documentation and when using multiple version of Quarkus compatible with different versions of GraalVM it is not easy to have a single CI pipeline setup. As sometimes, newer versions of GraalVM are not compatible with older version of Quarkus, having one GraalVM version is not always an option.\r\n\r\nThus, it should be possible to get the GraalVM version that is recommended so we can install the correct one.\r\nIdeally, when combining `-Dnative-sources` and `-Dquarkus.native.container-build=true`, it should output the docker image name that Quarkus plugin would have use. The idea is to be able to do : \r\n\r\n```sh\r\ncd target/native-image\r\ndocker run \\\r\n  -it \\\r\n  --rm \\\r\n  --v $(pwd):/work \r\n  -w /work \r\n  --entrypoint bin/sh \\\r\n  $(cat native-builder.image) \\ \r\n  -c \"native-image $(cat native-image.args) -J-Xmx4g\"\r\n```\r\n\n\n### Implementation ideas\n\n`NativeImageBuildStep.nativeSourcesResult` could be augmented with something like\r\n\r\n```\r\nif(nativeConfig.isContainerBuild()){\r\n            try (FileOutputStream dockerImageNameFOS = new FileOutputStream(outputDir.resolve(\"native-builder.image\").toFile())) {\r\n                dockerImageNameFOS.write(nativeConfig.getEffectiveBuilderImage().getBytes(StandardCharsets.UTF_8));\r\n            } catch (Exception e) {\r\n                throw new RuntimeException(\"Failed to build native image sources\", e);\r\n            }\r\n        }\r\n        else {\r\n            try (FileOutputStream dockerImageNameFOS = new FileOutputStream(outputDir.resolve(\"graalvm.version\").toFile())) {\r\n                dockerImageNameFOS.write(GraalVM.Version.CURRENT.version.toString().getBytes(StandardCharsets.UTF_8));\r\n            } catch (Exception e) {\r\n                throw new RuntimeException(\"Failed to build native image sources\", e);\r\n            }\r\n        }\r\n```\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32328/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
