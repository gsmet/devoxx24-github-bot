{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41854",
  "id": 2404982610,
  "node_id": "I_kwDOCFbutM6PWR9S",
  "number": 41854,
  "title": "REST request fails after adding maven dependency to quarkus-opentelemetry",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1282136257,
      "node_id": "MDU6TGFiZWwxMjgyMTM2MjU3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/maven",
      "name": "area/maven",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1676631606,
      "node_id": "MDU6TGFiZWwxNjc2NjMxNjA2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/env/windows",
      "name": "env/windows",
      "color": "edea47",
      "default": false,
      "description": "Impacts Windows machines"
    },
    {
      "id": 2236031412,
      "node_id": "MDU6TGFiZWwyMjM2MDMxNDEy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/tracing",
      "name": "area/tracing",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/349",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/349",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/349/labels",
    "id": 11519060,
    "node_id": "MI_kwDOCFbutM4Ar8RU",
    "number": 349,
    "title": "3.14.2",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 1,
    "closed_issues": 66,
    "state": "open",
    "created_at": "2024-08-30T16:14:50Z",
    "updated_at": "2024-08-30T16:32:00Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 15,
  "created_at": "2024-07-12T07:54:47Z",
  "updated_at": "2024-08-30T16:30:03Z",
  "closed_at": "2024-08-29T13:24:27Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nAfter adding the _quarkus-opentelemetry_ dependency to our maven project, we have experienced endpoints using URL prefix and a default empty path is failing.\r\n\r\nIf we don't use URL prefix we don't see the error, and this is currently our workaround.\r\n\r\nApparently the way URLs are evaluated in _quarkus-opentelemetry_ is different from _resteasy reactive_\r\nI expect the solution to this issue is to use the same _getPathWithoutPrefix_ method both places.\r\n\r\nPlease have a look at https://github.com/quarkusio/quarkus/blob/main/extensions/resteasy-reactive/rest/runtime/src/main/java/io/quarkus/resteasy/reactive/server/runtime/observability/ObservabilityIntegrationRecorder.java#L119\r\nand\r\n https://github.com/quarkusio/quarkus/blob/main/independent-projects/resteasy-reactive/server/runtime/src/main/java/org/jboss/resteasy/reactive/server/core/ResteasyReactiveRequestContext.java#L431\r\n\r\nWhen the path evaluation is out of sync, we will get an error when calling _substring_ here: https://github.com/quarkusio/quarkus/blob/main/independent-projects/resteasy-reactive/server/runtime/src/main/java/org/jboss/resteasy/reactive/server/mapping/RequestMapper.java#L112\r\n\r\n### Expected behavior\r\n\r\nWe expect existing rest endpoint to keep working after adding the _quarkus-opentelemetry_ dependency\r\n\r\n### Actual behavior\r\n\r\nOur rest request fails after the _quarkus-opentelemetry_ dependency was added.\r\n\r\nThis is the returned stacktrace:\r\n```\r\n{\r\n    \"details\": \"Error id 657d1068-0aae-47f2-9bf6-f98dab005dc9-1, java.lang.StringIndexOutOfBoundsException: Range [1, 1) out of bounds for length 0\",\r\n    \"stack\": \"java.lang.StringIndexOutOfBoundsException: Range [1, 1) out of bounds for length 0\\r\\n\\tat java.base/jdk.internal.util.Preconditions$1.apply(Preconditions.java:55)\\r\\n\\tat java.base/jdk.internal.util.Preconditions$1.apply(Preconditions.java:52)\\r\\n\\tat java.base/jdk.internal.util.Preconditions$4.apply(Preconditions.java:213)\\r\\n\\tat java.base/jdk.internal.util.Preconditions$4.apply(Preconditions.java:210)\\r\\n\\tat java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:98)\\r\\n\\tat java.base/jdk.internal.util.Preconditions.outOfBoundsCheckFromToIndex(Preconditions.java:112)\\r\\n\\tat java.base/jdk.internal.util.Preconditions.checkFromToIndex(Preconditions.java:349)\\r\\n\\tat java.base/java.lang.String.checkBoundsBeginEnd(String.java:4865)\\r\\n\\tat java.base/java.lang.String.substring(String.java:2834)\\r\\n\\tat org.jboss.resteasy.reactive.server.mapping.RequestMapper.mapFromPathMatcher(RequestMapper.java:112)\\r\\n\\tat org.jboss.resteasy.reactive.server.mapping.RequestMapper.map(RequestMapper.java:53)\\r\\n\\tat io.quarkus.resteasy.reactive.server.runtime.observability.ObservabilityIntegrationRecorder.setTemplatePath(ObservabilityIntegrationRecorder.java:56)\\r\\n\\tat io.quarkus.resteasy.reactive.server.runtime.ResteasyReactiveRecorder$13.handle(ResteasyReactiveRecorder.java:352)\\r\\n\\tat io.quarkus.resteasy.reactive.server.runtime.ResteasyReactiveRecorder$13.handle(ResteasyReactiveRecorder.java:347)\\r\\n\\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1285)\\r\\n\\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:177)\\r\\n\\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:137)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler$3$1.onItem(HttpSecurityRecorder.java:311)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler$3$1.onItem(HttpSecurityRecorder.java:301)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:60)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.DefaultUniEmitter.complete(DefaultUniEmitter.java:37)\\r\\n\\tat io.smallrye.mutiny.groups.UniOnNull.lambda$failWith$1(UniOnNull.java:46)\\r\\n\\tat io.smallrye.context.impl.wrappers.SlowContextualBiConsumer.accept(SlowContextualBiConsumer.java:21)\\r\\n\\tat io.smallrye.mutiny.groups.UniOnItem.lambda$transformToUni$4(UniOnItem.java:177)\\r\\n\\tat io.smallrye.context.impl.wrappers.SlowContextualConsumer.accept(SlowContextualConsumer.java:21)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateWithEmitter.subscribe(UniCreateWithEmitter.java:22)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.performInnerSubscription(UniOnItemTransformToUni.java:81)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:57)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.forward(UniCreateFromKnownItem.java:38)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem.subscribe(UniCreateFromKnownItem.java:23)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni.subscribe(UniOnItemTransformToUni.java:25)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.groups.UniSubscribe.withSubscriber(UniSubscribe.java:51)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler$3.onItem(HttpSecurityRecorder.java:301)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler$3.onItem(HttpSecurityRecorder.java:286)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniMemoizeOp.forwardTo(UniMemoizeOp.java:123)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniMemoizeOp.notifyAwaiters(UniMemoizeOp.java:135)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniMemoizeOp.onItem(UniMemoizeOp.java:97)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:60)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.forward(UniCreateFromKnownItem.java:38)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem.subscribe(UniCreateFromKnownItem.java:23)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.performInnerSubscription(UniOnItemTransformToUni.java:81)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:57)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:60)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.forward(UniCreateFromKnownItem.java:38)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem.subscribe(UniCreateFromKnownItem.java:23)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.performInnerSubscription(UniOnItemTransformToUni.java:81)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:57)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransform$UniOnItemTransformProcessor.onItem(UniOnItemTransform.java:43)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransform$UniOnItemTransformProcessor.onItem(UniOnItemTransform.java:43)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.forward(UniCreateFromKnownItem.java:38)\\r\\n\\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem.subscribe(UniCreateFromKnownItem.java:23)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransform.subscribe(UniOnItemTransform.java:22)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransform.subscribe(UniOnItemTransform.java:22)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni.subscribe(UniOnItemTransformToUni.java:25)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni.subscribe(UniOnItemTransformToUni.java:25)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.groups.UniSubscribe.withSubscriber(UniSubscribe.java:51)\\r\\n\\tat io.smallrye.mutiny.operators.uni.UniMemoizeOp.subscribe(UniMemoizeOp.java:59)\\r\\n\\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\\r\\n\\tat io.smallrye.mutiny.groups.UniSubscribe.withSubscriber(UniSubscribe.java:51)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler.handle(HttpSecurityRecorder.java:286)\\r\\n\\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$AuthenticationHandler.handle(HttpSecurityRecorder.java:233)\\r\\n\\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1285)\\r\\n\\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:177)\\r\\n\\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:137)\\r\\n\\tat io.quarkus.vertx.http.runtime.devmode.VertxHttpHotReplacementSetup$5.handle(VertxHttpHotReplacementSetup.java:204)\\r\\n\\tat io.quarkus.vertx.http.runtime.devmode.VertxHttpHotReplacementSetup$5.handle(VertxHttpHotReplacementSetup.java:192)\\r\\n\\tat io.vertx.core.impl.future.FutureImpl$4.onSuccess(FutureImpl.java:176)\\r\\n\\tat io.vertx.core.impl.future.FutureBase.lambda$emitSuccess$0(FutureBase.java:60)\\r\\n\\tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\\r\\n\\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\\r\\n\\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\\r\\n\\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\\r\\n\\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\\r\\n\\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\\r\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:1583)\"\r\n}\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nI have created a small project that reproduces the issue.\r\n\r\nStart the server and make a request for http://localhost:8080/demo\r\nNotice the issue only occur when we have another rest endpoint defined that takes URL parameters. \r\n[rest-json-quickstart.zip](https://github.com/user-attachments/files/16190422/rest-json-quickstart.zip)\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nMicrosoft Windows [Version 10.0.19045.4529]\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"21.0.2\" 2024-01-16 LTS\r\n\r\n### Quarkus version or git rev\r\n\r\n3.12.2\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.2 (c9616018c7a021c1c39be70fb2843d6f5f9b8a1c)\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41854/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
