{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25325",
  "id": 1223823607,
  "node_id": "I_kwDOCFbutM5I8hD3",
  "number": 25325,
  "title": "JAXB2 ClassCastException in Native Image (XmlSeeAlso$$ProxyImpl cannot be cast to Locatable)",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1683744663,
      "node_id": "MDU6TGFiZWwxNjgzNzQ0NjYz",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/jaxb",
      "name": "area/jaxb",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/183",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/183/labels",
    "id": 7917759,
    "node_id": "MI_kwDOCFbutM4AeNC_",
    "number": 183,
    "title": "2.10.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 253,
    "state": "closed",
    "created_at": "2022-04-27T08:14:38Z",
    "updated_at": "2023-01-13T10:46:24Z",
    "due_on": null,
    "closed_at": "2022-06-09T16:06:42Z"
  },
  "comments": 11,
  "created_at": "2022-05-03T08:34:59Z",
  "updated_at": "2022-06-01T14:15:03Z",
  "closed_at": "2022-06-01T14:14:58Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nAfter upgrading Quarkus from 2.8.0 to 2.8.1 our RestEasy XML Endpoint is failing on generated JAXB2 Classes.\r\n\r\nWhen a request is processed and the response should be returned Quarkus throws the following exception:\r\n```\r\n2022-05-03 08:16:13,974 WARN  [org.lfe.com.cor.jax.exc.GenericExceptionHandler] (executor-thread-0) Unknown exception occurred.: java.lang.ClassCastException: javax.xml.bind.annotation.XmlSeeAlso$$ProxyImpl cannot be cast to com.sun.xml.bind.v2.model.annotation.Locatable\r\n\tat com.sun.xml.bind.v2.model.impl.ModelBuilder.getClassInfo(ModelBuilder.java:260)\r\n\tat com.sun.xml.bind.v2.model.impl.RuntimeModelBuilder.getClassInfo(RuntimeModelBuilder.java:73)\r\n\tat com.sun.xml.bind.v2.model.impl.RuntimeModelBuilder.getClassInfo(RuntimeModelBuilder.java:54)\r\n\tat com.sun.xml.bind.v2.model.impl.ClassInfoImpl.getBaseClass(ClassInfoImpl.java:198)\r\n\tat com.sun.xml.bind.v2.model.impl.RuntimeClassInfoImpl.getBaseClass(RuntimeClassInfoImpl.java:125)\r\n\tat com.sun.xml.bind.v2.model.impl.RuntimeClassInfoImpl.getBaseClass(RuntimeClassInfoImpl.java:56)\r\n\tat com.sun.xml.bind.v2.model.impl.ModelBuilder.getClassInfo(ModelBuilder.java:248)\r\n```\r\n\r\nThe native image worked with version 2.8.0. And also the non-native images still works with version 2.8.2.\r\nThe model is generated by a other maven project using JAXB2 from XSD Files.\r\n\r\nThe image is build using Maven with a Docker Container. \r\nCommand: mvn clean verify -Pnative -Dquarkus.container-image.build=true\r\n\r\nIt look like PR #24768 may have caused this, because searching for this kind of errors, often similar changes are mentions, but these are partially removed in this PR. Also in this PR there is a discussion about the GraalVM version 22.1, but with Quarkus 2.8.1 this is still 22.0, maybe this is something causing the problem.\n\n### Expected behavior\n\nThe response being created and returned.\n\n### Actual behavior\n\nClassCastException thrown\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\nLinux ubuntu 5.13.0-40-generic #45-Ubuntu SMP Tue Mar 29 14:48:14 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"11.0.15\" 2022-04-19 OpenJDK Runtime Environment (build 11.0.15+10-Ubuntu-0ubuntu0.21.10.1) OpenJDK 64-Bit Server VM (build 11.0.15+10-Ubuntu-0ubuntu0.21.10.1, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\nRunning Quarkus native-image plugin on GraalVM 22.0.0.2 Java 11 CE (Java Version 11.0.14+9-jvmci-22.0-b05)\n\n### Quarkus version or git rev\n\n2.8.2.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.1 (05c21c65bdfed0f71a2f2ada8b84da59348c4c5d) Maven home: /home/dlabordus/.m2/wrapper/dists/apache-maven-3.8.1-bin/2l5mhf2pq2clrde7f7qp1rdt5m/apache-maven-3.8.1 Java version: 11.0.15, vendor: Private Build, runtime: /usr/lib/jvm/java-11-openjdk-amd64 Default locale: en_GB, platform encoding: UTF-8 OS name: \"linux\", version: \"5.13.0-40-generic\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\nPart of the Maven output:\r\n\r\n```\r\n[INFO] --- quarkus-maven-plugin:2.8.2.Final:build (default) @ app ---\r\n[WARNING] [io.quarkus.deployment.steps.ReflectiveHierarchyStep] Unable to properly register the hierarchy of the following classes for reflection as they are not in the Jandex index:\r\n\t- javax.xml.namespace.QName (source: SmallRyeOpenApiProcessor > org.lfenergy.compas.cim.mapping.rest.v1.model.MapResponse)\r\nConsider adding them to the index either by creating a Jandex index for your dependency via the Maven plugin, an empty META-INF/beans.xml or quarkus.index-dependency properties.\r\n[INFO] [io.quarkus.deployment.pkg.steps.JarResultBuildStep] Building native image source jar: /home/dlabordus/projects/compas/compas-cim-mapping/app/target/app-local-SNAPSHOT-native-image-source-jar/app-local-SNAPSHOT-runner.jar\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Building native image from /home/dlabordus/projects/compas/compas-cim-mapping/app/target/app-local-SNAPSHOT-native-image-source-jar/app-local-SNAPSHOT-runner.jar\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner] Using docker to run the native image builder\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner] Checking image status quay.io/quarkus/ubi-quarkus-native-image:22.0-java11\r\n22.0-java11: Pulling from quarkus/ubi-quarkus-native-image\r\nDigest: sha256:44fe2378937b3b0b6f64189f68fda629dfc090370239cec8a8f1496d3f1d96e7\r\nStatus: Image is up to date for quay.io/quarkus/ubi-quarkus-native-image:22.0-java11\r\nquay.io/quarkus/ubi-quarkus-native-image:22.0-java11\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on GraalVM 22.0.0.2 Java 11 CE (Java Version 11.0.14+9-jvmci-22.0-b05)\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] docker run --env LANG=C --rm --user 1000:1000 -v /home/dlabordus/projects/compas/compas-cim-mapping/app/target/app-local-SNAPSHOT-native-image-source-jar:/project:z --name build-native-hqVmc quay.io/quarkus/ubi-quarkus-native-image:22.0-java11 -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Dcom.sun.xml.bind.v2.bytecode.ClassTailor.noOptimize=true -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Duser.language=en -J-Duser.country=GB -J-Dfile.encoding=UTF-8 -H:-ParseOnce -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED --initialize-at-run-time=org.eclipse.rdf4j.common.iteration.TimeLimitIteration --initialize-at-run-time=org.apache.http.impl.auth.NTLMEngineImpl -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -H:+AllowFoldMethods -J-Djava.awt.headless=true -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:-AddAllCharsets -H:EnableURLProtocols=http,https -H:-UseServiceLoaderFeature -H:+StackTrace app-local-SNAPSHOT-runner -jar app-local-SNAPSHOT-runner.jar\r\n========================================================================================================================\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25325/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
