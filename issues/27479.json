{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27479",
  "id": 1349226389,
  "node_id": "I_kwDOCFbutM5Qa4-V",
  "number": 27479,
  "title": "Native Image Build - Reuse-Existing requires docker runtime",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1891982257,
      "node_id": "MDU6TGFiZWwxODkxOTgyMjU3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/container-image",
      "name": "area/container-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/204",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/204",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/204/labels",
    "id": 8384152,
    "node_id": "MI_kwDOCFbutM4Af-6Y",
    "number": 204,
    "title": "2.12.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 77,
    "state": "closed",
    "created_at": "2022-09-05T19:04:15Z",
    "updated_at": "2022-09-13T05:31:24Z",
    "due_on": null,
    "closed_at": "2022-09-07T11:32:02Z"
  },
  "comments": 4,
  "created_at": "2022-08-24T10:36:31Z",
  "updated_at": "2022-09-05T19:06:01Z",
  "closed_at": "2022-08-29T08:37:55Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI am attempting to develop a two part Quarkus CI Pipeline in Jenkins. The process is to build the core artifact and then run the image build and push per target registry. So:\r\n\r\n1. Build Artifact with Tests and Reports (docker agent)\r\n2. Build the image (node agent with docker install)\r\n3. Push to Reg1 (docker agent)\r\n4. Push to Reg2 (docker agent)\r\n\r\nThis works fine for JVM builds but fails for Native Images.\r\n\r\nDuring Stage 2 I build the native executable when a 'Native' parameter is set. For Stages 3 & 4, I use a command like so:\r\n\r\n```\r\nmvn package $MVN_OPTS -DskipTests -Dquarkus.container-image.build=true \\\r\n    -Dquarkus.container-image.builder=jib \\\r\n    -Dquarkus.container-image.push=true \\\r\n    -Dquarkus.container-image.tag=$tag \\\r\n    -Dquarkus.container-image.registry=$registry \\\r\n    -Dquarkus.native.reuse-existing=true -Pnative\r\n```\n\n### Expected behavior\n\nI expect that the JIB builder will construct the image, set the correct entrypoint and push the image to registry without requiring an intermediate container-runtime\n\n### Actual behavior\n\nThe build fails\r\n\r\n```\r\n17:26:32  Caused by: java.lang.IllegalStateException: No container runtime was found to run the native image builder. Make sure you have Docker or Podman installed in your environment.\r\n17:26:32      at io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner.detectContainerRuntime (NativeImageBuildContainerRunner.java:151)\r\n17:26:32      at java.util.Optional.orElseGet (Optional.java:369)\r\n17:26:32      at io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner.<init> (NativeImageBuildContainerRunner.java:33)\r\n17:26:32      at io.quarkus.deployment.pkg.steps.NativeImageBuildLocalContainerRunner.<init> (NativeImageBuildLocalContainerRunner.java:19)\r\n17:26:32      at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.getNativeImageBuildRunner (NativeImageBuildStep.java:291)\r\n17:26:32      at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build (NativeImageBuildStep.java:177)\r\n17:26:32      at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0 (Native Method)\r\n17:26:32      at jdk.internal.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:62)\r\n17:26:32      at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:43)\r\n17:26:32      at java.lang.reflect.Method.invoke (Method.java:566)\r\n17:26:32      at io.quarkus.deployment.ExtensionLoader$2.execute (ExtensionLoader.java:887)\r\n17:26:32      at io.quarkus.builder.BuildContext.run (BuildContext.java:277)\r\n17:26:32      at org.jboss.threads.ContextHandler$1.runWith (ContextHandler.java:18)\r\n17:26:32      at org.jboss.threads.EnhancedQueueExecutor$Task.run (EnhancedQueueExecutor.java:2449)\r\n17:26:32      at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run (EnhancedQueueExecutor.java:1478)\r\n17:26:32      at java.lang.Thread.run (Thread.java:829)\r\n17:26:32      at org.jboss.threads.JBossThread.run (JBossThread.java:501)\r\n```\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\nJava version: 11.0.16, vendor: Oracle Corporation, runtime: /usr/local/openjdk-11\n\n### GraalVM version (if different from Java)\n\nContainer Build\n\n### Quarkus version or git rev\n\n2.6.3.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nmaven:3.8.6\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27479/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
