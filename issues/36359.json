{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36359",
  "id": 1933255341,
  "node_id": "I_kwDOCFbutM5zOyKt",
  "number": 36359,
  "title": "Quarkus ignores all \"quarkus.*\" environment properties on Kubernetes",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/283",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/283",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/283/labels",
    "id": 10061188,
    "node_id": "MI_kwDOCFbutM4AmYWE",
    "number": 283,
    "title": "3.5.0",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 34,
    "state": "closed",
    "created_at": "2023-10-17T15:15:06Z",
    "updated_at": "2023-11-02T12:52:54Z",
    "due_on": null,
    "closed_at": "2023-10-18T14:31:42Z"
  },
  "comments": 16,
  "created_at": "2023-10-09T14:47:45Z",
  "updated_at": "2023-11-13T11:18:27Z",
  "closed_at": "2023-10-30T17:21:35Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI have an application, which uses consul, I use property \"quarkus.consul-config.agent.host-port\" to provide the application with path to deployed consul instance. Starting from 6 or 7 of October, when I deploy this app on Openshift using 999-SNAPSHOT build, the app can not retrieve this property and fails to start.\r\nThe property is stored in openshift DeploymentConfig as \"template.spec.containers.env.name\".\r\nIf the property is put into property file, or the property variable inside the yaml is renamed into \"QUARKUS_CONSUL_CONFIG_AGENT_HOST_PORT\", then everything works fine.\n\n### Expected behavior\n\nApplication starts succefully\n\n### Actual behavior\n\nApplication fails with the following error:\r\n\r\n```\r\n16:07:48,407 INFO  [app] java.lang.RuntimeException: Failed to start quarkus\r\n16:07:48,408 INFO  [app] \tat io.quarkus.runner.ApplicationImpl.doStart(Unknown Source)\r\n16:07:48,408 INFO  [app] \tat io.quarkus.runtime.Application.start(Application.java:101)\r\n16:07:48,409 INFO  [app] \tat io.quarkus.runtime.ApplicationLifecycleManager.run(ApplicationLifecycleManager.java:111)\r\n16:07:48,409 INFO  [app] \tat io.quarkus.runtime.Quarkus.run(Quarkus.java:71)\r\n16:07:48,409 INFO  [app] \tat io.quarkus.runtime.Quarkus.run(Quarkus.java:44)\r\n16:07:48,410 INFO  [app] \tat io.quarkus.runtime.Quarkus.run(Quarkus.java:124)\r\n16:07:48,410 INFO  [app] \tat io.quarkus.runner.GeneratedMain.main(Unknown Source)\r\n16:07:48,411 INFO  [app] \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n16:07:48,411 INFO  [app] \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n16:07:48,411 INFO  [app] \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n16:07:48,412 INFO  [app] \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n16:07:48,412 INFO  [app] \tat io.quarkus.bootstrap.runner.QuarkusEntryPoint.doRun(QuarkusEntryPoint.java:61)\r\n16:07:48,413 INFO  [app] \tat io.quarkus.bootstrap.runner.QuarkusEntryPoint.main(QuarkusEntryPoint.java:32)\r\n16:07:48,413 INFO  [app] Caused by: java.lang.RuntimeException: An error occurred while attempting to fetch configuration from Consul.\r\n16:07:48,413 INFO  [app] \tat io.quarkus.consul.config.runtime.ConsulConfigSourceFactory.getConfigSources(ConsulConfigSourceFactory.java:82)\r\n16:07:48,414 INFO  [app] \tat io.quarkus.consul.config.runtime.ConsulConfigSourceFactory.getConfigSources(ConsulConfigSourceFactory.java:28)\r\n16:07:48,414 INFO  [app] \tat io.quarkus.consul.config.runtime.ConsulConfigSourceFactory.getConfigSources(ConsulConfigSourceFactory.java:19)\r\n16:07:48,415 INFO  [app] \tat io.smallrye.config.ConfigSourceFactory$ConfigurableConfigSourceFactory.getConfigSources(ConfigSourceFactory.java:58)\r\n16:07:48,415 INFO  [app] \tat io.smallrye.config.ConfigurableConfigSource.getConfigSources(ConfigurableConfigSource.java:50)\r\n16:07:48,416 INFO  [app] \tat io.smallrye.config.SmallRyeConfig$ConfigSources.mapLateSources(SmallRyeConfig.java:687)\r\n16:07:48,416 INFO  [app] \tat io.smallrye.config.SmallRyeConfig$ConfigSources.<init>(SmallRyeConfig.java:577)\r\n16:07:48,416 INFO  [app] \tat io.smallrye.config.SmallRyeConfig.<init>(SmallRyeConfig.java:68)\r\n16:07:48,417 INFO  [app] \tat io.smallrye.config.SmallRyeConfigBuilder.build(SmallRyeConfigBuilder.java:698)\r\n16:07:48,417 INFO  [app] \tat io.quarkus.runtime.generated.Config.readConfig(Unknown Source)\r\n16:07:48,417 INFO  [app] \tat io.quarkus.runtime.generated.Config.createRunTimeConfig(Unknown Source)\r\n16:07:48,418 INFO  [app] \tat io.quarkus.deployment.steps.RuntimeConfigSetup.deploy(Unknown Source)\r\n16:07:48,418 INFO  [app] \t... 13 more\r\n16:07:48,419 INFO  [app] Caused by: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:8500\r\n16:07:48,419 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniBlockingAwait.await(UniBlockingAwait.java:79)\r\n16:07:48,420 INFO  [app] \tat io.smallrye.mutiny.groups.UniAwait.atMost(UniAwait.java:65)\r\n16:07:48,420 INFO  [app] \tat io.quarkus.consul.config.runtime.ConsulConfigSourceFactory.getConfigSources(ConsulConfigSourceFactory.java:79)\r\n16:07:48,420 INFO  [app] \t... 24 more\r\n16:07:48,421 INFO  [app] Caused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:8500\r\n16:07:48,422 INFO  [app] Caused by: java.net.ConnectException: Connection refused\r\n16:07:48,422 INFO  [app] \tat java.base/sun.nio.ch.Net.pollConnect(Native Method)\r\n16:07:48,422 INFO  [app] \tat java.base/sun.nio.ch.Net.pollConnectNow(Net.java:672)\r\n16:07:48,423 INFO  [app] \tat java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:946)\r\n16:07:48,423 INFO  [app] \tat io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:337)\r\n16:07:48,424 INFO  [app] \tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334)\r\n16:07:48,424 INFO  [app] \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:776)\r\n16:07:48,425 INFO  [app] \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\n16:07:48,425 INFO  [app] \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\n16:07:48,425 INFO  [app] \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\n16:07:48,426 INFO  [app] \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n16:07:48,426 INFO  [app] \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n16:07:48,427 INFO  [app] \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n16:07:48,427 INFO  [app] \tat java.base/java.lang.Thread.run(Thread.java:833)\r\n```\n\n### How to Reproduce?\n\n1. ` git clone git@github.com:quarkus-qe/quarkus-test-framework.git`\r\n2. `mvn clean install -Pframework`\r\n3. Log in into openshift\r\nThis fails: \" mvn clean install -Pexamples,openshift -pl examples/consul/ -Dit.test=OpenShiftGreetingResourceIT -Dquarkus.platform.version=999-SNAPSHOT\"\r\nThis works as expected: `mvn clean install -Pexamples,openshift -pl examples/consul/ -Dit.test=OpenShiftGreetingResourceIT -Dquarkus.platform.version=3.4.2`\r\n\r\nIf option `-Dts.global.delete.folder.on.exit=false` is added, then yaml file `examples/consul/target/OpenShiftGreetingResourceIT/app/openshift.yml` contains deployment config\r\nBy default, the project is cleared afterwards, add `-Dts.openshift.delete.project.after.all=false -Dts.openshift.ephemeral.namespaces.enabled=false` to use the persistent one\n\n### Output of `uname -a` or `ver`\n\n6.4.14-200.fc38.x86_64\n\n### Output of `java -version`\n\n17.0.5, vendor: GraalVM Community\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n6be99a4aeb0107e3104e05dd7cd50e6b8f1533a1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.7 (b89d5959fcde851dcb1c8946a785a163f14e1e29)\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36359/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
