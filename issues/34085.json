{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/34085",
  "id": 1760073288,
  "node_id": "I_kwDOCFbutM5o6JZI",
  "number": 34085,
  "title": "No gRPC response when no separate server is used & quarkus-keycloak-authorization is present",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1676631606,
      "node_id": "MDU6TGFiZWwxNjc2NjMxNjA2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/env/windows",
      "name": "env/windows",
      "color": "edea47",
      "default": false,
      "description": "Impacts Windows machines"
    },
    {
      "id": 2062531368,
      "node_id": "MDU6TGFiZWwyMDYyNTMxMzY4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/grpc",
      "name": "area/grpc",
      "color": "0366d6",
      "default": false,
      "description": "gRPC"
    },
    {
      "id": 3289887215,
      "node_id": "MDU6TGFiZWwzMjg5ODg3MjE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/keycloak",
      "name": "area/keycloak",
      "color": "0366d6",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/261",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261/labels",
    "id": 9620417,
    "node_id": "MI_kwDOCFbutM4AksvB",
    "number": 261,
    "title": "3.2.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 137,
    "state": "closed",
    "created_at": "2023-07-05T15:27:44Z",
    "updated_at": "2023-08-07T13:21:27Z",
    "due_on": null,
    "closed_at": "2023-07-19T13:26:50Z"
  },
  "comments": 17,
  "created_at": "2023-06-16T07:20:43Z",
  "updated_at": "2023-07-18T16:17:26Z",
  "closed_at": "2023-07-06T17:45:51Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nCombination of trying to use the same http vertx server for grpc and having keycloak-authorization, seems to break the flow and stopping actual grpc service implementation being invoked.\r\n\r\nOn debugging the only difference between with & without keycloack is that, when keycloak is present the HttpAuthorizer gets executed in a blocking fashion as a runnable and the subsequent grpc handler too gets executed on this executor thread instead of the eventloop thread.\r\n\r\nPlease suggest whether this a bug.\r\nHappy to help with additional information if needed\n\n### Expected behavior\n\nOn setting  quarkus.grpc.server.use-separate-server=false when keycloak-authorization is present, the security Identity to be validated via the HttpAuthorizer and respective grpc service implementation triggered and response returned.\n\n### Actual behavior\n\nOn setting  quarkus.grpc.server.use-separate-server=false when keycloak-authorization is present, the security identity is validated via the HttpAuthorizer and gets validated. \r\nPost which the grpc server handler and interceptors are invoked, but the grpc service implementation is not invoked.\r\nEventually no grpc response leaving the grpc client hanging.\n\n### How to Reproduce?\n\nReproducer:\r\n\r\n1. Use grpc-plain-text-quickstart \r\n2. Add property quarkus.grpc.server.use-separate-server=false\r\n3. Add quarkus-oidc & quarkus-keycloak-authorization dependency\r\n4. Copy the security configurations from security-keycloak-authorization-quickstart\r\n5. Generate a bearer token and add it as part of the grpc request ( I have used grpcul for this `./grpcurl -plaintext -H 'authorization: Bearer ${TOKEN}' -expand-headers -d '{\"name\":\"test\"}' -vv localhost:8080 helloworld.Greeter/sayHello`\n\n### Output of `uname -a` or `ver`\n\nMicrosoft Windows [Version 10.0.22621.1778]\n\n### Output of `java -version`\n\nopenjdk version \"11.0.11\" 2021-04-20 OpenJDK Runtime Environment AdoptOpenJDK-11.0.11+9 (build 11.0.11+9) OpenJDK 64-Bit Server VM AdoptOpenJDK-11.0.11+9 (build 11.0.11+9, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.16.7.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34085/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
