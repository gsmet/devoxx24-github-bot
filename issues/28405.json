{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/28405",
  "id": 1397780363,
  "node_id": "I_kwDOCFbutM5TUG-L",
  "number": 28405,
  "title": "RejectedExecutionException in fabric8 when checking status of amq-streams operator",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 9,
  "created_at": "2022-10-05T13:17:37Z",
  "updated_at": "2022-10-06T10:18:27Z",
  "closed_at": "2022-10-05T18:22:55Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI have an application, which deploys Kafka on Openshift via amq-streams operator, checks it status, connects to it via quarkus-smallrye-reactive-messaging-kafka and when deletes it. It uses fabric8 library to check status of the operator. This works flawlessly with Quarkus 2.13.0.Final, but fails when running with 999-SNAPSHOT\r\n\r\n### Expected behavior\r\n\r\nThe scenario should work without failures.\r\n\r\n### Actual behavior\r\n\r\nThe scenario fails with this stacktrace:\r\n\r\n```\r\nSEVERE Caught exception while closing extension context: org.junit.jupiter.engine.descriptor.ClassExtensionContext@50b46e24: io.fabric8.kubernetes.client.KubernetesClientException: Operation: [get]  for kind: [Kafka]  with name: [kafka-instance]  in namespace: [ts-yffbyetnae]  failed.\r\n\tat io.fabric8.kubernetes.client.KubernetesClientException.launderThrowable(KubernetesClientException.java:159)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.BaseOperation.getMandatory(BaseOperation.java:177)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.BaseOperation.get(BaseOperation.java:139)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.BaseOperation.get(BaseOperation.java:88)\r\n\tat io.quarkus.test.bootstrap.inject.OpenShiftClient.isCustomResourceReady(OpenShiftClient.java:503)\r\n\tat io.quarkus.test.services.operator.OperatorManagedResource.lambda$customResourcesAreReady$0(OperatorManagedResource.java:87)\r\n\tat java.base/java.util.stream.MatchOps$1MatchSink.accept(MatchOps.java:90)\r\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.tryAdvance(ArrayList.java:1632)\r\n\tat java.base/java.util.stream.ReferencePipeline.forEachWithCancel(ReferencePipeline.java:127)\r\n\tat java.base/java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:502)\r\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:488)\r\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\r\n\tat java.base/java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:230)\r\n\tat java.base/java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:196)\r\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.base/java.util.stream.ReferencePipeline.allMatch(ReferencePipeline.java:533)\r\n\tat io.quarkus.test.services.operator.OperatorManagedResource.customResourcesAreReady(OperatorManagedResource.java:87)\r\n\tat io.quarkus.test.services.operator.OperatorManagedResource.isRunning(OperatorManagedResource.java:53)\r\n\tat io.quarkus.test.bootstrap.BaseService.isRunning(BaseService.java:129)\r\n\tat io.quarkus.test.bootstrap.BaseService.stop(BaseService.java:210)\r\n\tat io.quarkus.test.bootstrap.BaseService.close(BaseService.java:227)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.jupiter.engine.execution.ExtensionValuesStore.lambda$closeAllStoredCloseableValues$3(ExtensionValuesStore.java:68)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\r\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195)\r\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\r\n\tat java.base/java.util.stream.SortedOps$RefSortingSink.end(SortedOps.java:395)\r\n\tat java.base/java.util.stream.Sink$ChainedReference.end(Sink.java:258)\r\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:485)\r\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\r\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)\r\n\tat org.junit.jupiter.engine.execution.ExtensionValuesStore.closeAllStoredCloseableValues(ExtensionValuesStore.java:68)\r\n\tat org.junit.jupiter.engine.descriptor.AbstractExtensionContext.close(AbstractExtensionContext.java:80)\r\n\tat org.junit.jupiter.engine.execution.JupiterEngineExecutionContext.close(JupiterEngineExecutionContext.java:53)\r\n\tat org.junit.jupiter.engine.descriptor.JupiterTestDescriptor.cleanUp(JupiterTestDescriptor.java:222)\r\n\tat org.junit.jupiter.engine.descriptor.JupiterTestDescriptor.cleanUp(JupiterTestDescriptor.java:57)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$cleanUp$10(NodeTestTask.java:167)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.cleanUp(NodeTestTask.java:167)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:98)\r\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\r\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\r\n\tat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\r\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:147)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:127)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:90)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:55)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:102)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:54)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)\r\n\tat org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)\r\n\tat org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)\r\n\tat org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)\r\n\tat org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\r\nCaused by: java.io.InterruptedIOException: executor rejected\r\n\tat okhttp3.RealCall$AsyncCall.executeOn(RealCall.java:157)\r\n\tat okhttp3.Dispatcher.promoteAndExecute(Dispatcher.java:204)\r\n\tat okhttp3.Dispatcher.enqueue(Dispatcher.java:144)\r\n\tat okhttp3.RealCall.enqueue(RealCall.java:93)\r\n\tat io.fabric8.kubernetes.client.okhttp.OkHttpClientImpl.sendAsync(OkHttpClientImpl.java:264)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.retryWithExponentialBackoff(OperationSupport.java:598)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.handleResponse(OperationSupport.java:577)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.handleResponse(OperationSupport.java:558)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.OperationSupport.handleGet(OperationSupport.java:469)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.BaseOperation.handleGet(BaseOperation.java:711)\r\n\tat io.fabric8.kubernetes.client.dsl.internal.BaseOperation.getMandatory(BaseOperation.java:172)\r\n\t... 70 more\r\nCaused by: java.util.concurrent.RejectedExecutionException: Task okhttp3.RealCall$AsyncCall@51c65a43 rejected from java.util.concurrent.ThreadPoolExecutor@740dcae3[Shutting down, pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 165]\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2055)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:825)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1355)\r\n\tat okhttp3.RealCall$AsyncCall.executeOn(RealCall.java:154)\r\n\t... 80 more\r\n\r\n```\r\n\r\n### How to Reproduce?\r\n\r\n1. `git clone git@github.com:quarkus-qe/quarkus-test-suite.git`\r\n2. Connect to openshift installation and verify, that `oc` binary exists on $PATH\r\n3. Run test: `mvn clean verify -Popenshift -pl messaging/kafka-streams-reactive-messaging/ -Dall-modules -Dit.test=OperatorOpenShiftAmqStreamsKafkaStreamIT`. It should fail.\r\n4. Run the same test, but with 2.13: `mvn clean verify -Popenshift -pl messaging/kafka-streams-reactive-messaging/ -Dall-modules -Dit.test=OperatorOpenShiftAmqStreamsKafkaStreamIT -Dquarkus.platform.version=2.13.0.Final`. It should succeed.\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n`5.19.11-200.fc36.x86_64`\r\n\r\n### Output of `java -version`\r\n\r\n`11.0.16`\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n`6dad45448433bbe1b902d3ac3db6ea4782195197`\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n`Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)`\r\n\r\n### Additional information\r\n\r\n```\r\n$ oc version\r\nClient Version: 4.11.0-202208020706.p0.g7075089.assembly.stream-7075089\r\nKustomize Version: v4.5.4\r\nKubernetes Version: v1.24.0+3882f8f\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28405/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
