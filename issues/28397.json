{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/28397",
  "id": 1397498771,
  "node_id": "I_kwDOCFbutM5TTCOT",
  "number": 28397,
  "title": "Smallrye-OpenAPI: Don't produce any CORS headers by default in production when CORS is disabled",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1283619446,
      "node_id": "MDU6TGFiZWwxMjgzNjE5NDQ2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye",
      "name": "area/smallrye",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1336727006,
      "node_id": "MDU6TGFiZWwxMzM2NzI3MDA2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/openapi",
      "name": "area/openapi",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/228",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/228",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/228/labels",
    "id": 8842745,
    "node_id": "MI_kwDOCFbutM4Ahu35",
    "number": 228,
    "title": "3.0.0.Alpha4",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 323,
    "state": "closed",
    "created_at": "2023-01-11T08:43:57Z",
    "updated_at": "2023-07-20T16:42:38Z",
    "due_on": null,
    "closed_at": "2023-02-09T15:24:11Z"
  },
  "comments": 13,
  "created_at": "2022-10-05T09:22:34Z",
  "updated_at": "2023-01-30T16:59:53Z",
  "closed_at": "2023-01-30T16:59:49Z",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nCurrently, when Smallrye-OpenAPI is included in the application, and [CORS filters](https://quarkus.io/guides/http-reference#cors-filter) are not enabled, the endpoint returning the OpenAPI definitions will automatically add wildcard CORS headers to its responses, effectively silencing browser CORS errors without actually securing CORS.\r\n\r\nEven though this is only for a read-only, theoretically safe OpenAPI endpoint, this is admittedly a questionable practice on paper. To the point that we're [warning about CORS filters needing to be enabled in the documentation](https://quarkus.io/guides/openapi-swaggerui#cross-origin-resource-sharing) and logging about it at info level on startup (#28377), partly because it's not a best practice and partly because vulnerability detection tools would otherwise complain about it.\r\n\r\nSince the log message is annoying, and the general opinion seems to be that wildcard CORS headers are insecure, maybe we should stop doing that?\r\n\r\nIn production mode, we would simply not add any CORS header when there's no CORS configuration. Some users, depending on their use case, would get CORS errors in their browser, which would lead them to look for information about CORS in Quarkus, and hopefully to configuring CORS properly. Whether or not they do that, their application would be, in the worst case, just as secure as it is now.\r\n\r\nBecause some users would get CORS errors in their browser, this is a breaking change and must been planned carefully (next major?).\r\n\r\nSee #28377 / #28384 for the full conversation.\r\n\r\n### Implementation ideas\r\n\r\nIn the next major of Quarkus, I would:\r\n\r\n* Change `io.quarkus.smallrye.openapi.runtime.OpenApiHandler` to not add any CORS headers by itself **in production mode**, and let Vert.x take care of that if CORS is configured (`quarkus.http.cors`).\r\n* Remove the (now irrelevant) log on startup: https://github.com/quarkusio/quarkus/blob/1f63436a8b2d94c7dd21ea31bc8c16a69dd08e47/extensions/smallrye-openapi/runtime/src/main/java/io/quarkus/smallrye/openapi/runtime/OpenApiRecorder.java#L47-L49\r\n* Add an entry to the migration guide (\"you now need to configure CORS if requesting the OpenAPI definition from another domain in your browser, as the INFO message has been telling you since forever\")\r\n* Maybe update the [CORS documentation](https://quarkus.io/guides/http-reference#cors-filter) and [warning about CORS filters in the Smallrye-OpenAPI documentation]https://quarkus.io/guides/openapi-swaggerui#cross-origin-resource-sharing) to mention the symptoms we'd expect if CORS restrictions become a problem for the OpenAPI endpoint, and provide a few examples of CORS policies would solve that in the specific case of the OpenAPI endpoint.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28397/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
