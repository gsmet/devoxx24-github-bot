{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/42737",
  "id": 2483497508,
  "node_id": "I_kwDOCFbutM6UByok",
  "number": 42737,
  "title": "websockets next not working with panache",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026134,
      "node_id": "MDU6TGFiZWwxMjczMDI2MTM0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/panache",
      "name": "area/panache",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2748318141,
      "node_id": "MDU6TGFiZWwyNzQ4MzE4MTQx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/websockets",
      "name": "area/websockets",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 5,
  "created_at": "2024-08-23T16:41:02Z",
  "updated_at": "2024-08-26T14:11:04Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI tried the new websockets next with panache but it throws several exceptions. First when I try to evaluation the value from this Code line: `Setting test = Setting.findAll().firstResult();`\r\nthen I get the following error message:\r\n`This method is normally automatically overridden in subclasses: did you forget to annotate your entity with @Entity?`\r\n\r\nWhen I leave the program running I enter the exception and I get the following error message:\r\n`Normal scoped producer method may not return null: io.quarkus.vertx.http.runtime.CurrentVertxRequest.getCurrent()`\r\n\n\n### Expected behavior\n\nNo error, returning a int-number.\n\n### Actual behavior\n\nError message\n\n### How to Reproduce?\n\nI have this websocket next endpoint:\r\n\r\n```\r\n@WebSocket(path = \"/beamer/{uselessID}\", endpointId = \"Beamer\")\r\n@ApplicationScoped\r\npublic class BeamerWebsocketEndpoint {\r\n\r\n    @OnOpen()\r\n    public Integer onOpen() {\r\n        try {\r\n            Setting test = Setting.findAll().firstResult(); //Stop the debugger here and evaluate the value Setting.findAll....\r\n            return test.getRealNumber();\r\n        } catch (Exception e) {\r\n            System.err.println(\"Error: \" + e.getMessage());\r\n        }\r\n        return 222;\r\n    }\r\n\r\n    @OnClose\r\n    public void onClose() {\r\n        System.out.println(\"Someone left the game\");\r\n    }\r\n\r\n    @OnError\r\n    String error(Exception t) {\r\n        System.err.println(\"Error: \" + t.getMessage());\r\n   \r\n        return \"error\";\r\n    }\r\n}\r\n```\r\n\r\nThis is my `Setting.java` class:\r\n```\r\n@Entity\r\n@NoArgsConstructor\r\n@Data\r\n@EqualsAndHashCode(callSuper=false)\r\npublic class Setting extends PanacheEntityBase implements Serializable {\r\n\r\n    @Id\r\n    @GeneratedValue( strategy = GenerationType.AUTO )\r\n    private long einstellung_id;\r\n\r\n    @Basic\r\n    @Column(name = \"realNumber\")\r\n    private int realNumber;\r\n}\r\n```\r\n\r\nI try the connection with the quarkus developer ui:\r\nhttp://localhost:8080/q/dev-ui/io.quarkus.quarkus-websockets-next/server-endpoints\r\n\r\nConnect to the websocket next endpoint and you get the two error messages explained above.\r\n\r\nBehind is a postgresql database and in the setting-table there is a row in the database.\r\nWith a normal rest-response call `Setting test = Setting.findAll().firstResult();` returns a number.\r\n\r\nIf needed my pom.xml file:\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\r\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n    <modelVersion>4.0.0</modelVersion>\r\n\r\n    <artifactId>pea-backend</artifactId>\r\n\r\n    <parent>\r\n        <groupId>at.tanzauswertung</groupId>\r\n        <artifactId>pea</artifactId>\r\n        <version>2.0.0-SNAPSHOT</version>\r\n    </parent>\r\n\r\n    <properties>\r\n        <maven.compiler.source>21</maven.compiler.source>\r\n        <maven.compiler.target>21</maven.compiler.target>\r\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\r\n        <!-- Update quarkus\r\n        https://quarkus.io/guides/update-quarkus\r\n        Dort nimm das \"Using maven\" Befehl und fÃ¼r diesen im CMD unter pea-backend aus -->\r\n        <quarkus.version>3.13.2</quarkus.version>\r\n        <version.maven.surefire-plugin>3.2.3</version.maven.surefire-plugin>\r\n        <version.maven.failsafe-plugin>3.1.0</version.maven.failsafe-plugin>\r\n        <version.apache-poi>5.2.5</version.apache-poi>\r\n    </properties>\r\n\r\n    <dependencyManagement>\r\n        <dependencies>\r\n            <dependency>\r\n                <groupId>io.quarkus.platform</groupId>\r\n                <artifactId>quarkus-bom</artifactId>\r\n                <version>${quarkus.version}</version>\r\n                <type>pom</type>\r\n                <scope>import</scope>\r\n            </dependency>\r\n        </dependencies>\r\n    </dependencyManagement>\r\n\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>at.tanzauswertung.api</groupId>\r\n            <artifactId>pea-portal-api</artifactId>\r\n            <version>1.1-SNAPSHOT</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.apache.poi</groupId>\r\n            <artifactId>poi</artifactId>\r\n            <version>${version.apache-poi}</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.apache.poi</groupId>\r\n            <artifactId>poi-ooxml</artifactId>\r\n            <version>${version.apache-poi}</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.flywaydb</groupId>\r\n            <artifactId>flyway-database-postgresql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.projectlombok</groupId>\r\n            <artifactId>lombok</artifactId>\r\n            <version>1.18.32</version>\r\n            <scope>provided</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>net.sf.jasperreports</groupId>\r\n            <artifactId>jasperreports</artifactId>\r\n            <version>6.21.3</version>\r\n            <type>jar</type>\r\n            <exclusions>\r\n                <exclusion>\r\n                    <artifactId>javax.inject</artifactId>\r\n                    <groupId>javax.inject</groupId>\r\n                </exclusion>\r\n            </exclusions>\r\n        </dependency>\r\n        <!-- glaube braucht man nicht mehr\r\n        <dependency>\r\n            <groupId>org.jboss.resteasy</groupId>\r\n            <artifactId>resteasy-multipart-provider</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.fasterxml.jackson.datatype</groupId>\r\n            <artifactId>jackson-datatype-jsr310</artifactId>\r\n            <version>2.14.2</version>\r\n        </dependency>-->\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-narayana-jta</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-websockets-next</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-arc</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-scheduler</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-rest-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-rest-client-jackson</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-rest</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-rest-jackson</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-hibernate-orm</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-hibernate-orm-panache</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-flyway</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-postgresql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-agroal</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-oidc</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-undertow</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-keycloak-authorization</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-junit5</artifactId>\r\n            <scope>test</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-test-h2</artifactId>\r\n            <scope>test</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.assertj</groupId>\r\n            <artifactId>assertj-core</artifactId>\r\n            <version>3.25.3</version>\r\n            <scope>test</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.rest-assured</groupId>\r\n            <artifactId>rest-assured</artifactId>\r\n            <scope>test</scope>\r\n        </dependency>\r\n    </dependencies>\r\n\r\n    <build>\r\n        <plugins>\r\n            <plugin>\r\n                <groupId>org.apache.maven.plugins</groupId>\r\n                <artifactId>maven-install-plugin</artifactId>\r\n                <version>3.1.1</version>\r\n            </plugin>\r\n            <plugin>\r\n                <groupId>io.quarkus</groupId>\r\n                <artifactId>quarkus-maven-plugin</artifactId>\r\n                <version>${quarkus.version}</version>\r\n                <executions>\r\n                    <execution>\r\n                        <goals>\r\n                            <goal>build</goal>\r\n                        </goals>\r\n                    </execution>\r\n                </executions>\r\n            </plugin>\r\n            <plugin>\r\n                <groupId>org.apache.maven.plugins</groupId>\r\n                <artifactId>maven-resources-plugin</artifactId>\r\n                <version>3.3.1</version>\r\n                <executions>\r\n                    <execution>\r\n                        <id>copy-resources</id>\r\n                        <phase>validate</phase>\r\n                        <goals>\r\n                            <goal>copy-resources</goal>\r\n                        </goals>\r\n                        <configuration>\r\n                            <outputDirectory>${project.build.directory}/classes/META-INF/resources/pea</outputDirectory>\r\n                            <resources>\r\n                                <resource>\r\n                                    <directory>${project.parent.basedir}/pea-frontend/build/</directory>\r\n                                </resource>\r\n                            </resources>\r\n                        </configuration>\r\n                    </execution>\r\n                </executions>\r\n            </plugin>\r\n            <plugin>\r\n                <groupId>org.apache.maven.plugins</groupId>\r\n                <artifactId>maven-failsafe-plugin</artifactId>\r\n                <version>${version.maven.failsafe-plugin}</version>\r\n                <executions>\r\n                    <execution>\r\n                        <goals>\r\n                            <goal>integration-test</goal>\r\n                            <goal>verify</goal>\r\n                        </goals>\r\n                    </execution>\r\n                </executions>\r\n            </plugin>\r\n            <plugin>\r\n                <artifactId>maven-surefire-plugin</artifactId>\r\n                <version>${version.maven.surefire-plugin}</version>\r\n                <configuration>\r\n                    <systemPropertyVariables>\r\n                        <java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager>\r\n                    </systemPropertyVariables>\r\n                </configuration>\r\n            </plugin>\r\n            <plugin>\r\n                <groupId>org.apache.maven.plugins</groupId>\r\n                <artifactId>maven-compiler-plugin</artifactId>\r\n                <version>3.12.1</version>\r\n                <configuration>\r\n                    <compilerArgs>\r\n                        <arg>-Xpkginfo:always</arg>\r\n                    </compilerArgs>\r\n                </configuration>\r\n            </plugin>\r\n        </plugins>\r\n    </build>\r\n\r\n</project>\r\n\r\n```\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n21.0.3\n\n### Quarkus version or git rev\n\n3.13.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nmvn version 3.9.8\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42737/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
