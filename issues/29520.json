{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/29520",
  "id": 1466080581,
  "node_id": "I_kwDOCFbutM5XYp1F",
  "number": 29520,
  "title": "decouple from okhttp(3) ",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1273042002,
      "node_id": "MDU6TGFiZWwxMjczMDQyMDAy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/reactive",
      "name": "area/reactive",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/228",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/228",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/228/labels",
    "id": 8842745,
    "node_id": "MI_kwDOCFbutM4Ahu35",
    "number": 228,
    "title": "3.0.0.Alpha4",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 323,
    "state": "closed",
    "created_at": "2023-01-11T08:43:57Z",
    "updated_at": "2023-07-20T16:42:38Z",
    "due_on": null,
    "closed_at": "2023-02-09T15:24:11Z"
  },
  "comments": 26,
  "created_at": "2022-11-28T09:23:20Z",
  "updated_at": "2023-10-09T17:25:41Z",
  "closed_at": "2023-02-01T19:59:06Z",
  "active_lock_reason": null,
  "body": "### Description\n\nCurrently quarkus ends up having a dependency to okhttp3 via the kubernetes client. This issue tries to gather the issues/options as fixing this potentially involves collaboration across Quarkus, fabric8 io kubernetes client, operator SDK and the OpenJDK team. \r\n\r\nThis is a root cause of a list of issues:\r\n1) CVE issue list for okhttp3 keeps growing (albeit at this time of writing not aware of issues that gets exposed via Quarkus usage of okhttp3 but it is problematic if anyone do need to use okhttp for other means)\r\n2) We prefer to use one HTTP client (vert.x) to reduce exposure of CVE's and in vert.x case to be able to reuse the same asyn event loop wherever possible\r\n3) Upgrading to okhttp4 would help on both #1 and #2 but then we drag in a reliance on kotlin stdlib which has all kinds of potential downsides when it comes to dependency alignment and support in native. \r\n\r\nThus the best option will be to find ways to not introduce more CVE exposure, not add more libraries and still have good async and native support.\r\n\r\nOn Kubernetes client side they now have support for different HTTP clients. We should make that work for us!\r\n\r\nThere are 3 client options:\r\n\r\n## Jetty \r\n\r\nThis client is somewhat complete but has some issues around blocking behaviours. Adding Jetty into Quarkus managed dependency set does not sound like a good option.\r\n\r\nUsers can though update the dependency to use it if they so wish.\r\n\r\n## JDK http client\r\n\r\nThis is working but only recommended for Java 16 and upwards due to [JDK 11 bug](https://bugs.openjdk.org/browse/JDK-8245245) affecting query parameters in websocket based calls. \r\n\r\nAlso would be improved when [cleaner async support](https://github.com/fabric8io/kubernetes-client/pull/4430) merged\r\n\r\nThe JDK bug we can probably get backported to JDK 11. Will take a few months before broadly available though (January earliest).\r\n\r\n## vert.x \r\n\r\nCurrent progress is in [this branch](https://github.com/fabric8io/kubernetes-client/tree/vertx-client/httpclient-vertx).\r\nIt has issues and is awaiting https://github.com/fabric8io/kubernetes-client/pull/4430 to get merged. This PR fixes issues \r\naround how the client deals with bytebuffers and streams. With this in a vert.x client should be much more manageable to get in.\r\n\r\n\r\n\r\n\n\n### Implementation ideas\n\nMy (Max) preferable option is to get vert.x client enabled as that avoids all the issues know for okhttp.\r\nSecondary option is to get jdk issue fixed allowing users to at least just fall back to the JDK.\r\n\r\nJetty I'm not a fan of as it adds yet another dependency chain to maintain.\r\n\r\n ",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520/reactions",
    "total_count": 7,
    "+1": 7,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29520/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
