{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/33692",
  "id": 1731762037,
  "node_id": "I_kwDOCFbutM5nOJd1",
  "number": 33692,
  "title": "Unexpected HTTP 431 response",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1320737519,
      "node_id": "MDU6TGFiZWwxMzIwNzM3NTE5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/vertx",
      "name": "area/vertx",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/250",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/250",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/250/labels",
    "id": 9407630,
    "node_id": "MI_kwDOCFbutM4Aj4yO",
    "number": 250,
    "title": "3.2.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 244,
    "state": "closed",
    "created_at": "2023-05-17T07:29:12Z",
    "updated_at": "2023-11-15T13:59:38Z",
    "due_on": null,
    "closed_at": "2023-06-21T13:08:09Z"
  },
  "comments": 13,
  "created_at": "2023-05-30T08:21:08Z",
  "updated_at": "2023-12-11T19:11:55Z",
  "closed_at": "2023-06-06T07:52:00Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nUnexpected HTTP 431 response\r\n\r\nWhen requesting resources via HTTPS, unexpected HTTP 431 (Request header fields too large) are returned. We observe this on production after migration to a managed openshift environment. The very same service worked as expected on the old environment.\r\n\r\nWe can reproduce it with curl. When the total request size is more than 7966 bytes (according to curl), a 431 ist returned instead of a 200.\r\n\r\nAccording to our tests:\r\n\r\n- it does not matter if bearer token is provided or not (our service uses authentication)\r\n- it can be any resource, it does not have to exist\r\n- it is the total request size that counts, not just size of the header lines\r\n\r\nWe see the error appeared only after the migration. We assume the new environment attaches more or different headers. On production we use a redhat build of Quarkus 2.13, however, it can be reproduced using 3.0.4.Final.\r\n\r\nIt seems to happen only when using HTTPS, and only with HTTP/2.\r\n\r\nAs a workaround, we disabled HTTP/2 using quarkus configuration:\r\n\r\n    quarkus.http.http2=false\n\n### Expected behavior\n\nA HTTP 200 is returned\n\n### Actual behavior\n\nA HTTP 431 is returned\n\n### How to Reproduce?\n\nUse a plain quarkus app:\r\n\r\n    quarkus create app\r\n\r\nConfigure https:\r\n\r\n    cd /tmp\r\n    openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem\r\n\r\napplication.properties:\r\n\r\n    quarkus.http.ssl.certificate.files=/tmp/cert.pem\r\n    quarkus.http.ssl.certificate.key-files=/tmp/key.pem\r\n\r\nRequest a resource via https.\r\n\r\nIf total bytes sent > 7966, a http 431 is returned:\r\n\r\n    $ curl -k 'https://localhost:8443/' \\\r\n          -H \"x-foo: $(printf -- 'A%.0s' {1..7881})\" \\\r\n          -o /dev/null -s -w '> bytes sent: %{size_request}' -vv 2>&1 |grep -E '(< HTTP|> bytes)'\r\n    < HTTP/2 200 \r\n    > bytes sent: 7966\r\n\r\n    $ curl -k 'https://localhost:8443/' \\\r\n          -H \"x-foo: $(printf -- 'A%.0s' {1..7882})\" \\\r\n          -o /dev/null -s -w '> bytes sent: %{size_request}' -vv 2>&1 |grep -E '(< HTTP|> bytes)'\r\n    < HTTP/2 431 \r\n    > bytes sent: 7967\r\n\r\nHowever, it works (= HTTP 200) with https/http 1.1:\r\n\r\n    $ curl -k 'https://localhost:8443/' \\\r\n          -H \"x-foo: $(printf -- 'A%.0s' {1..7882})\" \\\r\n          -o /dev/null -s -w '> bytes sent: %{size_request}' -vv --http1.1 2>&1 |grep -E '(< HTTP|> bytes)'\r\n    < HTTP/1.1 200 OK\r\n    > bytes sent: 7969\r\n\r\nIt works (= HTTP 200) with plain http as well:\r\n\r\n    $ curl -k 'http://localhost:8080/' \\\r\n          -H \"x-foo: $(printf -- 'A%.0s' {1..7882})\" \\\r\n          -o /dev/null -s -w '> bytes sent: %{size_request}' -vv --http1.1 2>&1 |grep -E '(< HTTP|> bytes)'\r\n    < HTTP/1.1 200 OK\r\n    > bytes sent: 7969\r\n\n\n### Output of `uname -a` or `ver`\n\nLinux 4.18.0-477.10.1.el8_8.x86_64 #1 SMP Wed Apr 5 13:35:01 EDT 2023 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"11.0.19\" 2023-04-18 LTS\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.0.4.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.8 (4c87b05d9aedce574290d1acc98575ed5eb6cd39)\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33692/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
