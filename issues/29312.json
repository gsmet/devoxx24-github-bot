{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/29312",
  "id": 1451789870,
  "node_id": "I_kwDOCFbutM5WiI4u",
  "number": 29312,
  "title": "NPE thrown when trying to connect to existing Keycloak devservice",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 3289887215,
      "node_id": "MDU6TGFiZWwzMjg5ODg3MjE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/keycloak",
      "name": "area/keycloak",
      "color": "0366d6",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/217",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/217",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/217/labels",
    "id": 8670386,
    "node_id": "MI_kwDOCFbutM4AhEyy",
    "number": 217,
    "title": "2.14.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 32,
    "state": "closed",
    "created_at": "2022-11-18T18:12:54Z",
    "updated_at": "2023-03-08T15:41:50Z",
    "due_on": null,
    "closed_at": "2022-11-25T13:31:13Z"
  },
  "comments": 2,
  "created_at": "2022-11-16T15:17:10Z",
  "updated_at": "2022-11-21T10:34:05Z",
  "closed_at": "2022-11-16T20:48:15Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWe have a setup where we got multiple Quarkus apps working together. As such, when starting it locally in development mode, we rely on devservices provided by Quarkus and share the Keycloak instance. We do not really configure anything on the devservice except fixing the port and this was working fine before Quarkus 2.14.0.Final. After the update, we keep getting the following error:\r\n\r\n> Caused by: java.lang.RuntimeException: java.lang.NullPointerException: Cannot invoke \"java.util.List.isEmpty()\" because \"realmReps\" is null\r\n\tat io.quarkus.oidc.deployment.devservices.keycloak.KeycloakDevServicesProcessor.startKeycloakContainer(KeycloakDevServicesProcessor.java:247)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:909)\r\n\tat io.quarkus.builder.BuildContext.run(BuildContext.java:281)\r\n\tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\n\tat org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nCaused by: java.lang.NullPointerException: Cannot invoke \"java.util.List.isEmpty()\" because \"realmReps\" is null\r\n\tat io.quarkus.oidc.deployment.devservices.keycloak.KeycloakDevServicesProcessor.prepareConfiguration(KeycloakDevServicesProcessor.java:262)\r\n\tat io.quarkus.oidc.deployment.devservices.keycloak.KeycloakDevServicesProcessor.lambda$startContainer$5(KeycloakDevServicesProcessor.java:389)\r\n\tat java.base/java.util.Optional.map(Optional.java:260)\r\n\tat io.quarkus.oidc.deployment.devservices.keycloak.KeycloakDevServicesProcessor.startContainer(KeycloakDevServicesProcessor.java:387)\r\n\tat io.quarkus.oidc.deployment.devservices.keycloak.KeycloakDevServicesProcessor.startKeycloakContainer(KeycloakDevServicesProcessor.java:195)\r\n\t... 11 more\r\n\r\nLooking at the code history we determined that the bug was introduced by the following PR: https://github.com/quarkusio/quarkus/pull/28327/files#diff-67404a43520250b1ebd5a0c945e070e60d70d4a3ba06b15e3fac747f820320cc in KeycloakDevServicesProcessor.java, line 259. \r\nPreviously, there was a check if `realmRep` is `null` (which is always the case when dev service is shared - [check the call](https://github.com/quarkusio/quarkus/blob/c9e00898b30be0ed710087522da58b294bed6834/extensions/oidc/deployment/src/main/java/io/quarkus/oidc/deployment/devservices/keycloak/KeycloakDevServicesProcessor.java#L389)).\r\n\r\nThis is blocking us to update to new version and for now have reverted to the old one.\r\n\r\n### Expected behavior\r\n\r\nMultiple Quarkus apps should be able to share the same Keycloak instance in dev mode.\r\n\r\n### Actual behavior\r\n\r\nNPE occurs when existing Keycloak instance is detected.\r\n\r\n### How to Reproduce?\r\n\r\nStart two separate Quarkus Apps in dev mode that both make use of Keycloak devservice.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nLinux-ubuntu 5.15.0-52-generic \r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"17.0.5\" 2022-10-18\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.14.0.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nGradle 7.5.1\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/29312/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
