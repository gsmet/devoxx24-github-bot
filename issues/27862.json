{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27862",
  "id": 1369537552,
  "node_id": "I_kwDOCFbutM5RoXwQ",
  "number": 27862,
  "title": "ElasticSearch Dev Service image cannot be replaced with custom-built image",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2222769329,
      "node_id": "MDU6TGFiZWwyMjIyNzY5MzI5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/elasticsearch",
      "name": "area/elasticsearch",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/209",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/209",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/209/labels",
    "id": 8483139,
    "node_id": "MI_kwDOCFbutM4AgXFD",
    "number": 209,
    "title": "2.13.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 116,
    "state": "closed",
    "created_at": "2022-09-30T16:08:55Z",
    "updated_at": "2023-01-13T11:09:46Z",
    "due_on": null,
    "closed_at": "2022-10-05T12:39:54Z"
  },
  "comments": 4,
  "created_at": "2022-09-12T09:10:41Z",
  "updated_at": "2022-09-30T16:36:32Z",
  "closed_at": "2022-09-27T06:46:34Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIn the ElasticSearch DEV service you can use your own image (`quarkus.elasticsearch.devservices.image-name`), however it is not accepted because it is not **name-compatible** with the expected value: `docker.elastic.co/elasticsearch/elasticsearch`.\n\n### Expected behavior\n\nAny image that extends an ElasticSearch image is accepted and used.\n\n### Actual behavior\n\n```\r\nERROR [io.qua.dep.dev.IsolatedDevModeMain] (main) Failed to start quarkus: java.lang.RuntimeException: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n        [error]: Build step io.quarkus.elasticsearch.restclient.common.deployment.DevServicesElasticsearchProcessor#startElasticsearchDevService threw an exception: java.lang.RuntimeException: java.lang.IllegalStateException: Failed to verify that image 'registry.gitlab.com/xxxxx/search-service/elastic-with-files:my-tag' is a compatible substitute for 'docker.elastic.co/elasticsearch/elasticsearch'. This generally means that you are trying to use an image that Testcontainers has not been designed to use. If this is deliberate, and if you are confident that the image is compatible, you should declare compatibility in code using the `asCompatibleSubstituteFor` method. For example:\r\n   DockerImageName myImage = DockerImageName.parse(\"registry.gitlab.com/xxxxx/search-service/elastic-with-files:my-tag\").asCompatibleSubstituteFor(\"docker.elastic.co/elasticsearch/elasticsearch\");\r\nand then use `myImage` instead.\r\n        at io.quarkus.elasticsearch.restclient.common.deployment.DevServicesElasticsearchProcessor.startElasticsearchDevService(DevServicesElasticsearchProcessor.java:98)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n        at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:977)\r\n        at io.quarkus.builder.BuildContext.run(BuildContext.java:281)\r\n        at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\n        at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nCaused by: java.lang.IllegalStateException: Failed to verify that image 'registry.gitlab.com/xxxxx/search-service/elastic-with-files:my-tag' is a compatible substitute for 'docker.elastic.co/elasticsearch/elasticsearch'. This generally means that you are trying to use an image that Testcontainers has not been designed to use. If this is deliberate, and if you are confident that the image is compatible, you should declare compatibility in code using the `asCompatibleSubstituteFor` method. For example:\r\n   DockerImageName myImage = DockerImageName.parse(\"registry.gitlab.com/xxxxx/search-service/elastic-with-files:my-tag\").asCompatibleSubstituteFor(\"docker.elastic.co/elasticsearch/elasticsearch\");\r\nand then use `myImage` instead.\r\n        at org.testcontainers.utility.DockerImageName.assertCompatibleWith(DockerImageName.java:270)\r\n        at org.testcontainers.elasticsearch.ElasticsearchContainer.<init>(ElasticsearchContainer.java:95)\r\n        at io.quarkus.elasticsearch.restclient.common.deployment.DevServicesElasticsearchProcessor.lambda$startElasticsearch$1(DevServicesElasticsearchProcessor.java:198)\r\n        at java.base/java.util.Optional.orElseGet(Optional.java:364)\r\n        at io.quarkus.elasticsearch.restclient.common.deployment.DevServicesElasticsearchProcessor.startElasticsearch(DevServicesElasticsearchProcessor.java:224)\r\n        at io.quarkus.elasticsearch.restclient.common.deployment.DevServicesElasticsearchProcessor.startElasticsearchDevService(DevServicesElasticsearchProcessor.java:88)\r\n        ... 11 more\r\n```\n\n### How to Reproduce?\n\nmvn io.quarkus.platform:quarkus-maven-plugin:2.12.1.Final:create \\\r\n          -DprojectGroupId=org.acme \\\r\n          -DprojectArtifactId=elasticsearch-quickstart \\\r\n          -DclassName=\"org.acme.datasource.GreetingResource\" \\\r\n          -Dextensions=\"resteasy,resteasy-jackson,elasticsearch-rest-client\"\r\n\r\ncd elasticsearch-quickstart/\r\n\r\necho \"quarkus.elasticsearch.devservices.image-name = debian:buster\" >> ./src/main/resources/application.properties\r\n\r\nmvn verify\n\n### Output of `uname -a` or `ver`\n\nLinux ****** 5.4.72-microsoft-standard-WSL2 #1 SMP Wed Oct 28 23:40:43 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"17.0.3\" 2022-04-19 OpenJDK Runtime Environment (build 17.0.3+7-Ubuntu-0ubuntu0.20.04.1) OpenJDK 64-Bit Server VM (build 17.0.3+7-Ubuntu-0ubuntu0.20.04.1, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.12.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63) Maven home: /opt/maven Java version: 17.0.3, vendor: Private Build, runtime: /usr/lib/jvm/java-17-openjdk-amd64 Default locale: en, platform encoding: UTF-8 OS name: \"linux\", version: \"5.4.72-microsoft-standard-wsl2\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\nThis bug has the identical problem as: https://github.com/quarkusio/quarkus/issues/20945",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27862/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
