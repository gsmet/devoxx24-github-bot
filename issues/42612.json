{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/42612",
  "id": 2471570602,
  "node_id": "I_kwDOCFbutM6TUSyq",
  "number": 42612,
  "title": "MQTT dev services always start if another reactive messaging connector is present",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283619446,
      "node_id": "MDU6TGFiZWwxMjgzNjE5NDQ2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye",
      "name": "area/smallrye",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1416364896,
      "node_id": "MDU6TGFiZWwxNDE2MzY0ODk2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/reactive-messaging",
      "name": "area/reactive-messaging",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2955097667,
      "node_id": "MDU6TGFiZWwyOTU1MDk3NjY3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/devservices",
      "name": "area/devservices",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/348",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/348",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/348/labels",
    "id": 11501251,
    "node_id": "MI_kwDOCFbutM4Ar37D",
    "number": 348,
    "title": "3.14.1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 18,
    "state": "closed",
    "created_at": "2024-08-27T15:13:29Z",
    "updated_at": "2024-08-28T10:19:06Z",
    "due_on": null,
    "closed_at": "2024-08-28T10:19:06Z"
  },
  "comments": 3,
  "created_at": "2024-08-17T15:40:43Z",
  "updated_at": "2024-08-27T15:14:13Z",
  "closed_at": "2024-08-25T08:56:12Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nIf a Quarkus app uses at least 2 distinct reactive messaging connectors, one of the `smallrye-mqtt` type and another one of a different type, then the dev services for MQTT connector spawn a broker container, regardless of whether MQTT connector is configured to use an external broker or not.\r\n\r\nThe relevant piece of code that determines if MQTT dev services are needed is as follows:\r\nhttps://github.com/quarkusio/quarkus/blob/a41f7de85bef9a72d4a09c830a2f6209047d6d0c/extensions/smallrye-reactive-messaging-mqtt/deployment/src/main/java/io/quarkus/smallrye/reactivemessaging/mqtt/deployment/MqttDevServicesProcessor.java#L208-L215\r\nThis is executed for each connector, so if another connector is also present, `isMqtt` is equal to `false`. So is `isConfigured` and we exit this method with the return value `true`, indicating that MQTT dev services are actually needed. The proper logic should be more like:\r\n```java\r\nif (isMqtt && !(hasHost || hasPort)) {\r\n    return true;\r\n}\r\n```\r\n\r\nSimilarly to #32463, in this case MQTT dev services must be explicitly disabled with\r\n```\r\nquarkus.mqtt.devservices.enabled=false\r\n```\r\n\r\n### Expected behavior\r\n\r\nMQTT dev services are not spawned.\r\n\r\n### Actual behavior\r\n\r\nMQTT dev services are spawned even if the connector is configured to connect to an external MQTT broker.\r\n\r\n### How to Reproduce?\r\n\r\nHave 2 reactive messaging connectors of distinct types, one being `smallrye-mqtt`.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.13.2\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42612/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
