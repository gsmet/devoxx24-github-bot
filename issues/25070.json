{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25070",
  "id": 1211093436,
  "node_id": "I_kwDOCFbutM5IL9G8",
  "number": 25070,
  "title": "Tests run at incorrect phase in case of integration tests name not ending in \"IT\"",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 985346625,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjU=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/triage/invalid",
      "name": "triage/invalid",
      "color": "e4e669",
      "default": false,
      "description": "This doesn't seem right"
    },
    {
      "id": 1375177076,
      "node_id": "MDU6TGFiZWwxMzc1MTc3MDc2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/testing",
      "name": "area/testing",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 5,
  "created_at": "2022-04-21T14:03:21Z",
  "updated_at": "2022-04-22T14:12:23Z",
  "closed_at": "2022-04-22T11:40:06Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIf an integration test class (`@QuarkusIntegrationTest`) name doesn't end in \"IT\", the test is run at a wrong phase, and the build fails.\r\nWould expect to work correctly with any naming.\n\n### Expected behavior\n\nBuild should pass irrespective of the naming used for the integration test class. The annotation `@QuarkusIntegrationTest` could already indicate that it is an integration test.\n\n### Actual behavior\n\nComplete output:\r\n```\r\nuser@laptop:~/work/lambda-rest-example$ quarkus build --native\r\n[INFO] Scanning for projects...\r\n[INFO]\r\n[INFO] ------------------< com.example:lambda-rest-example >-------------------\r\n[INFO] Building lambda-rest-example 1.0-SNAPSHOT\r\n[INFO] --------------------------------[ jar ]---------------------------------\r\n[INFO]\r\n[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ lambda-rest-example ---\r\n[INFO] Using 'UTF-8' encoding to copy filtered resources.\r\n[INFO] Copying 1 resource\r\n[INFO]\r\n[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ lambda-rest-example ---\r\n[INFO] Nothing to compile - all classes are up to date\r\n[INFO]\r\n[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ lambda-rest-example ---\r\n[INFO] Using 'UTF-8' encoding to copy filtered resources.\r\n[INFO] skip non existing resourceDirectory /home/hpeter/work/lambda-rest-example/src/test/resources\r\n[INFO]\r\n[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ lambda-rest-example ---\r\n[INFO] Changes detected - recompiling the module!\r\n[INFO] Compiling 2 source files to /home/hpeter/work/lambda-rest-example/target/test-classes\r\n[INFO]\r\n[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ lambda-rest-example ---\r\n[INFO]\r\n[INFO] -------------------------------------------------------\r\n[INFO]  T E S T S\r\n[INFO] -------------------------------------------------------\r\n[INFO] Running com.example.GreetingIntegrationTest\r\n2022-04-21 16:43:43,851 INFO  [org.jbo.threads] (main) JBoss Threads version 3.4.2.Final\r\n2022-04-21 16:43:44,339 INFO  [io.qua.ama.lam.run.MockEventServer] (build-1) Mock Lambda Event Server Started\r\n======================================================================================\r\n  native.image.path was not set, making a guess for the correct path of native image\r\n  guessed path: /home/hpeter/work/lambda-rest-example/target/lambda-rest-example-1.0-SNAPSHOT-runner\r\n======================================================================================\r\nExecuting \"/home/hpeter/work/lambda-rest-example/target/lambda-rest-example-1.0-SNAPSHOT-runner -Dquarkus.http.port=8081 -Dquarkus.http.ssl-port=8444 -Dtest.url=http://localhost:8081 -Dquarkus.log.file.path=/home/hpeter/work/lambda-rest-example/target/quarkus.log -Dquarkus.log.file.enable=true -Dquarkus-internal.aws-lambda.test-api=localhost:8081/_lambda_\"\r\n__  ____  __  _____   ___  __ ____  ______\r\n --/ __ \\/ / / / _ | / _ \\/ //_/ / / / __/\r\n -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\\ \\\r\n--\\___\\_\\____/_/ |_/_/|_/_/|_|\\____/___/\r\n2022-04-21 16:43:44,534 INFO  [io.quarkus] (main) lambda-rest-example 1.0-SNAPSHOT native (powered by Quarkus 2.8.1.Final) started in 0.070s.\r\n2022-04-21 16:43:44,536 INFO  [io.quarkus] (main) Profile prod activated.\r\n2022-04-21 16:43:44,536 INFO  [io.quarkus] (main) Installed features: [amazon-lambda, cdi, resteasy, security, smallrye-context-propagation, vertx]\r\n2022-04-21 16:43:44,537 INFO  [io.qua.ama.lam.run.AbstractLambdaPollLoop] (Lambda Thread (NORMAL)) Listening on: http://localhost:8081/_lambda_/2018-06-01/runtime/invocation/next\r\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.62 s - in com.example.GreetingIntegrationTest\r\n[INFO] Running com.example.GreetingTest\r\n2022-04-21 16:43:46,900 INFO  [org.jbo.threads] (main) JBoss Threads version 3.4.2.Final\r\n[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.258 s <<< FAILURE! - in com.example.GreetingTest\r\n[ERROR] com.example.GreetingTest.testJaxrs  Time elapsed: 0.001 s  <<< ERROR!\r\njava.lang.RuntimeException:\r\njava.lang.RuntimeException: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n        [error]: Build step io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor#startEventServer threw an exception: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:82)\r\n        at io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor.startEventServer(DevServicesLambdaProcessor.java:81)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:925)\r\n        at io.quarkus.builder.BuildContext.run(BuildContext.java:277)\r\n        at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n        at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nCaused by: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:395)\r\n        at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1999)\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:79)\r\n        ... 12 more\r\nCaused by: java.net.BindException: Address already in use\r\n        at java.base/sun.nio.ch.Net.bind0(Native Method)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:459)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:448)\r\n        at java.base/sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:227)\r\n        at io.netty.channel.socket.nio.NioServerSocketChannel.doBind(NioServerSocketChannel.java:134)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.bind(AbstractChannel.java:562)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.bind(DefaultChannelPipeline.java:1334)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeBind(AbstractChannelHandlerContext.java:506)\r\n        at io.netty.channel.AbstractChannelHandlerContext.bind(AbstractChannelHandlerContext.java:491)\r\n        at io.netty.channel.DefaultChannelPipeline.bind(DefaultChannelPipeline.java:973)\r\n        at io.netty.channel.AbstractChannel.bind(AbstractChannel.java:260)\r\n        at io.netty.bootstrap.AbstractBootstrap$2.run(AbstractBootstrap.java:356)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasksFrom(SingleThreadEventExecutor.java:425)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:374)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:491)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n\r\nCaused by: java.lang.RuntimeException:\r\nio.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n        [error]: Build step io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor#startEventServer threw an exception: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:82)\r\n        at io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor.startEventServer(DevServicesLambdaProcessor.java:81)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:925)\r\n        at io.quarkus.builder.BuildContext.run(BuildContext.java:277)\r\n        at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n        at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nCaused by: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:395)\r\n        at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1999)\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:79)\r\n        ... 12 more\r\nCaused by: java.net.BindException: Address already in use\r\n        at java.base/sun.nio.ch.Net.bind0(Native Method)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:459)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:448)\r\n        at java.base/sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:227)\r\n        at io.netty.channel.socket.nio.NioServerSocketChannel.doBind(NioServerSocketChannel.java:134)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.bind(AbstractChannel.java:562)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.bind(DefaultChannelPipeline.java:1334)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeBind(AbstractChannelHandlerContext.java:506)\r\n        at io.netty.channel.AbstractChannelHandlerContext.bind(AbstractChannelHandlerContext.java:491)\r\n        at io.netty.channel.DefaultChannelPipeline.bind(DefaultChannelPipeline.java:973)\r\n        at io.netty.channel.AbstractChannel.bind(AbstractChannel.java:260)\r\n        at io.netty.bootstrap.AbstractBootstrap$2.run(AbstractBootstrap.java:356)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasksFrom(SingleThreadEventExecutor.java:425)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:374)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:491)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n\r\nCaused by: io.quarkus.builder.BuildException:\r\nBuild failure: Build failed due to errors\r\n        [error]: Build step io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor#startEventServer threw an exception: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:82)\r\n        at io.quarkus.amazon.lambda.deployment.DevServicesLambdaProcessor.startEventServer(DevServicesLambdaProcessor.java:81)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:925)\r\n        at io.quarkus.builder.BuildContext.run(BuildContext.java:277)\r\n        at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n        at org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\nCaused by: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\n        at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:395)\r\n        at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1999)\r\n        at io.quarkus.amazon.lambda.runtime.MockEventServer.start(MockEventServer.java:79)\r\n        ... 12 more\r\nCaused by: java.net.BindException: Address already in use\r\n        at java.base/sun.nio.ch.Net.bind0(Native Method)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:459)\r\n        at java.base/sun.nio.ch.Net.bind(Net.java:448)\r\n        at java.base/sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:227)\r\n        at io.netty.channel.socket.nio.NioServerSocketChannel.doBind(NioServerSocketChannel.java:134)\r\n        at io.netty.channel.AbstractChannel$AbstractUnsafe.bind(AbstractChannel.java:562)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.bind(DefaultChannelPipeline.java:1334)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeBind(AbstractChannelHandlerContext.java:506)\r\n        at io.netty.channel.AbstractChannelHandlerContext.bind(AbstractChannelHandlerContext.java:491)\r\n        at io.netty.channel.DefaultChannelPipeline.bind(DefaultChannelPipeline.java:973)\r\n        at io.netty.channel.AbstractChannel.bind(AbstractChannel.java:260)\r\n        at io.netty.bootstrap.AbstractBootstrap$2.run(AbstractBootstrap.java:356)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasksFrom(SingleThreadEventExecutor.java:425)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:374)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:491)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:829)\r\n\r\nCaused by: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\nCaused by: java.util.concurrent.ExecutionException: java.net.BindException: Address already in use\r\nCaused by: java.net.BindException: Address already in use\r\n\r\n[INFO]\r\n[INFO] Results:\r\n[INFO]\r\n[ERROR] Errors:\r\n[ERROR]   GreetingTest.testJaxrs » Runtime java.lang.RuntimeException: io.quarkus.builde...\r\n[INFO]\r\n[ERROR] Tests run: 2, Failures: 0, Errors: 1, Skipped: 0\r\n[INFO]\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD FAILURE\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time:  9.538 s\r\n[INFO] Finished at: 2022-04-21T16:43:47+03:00\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M5:test (default-test) on project lambda-rest-example: There are test failures.\r\n[ERROR]\r\n[ERROR] Please refer to /home/hpeter/work/lambda-rest-example/target/surefire-reports for the individual test results.\r\n[ERROR] Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.\r\n[ERROR] -> [Help 1]\r\n[ERROR]\r\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n[ERROR]\r\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\r\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException\r\n```\n\n### How to Reproduce?\n\n1. generate a project using `mvn archetype:generate \\\r\n       -DarchetypeGroupId=io.quarkus \\\r\n       -DarchetypeArtifactId=quarkus-amazon-lambda-rest-archetype \\\r\n       -DarchetypeVersion=2.8.1.Final`\r\n2. rename `GreetingIT` to `GreetingIntegrationTest`\r\n3. run `quarkus build --native`, and for some reason the integration test gets run before the plain test, by the `maven-surefire-plugin:3.0.0-M5:test` at test phase, and not integration-test phase and fails\r\n\r\n\n\n### Output of `uname -a` or `ver`\n\nLinux XS15-DQJ9ND3 5.10.16.3-microsoft-standard-WSL2 #1 SMP Fri Apr 2 22:23:49 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk 11.0.14 2022-01-18 OpenJDK Runtime Environment (build 11.0.14+9-Ubuntu-0ubuntu2.20.04) OpenJDK 64-Bit Server VM (build 11.0.14+9-Ubuntu-0ubuntu2.20.04, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n(using docker to build native)\n\n### Quarkus version or git rev\n\n2.8.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: /opt/maven Java version: 11.0.14, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-amd64 Default locale: en, platform encoding: UTF-8 OS name: \"linux\", version: \"5.10.16.3-microsoft-standard-wsl2\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25070/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
