{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/23749",
  "id": 1139747299,
  "node_id": "I_kwDOCFbutM5D7ynj",
  "number": 23749,
  "title": "Proactive auth as false doesn't work for endpoints annotated with @PermitAll and requests with Bearer Token ",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1282139374,
      "node_id": "MDU6TGFiZWwxMjgyMTM5Mzc0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/security",
      "name": "area/security",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/175",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175/labels",
    "id": 7698730,
    "node_id": "MI_kwDOCFbutM4AdXkq",
    "number": 175,
    "title": "2.7.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 159,
    "state": "closed",
    "created_at": "2022-02-21T12:59:08Z",
    "updated_at": "2022-05-12T16:40:04Z",
    "due_on": null,
    "closed_at": "2022-02-22T17:21:05Z"
  },
  "comments": 9,
  "created_at": "2022-02-16T09:15:24Z",
  "updated_at": "2022-02-21T16:52:04Z",
  "closed_at": "2022-02-17T10:56:59Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI was moving a service we have from Quarkus version 2.3.1.Final to 2.7.1.Final and I've noticed there's different behaviour when it comes to proactive authentication and bearer tokens. From version 2.4.0 onwards, setting `quarkus.http.auth.proactive=false` doesn't seem to influence requests with bearer token authentication when the endpoint the request targets is annotated with @PermitAll, returning 401 instead of 200, as was the case before 2.4.0. I've used Postman and curl for testing and additionally, the reproducer has tests that also produce different behaviour depending on the Quarkus version.\r\n\r\nThis is the endpoint I'm testing\r\n```\r\n@PermitAll\r\n@Path(\"/hello\")\r\npublic class GreetingResource {\r\n\r\n    @GET\r\n    @Produces(MediaType.TEXT_PLAIN)\r\n    public String hello() {\r\n        return \"Hello RESTEasy\";\r\n    }\r\n}\r\n```\r\n\r\napplication properties:\r\n```\r\nquarkus.http.port=8080\r\nquarkus.http.auth.proactive=false\r\n```\r\n\r\nIs this change in behaviour expected and does Quarkus treat the @PermitAll annotation differently than it did in the versions prior to 2.4.0? I'm trying to understand the change in this behaviour, if it's expected or not, so I can modify our application code if needed.\n\n### Expected behavior\n\nRequest with Bearer Token authentication header to an endpoint with @PermitAll annotation should succeed when proactive authentication is set to false, as was the case in version prior to 2.4.0.\n\n### Actual behavior\n\nRequest fails with 401.\n\n### How to Reproduce?\n\nReproducer:\r\nhttps://github.com/jrepe/quarkus-proactive-reproducible\r\n\r\nSteps to reproduce:\r\n1. Set Quarkus version to 2.3.1.Final and run tests (All tests should pass)\r\n2. Set Quarkus version to 2.7.1.Final and run tests (Bearer Token test should fail)\r\n3. Remove @PermitAll annotation from `GreetingResource` in `GreetingResource.java`, run tests again \r\n(All tests should pass)\n\n### Output of `uname -a` or `ver`\n\nDarwin Kernel Version 21.1.0: root:xnu-8019.41.5~1/RELEASE_X86_64 x86_64 i386 MacBookPro16,1 Darwin\n\n### Output of `java -version`\n\nopenjdk version \"11.0.8\" 2020-07-14 OpenJDK Runtime Environment AdoptOpenJDK (build 11.0.8+10) OpenJDK 64-Bit Server VM AdoptOpenJDK (build 11.0.8+10, mixed mode)\n\n### GraalVM version (if different from Java)\n\n/\n\n### Quarkus version or git rev\n\n2.7.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nGradle 7.3.3\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23749/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
