{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21576",
  "id": 1058694587,
  "node_id": "I_kwDOCFbutM4_GmW7",
  "number": 21576,
  "title": "IllegalArgumentException on x-www-form-urlencoded POST with Amazon Lambda HTTP extension",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1326073020,
      "node_id": "MDU6TGFiZWwxMzI2MDczMDIw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/amazon-lambda",
      "name": "area/amazon-lambda",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/160",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160/labels",
    "id": 7427013,
    "node_id": "MI_kwDOCFbutM4AcVPF",
    "number": 160,
    "title": "2.5.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 110,
    "state": "closed",
    "created_at": "2021-11-24T15:28:10Z",
    "updated_at": "2021-12-02T11:14:37Z",
    "due_on": null,
    "closed_at": "2021-12-01T12:26:44Z"
  },
  "comments": 5,
  "created_at": "2021-11-19T16:13:02Z",
  "updated_at": "2021-12-01T15:36:22Z",
  "closed_at": "2021-11-29T20:07:45Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI run a small service on Amazon Lambda with HTTP binding and Qute templates. When POSTing form data (application/x-www-form-urlencoded), the request fails if the payload is somehow bigger than the Base64-decoding, called by the LambdaHttpHandler expects and an IllegalArgumentException is thrown.\r\n\r\nI figured out, that the String which is passed to the `Base64.decode()` method, contains some line breaks `\\r\\n` and these are causing the error.\r\nIf the payload is small enough, so that there are no line-breaks, it works.\r\nIf I put a breakpoint on the line and remove the line breaks manually, it also works.\r\n\r\n### Expected behavior\r\n\r\nQuarkus can parse the request properly without errors, line-breaks in the base64 encoded payload are eliminated automatically and/or yield not in an exception.\r\n\r\n### Actual behavior\r\n\r\nWhen posting a form as described above, the following exception is thrown:\r\n\r\n```\r\n2021-11-19 16:50:06,111 ERROR [qua.ama.lam.http] (Lambda Thread (DEVELOPMENT)) Request Failure: java.lang.IllegalArgumentException: Illegal base64 character d\r\n\tat java.base/java.util.Base64$Decoder.decode0(Base64.java:746)\r\n\tat java.base/java.util.Base64$Decoder.decode(Base64.java:538)\r\n\tat java.base/java.util.Base64$Decoder.decode(Base64.java:561)\r\n\tat io.quarkus.amazon.lambda.http.LambdaHttpHandler.nettyDispatch(LambdaHttpHandler.java:196)\r\n\tat io.quarkus.amazon.lambda.http.LambdaHttpHandler.handleRequest(LambdaHttpHandler.java:61)\r\n\tat io.quarkus.amazon.lambda.http.LambdaHttpHandler.handleRequest(LambdaHttpHandler.java:41)\r\n\tat io.quarkus.amazon.lambda.runtime.AmazonLambdaRecorder$1.processRequest(AmazonLambdaRecorder.java:156)\r\n\tat io.quarkus.amazon.lambda.runtime.AbstractLambdaPollLoop$1.run(AbstractLambdaPollLoop.java:124)\r\n\tat java.base/java.lang.Thread.run(Thread.java:829)\r\n```\r\n\r\nThis error occurs since version 2.3.0.Final as some base64 decoding is called, before, until 2.2.3.Final, no base64 decoding is called and it works.\r\n\r\nRemoving the line breaks in the payload manually, as mentioned in the description above, \"fixes\" the error.\r\n\r\n### How to Reproduce?\r\n\r\nI've made a small demo repo for reproducing the issue:\r\nhttps://github.com/dasniko/quarkus-post-bug\r\n\r\nThere are two tests, one with a smaller payload which gets a 200 like expected, one with a slightly bigger payload which gets a 500, wich should not occur.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin Mac-mini.local 20.6.0 Darwin Kernel Version 20.6.0: Tue Oct 12 18:33:42 PDT 2021; root:xnu-7195.141.8~1/RELEASE_X86_64 x86_64\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"11.0.12\" 2021-07-20 OpenJDK Runtime Environment Temurin-11.0.12+7 (build 11.0.12+7) OpenJDK 64-Bit Server VM Temurin-11.0.12+7 (build 11.0.12+7, mixed mode)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\nn/a\r\n\r\n### Quarkus version or git rev\r\n\r\n2.4.2\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.8.3 (ff8e977a158738155dc465c6a97ffaf31982d739)\r\n\r\n### Additional information\r\n\r\nThis occors with both lambda bindings `quarkus-amazon-lambda-rest` and `quarkus-amazon-lambda-http`.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21576/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
