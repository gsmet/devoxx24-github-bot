{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25975",
  "id": 1261800478,
  "node_id": "I_kwDOCFbutM5LNYwe",
  "number": 25975,
  "title": "Refactoring the way we register classes for reflection, JNI, etc.",
  "labels": [
    {
      "id": 1710069947,
      "node_id": "MDU6TGFiZWwxNzEwMDY5OTQ3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/housekeeping",
      "name": "area/housekeeping",
      "color": "d1d86a",
      "default": false,
      "description": "Issue type for generalized tasks not related to bugs or enhancements"
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 10,
  "created_at": "2022-06-06T12:50:33Z",
  "updated_at": "2024-02-15T13:18:45Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Description\n\nQuarkus currently relies on [gizmo](https://github.com/quarkusio/gizmo/) to generate a rather large `AutomaticFeature` for performing a number of things by often invoking GraalVM internal APIs instead of following the \"standard\" approach of generating `json` configuration files for GraalVM to consume.\r\n\r\nNamely, Quarkus, at the time of writing, seems to rely on the following internal APIs:\r\n\r\n1. `com.oracle.svm.util.ReflectionUtil`\r\n2. `com.oracle.svm.core.jni.JNIRuntimeAccess`\r\n3. `com.oracle.svm.core.jdk.proxy.DynamicProxyRegistry`\r\n4. `com.oracle.svm.core.jdk.LocalizationFeature`\r\n5. `com.oracle.svm.core.jdk.localization.LocalizationFeature`\r\n6. `com.oracle.svm.core.configure.ResourcesRegistry`\r\n7. `com.oracle.svm.reflect.serialize.hosted.SerializationFeature`\r\n8. `com.oracle.svm.core.jdk.serialize.SerializationRegistry`\r\n9. `com.oracle.svm.reflect.serialize.SerializationSupport$StubForAbstractClass`\r\n10. `com.oracle.svm.reflect.serialize.SerializationSupport` \r\n\r\nTo me this approach has the following issues:\r\n1. It makes it harder to add new quarkus features or fix bugs that require tampering with the generation of the `AutoFeature`. First you need to write code by using an assembler... which you then need to debug by extracting the generated by gizmo class and disassembling it to see if everything looks as expected or not.\r\n2.  We rely on internal APIs with all the issues that brings (e.g. harder to maintain our code because of unexpected changes to internal API, need to ensure the internal APIs are somehow exposed to us, etc.)\r\n\n\n### Implementation ideas\n\nI propose we start:\r\n1. Moving as much configuration as possible out of the `AutomaticFeature` and generating `json` files instead (which one can easily inspect and alter)\r\n2. Request upstream Graal to make public any internal APIs that we really need access to.\r\n\r\nWDYT?",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25975/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
