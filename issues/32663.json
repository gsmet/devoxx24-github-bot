{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/32663",
  "id": 1669279339,
  "node_id": "I_kwDOCFbutM5jfy5r",
  "number": 32663,
  "title": "infov impacts local variable type",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026134,
      "node_id": "MDU6TGFiZWwxMjczMDI2MTM0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/panache",
      "name": "area/panache",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1283428650,
      "node_id": "MDU6TGFiZWwxMjgzNDI4NjUw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/logging",
      "name": "area/logging",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/234",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/234",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/234/labels",
    "id": 9024843,
    "node_id": "MI_kwDOCFbutM4AibVL",
    "number": 234,
    "title": "2.13.8.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 58,
    "state": "closed",
    "created_at": "2023-02-09T12:37:45Z",
    "updated_at": "2023-05-25T12:39:39Z",
    "due_on": null,
    "closed_at": "2023-05-25T12:39:39Z"
  },
  "comments": 7,
  "created_at": "2023-04-15T09:27:42Z",
  "updated_at": "2023-05-09T09:47:50Z",
  "closed_at": "2023-04-18T08:30:07Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI propose here a very specific problem, but, unfortunately, during a POC of a team to see if Quarkus could replace Spring Boot, the trust of the team on Quarkus is impacted.\r\n\r\n**Log.infov with more than 1 variable related to a Kafka record, seems to change the type of a local variable in specific context.**\r\n\r\nThe specific context is: \r\n- the first line is a Uni not initialized explicitly (no = null for example), but the result would be the same with a CompletionStage.\r\n-  a Log.infov is used with 2 variables related to a Kafka record\r\n\r\nIt means: \r\n```\r\n@Incoming(\"prices\")\r\n    public Uni<Void> consume(ConsumerRecord<String, String> msg) {\r\n        Uni<Void> result; // result = null will work, or even if Instant now = Instant.now(); if before this line\r\n        Instant now = Instant.now();\r\n\r\n        Log.infov(\"infov seems changing now into a long, {0} - {1}\", msg.topic(), msg.offset());\r\n        // Log.infov(\"infov seems changing now into a long, {0}\", msg.topic()); will work\r\n\r\n        methodThatGetAnInstant(now);\r\n\r\n        result = Uni.createFrom().voidItem();\r\n        return result;\r\n    }\r\n\r\n    private void methodThatGetAnInstant(Instant instant) {\r\n        Log.info(\"What a wonderfull method.\");\r\n    }\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nWe would expect mvn quarkus:dev starts the service without errors.\r\n\r\n### Actual behavior\r\n\r\nWe have an error on mvn quarkus:dev\r\n\r\n```\r\n2023-04-15 11:16:11,240 ERROR [io.qua.dep.dev.IsolatedDevModeMain] (Aesh InputStream Reader) Failed to start quarkus: io.quarkus.dev.appstate.ApplicationStartException: java.lang.RuntimeException: Failed to start quarkus\r\n\tat io.quarkus.dev.appstate.ApplicationStateNotification.waitForApplicationStart(ApplicationStateNotification.java:58)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl.runMainClass(StartupActionImpl.java:123)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartApp(IsolatedDevModeMain.java:222)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartCallback(IsolatedDevModeMain.java:203)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:543)\r\n\tat io.quarkus.deployment.console.ConsoleStateManager.forceRestart(ConsoleStateManager.java:141)\r\n\tat io.quarkus.deployment.console.ConsoleStateManager.lambda$installBuiltins$0(ConsoleStateManager.java:98)\r\n\tat io.quarkus.deployment.console.ConsoleStateManager$1.accept(ConsoleStateManager.java:73)\r\n\tat io.quarkus.deployment.console.ConsoleStateManager$1.accept(ConsoleStateManager.java:46)\r\n\tat io.quarkus.deployment.console.AeshConsole.lambda$setup$1(AeshConsole.java:275)\r\n\tat org.aesh.terminal.EventDecoder.accept(EventDecoder.java:118)\r\n\tat org.aesh.terminal.EventDecoder.accept(EventDecoder.java:31)\r\n\tat org.aesh.terminal.io.Decoder.write(Decoder.java:133)\r\n\tat org.aesh.readline.tty.terminal.TerminalConnection.openBlocking(TerminalConnection.java:216)\r\n\tat org.aesh.readline.tty.terminal.TerminalConnection.openBlocking(TerminalConnection.java:203)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: java.lang.RuntimeException: Failed to start quarkus\r\n\tat io.quarkus.runner.ApplicationImpl.doStart(Unknown Source)\r\n\tat io.quarkus.runtime.Application.start(Application.java:101)\r\n\tat io.quarkus.runtime.ApplicationLifecycleManager.run(ApplicationLifecycleManager.java:111)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:71)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:44)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:124)\r\n\tat io.quarkus.runner.GeneratedMain.main(Unknown Source)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl$1.run(StartupActionImpl.java:104)\r\n\t... 1 more\r\nCaused by: jakarta.enterprise.inject.spi.DefinitionException: java.lang.VerifyError: Bad type on operand stack\r\nException Details:\r\n  Location:\r\n    legros/emmanuel/KafkaConsumer.consume(Lorg/apache/kafka/clients/consumer/ConsumerRecord;)Lio/smallrye/mutiny/Uni; @52: invokevirtual\r\n  Reason:\r\n    Type 'java/lang/Long' (current frame, stack[1]) is not assignable to 'java/time/Instant'\r\n  Current Frame:\r\n    bci: @52\r\n    flags: { }\r\n    locals: { 'legros/emmanuel/KafkaConsumer', 'org/apache/kafka/clients/consumer/ConsumerRecord', 'java/lang/Long', top, top, 'java/lang/String', top, 'java/lang/String' }\r\n    stack: { 'legros/emmanuel/KafkaConsumer', 'java/lang/Long' }\r\n  Bytecode:\r\n    0000000: b800 074d 120d 2bb6 000f b800 15b2 005f\r\n    0000010: 5b57 b600 6212 212b b600 232b b600 0fb8\r\n    0000020: 0015 4d3a 053a 07b2 005f 1907 1905 2cb6\r\n    0000030: 0063 2a2c b600 2ab8 0030 b600 363a 0819\r\n    0000040: 08b0                                   \r\n\r\n\tat io.smallrye.reactive.messaging.providers.extension.MediatorManager.createMediator(MediatorManager.java:199)\r\n\tat io.smallrye.reactive.messaging.providers.extension.MediatorManager_ClientProxy.createMediator(Unknown Source)\r\n\tat io.smallrye.reactive.messaging.providers.wiring.Wiring$SubscriberMediatorComponent.materialize(Wiring.java:626)\r\n\tat io.smallrye.reactive.messaging.providers.wiring.Graph.lambda$materialize$10(Graph.java:100)\r\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\r\n\tat io.smallrye.reactive.messaging.providers.wiring.Graph.materialize(Graph.java:99)\r\n\tat io.smallrye.reactive.messaging.providers.extension.MediatorManager.start(MediatorManager.java:219)\r\n\tat io.smallrye.reactive.messaging.providers.extension.MediatorManager_ClientProxy.start(Unknown Source)\r\n\tat io.quarkus.smallrye.reactivemessaging.runtime.SmallRyeReactiveMessagingLifecycle.onApplicationStart(SmallRyeReactiveMessagingLifecycle.java:52)\r\n\tat io.quarkus.smallrye.reactivemessaging.runtime.SmallRyeReactiveMessagingLifecycle_Observer_onApplicationStart_68e7b57eb97cb75d597c5b816682366e888d0d9b.notify(Unknown Source)\r\n\tat io.quarkus.arc.impl.EventImpl$Notifier.notifyObservers(EventImpl.java:344)\r\n\tat io.quarkus.arc.impl.EventImpl$Notifier.notify(EventImpl.java:326)\r\n\tat io.quarkus.arc.impl.EventImpl.fire(EventImpl.java:82)\r\n\tat io.quarkus.arc.runtime.ArcRecorder.fireLifecycleEvent(ArcRecorder.java:151)\r\n\tat io.quarkus.arc.runtime.ArcRecorder.handleLifecycleEvents(ArcRecorder.java:102)\r\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent1144526294.deploy_0(Unknown Source)\r\n\tat io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent1144526294.deploy(Unknown Source)\r\n\t... 13 more\r\nCaused by: java.lang.VerifyError: Bad type on operand stack\r\nException Details:\r\n  Location:\r\n    legros/emmanuel/KafkaConsumer.consume(Lorg/apache/kafka/clients/consumer/ConsumerRecord;)Lio/smallrye/mutiny/Uni; @52: invokevirtual\r\n  Reason:\r\n    Type 'java/lang/Long' (current frame, stack[1]) is not assignable to 'java/time/Instant'\r\n  Current Frame:\r\n    bci: @52\r\n    flags: { }\r\n    locals: { 'legros/emmanuel/KafkaConsumer', 'org/apache/kafka/clients/consumer/ConsumerRecord', 'java/lang/Long', top, top, 'java/lang/String', top, 'java/lang/String' }\r\n    stack: { 'legros/emmanuel/KafkaConsumer', 'java/lang/Long' }\r\n  Bytecode:\r\n    0000000: b800 074d 120d 2bb6 000f b800 15b2 005f\r\n    0000010: 5b57 b600 6212 212b b600 232b b600 0fb8\r\n    0000020: 0015 4d3a 053a 07b2 005f 1907 1905 2cb6\r\n    0000030: 0063 2a2c b600 2ab8 0030 b600 363a 0819\r\n    0000040: 08b0                                   \r\n\r\n\tat legros.emmanuel.KafkaConsumer_Bean.proxy(Unknown Source)\r\n\tat legros.emmanuel.KafkaConsumer_Bean.get(Unknown Source)\r\n\tat legros.emmanuel.KafkaConsumer_Bean.get(Unknown Source)\r\n\tat io.quarkus.arc.impl.ArcContainerImpl.beanInstanceHandle(ArcContainerImpl.java:477)\r\n\tat io.quarkus.arc.impl.ArcContainerImpl.beanInstanceHandle(ArcContainerImpl.java:490)\r\n\tat io.quarkus.arc.impl.BeanManagerImpl.getReference(BeanManagerImpl.java:63)\r\n\tat io.smallrye.reactive.messaging.providers.extension.MediatorManager.createMediator(MediatorManager.java:176)\r\n\t... 29 more\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nI think that the description of the bug already explains how to reproduce it, but to make it simple, I propose you more comments on the following code -> https://github.com/legrosmanu/quarkus-infov-issue/blob/main/src/main/java/legros/emmanuel/KafkaConsumer.java\r\n\r\nOn this project, you can do a mvn:quarkus to get the error.\r\n\r\nYou'll have the same issue with Quarkus 2.6 or 3.0\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin **** 22.4.0 Darwin Kernel Version 22.4.0: Mon Mar  6 21:00:17 PST 2023; root:xnu-8796.101.5~3/RELEASE_X86_64 x86_64\r\n\r\n### Output of `java -version`\r\n\r\nOpenJDK Runtime Environment Temurin-17.0.6+10 (build 17.0.6+10) OpenJDK 64-Bit Server VM Temurin-17.0.6+10 (build 17.0.6+10, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.0.0.CR2\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.1 (2e178502fcdbffc201671fb2537d0cb4b4cc58f8) Maven home: /usr/local/Cellar/maven/3.9.1/libexec Java version: 17.0.6, vendor: Eclipse Adoptium, runtime: /Users/manu/.sdkman/candidates/java/17.0.6-tem Default locale: fr_FR, platform encoding: UTF-8 OS name: \"mac os x\", version: \"13.3\", arch: \"x86_64\", family: \"mac\"\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32663/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
