{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/23341",
  "id": 1120700530,
  "node_id": "I_kwDOCFbutM5CzIhy",
  "number": 23341,
  "title": "Oracle JDBC extension in native mode doesnÂ´t work with XA",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026509,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/persistence",
      "name": "area/persistence",
      "color": "FBCA04",
      "default": false,
      "description": "OBSOLETE, DO NOT USE"
    },
    {
      "id": 1676631606,
      "node_id": "MDU6TGFiZWwxNjc2NjMxNjA2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/env/windows",
      "name": "env/windows",
      "color": "edea47",
      "default": false,
      "description": "Impacts Windows machines"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/328",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/328",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/328/labels",
    "id": 11051630,
    "node_id": "MI_kwDOCFbutM4AqKJu",
    "number": 328,
    "title": "3.8.5",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 112,
    "state": "closed",
    "created_at": "2024-05-14T13:22:35Z",
    "updated_at": "2024-06-05T11:10:12Z",
    "due_on": null,
    "closed_at": "2024-06-05T11:10:12Z"
  },
  "comments": 11,
  "created_at": "2022-02-01T13:50:16Z",
  "updated_at": "2024-05-22T13:59:40Z",
  "closed_at": "2024-05-22T06:16:04Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nUsing the provided reproducer below with enabled XA [on this line](https://github.com/bvahdat/code-with-quarkus3/blob/master/src/main/resources/application.properties#L2) I get the following error when accessing http://localhost:8080/hello:\r\n\r\n```\r\n2022-02-01 14:00:05,072 ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (executor-thread-0) HTTP Request to /hello failed, error id: 52892a3f-33b3-4973-81ca-04bca84e9cb3-1: org.jboss.resteasy.spi.UnhandledException: java.sql.SQLException: Invalid Oracle URL specified: OracleDataSource.makeURL\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleApplicationException(ExceptionHandler.java:105)\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleException(ExceptionHandler.java:359)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.writeException(SynchronousDispatcher.java:218)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:519)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$invoke$4(SynchronousDispatcher.java:261)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$preprocess$0(SynchronousDispatcher.java:161)\r\n        at org.jboss.resteasy.core.interception.jaxrs.PreMatchContainerRequestContext.filter(PreMatchContainerRequestContext.java:364)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.preprocess(SynchronousDispatcher.java:164)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:247)\r\n        at io.quarkus.resteasy.runtime.standalone.RequestDispatcher.service(RequestDispatcher.java:73)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.dispatch(VertxRequestHandler.java:151)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler$1.run(VertxRequestHandler.java:91)\r\n        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$13.runWith(VertxCoreRecorder.java:543)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:833)\r\n        at com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:596)\r\n        at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:192)\r\nCaused by: java.sql.SQLException: Invalid Oracle URL specified: OracleDataSource.makeURL\r\n        at oracle.jdbc.datasource.impl.OracleDataSource.makeURL(OracleDataSource.java:1294)\r\n        at oracle.jdbc.datasource.impl.OracleDataSource.getURL(OracleDataSource.java:1066)\r\n        at oracle.jdbc.xa.client.OracleXADataSource.getPooledConnection(OracleXADataSource.java:362)\r\n        at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:233)\r\n        at oracle.jdbc.xa.client.OracleXADataSource.getXAConnectionInternal(OracleXADataSource.java:281)\r\n        at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:174)\r\n        at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:146)\r\n        at io.agroal.pool.ConnectionFactory.createConnection(ConnectionFactory.java:216)\r\n        at io.agroal.pool.ConnectionPool$CreateConnectionTask.call(ConnectionPool.java:513)\r\n        at io.agroal.pool.ConnectionPool$CreateConnectionTask.call(ConnectionPool.java:494)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n        at io.agroal.pool.util.PriorityScheduledExecutor.beforeExecute(PriorityScheduledExecutor.java:75)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        ... 3 more\r\n```\r\nAnd without XA (although `-H:+AddAllCharsets` per default is set):\r\n\r\n```\r\n2022-02-01 14:04:49,659 ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (executor-thread-0) HTTP Request to /hello failed, error id: 4bfa0e07-3ae3-4f3a-9064-03004804f9bc-1: org.jboss.resteasy.spi.UnhandledException: java.lang.IllegalStateException: Missing character set id 46 is not loaded at image build time\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleApplicationException(ExceptionHandler.java:105)\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleException(ExceptionHandler.java:359)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.writeException(SynchronousDispatcher.java:218)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:519)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$invoke$4(SynchronousDispatcher.java:261)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$preprocess$0(SynchronousDispatcher.java:161)\r\n        at org.jboss.resteasy.core.interception.jaxrs.PreMatchContainerRequestContext.filter(PreMatchContainerRequestContext.java:364)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.preprocess(SynchronousDispatcher.java:164)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:247)\r\n        at io.quarkus.resteasy.runtime.standalone.RequestDispatcher.service(RequestDispatcher.java:73)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.dispatch(VertxRequestHandler.java:151)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler$1.run(VertxRequestHandler.java:91)\r\n        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$13.runWith(VertxCoreRecorder.java:543)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:833)\r\n        at com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:596)\r\n        at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:192)\r\nCaused by: java.lang.IllegalStateException: Missing character set id 46 is not loaded at image build time\r\n        at oracle.sql.CharacterSet.make(CharacterSet.java:122)\r\n        at oracle.jdbc.driver.DBConversion.init(DBConversion.java:184)\r\n        at oracle.jdbc.driver.DBConversion.<init>(DBConversion.java:137)\r\n        at oracle.jdbc.driver.T4CConnection.doCharSetNegotiation(T4CConnection.java:2620)\r\n        at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:2184)\r\n        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:652)\r\n        at oracle.jdbc.driver.PhysicalConnection.connect(PhysicalConnection.java:1086)\r\n        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:90)\r\n        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:728)\r\n        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:649)\r\n        at io.agroal.pool.ConnectionFactory.createConnection(ConnectionFactory.java:210)\r\n        at io.agroal.pool.ConnectionPool$CreateConnectionTask.call(ConnectionPool.java:513)\r\n        at io.agroal.pool.ConnectionPool$CreateConnectionTask.call(ConnectionPool.java:494)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n        at io.agroal.pool.util.PriorityScheduledExecutor.beforeExecute(PriorityScheduledExecutor.java:75)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        ... 3 more\r\n```\r\n\r\n### Expected behavior\r\n\r\nI expect this extension to work properly the same way as in JVM mode.\r\n\r\n### Actual behavior\r\n\r\nIt fails in native mode both w/o XA.\r\n\r\n### How to Reproduce?\r\n\r\n- Clone https://github.com/bvahdat/code-with-quarkus3\r\n- Set the Oracle JDBC url `FOO_URL` (something like `jdbc:oracle:thin:@10.251.242.211:15001:DB`), username `FOO_USER` and password `FOO_PASS`, all as ENV variables.\r\n- Run `./mvnw package -Pnative` and then `./target/code-with-quarkus-1.0.0-SNAPSHOT-runner`\r\n- Access http://localhost:8080/hello\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nLinux XYZ 4.4.0-18362-Microsoft #1801-Microsoft Sat Sep 11 15:28:00 PST 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"17.0.1\" 2021-10-19 OpenJDK Runtime Environment GraalVM CE 21.3.0 (build 17.0.1+12-jvmci-21.3-b05) OpenJDK 64-Bit Server VM GraalVM CE 21.3.0 (build 17.0.1+12-jvmci-21.3-b05, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.6.3.Final (Also tried out 999-SNAPSHOT)\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: C:\\Develop\\apache-maven-3.8.4 Java version: 17.0.1, vendor: GraalVM Community, runtime: C:\\Develop\\graalvm-17 Default locale: en_US, platform encoding: Cp1252 OS name: \"windows 10\", version: \"10.0\", arch: \"amd64\", family: \"windows\"\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/23341/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
