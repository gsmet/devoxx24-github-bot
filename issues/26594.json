{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/26594",
  "id": 1296381841,
  "node_id": "I_kwDOCFbutM5NRTeR",
  "number": 26594,
  "title": "@InjectMock with reactive RestClient breaks the RestClient for subsequent tests",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1375177076,
      "node_id": "MDU6TGFiZWwxMzc1MTc3MDc2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/testing",
      "name": "area/testing",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/196",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/196",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/196/labels",
    "id": 8208830,
    "node_id": "MI_kwDOCFbutM4AfUG-",
    "number": 196,
    "title": "2.10.3.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 33,
    "state": "closed",
    "created_at": "2022-07-18T13:45:45Z",
    "updated_at": "2023-01-13T10:37:02Z",
    "due_on": null,
    "closed_at": "2022-07-19T11:12:20Z"
  },
  "comments": 5,
  "created_at": "2022-07-06T20:23:22Z",
  "updated_at": "2022-07-18T14:02:35Z",
  "closed_at": "2022-07-08T13:08:35Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIf a RestClient is mocked with `@InjectMock` (from `io.quarkus:quarkus-junit5-mockito`) in a test, the reactive RestClient will not work correctly for subsequent tests without mocks.\r\n\r\nHowever, the error occurs only when `io.quarkus:quarkus-rest-client-reactive-jackson` is used. With the classic RestClient (`io.quarkus:quarkus-rest-client-jackson`), the RestClient is reset as expected after the tests.\n\n### Expected behavior\n\nRestClient from `io.quarkus:quarkus-rest-client-reactive-jackson` can be used in different tests both as a mock and without.\r\nThe order in which the tests are run should not matter either.\r\n\r\n\r\nThe behavior should be the same for `io.quarkus:quarkus-rest-client-reactive-jackson` as for `io.quarkus:quarkus-rest-client-jackson`.\n\n### Actual behavior\n\nAfter the first QuarkusTest, in which a RestClient is mocked with `@io.quarkus.test.junit.mockito.InjectMock`, the RestClient can no longer be used without a mock.\r\nThe requests, which are executed over the RestClient, are not executed and an empty response is always returned.\r\n\r\nIn the tests, which are executed before, the RestClient works as expected.\r\n\r\nSubsequent tests, which also use a `@InjectMock` mocked RestClient, also work correctly.\n\n### How to Reproduce?\n\nReproducer: https://github.com/vonatzigenc/reproducer_quarkus_reactive_restclient_mockito\r\n\r\n1. Run ` ./mvnw clean verify`\r\n2. Test `TestWithoutMockAfterUsingInjectMock.testHelloEndpoint` fails\r\n\r\n**Description of the tests:**\r\n- Error does not occur when tests are run individually\r\n- Error can also be reproduced directly in IntelliJ. (Run all tests)\r\n- Tests are executed in the following order:\r\n  - `TestWithoutMockBeforeUsingInjectMock`\r\n  - `TestWithInjectMock`\r\n  - `SecondTestWithInjectMock`\r\n  - `TestWithoutMockAfterUsingInjectMock`\r\n- The first and the last test are equal (first works, last one doesn't)\r\n- the second and third test use InjectMock\r\n\r\n\r\n**\"Workarounds\"**\r\n- When `io.quarkus:quarkus-rest-client-reactive-jackson` is replaced by `io.quarkus:quarkus-rest-client-jackson` all tests pass\r\n- If the tests are run with `@InjectMocks` with a custom TestProfile, the tests will pass\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.10.2.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26594/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
