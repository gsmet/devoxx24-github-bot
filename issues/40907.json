{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/40907",
  "id": 2326300593,
  "node_id": "I_kwDOCFbutM6KqIex",
  "number": 40907,
  "title": "HTTP 400 while invoking RESTeasy endpoint",
  "labels": [
    {
      "id": 985346626,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjY=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/question",
      "name": "kind/question",
      "color": "d876e3",
      "default": false,
      "description": "Further information is requested"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 4,
  "created_at": "2024-05-30T18:29:33Z",
  "updated_at": "2024-06-05T13:05:31Z",
  "closed_at": "2024-05-31T07:27:16Z",
  "active_lock_reason": null,
  "body": "Hello,\r\n\r\nI've used the Quarkus quick start examples [here](https://github.com/quarkusio/quarkus-quickstarts/tree/main/amazon-s3-quickstart) to implement a simple RESTesay endpoint. The original example works as expected, of course, however mine doesn't and, while executing the associated unit test, it keeps returning HTTP 400.\r\n\r\nI tried to reduce the two implementations such that to figure out what exactly produces this behavior and, finally, I came up with two almost identical implementations, the original one slightly modified which works as expected, and the one adapted by me, which doesn't and which, whatever I do, returns HTTP 400.\r\n\r\nCould anyone please let me know what might be the problem here ?\r\n\r\n### Expected behavior\r\n\r\nRunning the quick start unit test works as expected by running the simple example adapted by me from this same quick start doesn't and returns HTTP 400.\r\n\r\n### Actual behavior\r\n\r\nI expect that both implementations run identically given that, apart a few minor details, that's almost the same code.\r\n\r\n### How to Reproduce?\r\n\r\n1. Clone the sample repository:\r\n    \r\n    git clone https://github.com/nicolasduminil/quarkus-s3.git\r\n    \r\n2. `cd` to the root directory\r\n\r\n    cd quarkus-s3\r\n\r\n3. Run the unit test:\r\n\r\n    mvn test\r\n\r\nThe unit test fails as shown below:\r\n\r\n    [INFO] -------------------------------------------------------\r\n    [INFO]  T E S T S\r\n    [INFO] -------------------------------------------------------\r\n    [INFO] Running fr.simplex_software.aws.iac.quarkus.s3.tests.S3FileManagementTest\r\n    2024-05-30 19:26:53,980 INFO  [org.tes.doc.DockerClientProviderStrategy] (build-5) Loaded org.testcontainers.dockerclient.UnixSocketClientProviderStrategy from ~/.testcontainers.properties, will try it first\r\n    2024-05-30 19:26:54,212 INFO  [org.tes.doc.DockerClientProviderStrategy] (build-5) Found Docker environment with local Unix socket (unix:///var/run/docker.sock)\r\n    2024-05-30 19:26:54,214 INFO  [org.tes.DockerClientFactory] (build-5) Docker host IP address is localhost\r\n    2024-05-30 19:26:54,228 INFO  [org.tes.DockerClientFactory] (build-5) Connected to docker: \r\n      Server Version: 26.0.1\r\n      API Version: 1.45\r\n      Operating System: Ubuntu 22.04.4 LTS\r\n      Total Memory: 31730 MB\r\n    2024-05-30 19:26:54,236 INFO  [org.tes.ima.PullPolicy] (build-5) Image pull policy will be performed by: DefaultPullPolicy()\r\n    2024-05-30 19:26:54,237 INFO  [org.tes.uti.ImageNameSubstitutor] (build-5) Image name substitution will be performed by: DefaultImageNameSubstitutor (composite of 'ConfigurationFileImageNameSubstitutor' and 'PrefixingImageNameSubstitutor')\r\n    2024-05-30 19:26:54,240 INFO  [org.tes.DockerClientFactory] (build-5) Checking the system...\r\n    2024-05-30 19:26:54,240 INFO  [org.tes.DockerClientFactory] (build-5) ✔︎ Docker server version should be at least 1.6.0\r\n    2024-05-30 19:26:54,344 INFO  [tc.loc.0.1] (build-5) LOCALSTACK_HOST environment variable set to localstack-1xdyp (to match last network alias on container with non-default network)\r\n    2024-05-30 19:26:54,345 INFO  [tc.tes.7.0] (build-5) Creating container for image: testcontainers/ryuk:0.7.0\r\n    2024-05-30 19:26:54,348 INFO  [org.tes.uti.RegistryAuthLocator] (build-5) Failure when attempting to lookup auth config. Please ignore if you don't have images in an authenticated registry. Details: (dockerImageName: testcontainers/ryuk:0.7.0, configFile: /home/nicolas/.docker/config.json, configEnv: DOCKER_AUTH_CONFIG). Falling back to docker-java default behaviour. Exception message: Status 404: No config supplied. Checked in order: /home/nicolas/.docker/config.json (file not found), DOCKER_AUTH_CONFIG (not set)\r\n    2024-05-30 19:26:54,503 INFO  [tc.tes.7.0] (build-5) Container testcontainers/ryuk:0.7.0 is starting: 8a696bea2ef1ec20a42f90d0505ac9f28767d2670d60dae9dc51a15990a4a077\r\n    2024-05-30 19:26:54,830 INFO  [tc.tes.7.0] (build-5) Container testcontainers/ryuk:0.7.0 started in PT0.485372478S\r\n    2024-05-30 19:26:54,834 INFO  [tc.loc.0.1] (build-5) Creating container for image: localstack/localstack:3.0.1\r\n    2024-05-30 19:26:55,679 INFO  [tc.loc.0.1] (build-5) Container localstack/localstack:3.0.1 is starting: ed   ee8305f7e2bb19423723ec602cdc234a0464cc7fde5f91530680729e0181f2\r\n    2024-05-30 19:26:58,331 INFO  [tc.loc.0.1] (build-5) Container localstack/localstack:3.0.1 started in PT3.496597954S\r\n    2024-05-30 19:27:00,558 INFO  [io.qua.ama.com.dep.DevServicesLocalStackProcessor] (build-5) Amazon Dev Services for localstack (s3) started. Other Quarkus applications in dev mode will find the LocalStack automatically.\r\n    2024-05-30 19:27:01,138 INFO  [io.quarkus] (main) quarkus-s3 0.1 on JVM (powered by Quarkus 3.11.0) started in 8.838s. Listening on: http://localhost:8081\r\n    2024-05-30 19:27:01,139 INFO  [io.quarkus] (main) Profile test activated. \r\n    \r\n    [ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 11.62 s <<< FAILURE! -- in fr.simplex_software.aws.iac.quarkus.s3.tests.S3FileManagementTest\r\n    [ERROR] fr.simplex_software.aws.iac.quarkus.s3.tests.S3FileManagementTest.testUploadFile -- Time elapsed: 0.746 s <<< FAILURE!\r\n    java.lang.AssertionError: \r\n    1 expectation failed.\r\n    Expected status code <201> but was <400>.\r\n\r\n            at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)\r\n            at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)\r\n            at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)\r\n            at org.codehaus.groovy.reflection.CachedConstructor.invoke(CachedConstructor.java:73)\r\n            at  org.codehaus.groovy.runtime.callsite.ConstructorSite$ConstructorSiteNoUnwrapNoCoerce.callConstructor(ConstructorSite.java:108)\r\n            at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallConstructor(CallSiteArray.java:57)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:263)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:277)\r\n            at io.restassured.internal.ResponseSpecificationImpl$HamcrestAssertionClosure.validate(ResponseSpecificationImpl.groovy:512)\r\n            at io.restassured.internal.ResponseSpecificationImpl$HamcrestAssertionClosure$validate$1.call(Unknown Source)\r\n            at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:45)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:125)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:139)\r\n            at io.restassured.internal.ResponseSpecificationImpl.validateResponseIfRequired(ResponseSpecificationImpl.groovy:696)\r\n            at io.restassured.internal.ResponseSpecificationImpl.this$2$validateResponseIfRequired(ResponseSpecificationImpl.groovy)\r\n            at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\r\n            at java.base/java.lang.reflect.Method.invoke(Method.java:580)\r\n            at org.codehaus.groovy.runtime.callsite.PlainObjectMetaMethodSite.doInvoke(PlainObjectMetaMethodSite.java:43)\r\n            at org.codehaus.groovy.runtime.callsite.PogoMetaMethodSite$PogoCachedMethodSiteNoUnwrapNoCoerce.invoke(PogoMetaMethodSite.java:198)\r\n            at org.codehaus.groovy.runtime.callsite.PogoMetaMethodSite.callCurrent(PogoMetaMethodSite.java:62)\r\n            at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:49)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:171)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:185)\r\n            at io.restassured.internal.ResponseSpecificationImpl.statusCode(ResponseSpecificationImpl.groovy:135)\r\n            at io.restassured.specification.ResponseSpecification$statusCode$0.callCurrent(Unknown Source)\r\n            at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:49)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:171)\r\n            at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:185)\r\n            at io.restassured.internal.ResponseSpecificationImpl.statusCode(ResponseSpecificationImpl.groovy:143)\r\n            at io.restassured.internal.ValidatableResponseOptionsImpl.statusCode(ValidatableResponseOptionsImpl.java:89)\r\n            at fr.simplex_software.aws.iac.quarkus.s3.tests.S3FileManagementTest.testUploadFile(S3FileManagementTest.java:36)\r\n            at java.base/java.lang.reflect.Method.invoke(Method.java:580)\r\n            at io.quarkus.test.junit.QuarkusTestExtension.runExtensionMethod(QuarkusTestExtension.java:1017)\r\n            at io.quarkus.test.junit.QuarkusTestExtension.interceptTestMethod(QuarkusTestExtension.java:831)\r\n            at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\r\n            at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nLinux nicolas-XPS-15-9570 5.15.0-107-generic #117-Ubuntu SMP Fri Apr 26 12:26:49 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Output of `java -version`\r\n\r\njava version \"21.0.3\" 2024-04-16 LTS Java(TM) SE Runtime Environment (build 21.0.3+7-LTS-152) Java HotSpot(TM) 64-Bit Server VM (build 21.0.3+7-LTS-152, mixed mode, sharing)\r\n\r\n### Quarkus version or git rev\r\n\r\n3.11\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.5 (57804ffe001d7215b5e7bcb531cf83df38f93546) Maven home: /opt/apache-maven-3.9.5 Java version: 21.0.3, vendor: Oracle Corporation, runtime: /usr/lib/jvm/jdk-21-oracle-x64 Default locale: en_US, platform encoding: UTF-8 OS name: \"linux\", version: \"5.15.0-107-generic\", arch: \"amd64\", family: \"unix\"\r\n\r\n### Additional information\r\n\r\nN/A",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40907/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
