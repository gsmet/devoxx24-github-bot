{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36563",
  "id": 1950471060,
  "node_id": "I_kwDOCFbutM50QdOU",
  "number": 36563,
  "title": "OIDC ID token introspection",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/280",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/280",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/280/labels",
    "id": 10034258,
    "node_id": "MI_kwDOCFbutM4AmRxS",
    "number": 280,
    "title": "3.6.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 185,
    "state": "closed",
    "created_at": "2023-10-11T07:34:36Z",
    "updated_at": "2024-01-14T09:44:21Z",
    "due_on": null,
    "closed_at": "2023-11-15T12:08:43Z"
  },
  "comments": 37,
  "created_at": "2023-10-18T19:18:00Z",
  "updated_at": "2023-11-14T12:10:56Z",
  "closed_at": "2023-11-14T12:10:51Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nBefore starting the issue I'm facing, I must say I've looked around and tried _everything_ possible before creating this issue, I feel like i'm facing a very particular issue given the environment I'm in.\r\n\r\nWe are evaluating quarkus-oidc and we have a in-house OIDC provider. \r\n\r\nOIDC Provider:\r\n- does not offer an introspection endpoint\r\n- the JSON Web Key Set (JWKS) endpoint (jwks_uri) requires authentication.\r\n- we want to use local introspection, we will make an authenticated call to jwks_uri and cache the public keys temporarily, to validate the token\r\n\r\nFlow:\r\n\r\n1. ID and access tokens are fetched once the code flow is completed.\r\n2. Both of these tokens are kept in the session cookie\r\n3. ID token is the primary token which we verify on every user request, we get the roles from it, etc.\r\n\r\nProblems:\r\n\r\n1. If we enable discovery, I can avoid an error trying to get metadata from **jwks_uri** (authentication required) but fails in step number 3 of the flow, given that ID tokens are always verified and tries to use the introspection endpoint which we don't have.\r\n - quarkus.oidc.discovery-enabled=true\r\n - quarkus.oidc.token.require-jwt-introspection-only=true \r\n\r\n2. If we disable discovery, fails to fetch **jwks_uri** (authentication required)\r\n- provide all the endpoints (jwks_uri, token, authorize)\r\n- quarkus.oidc.token.allow-jwt-introspection=false\r\n- quarkus.oidc.token.require-jwt-introspection-only=false\r\n\r\nAgain, this seems very specific, but would be possible to have no need for remote introspection and avoid trying to fetch the metadata from jwks_uri on boot or even during step 3 of the flow.\r\n\r\nThanks\n\n### Expected behavior\n\n_No response_\n\n### Actual behavior\n\n_No response_\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36563/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
