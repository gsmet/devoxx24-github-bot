{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/24258",
  "id": 1165783041,
  "node_id": "I_kwDOCFbutM5FfHAB",
  "number": 24258,
  "title": "Kotlin dev compiler cannot access Builder subclass after gRPC hot reload",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2062531368,
      "node_id": "MDU6TGFiZWwyMDYyNTMxMzY4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/grpc",
      "name": "area/grpc",
      "color": "0366d6",
      "default": false,
      "description": "gRPC"
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 8,
  "created_at": "2022-03-10T22:19:35Z",
  "updated_at": "2023-06-07T06:41:40Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nApplication builds and starts correctly with 'mvn compile quarkus:dev', but then making changes to any code dependent on generated gRPC classes generates a class access exception for Builder subclass, but only when also using Kotlin.  The following is the stack error message generated by KotlinCompilerProvider on hot reload:\r\n\r\nCompilation failed.             .map { res: String? -> HelloReply.newBuilder().setMessage(res).setCount(count).build() }\r\nC:\\training\\quarkus-quickstarts\\grpc-plain-text-quickstart\\src\\main\\kotlin\\io\\quarkus\\grpc\\examples\\hello\\HelloWorldService.kt:17:47\r\nReason: Cannot access class 'examples.HelloReply.Builder'. Check your module classpath for missing or conflicting dependencies\r\n            .map { res: String? -> HelloReply.newBuilder().setMessage(res).setCount(count).build() }\r\nC:\\training\\quarkus-quickstarts\\grpc-plain-text-quickstart\\src\\main\\kotlin\\io\\quarkus\\grpc\\examples\\hello\\HelloWorldService.kt:17:60\r\nReason: Unresolved reference: setMessage\r\n2022-03-10 11:13:19,832 ERROR [io.qua.grp.run.dev.GrpcHotReplacementSetup] (vert.x-worker-thread-0) Failed to redeploy application on changes: java.lang.RuntimeException: Compilation failed.             .map { res: String? -> HelloReply.newBuilder().setMessage(res).setCount(count).build() }\r\nC:\\training\\quarkus-quickstarts\\grpc-plain-text-quickstart\\src\\main\\kotlin\\io\\quarkus\\grpc\\examples\\hello\\HelloWorldService.kt:17:47\r\nReason: Cannot access class 'examples.HelloReply.Builder'. Check your module classpath for missing or conflicting dependencies\r\n            .map { res: String? -> HelloReply.newBuilder().setMessage(res).setCount(count).build() }\r\nC:\\training\\quarkus-quickstarts\\grpc-plain-text-quickstart\\src\\main\\kotlin\\io\\quarkus\\grpc\\examples\\hello\\HelloWorldService.kt:17:60\r\nReason: Unresolved reference: setMessage\r\n\tat io.quarkus.kotlin.deployment.KotlinCompilationProvider.compile(KotlinCompilationProvider.java:87)\r\n\tat io.quarkus.deployment.dev.QuarkusCompiler.compile(QuarkusCompiler.java:192)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.checkForChangedClasses(RuntimeUpdatesProcessor.java:707)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:454)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:436)\r\n\tat io.quarkus.grpc.runtime.devmode.GrpcHotReplacementSetup$RestartHandler.get(GrpcHotReplacementSetup.java:40)\r\n\tat io.quarkus.grpc.runtime.devmode.GrpcHotReplacementSetup$RestartHandler.get(GrpcHotReplacementSetup.java:34)\r\n\tat io.quarkus.grpc.runtime.devmode.GrpcHotReplacementInterceptor.fire(GrpcHotReplacementInterceptor.java:13)\r\n\tat io.quarkus.grpc.runtime.GrpcServerRecorder$9$1.handle(GrpcServerRecorder.java:409)\r\n\tat io.quarkus.grpc.runtime.GrpcServerRecorder$9$1.handle(GrpcServerRecorder.java:406)\n\n### Expected behavior\n\nChanges made to Kotlin code dependent on gRPC generated classes should compile during hot reload, as they did at compile/startup.\n\n### Actual behavior\n\nChanges to Kotlin code dependent on gRPC generated classes cannot access Builder subclasses after hot reload\n\n### How to Reproduce?\n\nhttps://github.com/seanyerg/quarkus-grpc-kotlin-reproducer.git\r\n\r\nThis reproducer is no more than the \"quarkus-quickstarts/grpc-plain-text-quickstart\" combined with the \"rest-kotlin-quickstart\" (https://quarkus.io/guides/kotlin).  After running the application, make a change to HelloworldService.kt and rerun the gRPC request.  You should see the compile error mentioned.  \n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\nEvery other Kotlin class hot reloads as long as it isn't dependent on gRPC generated classes.  gRPC with Java also works just fine.  I ruled out any classpath related issues as the classes were clearly included in the target folder and modifications to those classes directly were compiled appropriately.  \r\n\r\nI also removed any \"final\" or \"private\" access-related issues that were possibly created from Kotlin to Java compile-time issues.  I wasn't able to do this with the all-open plugin automatically, but given that it compiled and ran successfully prior to dev mode hot reload, I doubt that this is the issue anyway.\r\n\r\nI also tried compiling gRPC with the protobuf-maven-plugin and was still able to recreate the issue.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258/reactions",
    "total_count": 5,
    "+1": 5,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24258/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
