{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41125",
  "id": 2346573185,
  "node_id": "I_kwDOCFbutM6L3d2B",
  "number": 41125,
  "title": "TestSecurity behaviour for OIDC extension's local logout changed since 3.11.0.CR1",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1282139374,
      "node_id": "MDU6TGFiZWwxMjgyMTM5Mzc0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/security",
      "name": "area/security",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/336",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/336",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/336/labels",
    "id": 11186673,
    "node_id": "MI_kwDOCFbutM4AqrHx",
    "number": 336,
    "title": "3.12.0",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 20,
    "state": "closed",
    "created_at": "2024-06-14T15:56:28Z",
    "updated_at": "2024-06-19T11:34:59Z",
    "due_on": null,
    "closed_at": "2024-06-19T11:34:59Z"
  },
  "comments": 5,
  "created_at": "2024-06-11T14:22:54Z",
  "updated_at": "2024-06-14T15:57:24Z",
  "closed_at": "2024-06-13T22:11:43Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nBehaviour of local logout in the Quarkus OIDC extension under `@TestSecurity` annotation conditions has changed. The test accessing an endpoint that performs a local logout no longer clears the `q_session` and related cookies, while in practice when the endpoint is invoked externally in dev mode the response does still clear the cookies as expected.\r\n\r\nI have confirmed that this is still present against a snapshot build of the current `main` branch (git rev below). It does not occur with version 3.10.2. I have bisected this change to the commit fcdebde4e131fad3c6ef56503ea78bcb6e175dc4, the merge of PR #40059. Looking at the PR, I don't see any obvious reason why this test should start failing, so I am reporting this as a bug.\r\n\r\n### Expected behavior\r\n\r\nThe HTTP response from the local logout endpoint test will clear the `q_session` and related cookies.\r\n\r\n### Actual behavior\r\n\r\nThe HTTP response from the local logout endpoint test does not clear the `q_session` and related cookies.\r\n\r\n### How to Reproduce?\r\n\r\nReproducer: \r\n1. Use the reproducer at https://github.com/cflee/quarkus-reproducer-1/commit/81c5317ffb652be98b93facbda86e6b524bd3f2e which is set to use Quarkus 3.11.1\r\n2. Run `./mvnw test`, it should fail\r\n3. Modify the `quarkus.platform.version` property in `pom.xml` to be 3.10.2\r\n4. Run `./mvnw test`, it should now pass\r\n\r\nThe test failure message with 3.11.1:\r\n\r\n```\r\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 22.54 s <<< FAILURE! -- in org.acme.AuthControllerTest\r\n[ERROR] org.acme.AuthControllerTest.testLogout_authenticated_deletesCookiesSuccessfully -- Time elapsed: 0.582 s <<< FAILURE!\r\norg.opentest4j.AssertionFailedError: Targeted cookie \"q_session\" was not found in headers ==> expected: <true> but was: <false>\r\n```\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n`Darwin cf-lee-tp92p 23.5.0 Darwin Kernel Version 23.5.0: Wed May  1 20:14:38 PDT 2024; root:xnu-10063.121.3~5/RELEASE_ARM64_T6020 arm64`\r\n\r\n### Output of `java -version`\r\n\r\n```\r\nopenjdk version \"21\" 2023-09-19\r\nOpenJDK Runtime Environment GraalVM CE 21+35.1 (build 21+35-jvmci-23.1-b15)\r\nOpenJDK 64-Bit Server VM GraalVM CE 21+35.1 (build 21+35-jvmci-23.1-b15, mixed mode, sharing)\r\n```\r\n\r\n### Quarkus version or git rev\r\n\r\nc29652139610785174dd712bbb410d31a8765ba4\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n```\r\n------------------------------------------------------------\r\nGradle 8.5\r\n------------------------------------------------------------\r\n\r\nBuild time:   2023-11-29 14:08:57 UTC\r\nRevision:     28aca86a7180baa17117e0e5ba01d8ea9feca598\r\n\r\nKotlin:       1.9.20\r\nGroovy:       3.0.17\r\nAnt:          Apache Ant(TM) version 1.10.13 compiled on January 4 2023\r\nJVM:          21 (GraalVM Community 21+35-jvmci-23.1-b15)\r\nOS:           Mac OS X 14.5 aarch64\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41125/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
