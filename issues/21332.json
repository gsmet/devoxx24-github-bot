{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21332",
  "id": 1049499452,
  "node_id": "I_kwDOCFbutM4-jhc8",
  "number": 21332,
  "title": "Property expression `quarkus.http.test-port` with rest-client not working with 2.4.1",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/160",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160/labels",
    "id": 7427013,
    "node_id": "MI_kwDOCFbutM4AcVPF",
    "number": 160,
    "title": "2.5.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 110,
    "state": "closed",
    "created_at": "2021-11-24T15:28:10Z",
    "updated_at": "2021-12-02T11:14:37Z",
    "due_on": null,
    "closed_at": "2021-12-01T12:26:44Z"
  },
  "comments": 2,
  "created_at": "2021-11-10T07:48:04Z",
  "updated_at": "2021-11-29T16:27:57Z",
  "closed_at": "2021-11-22T22:24:30Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI'm having problems after upgrading from 2.3.1.Final to 2.4.1 Final. I'm using property expressions to test my RestClient. The test application.yaml has following properties\r\n\r\n```quarkus:\r\n  http:\r\n    test-port: 0 # use random port\r\n  rest-client:\r\n    example-rest-client:\r\n      url: 'http://localhost:${quarkus.http.test-port}'\r\n```\r\nso if the tests starts with random port like 61234 then the URL should be http://localhost:61234 . This works when using RestAssured. But this does not work for injected RestClient. But it did work before with 2.3.1.Final. So something must have changed in the mean time.\r\n\r\nWhen debugging and checking the property with ConfigProvider.getConfig().getConfigValue(\"quarkus.rest-client.example-rest-client.url\") it also shows correct URL. I have a strong feeling that this is connected with creation of io.quarkus.restclient.config.RestClientsConfig as it already has the incorrect URL.\r\n\r\nIt was discussed on [Zulip](https://quarkusio.zulipchat.com/#narrow/stream/187030-users/topic/Property.20expressions.20with.20rest-client.20not.20working.20with.202.2E4.2E1)\r\n\r\n@radcortez wrote\r\n\r\n> Roberto Cortez: ok this is caused by https://github.com/quarkusio/quarkus/pull/17220 and because REST Client configuration is now read from a ConfigRoot\r\n> Roberto Cortez: the issue is that ConfigRoots are eagerly initialized with the configuration when the app starts (before determining the test port)\r\n> Roberto Cortez: when the test port is mutated it is already too late, because the value is already set in the config root\r\n>Roberto Cortez: not exactly sure what can we do here. I need to discuss this and think about it first\r\n\r\n### Expected behavior\r\n\r\nProperty expressions evaluation works for rest-client properties with 2.4.1.Final\r\n\r\n### Actual behavior\r\n\r\nProperty expressions are not evaluated for rest-client\r\n\r\n### How to Reproduce?\r\n\r\nHere is a small reproducer https://github.com/damian-burda/rest-client-prop-expression\r\n\r\nJust build it with maven and the test will fail. Switch the version to 2.3.1.Final and it will work again.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.4.1.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21332/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
