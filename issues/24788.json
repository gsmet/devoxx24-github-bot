{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/24788",
  "id": 1194313956,
  "node_id": "I_kwDOCFbutM5HL8jk",
  "number": 24788,
  "title": "Reactive Oracle client - native build fails",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2260340367,
      "node_id": "MDU6TGFiZWwyMjYwMzQwMzY3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/mandrel",
      "name": "area/mandrel",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 14,
  "created_at": "2022-04-06T09:13:30Z",
  "updated_at": "2022-06-29T09:08:27Z",
  "closed_at": "2022-06-29T09:08:27Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIn an application that uses multiple reactive and JDBC clients, adding `io.quarkus:quarkus-reactive-oracle-client` + `io.quarkus:quarkus-jdbc-oracle` causes native build to fail.\r\n\r\n```\r\n...\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-routes</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-mysql-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-mysql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-pg-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-postgresql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-db2-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-db2</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-mssql-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-mssql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-reactive-oracle-client</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-jdbc-oracle</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-flyway</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.flywaydb</groupId>\r\n            <artifactId>flyway-mysql</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.flywaydb</groupId>\r\n            <artifactId>flyway-sqlserver</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-smallrye-openapi</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus</groupId>\r\n            <artifactId>quarkus-hibernate-validator</artifactId>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.quarkus.qe</groupId>\r\n            <artifactId>quarkus-test-service-database</artifactId>\r\n            <scope>test</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>io.rest-assured</groupId>\r\n            <artifactId>rest-assured</artifactId>\r\n            <scope>test</scope>\r\n        </dependency>\r\n    </dependencies>\r\n...\r\n```\r\n\r\nThis issue looks similar to https://github.com/quarkusio/quarkus/issues/19055.\n\n### Expected behavior\n\nNative build passes without errors.\n\n### Actual behavior\n\n```\r\n[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] docker run --env LANG=C --rm --user 1000:1000 -v /home/jsmrcka/work/github/quarkus-qe/quarkus-test-suite/sql-db/vertx-sql/target/vertx-sql-1.0.0-SNAPSHOT-native-image-source-jar:/project:z --name build-native-rHGfP quay.io/quarkus/ubi-quarkus-mandrel:21.3-java11 -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dcom.mysql.cj.disableAbandonedConnectionCleanup=true -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-DQuarkusWithJcc=true -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Duser.language=en -J-Duser.country=US -J-Dfile.encoding=UTF-8 -H:-ParseOnce -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED --trace-class-initialization=oracle.jdbc.driver.BlockSource\\$ThreadedCachingBlockSource\\$BlockReleaser,oracle.jdbc.driver.BlockSource\\$ThreadedCachingBlockSource -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -H:+AllowFoldMethods -J-Djava.awt.headless=true -H:FallbackThreshold=0 --allow-incomplete-classpath -H:+ReportExceptionStackTraces -J-Xmx4g -H:+AddAllCharsets -H:EnableURLProtocols=http,https -H:-UseServiceLoaderFeature -H:+StackTrace -J--add-exports=java.base/sun.security.action=ALL-UNNAMED --exclude-config .*com\\.oracle\\.database\\.jdbc.* /META-INF/native-image/(?:native-image\\.properties|reflect-config\\.json) vertx-sql-1.0.0-SNAPSHOT-runner -jar vertx-sql-1.0.0-SNAPSHOT-runner.jar\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]    classlist:   6,178.12 ms,  1.19 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]        (cap):     926.04 ms,  1.19 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]        setup:   4,143.08 ms,  1.19 GB\r\nThe bundle named: com/sun/rowset/RowSetResourceBundle, has not been found. If the bundle is part of a module, verify the bundle name is a fully qualified class name. Otherwise verify the bundle path is accessible in the classpath.\r\n08:59:27,826 INFO  [org.hib.val.int.uti.Version] HV000001: Hibernate Validator 6.2.2.Final\r\n08:59:53,540 INFO  [org.jbo.threads] JBoss Threads version 3.4.2.Final\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]     (clinit):   1,640.07 ms,  2.70 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]   (typeflow):   6,250.20 ms,  2.70 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]    (objects):  82,327.07 ms,  2.70 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]   (features):   7,986.46 ms,  2.70 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]     analysis: 101,769.99 ms,  2.70 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]     universe:   7,004.56 ms,  2.90 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]      (parse):  27,081.07 ms,  3.56 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]     (inline):  22,528.38 ms,  3.46 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]    (compile):  87,516.34 ms,  3.82 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]      compile: 142,728.96 ms,  3.82 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]        image:   9,875.64 ms,  3.64 GB\r\n[vertx-sql-1.0.0-SNAPSHOT-runner:57]        write:   1,305.71 ms,  3.64 GB\r\nError: Classes that should be initialized at run time got initialized during image building:\r\n oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaser the class was requested to be initialized at run time (from feature io.quarkus.runner.AutoFeature.beforeAnalysis with 'BlockSource$ThreadedCachingBlockSource$BlockReleaser.class'). oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource caused initialization of this class with the following trace: \r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaser.<clinit>(BlockSource.java:313)\r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource.<clinit>(BlockSource.java:454)\r\n\r\noracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource the class was requested to be initialized at run time (from feature io.quarkus.runner.AutoFeature.beforeAnalysis with 'BlockSource$ThreadedCachingBlockSource.class'). oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource caused initialization of this class with the following trace: \r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource.<clinit>(BlockSource.java:288)\r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaserListener.handleNotification(BlockSource.java:435)\r\n\tat sun.management.NotificationEmitterSupport.sendNotification(NotificationEmitterSupport.java:155)\r\n\tat sun.management.MemoryImpl.createNotification(MemoryImpl.java:161)\r\n\tat sun.management.MemoryPoolImpl$CollectionSensor.triggerAction(MemoryPoolImpl.java:326)\r\n\tat sun.management.Sensor.trigger(Sensor.java:134)\r\n\r\n\r\ncom.oracle.svm.core.util.UserError$UserException: Classes that should be initialized at run time got initialized during image building:\r\n oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaser the class was requested to be initialized at run time (from feature io.quarkus.runner.AutoFeature.beforeAnalysis with 'BlockSource$ThreadedCachingBlockSource$BlockReleaser.class'). oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource caused initialization of this class with the following trace: \r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaser.<clinit>(BlockSource.java:313)\r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource.<clinit>(BlockSource.java:454)\r\n\r\noracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource the class was requested to be initialized at run time (from feature io.quarkus.runner.AutoFeature.beforeAnalysis with 'BlockSource$ThreadedCachingBlockSource.class'). oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource caused initialization of this class with the following trace: \r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource.<clinit>(BlockSource.java:288)\r\n\tat oracle.jdbc.driver.BlockSource$ThreadedCachingBlockSource$BlockReleaserListener.handleNotification(BlockSource.java:435)\r\n\tat sun.management.NotificationEmitterSupport.sendNotification(NotificationEmitterSupport.java:155)\r\n\tat sun.management.MemoryImpl.createNotification(MemoryImpl.java:161)\r\n\tat sun.management.MemoryPoolImpl$CollectionSensor.triggerAction(MemoryPoolImpl.java:326)\r\n\tat sun.management.Sensor.trigger(Sensor.java:134)\r\n\r\n\r\n\tat com.oracle.svm.core.util.UserError.abort(UserError.java:73)\r\n\tat com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.checkDelayedInitialization(ConfigurableClassInitialization.java:555)\r\n\tat com.oracle.svm.hosted.classinitialization.ClassInitializationFeature.afterImageWrite(ClassInitializationFeature.java:316)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.lambda$doRun$8(NativeImageGenerator.java:663)\r\n\tat com.oracle.svm.hosted.FeatureHandler.forEachFeature(FeatureHandler.java:73)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:663)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:488)\r\n\tat com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:403)\r\n\tat com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:569)\r\n\tat com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:122)\r\n\tat com.oracle.svm.hosted.NativeImageGeneratorRunner$JDK9Plus.main(NativeImageGeneratorRunner.java:599)\r\n```\n\n### How to Reproduce?\n\n```\r\ngit clone git@github.com:jsmrcka/quarkus-test-suite.git\r\ngit checkout reactive-oracle-native-reproducer\r\nmvn clean verify -pl sql-db/vertx-sql -Dnative\r\n```\n\n### Output of `uname -a` or `ver`\n\nLinux ... 5.16.12-200.fc35.x86_64\n\n### Output of `java -version`\n\nopenjdk version \"11.0.14\" 2022-01-18 OpenJDK Runtime Environment Temurin-11.0.14+9 (build 11.0.14+9) OpenJDK 64-Bit Server VM Temurin-11.0.14+9 (build 11.0.14+9, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.7.5.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.4\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24788/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
