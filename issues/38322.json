{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/38322",
  "id": 2093377972,
  "node_id": "I_kwDOCFbutM58xmm0",
  "number": 38322,
  "title": "Impossible to build a project with quarkus-kind in the classpath if kind not available?",
  "labels": [
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 1,
  "created_at": "2024-01-22T08:43:17Z",
  "updated_at": "2024-01-22T08:43:22Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nSee the linked discussion for the long version.\r\n\r\nThe kind extension forces to have kind in the `PATH`, there is no way to build on a machine without `kind` even when `quarkus.kubernetes.deploy` is false.\r\nThis can be an issue, for instance in a CI environment.\r\n\r\n### Expected behavior\r\n\r\nThe build works even without kind in the path.\r\n\r\n### Actual behavior\r\n\r\nThe build fails with:\r\n\r\n```\r\n[ERROR] Failed to execute goal io.quarkus.platform:quarkus-maven-plugin:3.6.6:build (default) on project quarkus-kind-needed-bug: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n[ERROR] \t[error]: Build step io.quarkus.kind.deployment.KindProcessor#postBuild threw an exception: java.lang.RuntimeException: Input/Output error while executing command.\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.startProcess(ExecUtil.java:227)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:118)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:87)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:63)\r\n[ERROR] \tat io.quarkus.kind.deployment.KindProcessor.postBuild(KindProcessor.java:138)\r\n[ERROR] \tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\r\n[ERROR] \tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\r\n[ERROR] \tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:849)\r\n[ERROR] \tat io.quarkus.builder.BuildContext.run(BuildContext.java:256)\r\n[ERROR] \tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n[ERROR] \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n[ERROR] \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n[ERROR] \tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n[ERROR] \tat org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\n[ERROR] Caused by: java.io.IOException: Cannot run program \"kind\" (in directory \".\"): error=2, No such file or directory\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1170)\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1089)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.startProcess(ExecUtil.java:225)\r\n[ERROR] \t... 13 more\r\n[ERROR] Caused by: java.io.IOException: error=2, No such file or directory\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.forkAndExec(Native Method)\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.<init>(ProcessImpl.java:295)\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.start(ProcessImpl.java:225)\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1126)\r\n[ERROR] \t... 15 more\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nTo reproduce:\r\n\r\nPrerequisites: java 21 (or modify the version in the pom...), docker\r\n\r\n* clone https://github.com/PierreBtz/quarkus-kind-needed-bug\r\n* Make sure you do not have kind in your `PATH` (eg `mv $(which kind) $(which kind).bak`).\r\n* run `mvn package` on the project and observe the failure:\r\n\r\n```\r\n[ERROR] Failed to execute goal io.quarkus.platform:quarkus-maven-plugin:3.6.6:build (default) on project quarkus-kind-needed-bug: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\r\n[ERROR] \t[error]: Build step io.quarkus.kind.deployment.KindProcessor#postBuild threw an exception: java.lang.RuntimeException: Input/Output error while executing command.\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.startProcess(ExecUtil.java:227)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:118)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:87)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.exec(ExecUtil.java:63)\r\n[ERROR] \tat io.quarkus.kind.deployment.KindProcessor.postBuild(KindProcessor.java:138)\r\n[ERROR] \tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\r\n[ERROR] \tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\r\n[ERROR] \tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:849)\r\n[ERROR] \tat io.quarkus.builder.BuildContext.run(BuildContext.java:256)\r\n[ERROR] \tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\r\n[ERROR] \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n[ERROR] \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n[ERROR] \tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n[ERROR] \tat org.jboss.threads.JBossThread.run(JBossThread.java:501)\r\n[ERROR] Caused by: java.io.IOException: Cannot run program \"kind\" (in directory \".\"): error=2, No such file or directory\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1170)\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1089)\r\n[ERROR] \tat io.quarkus.deployment.util.ExecUtil.startProcess(ExecUtil.java:225)\r\n[ERROR] \t... 13 more\r\n[ERROR] Caused by: java.io.IOException: error=2, No such file or directory\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.forkAndExec(Native Method)\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.<init>(ProcessImpl.java:295)\r\n[ERROR] \tat java.base/java.lang.ProcessImpl.start(ProcessImpl.java:225)\r\n[ERROR] \tat java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1126)\r\n[ERROR] \t... 15 more\r\n```\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin ***** 23.2.0 Darwin Kernel Version 23.2.0: Wed Nov 15 21:53:18 PST 2023; root:xnu-10002.61.3~2/RELEASE_ARM64_T6000 arm64\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"21.0.1\" 2023-10-17 LTS\r\nOpenJDK Runtime Environment Temurin-21.0.1+12 (build 21.0.1+12-LTS)\r\nOpenJDK 64-Bit Server VM Temurin-21.0.1+12 (build 21.0.1+12-LTS, mixed mode)\r\n\r\n### Quarkus version or git rev\r\n\r\n3.6.6\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.6 (bc0240f3c744dd6b6ec2920b3cd08dcc295161ae)\r\nMaven home: /Users/pierrebeitz/.m2/wrapper/dists/apache-maven-3.9.6-bin/3311e1d4/apache-maven-3.9.6\r\nJava version: 21.0.1, vendor: Eclipse Adoptium, runtime: /Users/pierrebeitz/.asdf/installs/java/temurin-21.0.1+12.0.LTS\r\nDefault locale: en_FR, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"14.2.1\", arch: \"aarch64\", family: \"mac\"\r\n\r\n### Additional information\r\n\r\nSee my comments in the initial discussion.\r\n\r\n\r\n### Discussed in https://github.com/quarkusio/quarkus/discussions/38306\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **PierreBtz** January 19, 2024</sup>\r\nHey folks!\r\n\r\nQuick question before I open an issue. I have a project using the `quarkus-kind` to deploy locally in a kind cluster, all good there I like it :)\r\n\r\nNow for the issue, when running on the CI, there is no kind available, which shouldn't be a problem since I don't want to deploy. However, I think that `quarkus-kind` unconditionally tries to load the image built in kind, even if `quarkus.kubernetes.deploy` is false, as evidenced by https://github.com/quarkusio/quarkus/blob/8bf9f63815b0f2f6dee9fae3db1ee2e306573ee3/extensions/kubernetes/kind/deployment/src/main/java/io/quarkus/kind/deployment/KindProcessor.java#L124-L130.\r\n\r\nI looked around in https://quarkus.io/guides/all-config but didn't find any property to modify this behavior. Am I missing something? Would it make sense to skip `kind load...` if `quarkus.kubernetes.deploy` is false? Or have a different settings to deactivate the load? Or catch the exception and just slip a warning \"couldn't load the image into the kind cluster\"?\r\n\r\nThe only workaround I see is to hide the dependency behind a profile in Maven, obviously I don't like it :)</div>",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38322/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
