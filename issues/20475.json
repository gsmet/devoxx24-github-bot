{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/20475",
  "id": 1011996834,
  "node_id": "I_kwDOCFbutM48Udii",
  "number": 20475,
  "title": "NoSuchFileException when uploading file after a while",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/155",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/155",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/155/labels",
    "id": 7262270,
    "node_id": "MI_kwDOCFbutM4AbtA-",
    "number": 155,
    "title": "2.3.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 82,
    "state": "closed",
    "created_at": "2021-10-18T08:24:48Z",
    "updated_at": "2021-12-07T21:29:09Z",
    "due_on": null,
    "closed_at": "2021-10-20T13:14:36Z"
  },
  "comments": 2,
  "created_at": "2021-09-30T10:21:43Z",
  "updated_at": "2021-10-18T08:36:34Z",
  "closed_at": "2021-10-01T04:58:10Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nDear Quarkus community,\r\n\r\nWhen using Multipart File Upload feature of RestEasy Reactive, it uses by default ${java.io.tmpdir}/uploads to temporary store the uploaded files.\r\n\r\nIt seems in my system at least there are some cleaning tasks and from time to time this subdirectory named \"uploads\" gets deleted.\r\nIn that scenario, files cannot be uploaded anymore, with the following exception:\r\n\r\n`2021-09-30 09:21:16,634 ERROR [org.jbo.res.rea.com.cor.AbstractResteasyReactiveContext] (executor-thread-2) Request failed: java.lang.RuntimeException: java.nio.file.NoSuchFileException: /tmp/uploads/resteasy-reactive1643737138058622276upload\r\n\tat org.jboss.resteasy.reactive.server.core.multipart.MultiPartParserDefinition$MultiPartUploadHandler.beginPart(MultiPartParserDefinition.java:247)\r\n\tat org.jboss.resteasy.reactive.server.core.multipart.MultipartParser$ParseState.headerName(MultipartParser.java:184)\r\n\tat org.jboss.resteasy.reactive.server.core.multipart.MultipartParser$ParseState.parse(MultipartParser.java:99)\r\n\tat org.jboss.resteasy.reactive.server.core.multipart.MultiPartParserDefinition$MultiPartUploadHandler.parseBlocking(MultiPartParserDefinition.java:218)\r\n\tat org.jboss.resteasy.reactive.server.handlers.FormBodyHandler.handle(FormBodyHandler.java:88)\r\n\tat org.jboss.resteasy.reactive.server.handlers.FormBodyHandler.handle(FormBodyHandler.java:25)\r\n\tat org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:141)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$13.runWith(VertxCoreRecorder.java:543)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:831)\r\nCaused by: java.nio.file.NoSuchFileException: /tmp/uploads/resteasy-reactive1643737138058622276upload\r\n\tat java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)\r\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106)\r\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\r\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:219)\r\n\tat java.base/java.nio.file.Files.newByteChannel(Files.java:375)\r\n\tat java.base/java.nio.file.Files.createFile(Files.java:652)\r\n\tat java.base/java.nio.file.TempFileHelper.create(TempFileHelper.java:135)\r\n\tat java.base/java.nio.file.TempFileHelper.createTempFile(TempFileHelper.java:158)\r\n\tat java.base/java.nio.file.Files.createTempFile(Files.java:872)\r\n\tat org.jboss.resteasy.reactive.server.core.multipart.MultiPartParserDefinition$MultiPartUploadHandler.beginPart(MultiPartParserDefinition.java:240)\r\n\t... 13 more`\r\n\r\nIf I manually recreate the /tmp/uploads directory, then everything works again, even without restarting the java service.\r\n\r\nRegards,\r\n\r\n\r\n### Expected behavior\r\n\r\nAs by default the file upload feature requires a subdirectory of the temp directory, it should be checked if the subdirectory still exists\r\n\r\n### Actual behavior\r\n\r\nAt startup the subdirectory /tmp/uploads is created, but Quarkus fails to receive document if this directory gets deleted.\r\n\r\n### How to Reproduce?\r\n\r\n1. Run the File upload example service\r\n2. Delete /tmp/uploads directory that it creates\r\n3. Try to upload a new document\r\n4. See the exception\r\n5. Re-create the /tmp/uploads directory\r\n6. Upload a document\r\n7. Sees it's working again.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nLinux test.dont-code.net 5.6.6-300.fc32.x86_64 #1 SMP Tue Apr 21 13:44:19 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"16.0.1\" 2021-04-20 OpenJDK Runtime Environment 21.3 (build 16.0.1+9) OpenJDK 64-Bit Server VM 21.3 (build 16.0.1+9, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\nQuarkus 2.2.1.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20475/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
