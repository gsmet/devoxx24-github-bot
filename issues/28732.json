{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/28732",
  "id": 1417499299,
  "node_id": "I_kwDOCFbutM5UfVKj",
  "number": 28732,
  "title": "Weird problem when using interface + class for JAX-RS Resources + Auth",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/212",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/212",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/212/labels",
    "id": 8574708,
    "node_id": "MI_kwDOCFbutM4Agtb0",
    "number": 212,
    "title": "2.13.4.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 87,
    "state": "closed",
    "created_at": "2022-10-24T14:12:19Z",
    "updated_at": "2023-01-25T09:02:55Z",
    "due_on": null,
    "closed_at": "2022-11-07T12:39:34Z"
  },
  "comments": 2,
  "created_at": "2022-10-21T00:09:11Z",
  "updated_at": "2022-10-31T15:24:36Z",
  "closed_at": "2022-10-21T09:11:19Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWhen using interfaces with JAX-RS annotations plus classes without those annotations + `@RolesRequired`, there seems to be a weird problem.\r\n\r\nLogs:\r\n```\r\nCDI: programmatic lookup problem detected\r\n-----------------------------------------\r\nAt least one bean matched the required type and qualifiers but was marked as unused and removed during build\r\n\r\nStack frame: io.quarkus.resteasy.reactive.server.runtime.security.EagerSecurityHandler.handle(EagerSecurityHandler.java:62)\r\nRequired type: interface io.quarkus.security.spi.runtime.SecurityCheckStorage\r\nRequired qualifiers: [@javax.enterprise.inject.Default()]\r\nRemoved beans:\r\n\t- SYNTHETIC bean  [types=[interface io.quarkus.security.spi.runtime.SecurityCheckStorage], qualifiers=null]\r\nSolutions:\r\n\t- Application developers can eliminate false positives via the @Unremovable annotation\r\n\t- Extensions can eliminate false positives via build items, e.g. using the UnremovableBeanBuildItem\r\n\t- See also https://quarkus.io/guides/cdi-reference#remove_unused_beans\r\n\t- Enable the DEBUG log level to see the full stack trace\r\n================================================================================\r\n\r\n2022-10-21 00:55:21,948 ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (vert.x-eventloop-thread-2) HTTP Request to /hello failed, error id: 04032c56-8cb1-4a3b-a007-a0cd2c01db5c-1: java.lang.NullPointerException: Cannot invoke \"io.quarkus.security.spi.runtime.SecurityCheckStorage.getSecurityCheck(io.quarkus.security.spi.runtime.MethodDescription)\" because the return value of \"io.quarkus.arc.InstanceHandle.get()\" is null\r\n\tat io.quarkus.resteasy.reactive.server.runtime.security.EagerSecurityHandler.handle(EagerSecurityHandler.java:62)\r\n\tat io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:124)\r\n\tat org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:142)\r\n\tat org.jboss.resteasy.reactive.server.handlers.RestInitialHandler.beginProcessing(RestInitialHandler.java:51)\r\n\tat org.jboss.resteasy.reactive.server.vertx.ResteasyReactiveVertxHandler.handle(ResteasyReactiveVertxHandler.java:18)\r\n\tat org.jboss.resteasy.reactive.server.vertx.ResteasyReactiveVertxHandler.handle(ResteasyReactiveVertxHandler.java:8)\r\n\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1284)\r\n\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:173)\r\n\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:140)\r\n\tat io.quarkus.vertx.http.runtime.StaticResourcesRecorder$2.handle(StaticResourcesRecorder.java:84)\r\n\tat io.quarkus.vertx.http.runtime.StaticResourcesRecorder$2.handle(StaticResourcesRecorder.java:71)\r\n\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1284)\r\n\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:173)\r\n\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:140)\r\n\tat io.quarkus.vertx.http.runtime.VertxHttpRecorder$6.handle(VertxHttpRecorder.java:430)\r\n\tat io.quarkus.vertx.http.runtime.VertxHttpRecorder$6.handle(VertxHttpRecorder.java:408)\r\n\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1284)\r\n\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:173)\r\n\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:140)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpAuthorizer.doPermissionCheck(HttpAuthorizer.java:117)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpAuthorizer.checkPermission(HttpAuthorizer.java:100)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$3.handle(HttpSecurityRecorder.java:233)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$3.handle(HttpSecurityRecorder.java:225)\r\n\tat io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1284)\r\n\tat io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:173)\r\n\tat io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:140)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$2$2$1.onItem(HttpSecurityRecorder.java:137)\r\n\tat io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$2$2$1.onItem(HttpSecurityRecorder.java:127)\r\n```\r\nThis problem can be kinda solved by adding this bean to the unremovable beans list by config. \r\nBut, by doing so, any JAX-RS custom exception mappers for Forbidden and Unauthorized seem to stop working.\n\n### Expected behavior\n\nRequests with correct Auth return 200.\r\nRequests with invalid Auth return 401, using custom JAX-RS exception mapper.\r\nRequests without necessary roles return 403, using custom JAX-RS exception mapper.\n\n### Actual behavior\n\nAll requests return 500.\r\n\r\nAfter adding the bean to the unremovable list,\r\n\r\nRequests with correct Auth return 200.\r\nRequests with invalid Auth return 401, using default response.\r\nRequests without necessary roles return 403, using default response.\n\n### How to Reproduce?\n\nhttps://github.com/davidfrickert/quarkus-resteasy-reactive-resource-interfaces-auth\r\nRun `GreetingResourceImplTest` (only contains the http status 500 case described)\n\n### Output of `uname -a` or `ver`\n\nLinux dfrickert 6.0.2-3-MANJARO #1 SMP PREEMPT_DYNAMIC Sat Oct 15 18:49:52 UTC 2022 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"17.0.5\" 2022-10-18 OpenJDK Runtime Environment (build 17.0.5+1) OpenJDK 64-Bit Server VM (build 17.0.5+1, mixed mode)\n\n### GraalVM version (if different from Java)\n\nN/A\n\n### Quarkus version or git rev\n\n2.13.2.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63) Maven home: /opt/maven Java version: 17.0.5, vendor: N/A, runtime: /usr/lib/jvm/java-17-openjdk Default locale: en_US, platform encoding: UTF-8 OS name: \"linux\", version: \"6.0.2-3-manjaro\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/28732/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
