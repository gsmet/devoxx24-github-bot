{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/20310",
  "id": 1002777197,
  "node_id": "I_kwDOCFbutM47xSpt",
  "number": 20310,
  "title": "Native image start error:  Hibernate Search application startup failure",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1664142960,
      "node_id": "MDU6TGFiZWwxNjY0MTQyOTYw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-search",
      "name": "area/hibernate-search",
      "color": "0366d6",
      "default": false,
      "description": "Hibernate Search / Elasticsearch"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 2,
  "created_at": "2021-09-21T16:03:24Z",
  "updated_at": "2021-09-21T18:00:34Z",
  "closed_at": "2021-09-21T17:59:50Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI'm building a native image which depends on Hibernate Search quarkus extension. At the image startup, it fails with the following error. I'm using quarkus version 2.2.3.Final.\r\n`\r\n__  ____  __  _____   ___  __ ____  ______\r\n --/ __ \\/ / / / _ | / _ \\/ //_/ / / / __/\r\n -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\\ \\\r\n--\\___\\_\\____/_/ |_/_/|_/_/|_|\\____/___/\r\n2021-09-21 15:55:31,631 INFO  [io.agr.pool] (main) Datasource '<default>': Initial size smaller than min. Connections will be created when necessary\r\n2021-09-21 15:55:31,737 WARN  [io.qua.run.log.LoggingSetupRecorder] (main) Log level TRACE for category 'org.hibernate.search' set below minimum logging level DEBUG, promoting it to DEBUG\r\n2021-09-21 15:55:31,739 WARN  [io.qua.run.log.LoggingSetupRecorder] (main) Log level TRACE for category 'org.zalando.logbook' set below minimum logging level DEBUG, promoting it to DEBUG\r\n2021-09-21 15:55:32,288 DEBUG [org.hib.sea.map.orm.boo.imp.HibernateSearchIntegrator] (JPA Startup Thread: <default>) HSEARCH000034: Hibernate Search version 0.0.3\r\n2021-09-21 15:55:32,293 DEBUG [org.hib.sea.map.orm.boo.imp.HibernateSearchIntegrator] (JPA Startup Thread: <default>) Hibernate Search event listeners activated\r\n2021-09-21 15:55:33,447 DEBUG [org.hib.sea.map.orm.map.imp.HibernateOrmMapping] (JPA Startup Thread: <default>) HSEARCH000235: Default automatic indexing synchronization strategy set to 'AutomaticIndexingSynchronizationStrategy.sync()'.\r\n2021-09-21 15:55:33,467 ERROR [org.hib.sea.eng.rep.spi.RootFailureCollector] (JPA Startup Thread: <default>) HSEARCH000521: Hibernate Search encountered a failure during bootstrap; continuing for now to list all problems, but the process will ultimately be aborted.\r\nContext: default backend\r\nFailure:: org.apache.commons.logging.LogConfigurationException: java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl (Caused by java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl)\r\n        at org.apache.commons.logging.LogFactory.createFactory(LogFactory.java:1158)\r\n        at org.apache.commons.logging.LogFactory$2.run(LogFactory.java:960)\r\n        at java.security.AccessController.doPrivileged(AccessController.java:87)\r\n        at org.apache.commons.logging.LogFactory.newFactory(LogFactory.java:957)\r\n        at org.apache.commons.logging.LogFactory.getFactory(LogFactory.java:624)\r\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:655)\r\n        at org.apache.http.impl.client.AuthenticationStrategyImpl.<init>(AuthenticationStrategyImpl.java:69)\r\n        at org.apache.http.impl.client.TargetAuthenticationStrategy.<init>(TargetAuthenticationStrategy.java:50)\r\n        at org.elasticsearch.client.PersistentCredentialsAuthenticationStrategy.<init>(PersistentCredentialsAuthenticationStrategy.java:46)\r\n        at org.elasticsearch.client.RestClientBuilder.createHttpClient(RestClientBuilder.java:212)\r\n        at java.security.AccessController.doPrivileged(AccessController.java:87)\r\n        at org.elasticsearch.client.RestClientBuilder.build(RestClientBuilder.java:191)\r\n        at org.hibernate.search.backend.elasticsearch.client.impl.ElasticsearchClientFactoryImpl.createClient(ElasticsearchClientFactoryImpl.java:185)\r\n        at org.hibernate.search.backend.elasticsearch.client.impl.ElasticsearchClientFactoryImpl.create(ElasticsearchClientFactoryImpl.java:155)\r\n        at org.hibernate.search.backend.elasticsearch.impl.ElasticsearchLinkImpl.onStart(ElasticsearchLinkImpl.java:136)\r\n        at org.hibernate.search.backend.elasticsearch.impl.ElasticsearchBackendImpl.start(ElasticsearchBackendImpl.java:128)\r\n        at org.hibernate.search.engine.common.impl.BackendNonStartedState.start(BackendNonStartedState.java:48)\r\n        at org.hibernate.search.engine.common.impl.SearchIntegrationPartialBuildStateImpl$SearchIntegrationFinalizerImpl.finalizeIntegration(SearchIntegrationPartialBuildStateImpl.java:156)\r\n        at org.hibernate.search.mapper.orm.bootstrap.impl.HibernateOrmIntegrationBooterImpl.doBootSecondPhase(HibernateOrmIntegrationBooterImpl.java:284)\r\n        at org.hibernate.search.mapper.orm.bootstrap.impl.HibernateOrmIntegrationBooterImpl.bootNow(HibernateOrmIntegrationBooterImpl.java:221)\r\n        at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:642)\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506)\r\n        at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2073)\r\n        at org.hibernate.search.mapper.orm.bootstrap.impl.HibernateSearchSessionFactoryObserver.sessionFactoryCreated(HibernateSearchSessionFactoryObserver.java:41)\r\n        at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35)\r\n        at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:394)\r\n        at io.quarkus.hibernate.orm.runtime.boot.FastBootEntityManagerFactoryBuilder.build(FastBootEntityManagerFactoryBuilder.java:71)\r\n        at io.quarkus.hibernate.orm.runtime.FastBootHibernatePersistenceProvider.createEntityManagerFactory(FastBootHibernatePersistenceProvider.java:67)\r\n        at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:80)\r\n        at javax.persistence.Persistence.createEntityManagerFactory(Persistence.java:55)\r\n        at io.quarkus.hibernate.orm.runtime.JPAConfig$LazyPersistenceUnit.get(JPAConfig.java:149)\r\n        at io.quarkus.hibernate.orm.runtime.JPAConfig$1.run(JPAConfig.java:58)\r\n        at java.lang.Thread.run(Thread.java:829)\r\n        at com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:567)\r\n        at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:192)\r\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl\r\n        at com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:71)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:212)\r\n        at org.apache.commons.logging.LogFactory.createFactory(LogFactory.java:1020)\r\n        ... 34 more\r\n\r\n`\n\n### Expected behavior\n\nIt should run normally.\n\n### Actual behavior\n\nThe applications doesn't start.\n\n### How to Reproduce?\n\nThis is my pom dependencies:\r\n\r\n`\r\n<dependencies>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.springframework.security</groupId>\r\n\t\t\t<artifactId>spring-security-crypto</artifactId>\r\n\t\t\t<version>5.5.2</version>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-hibernate-validator</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-smallrye-openapi</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-hibernate-search-orm-elasticsearch</artifactId>\r\n\t\t</dependency>\r\n\t\t\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-smallrye-jwt</artifactId>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-smallrye-jwt-build</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>com.google.apis</groupId>\r\n\t\t\t<artifactId>google-api-services-oauth2</artifactId>\r\n\t\t\t<version>v2-rev157-1.25.0</version>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>com.google.http-client</groupId>\r\n\t\t\t<artifactId>google-http-client-gson</artifactId>\r\n\t\t\t<version>1.39.2</version>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.passay</groupId>\r\n\t\t\t<artifactId>passay</artifactId>\r\n\t\t\t<version>1.6.0</version>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>com.google.http-client</groupId>\r\n\t\t\t<artifactId>google-http-client-apache-v2</artifactId>\r\n\t\t\t<version>1.39.2</version>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.mapstruct</groupId>\r\n\t\t\t<artifactId>mapstruct</artifactId>\r\n\t\t\t<version>${org.mapstruct.version}</version>\r\n\t\t</dependency>\r\n\t\t\r\n\t\t<dependency>\r\n\t\t\t<groupId>org.projectlombok</groupId>\r\n\t\t\t<artifactId>lombok</artifactId>\r\n\t\t\t<scope>provided</scope>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-resteasy</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-resteasy-jackson</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-rest-client</artifactId>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-rest-client-jackson</artifactId>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-amazon-lambda-rest</artifactId>\r\n\t\t</dependency>\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-security-jpa</artifactId>\r\n\t\t</dependency>\r\n\r\n\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-junit5</artifactId>\r\n\t\t\t<scope>test</scope>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.rest-assured</groupId>\r\n\t\t\t<artifactId>rest-assured</artifactId>\r\n\t\t\t<scope>test</scope>\r\n\t\t</dependency>\r\n\t\t<dependency>\r\n\t\t\t<groupId>io.quarkus</groupId>\r\n\t\t\t<artifactId>quarkus-test-h2</artifactId>\r\n\t\t\t<scope>test</scope>\r\n\t\t</dependency>\r\n`\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\nOpenJDK 64-Bit Server VM 18.9 (build 11.0.12+7, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.2.3-Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.2 (ea98e05a04480131370aa0c110b8c54cf726c06f)\n\n### Additional information\n\nRunning with quarkus:dev mode, it works fine.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20310/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
