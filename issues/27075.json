{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27075",
  "id": 1325360883,
  "node_id": "I_kwDOCFbutM5O_2bz",
  "number": 27075,
  "title": "Mongodb connection string argument not passed when starting native integration tests",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1375177076,
      "node_id": "MDU6TGFiZWwxMzc1MTc3MDc2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/testing",
      "name": "area/testing",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1470336085,
      "node_id": "MDU6TGFiZWwxNDcwMzM2MDg1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/mongodb",
      "name": "area/mongodb",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/199",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/199",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/199/labels",
    "id": 8265772,
    "node_id": "MI_kwDOCFbutM4AfiAs",
    "number": 199,
    "title": "2.11.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 26,
    "state": "closed",
    "created_at": "2022-08-03T15:32:30Z",
    "updated_at": "2022-08-04T12:47:59Z",
    "due_on": null,
    "closed_at": "2022-08-04T12:47:59Z"
  },
  "comments": 6,
  "created_at": "2022-08-02T06:40:17Z",
  "updated_at": "2022-08-03T15:35:17Z",
  "closed_at": "2022-08-02T12:24:22Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI recently tried to upgrade from Quarkus 2.7.6 to 2.11.1 and found some issues when running integration tests for a native build with maven, using `mvn clean verify -Pnative`.\r\n\r\nThe issue is the mongodb driver not being able to connect to the server, timing out when some of the integration test try to access the database.\r\n\r\nTo be more specific, this is only happening when performing a second group of tests using a different profile.\r\nAs you know, tests (native or not) using different profiles are grouped per profile in order to optimize the number of time the application / quarkus is rebooted to execute all tests.\r\n\r\nThe first set of integration test is working fine, the following command is run to start the application, right after popping the mongodb container:\r\n\r\n`\r\nExecuting \"/my-service-runner -Dquarkus.http.port=8081 -Dquarkus.http.ssl-port=8444 -Dtest.url=http://localhost:8081 -Dquarkus.log.file.path=/path/to/my/service/target/quarkus.log -Dquarkus.log.file.enable=true -Dquarkus.mongodb.connection-string=mongodb://localhost:49291/databasename\"\r\n`\r\n\r\nwith the port number being randomized.\r\n\r\nBut when the application is shutdown and restarted with a new fresh mongodb container, the command ommit the `quarkus.mongodb.connection-string` argument: (and adding a few ones i have no idea what for)\r\n\r\n`Executing \"my-service-runner -Dquarkus.http.port=8081 -Dquarkus.http.ssl-port=8444 -Dtest.url=http://localhost:8081 -Dquarkus.log.file.path=/path/to/the/service/target/quarkus.log -Dquarkus.log.file.enable=true -Dquarkus.configuration.build-time-mismatch-at-runtime=fail -Dtoken.generator.secret=test -Dquarkus.profile=int-test -Dtoken.generator.issuer=integration-tests -Dtoken.generator.validity-delay=5\"`\r\n\r\nThe consequence is the service timing out on the tentative to connect to the mongodb server, as it tries by default to connect on the default mongodb port `127.0.0.1:27017` which surely cannot match the auto randomized port used by the dev services.\r\n\r\n**Failing since Quarkus 2.10.0 ?**\r\n\r\nAfter checking each version upgrade, i could finally spot the culprit version of Quarkus, the 2.10.0 (was still working fine on the 2.9.2, no matter wich jdk / graalvm or mandrel distribution is used)\r\n\r\nI found the [following ticket](https://github.com/quarkusio/quarkus/issues/25730) fixing something related to connection string / context information for the mongodb-client integrated into the 2.10.0-RC build and thus in the 2.10.0-Final release of Quarkus, could it be somehow related ?\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nThe native integration tests using multiple profiles should not fail for connectivity reasons.\r\n\r\n### Actual behavior\r\n\r\nSince the mongo connection string is not passed anymore from the second boot / second profile, all tests needing a connection to the mongodb are failling.\r\n\r\n### How to Reproduce?\r\n\r\nYou should be able to reproduce it by using [this reproducer](https://github.com/nicolas-vivot/quarkus-27075-reproducer)\r\n\r\nRequirements & how to reproduce in the readme.\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27075/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
