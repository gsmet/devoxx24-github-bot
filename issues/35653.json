{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/35653",
  "id": 1875075041,
  "node_id": "I_kwDOCFbutM5vw1_h",
  "number": 35653,
  "title": "Ungraceful continuous testing failure in dev mode due to (unhandled?) Jackson serialization error when communicating with dev ui",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273039603,
      "node_id": "MDU6TGFiZWwxMjczMDM5NjAz",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/devmode",
      "name": "area/devmode",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1676631606,
      "node_id": "MDU6TGFiZWwxNjc2NjMxNjA2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/env/windows",
      "name": "env/windows",
      "color": "edea47",
      "default": false,
      "description": "Impacts Windows machines"
    },
    {
      "id": 2715669984,
      "node_id": "MDU6TGFiZWwyNzE1NjY5OTg0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/dev-ui",
      "name": "area/dev-ui",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2955098535,
      "node_id": "MDU6TGFiZWwyOTU1MDk4NTM1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/continuous-testing",
      "name": "area/continuous-testing",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 3267721944,
      "node_id": "MDU6TGFiZWwzMjY3NzIxOTQ0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/jackson",
      "name": "area/jackson",
      "color": "0366d6",
      "default": false,
      "description": "Issues related to Jackson (JSON library)"
    },
    {
      "id": 5085228218,
      "node_id": "LA_kwDOCFbutM8AAAABLxpsug",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/triage/needs-feedback",
      "name": "triage/needs-feedback",
      "color": "FDE078",
      "default": false,
      "description": "We are waiting for feedback."
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/265",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/265",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/265/labels",
    "id": 9762660,
    "node_id": "MI_kwDOCFbutM4AlPdk",
    "number": 265,
    "title": "3.4.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 152,
    "state": "closed",
    "created_at": "2023-08-09T06:34:41Z",
    "updated_at": "2023-10-31T11:58:00Z",
    "due_on": null,
    "closed_at": "2023-09-06T13:01:00Z"
  },
  "comments": 7,
  "created_at": "2023-08-31T08:49:50Z",
  "updated_at": "2023-09-02T02:09:09Z",
  "closed_at": "2023-09-02T02:09:05Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWhen running tests in development mode (`quarkus dev` or `mvn quarkus:dev`), if an exception is thrown as part of a test that cannot be serialized to json for the dev UI, then continuous testing fails with a jackson processing exception and you have to restart the quarkus dev process.\r\n\r\nIf you run your tests with `quarkus:test` then everything is fine, as there is no attempt to parse the test results as json.\r\n\r\nI think that any sort of error / exception that occurs in the dev-ui/as part of the dev-ui communication should not interfere with continuous testing at all. These errors (IMO) should be stopped before they bleed into the continuous processing experience, as when they do, this interrupts development flow using `quarkus dev`.\r\n\r\n### Expected behavior\r\n\r\nAn error occurring in the communication process for the dev-ui should not cause the continuous testing process to fail, requiring a restart.\r\n\r\n### Actual behavior\r\n\r\nAn error occurring in the communication process for the dev-ui causes the continuous testing process to fail, requiring a restart.\r\n\r\n### How to Reproduce?\r\n\r\n1. Download the [reproducer](https://github.com/quarkusio/quarkus/files/12484269/quarkus-dev-ui-jackson-exception-reproducer.zip)\r\n2. Run `mvn quarkus:test`\r\n3. See a nicely reported test failure like so:\r\n```bash\r\n2023-08-31 10:45:24,901 ERROR [io.qua.test] (Test runner thread) ==================== TEST REPORT #1 ==================== [Error Occurred After Shutdown]\r\n2023-08-31 10:45:24,901 ERROR [io.qua.test] (Test runner thread) Test AwesomeServiceTest#watch it burn() failed\r\n [Error Occurred After Shutdown]: org.jboss.resteasy.reactive.ClientWebApplicationException: Received: 'Not Found, status code 404' when invoking: Rest Client method: 'de.awesomecompany.awesomeproduct.awesomeness.AwesomeRestClient#activateMaximumCoolness'\r\n        at org.jboss.resteasy.reactive.client.impl.RestClientRequestContext.unwrapException(RestClientRequestContext.java:185)\r\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.handleException(AbstractResteasyReactiveContext.java:322)\r\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:173)\r\n        at org.jboss.resteasy.reactive.client.impl.RestClientRequestContext$1.lambda$execute$0(RestClientRequestContext.java:295)\r\n        at io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:264)\r\n        at io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:246)\r\n        at io.vertx.core.impl.EventLoopContext.lambda$runOnContext$0(EventLoopContext.java:43)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:566)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: jakarta.ws.rs.WebApplicationException: Not Found, status code 404\r\n        at io.quarkus.rest.client.reactive.runtime.DefaultMicroprofileRestClientExceptionMapper.toThrowable(DefaultMicroprofileRestClientExceptionMapper.java:18)\r\n        at io.quarkus.rest.client.reactive.runtime.MicroProfileRestClientResponseFilter.filter(MicroProfileRestClientResponseFilter.java:52)\r\n        at org.jboss.resteasy.reactive.client.handlers.ClientResponseFilterRestHandler.handle(ClientResponseFilterRestHandler.java:21)\r\n        at org.jboss.resteasy.reactive.client.handlers.ClientResponseFilterRestHandler.handle(ClientResponseFilterRestHandler.java:10)\r\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.invokeHandler(AbstractResteasyReactiveContext.java:229)\r\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:145)\r\n        ... 12 more\r\n ```\r\n4. Stop `quarkus:test`\r\n5. Start `quarkus:dev`\r\n6. Press 'r' to start continuous testing process\r\n7. See a jackson serialization error like so\r\n```bash\r\n2023-08-31 10:49:15,226 ERROR [io.qua.test] (Test runner thread) Internal error running tests: java.lang.RuntimeException: java.lang.RuntimeException: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.ByteArrayInputStream and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: io.quarkus.deployment.dev.testing.TestRunResults[\"results\"]->java.util.Collections$UnmodifiableMap[\"AwesomeServiceTest\"]->io.quarkus.deployment.dev.testing.TestClassResult[\"failing\"]->java.util.ArrayList[0]->io.quarkus.deployment.dev.testing.TestResult[\"problems\"]->java.util.Collections$UnmodifiableRandomAccessList[0]->org.jboss.resteasy.reactive.ClientWebApplicationException[\"cause\"]->jakarta.ws.rs.WebApplicationException[\"response\"]->org.jboss.resteasy.reactive.client.impl.ClientResponseImpl[\"entityStream\"])\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService.invokeAction(ContinuousTestingJsonRPCService.java:96)\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService.getResults(ContinuousTestingJsonRPCService.java:89)\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService.accept(ContinuousTestingJsonRPCService.java:39)\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService.accept(ContinuousTestingJsonRPCService.java:15)\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService_ClientProxy.accept(Unknown Source)\r\n        at io.quarkus.dev.testing.ContinuousTestingSharedStateManager.setLastState(ContinuousTestingSharedStateManager.java:36)\r\n        at io.quarkus.deployment.dev.testing.ContinuousTestingSharedStateListener$1.runComplete(ContinuousTestingSharedStateListener.java:53)\r\n        at io.quarkus.deployment.dev.testing.TestSupport.runInternal(TestSupport.java:475)\r\n        at io.quarkus.deployment.dev.testing.TestSupport$3.run(TestSupport.java:381)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: java.lang.RuntimeException: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.ByteArrayInputStream and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: io.quarkus.deployment.dev.testing.TestRunResults[\"results\"]->java.util.Collections$UnmodifiableMap[\"AwesomeServiceTest\"]->io.quarkus.deployment.dev.testing.TestClassResult[\"failing\"]->java.util.ArrayList[0]->io.quarkus.deployment.dev.testing.TestResult[\"problems\"]->java.util.Collections$UnmodifiableRandomAccessList[0]->org.jboss.resteasy.reactive.ClientWebApplicationException[\"cause\"]->jakarta.ws.rs.WebApplicationException[\"response\"]->org.jboss.resteasy.reactive.client.impl.ClientResponseImpl[\"entityStream\"])\r\n        at io.quarkus.devui.deployment.menu.ContinuousTestingProcessor.lambda$registerGetResultsMethod$5(ContinuousTestingProcessor.java:198)\r\n        at io.quarkus.devui.runtime.continuoustesting.ContinuousTestingJsonRPCService.invokeAction(ContinuousTestingJsonRPCService.java:94)\r\n        ... 9 more\r\nCaused by: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.ByteArrayInputStream and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: io.quarkus.deployment.dev.testing.TestRunResults[\"results\"]->java.util.Collections$UnmodifiableMap[\"AwesomeServiceTest\"]->io.quarkus.deployment.dev.testing.TestClassResult[\"failing\"]->java.util.ArrayList[0]->io.quarkus.deployment.dev.testing.TestResult[\"problems\"]->java.util.Collections$UnmodifiableRandomAccessList[0]->org.jboss.resteasy.reactive.ClientWebApplicationException[\"cause\"]->jakarta.ws.rs.WebApplicationException[\"response\"]->org.jboss.resteasy.reactive.client.impl.ClientResponseImpl[\"entityStream\"])\r\n        at com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:77)\r\n        at com.fasterxml.jackson.databind.SerializerProvider.reportBadDefinition(SerializerProvider.java:1306)\r\n        at com.fasterxml.jackson.databind.DatabindContext.reportBadDefinition(DatabindContext.java:408)\r\n        at com.fasterxml.jackson.databind.ser.impl.UnknownSerializer.failForEmpty(UnknownSerializer.java:53)\r\n        at com.fasterxml.jackson.databind.ser.impl.UnknownSerializer.serialize(UnknownSerializer.java:30)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serializeContents(IndexedListSerializer.java:119)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serialize(IndexedListSerializer.java:79)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serialize(IndexedListSerializer.java:18)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serializeContents(IndexedListSerializer.java:119)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serialize(IndexedListSerializer.java:79)\r\n        at com.fasterxml.jackson.databind.ser.impl.IndexedListSerializer.serialize(IndexedListSerializer.java:18)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.std.MapSerializer.serializeFields(MapSerializer.java:808)\r\n        at com.fasterxml.jackson.databind.ser.std.MapSerializer.serializeWithoutTypeInfo(MapSerializer.java:764)\r\n        at com.fasterxml.jackson.databind.ser.std.MapSerializer.serialize(MapSerializer.java:720)\r\n        at com.fasterxml.jackson.databind.ser.std.MapSerializer.serialize(MapSerializer.java:35)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:733)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:774)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:178)\r\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:480)\r\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:319)\r\n        at com.fasterxml.jackson.databind.ObjectMapper._writeValueAndClose(ObjectMapper.java:4624)\r\n        at com.fasterxml.jackson.databind.ObjectMapper.writeValue(ObjectMapper.java:3852)\r\n        at io.quarkus.devui.deployment.menu.ContinuousTestingProcessor.lambda$registerGetResultsMethod$5(ContinuousTestingProcessor.java:193)\r\n        ... 11 more\r\n```\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nMicrosoft Windows [Version 10.0.19045.3393]\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"17.0.5\" 2022-10-18 OpenJDK Runtime Environment Temurin-17.0.5+8 (build 17.0.5+8) OpenJDK 64-Bit Server VM Temurin-17.0.5+8 (build 17.0.5+8, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\nN/A\r\n\r\n### Quarkus version or git rev\r\n\r\n3.0.3.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.2 (c9616018c7a021c1c39be70fb2843d6f5f9b8a1c) Maven home: C:\\Users\\olson\\dev\\tools\\apache-maven-3.9.2 Java version: 17.0.5, vendor: Eclipse Adoptium, runtime: C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.5.8-hotspot Default locale: de_DE, platform encoding: Cp1252 OS name: \"windows 10\", version: \"10.0\", arch: \"amd64\", family: \"windows\"\r\n\r\n### Additional information\r\n\r\nN/A",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/35653/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
