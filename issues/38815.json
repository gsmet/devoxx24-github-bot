{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/38815",
  "id": 2138333553,
  "node_id": "I_kwDOCFbutM5_dGFx",
  "number": 38815,
  "title": "Support security identity propagation in VT",
  "labels": [
    {
      "id": 985346622,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjI=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/enhancement",
      "name": "kind/enhancement",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1282102389,
      "node_id": "MDU6TGFiZWwxMjgyMTAyMzg5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/arc",
      "name": "area/arc",
      "color": "0366d6",
      "default": false,
      "description": "Issue related to ARC (dependency injection)"
    },
    {
      "id": 1282139374,
      "node_id": "MDU6TGFiZWwxMjgyMTM5Mzc0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/security",
      "name": "area/security",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 6031725549,
      "node_id": "LA_kwDOCFbutM8AAAABZ4TT7Q",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/virtual-threads",
      "name": "area/virtual-threads",
      "color": "0366d6",
      "default": false,
      "description": "Issue related to Java's Virtual Threads"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/310",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/310",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/310/labels",
    "id": 10578643,
    "node_id": "MI_kwDOCFbutM4AoWrT",
    "number": 310,
    "title": "3.7.4",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 45,
    "state": "closed",
    "created_at": "2024-02-19T17:04:48Z",
    "updated_at": "2024-07-13T17:07:53Z",
    "due_on": null,
    "closed_at": "2024-02-21T12:35:22Z"
  },
  "comments": 6,
  "created_at": "2024-02-16T10:46:31Z",
  "updated_at": "2024-05-17T14:23:10Z",
  "closed_at": "2024-02-19T16:18:52Z",
  "active_lock_reason": null,
  "body": "### Description\n\nHere is a use case we expect to be supported:\r\n```\r\n@Inject\r\n    MyComponent myComponent;\r\n\r\n    @Inject\r\n    @VirtualThreads\r\n    ExecutorService vThreads;\r\n\r\n    @Inject\r\n    SecurityIdentity securityIdentity;\r\n\r\n    @GET\r\n    @Produces(MediaType.TEXT_PLAIN)\r\n    @RunOnVirtualThread\r\n    @Path(\"/vt\")\r\n    @RolesAllowed(\"admin\")\r\n    public String getId() throws InterruptedException, ExecutionException {\r\n        String name = securityIdentity.getPrincipal().getName();\r\n        log.info(\"name = \" + name);\r\n        String nameV = vThreads.submit(() -> myComponent.getId()).get();\r\n        log.info(\"nameV = \" + nameVT);\r\n        return name + \"/\" + nameV;\r\n    }\r\n\r\n...\r\n\r\n@ApplicationScoped\r\npublic class MyComponent {\r\n\r\n    private static final Logger log = Logger.getLogger(MyComponent.class);\r\n\r\n    @Inject\r\n    SecurityIdentity securityIdentity;\r\n\r\n    // @ActivateRequestContext\r\n    public String getId() {\r\n        String nameVT = securityIdentity.getPrincipal().getName();\r\n        log.info(\"nameVT = \" + nameVT);\r\n        return name;\r\n    }\r\n}\r\n```\r\n\r\ntoday, without the `ActivateRequestContext`, it fails because there is no request context when accessing the security identity.\r\nand if we force the activation of the request context, there is no identity propagated from the calling thread : `getId()` returns an empty string.\r\n\r\nthe expectation is that there would be identity propagation.\r\nan alternative (non ideal)  idea would be to re-authenticate inside `getId()`.\r\nwe intend to use this pattern on facades that receive an invocation, and need to call multiple downstream services in parallel, then aggregate all the information and return the result to the caller.\r\n\n\n### Implementation ideas\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38815/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
