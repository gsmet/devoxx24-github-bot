{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/27300",
  "id": 1339875224,
  "node_id": "I_kwDOCFbutM5P3N-Y",
  "number": 27300,
  "title": "`hibernate-orm-panache-kotlin`, `resteasy-reactive-kotlin/standard`, `kotlin-serialization`, and `rest-client-reactive-kotlin-serialization` fail in native with latest GraalVM 22.3-dev build",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 22,
  "created_at": "2022-08-16T06:27:55Z",
  "updated_at": "2022-09-20T07:02:31Z",
  "closed_at": "2022-09-20T07:02:31Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\n`hibernate-orm-panache-kotlin` quarkus integration test fails with latest GraalVM CE dev build in native mode with:\r\n\r\n```\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'quarkus-integration-test-hibernate-orm-panache-kotlin-999-SNAPSHOT-runner' (executable)...\r\n========================================================================================================================\r\n[1/7] Initializing...                                                                                   (14.0s @ 0.26GB)\r\n Version info: 'GraalVM 22.3.0-dev Java 17 CE'\r\n Java version info: '17.0.3+7'\r\n C compiler: gcc (redhat, x86_64, 12.1.1)\r\n Garbage collector: Serial GC\r\n 8 user-specific feature(s)\r\n - io.quarkus.caffeine.runtime.graal.CacheConstructorsFeature\r\n - io.quarkus.hibernate.orm.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase for the [org.hibernate.Version, org.hibernate.annotations.common.Version, org.hibernate.dialect.Dialect] categories\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase for the [org.jboss.threads] categories\r\n - io.quarkus.runtime.graal.ResourcesFeature: Register each line in META-INF/quarkus-native-resources.txt as a resource on Substrate VM\r\n - org.graalvm.home.HomeFinderFeature: Finds GraalVM paths and its version number\r\n - org.hibernate.graalvm.internal.GraalVMStaticAutofeature\r\n - org.hibernate.graalvm.internal.QueryParsingSupport\r\n[2/7] Performing analysis...  [*]                                                                       (22.5s @ 2.19GB)\r\n  13,309 (88.68%) of 15,008 classes reachable\r\n  17,786 (56.27%) of 31,610 fields reachable\r\n  55,347 (60.25%) of 91,868 methods reachable\r\n     634 classes,   137 fields, and 2,087 methods registered for reflection\r\n\r\nFatal error: com.oracle.graal.pointsto.util.AnalysisError$ParsingError: Error encountered while parsing kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1.invoke() \r\nParsing context:\r\n   at kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1.invoke(KCallableImpl.kt:41)\r\n   at kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1.invoke(KCallableImpl.kt:40)\r\n   at kotlin.reflect.jvm.internal.ReflectProperties$LazySoftVal.invoke(ReflectProperties.java:93)\r\n   at kotlin.reflect.jvm.internal.ReflectProperties$Val.getValue(ReflectProperties.java:32)\r\n   at kotlin.reflect.jvm.internal.KClassImpl$Data.getAllMembers(KClassImpl.kt:177)\r\n   at kotlin.reflect.jvm.internal.KClassImpl.getMembers(KClassImpl.kt:195)\r\n   at kotlin.reflect.full.KClasses.getFunctions(KClasses.kt:89)\r\n   at kotlin.reflect.jvm.ReflectJvmMapping.getKotlinFunction(ReflectJvmMapping.kt:136)\r\n   at com.fasterxml.jackson.module.kotlin.KotlinNamesAnnotationIntrospector.findKotlinParameterName(KotlinNamesAnnotationIntrospector.kt:118)\r\n   at com.fasterxml.jackson.module.kotlin.KotlinNamesAnnotationIntrospector.findImplicitPropertyName(KotlinNamesAnnotationIntrospector.kt:40)\r\n   at com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector._addFields(POJOPropertiesCollector.java:531)\r\n   at com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector.collectAll(POJOPropertiesCollector.java:421)\r\n   at com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector.getPropertyMap(POJOPropertiesCollector.java:386)\r\n   at com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector.getProperties(POJOPropertiesCollector.java:233)\r\n   at com.fasterxml.jackson.databind.introspect.BasicBeanDescription._properties(BasicBeanDescription.java:164)\r\n   at com.fasterxml.jackson.databind.introspect.BasicBeanDescription.findProperties(BasicBeanDescription.java:239)\r\n   at com.fasterxml.jackson.databind.jsontype.impl.AsDeductionTypeDeserializer.buildFingerprints(AsDeductionTypeDeserializer.java:70)\r\n   at com.fasterxml.jackson.databind.jsontype.impl.AsDeductionTypeDeserializer.<init>(AsDeductionTypeDeserializer.java:48)\r\n   at com.fasterxml.jackson.databind.jsontype.impl.StdTypeResolverBuilder.buildTypeDeserializer(StdTypeResolverBuilder.java:166)\r\n   at com.fasterxml.jackson.databind.DeserializationConfig.findTypeDeserializer(DeserializationConfig.java:967)\r\n   at com.fasterxml.jackson.databind.deser.BeanDeserializerBase._findDelegateDeserializer(BeanDeserializerBase.java:696)\r\n   at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.resolve(BeanDeserializerBase.java:630)\r\n   at com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:294)\r\n   at com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\r\n   at com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\r\n   at com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:642)\r\n   at com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:4805)\r\n   at com.fasterxml.jackson.databind.ObjectMapper._readValue(ObjectMapper.java:4646)\r\n   at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2831)\r\n   at io.quarkus.vertx.runtime.jackson.QuarkusJacksonJsonCodec.fromParser(QuarkusJacksonJsonCodec.java:125)\r\n   at io.quarkus.vertx.runtime.jackson.QuarkusJacksonJsonCodec.fromString(QuarkusJacksonJsonCodec.java:95)\r\n   at io.vertx.core.json.JsonObject.fromJson(JsonObject.java:944)\r\n   at io.vertx.core.json.JsonObject.<init>(JsonObject.java:51)\r\n   at io.vertx.core.impl.HAManager.checkQuorum(HAManager.java:369)\r\n   at io.vertx.core.impl.HAManager.init(HAManager.java:153)\r\n   at io.vertx.core.impl.VertxImpl.lambda$initializeHaManager$6(VertxImpl.java:263)\r\n   at io.vertx.core.impl.VertxImpl$$Lambda$1500/0x00000007c2b2b7f0.handle(Unknown Source)\r\n   at io.vertx.core.impl.future.FutureImpl$3.onSuccess(FutureImpl.java:141)\r\n   at io.vertx.core.impl.future.FutureBase.emitSuccess(FutureBase.java:60)\r\n   at io.vertx.core.impl.future.FutureImpl.tryComplete(FutureImpl.java:211)\r\n   at io.vertx.core.impl.future.PromiseImpl.tryComplete(PromiseImpl.java:23)\r\n   at io.vertx.core.Promise.complete(Promise.java:66)\r\n   at io.vertx.core.impl.future.PromiseImpl.operationComplete(PromiseImpl.java:65)\r\n   at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:578)\r\n   at io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:571)\r\n   at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:550)\r\n   at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:491)\r\n   at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616)\r\n   at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:605)\r\n   at io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:104)\r\n   at io.netty.channel.DefaultChannelPromise.trySuccess(DefaultChannelPromise.java:84)\r\n   at io.netty.channel.AbstractChannel$CloseFuture.setClosed(AbstractChannel.java:1164)\r\n   at io.netty.channel.AbstractChannel$AbstractUnsafe.doClose0(AbstractChannel.java:758)\r\n   at io.netty.channel.AbstractChannel$AbstractUnsafe.close(AbstractChannel.java:731)\r\n   at io.netty.channel.AbstractChannel$AbstractUnsafe.handleWriteError(AbstractChannel.java:950)\r\n   at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:933)\r\n   at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.flush0(AbstractNioChannel.java:354)\r\n   at io.netty.channel.nio.AbstractNioByteChannel$1.run(AbstractNioByteChannel.java:54)\r\n   at java.lang.Shutdown.runHooks(Shutdown.java:130)\r\n   at java.lang.Shutdown.exit(Shutdown.java:173)\r\n   at java.lang.Runtime.exit(Runtime.java:115)\r\n   at java.lang.System.exit(System.java:1860)\r\n   at com.oracle.svm.core.graal.snippets.CEntryPointSnippets.initializeIsolate(CEntryPointSnippets.java:313)\r\n\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.AnalysisError.parsingError(AnalysisError.java:153)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.createFlowsGraph(MethodTypeFlow.java:104)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.ensureFlowsGraphCreated(MethodTypeFlow.java:83)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.getOrCreateMethodFlowsGraph(MethodTypeFlow.java:65)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.typestate.DefaultSpecialInvokeTypeFlow.onObservedUpdate(DefaultSpecialInvokeTypeFlow.java:61)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.TypeFlow.update(TypeFlow.java:558)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.PointsToAnalysis$1.run(PointsToAnalysis.java:488)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.executeCommand(CompletionExecutor.java:193)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.lambda$executeService$0(CompletionExecutor.java:177)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1395)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)\r\nCaused by: org.graalvm.compiler.java.BytecodeParser$BytecodeParserError: com.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Discovered a type for which getDeclaringClass0 cannot be called: kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1. This error is reported at image build time because class kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1 is registered for linking at image build time by command line\r\n\tat parsing kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1.invoke(KCallableImpl.kt:221)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.throwParserError(BytecodeParser.java:2518)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase$SharedBytecodeParser.throwParserError(SharedGraphBuilderPhase.java:110)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3379)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.handleBytecodeBlock(BytecodeParser.java:3331)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBlock(BytecodeParser.java:3176)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.build(BytecodeParser.java:1138)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.buildRootMethod(BytecodeParser.java:1030)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.GraphBuilderPhase$Instance.run(GraphBuilderPhase.java:97)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase.run(SharedGraphBuilderPhase.java:84)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.run(Phase.java:49)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.phases.BasePhase.apply(BasePhase.java:446)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:42)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:38)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.AnalysisParsedGraph.parseBytecode(AnalysisParsedGraph.java:135)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisMethod.ensureGraphParsed(AnalysisMethod.java:685)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.parse(MethodTypeFlowBuilder.java:168)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.apply(MethodTypeFlowBuilder.java:343)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.createFlowsGraph(MethodTypeFlow.java:93)\r\n\t... 13 more\r\nCaused by: com.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Discovered a type for which getDeclaringClass0 cannot be called: kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1. This error is reported at image build time because class kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1 is registered for linking at image build time by command line\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.handleLinkageError(SVMHost.java:424)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.getDeclaringClass(SVMHost.java:410)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.createHub(SVMHost.java:398)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.registerType(SVMHost.java:244)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisUniverse.createType(AnalysisUniverse.java:302)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisUniverse.lookupAllowUnresolved(AnalysisUniverse.java:212)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.infrastructure.WrappedConstantPool.lookupType(WrappedConstantPool.java:209)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.lookupType(BytecodeParser.java:4178)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genNewInstance(BytecodeParser.java:4457)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBytecode(BytecodeParser.java:5239)\r\n\tat jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3371)\r\n\t... 28 more\r\nCaused by: java.lang.IncompatibleClassChangeError: kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1 and kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1 disagree on InnerClasses attribute\r\n\tat java.base/java.lang.Class.getDeclaringClass0(Native Method)\r\n\tat java.base/jdk.internal.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.getDeclaringClass(SVMHost.java:407)\r\n```\n\n### Expected behavior\n\nNative image build works.\n\n### Actual behavior\n\nNative image build fails with: \r\n\r\n```\r\njava.lang.IncompatibleClassChangeError: kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1 and kotlin.reflect.jvm.internal.KCallableImpl$_parameters$1$invoke$$inlined$sortBy$1\r\n```\n\n### How to Reproduce?\n\nSteps to reproduce:\r\n\r\n1. Download the latest 22.3.0-dev GraalVM CE build. For example from here: https://github.com/graalvm/graalvm-ce-dev-builds/releases/tag/22.3.0-dev-20220816_0019\r\n2. Use it as `GRAALVM_HOME`\r\n3. Run the liquibase-mongodb integration test:\r\n\r\n```\r\n./mvnw -Dnative -pl integration-tests/hibernate-orm-panache-kotlin -Dtest-containers -Dstart-containers -Dnative.surefire.skip -Dformat.skip -Dno-descriptor-tests -Dlog.level=ALL clean verify -Dquarkus.native.container-build=false\r\n```\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n11 or 17 based GraalVM (doesn't matter)\n\n### GraalVM version (if different from Java)\n\n22.3.0-dev\n\n### Quarkus version or git rev\n\n8764ba4591622a676ec02f4c3cb235cac2264b14\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\nThis seems to be related to this GraalVM change:\r\nhttps://github.com/oracle/graal/commit/ce3d101fba368cdb4bd8eebad770e5c59c8aa57a",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/27300/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
