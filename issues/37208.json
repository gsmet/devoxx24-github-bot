{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/37208",
  "id": 2001767150,
  "node_id": "I_kwDOCFbutM53UIru",
  "number": 37208,
  "title": "[GraalVM 24.0] quarkus-integration-test-hibernate-reactive-postgresql fails to compile due to vertx-sql-client issue with JDK 22",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273026509,
      "node_id": "MDU6TGFiZWwxMjczMDI2NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/persistence",
      "name": "area/persistence",
      "color": "FBCA04",
      "default": false,
      "description": "OBSOLETE, DO NOT USE"
    },
    {
      "id": 2122256208,
      "node_id": "MDU6TGFiZWwyMTIyMjU2MjA4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/hibernate-reactive",
      "name": "area/hibernate-reactive",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 10,
  "created_at": "2023-11-20T09:39:28Z",
  "updated_at": "2024-01-08T14:45:14Z",
  "closed_at": "2024-01-08T14:45:14Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWe see the `quarkus-integration-test-hibernate-reactive-postgresql` native integration test failing using Mandrel 24.0 (GraalVM for JDK 22) with the following error:\r\n\r\n```\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-runner' (executable)...\r\n========================================================================================================================\r\nFor detailed information and explanations on the build output, visit:\r\nhttps://github.com/oracle/graal/blob/master/docs/reference-manual/native-image/BuildOutput.md\r\n------------------------------------------------------------------------------------------------------------------------\r\n[1/8] Initializing...                                                                                    (8.7s @ 0.19GB)\r\n Java version: 22-beta+24-ea, vendor version: Mandrel-24.0.0-devc291aa4f\r\n Graal compiler: optimization level: 2, target machine: x86-64-v3\r\n C compiler: gcc (linux, x86_64, 11.4.0)\r\n Garbage collector: Serial GC (max heap size: 80% of RAM)\r\n 7 user-specific feature(s):\r\n - com.oracle.svm.thirdparty.gson.GsonFeature\r\n - io.quarkus.caffeine.runtime.graal.CacheConstructorsFeature\r\n - io.quarkus.hibernate.orm.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n - org.eclipse.angus.activation.nativeimage.AngusActivationFeature\r\n - org.hibernate.graalvm.internal.GraalVMStaticFeature: Hibernate ORM's static reflection registrations for GraalVM\r\n------------------------------------------------------------------------------------------------------------------------\r\n 5 experimental option(s) unlocked:\r\n - '-H:+AllowFoldMethods' (origin(s): command line)\r\n - '-H:BuildOutputJSONFile' (origin(s): command line)\r\n - '-H:-UseServiceLoaderFeature' (origin(s): command line)\r\n - '-H:IncludeResourceBundles' (origin(s): 'META-INF/native-image/org.eclipse/yasson/native-image.properties' in 'file:///home/runner/work/mandrel/mandrel/quarkus/integration-tests/hibernate-reactive-postgresql/target/quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-native-image-source-jar/lib/org.eclipse.yasson-3.0.3.jar')\r\n - '-H:ReflectionConfigurationResources': Use a reflect-config.json in your META-INF/native-image/<groupID>/<artifactID> directory instead. (origin(s): 'META-INF/native-image/io.netty/netty-transport/native-image.properties' in 'file:///home/runner/work/mandrel/mandrel/quarkus/integration-tests/hibernate-reactive-postgresql/target/quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-native-image-source-jar/lib/io.netty.netty-transport-4.1.100.Final.jar')\r\n------------------------------------------------------------------------------------------------------------------------\r\nBuild resources:\r\n - 4.44GB of memory (28.5% of 15.61GB system memory, set via '-Xmx5g')\r\n - 4 thread(s) (100.0% of 4 available processor(s), determined at start)\r\n02:18:27,709 WARN  [org.hib.orm.deprecation] HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)\r\n[2/8] Performing analysis...  []                                                                        (44.9s @ 1.00GB)\r\n   12,267 reachable types   (80.0% of   15,336 total)\r\n   16,108 reachable fields  (49.8% of   32,373 total)\r\n   54,804 reachable methods (48.9% of  112,024 total)\r\n    4,159 types,   158 fields, and 3,784 methods registered for reflection\r\n\r\nError: Class initialization of io.vertx.pgclient.impl.codec.DataTypeCodec failed. Use the option \r\n\r\n    '--initialize-at-run-time=io.vertx.pgclient.impl.codec.DataTypeCodec'\r\n\r\n to explicitly request initialization of this class at run time.\r\ncom.oracle.svm.core.util.UserError$UserException: Class initialization of io.vertx.pgclient.impl.codec.DataTypeCodec failed. Use the option \r\n\r\n    '--initialize-at-run-time=io.vertx.pgclient.impl.codec.DataTypeCodec'\r\n\r\n to explicitly request initialization of this class at run time.\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.core.util.UserError.abort(UserError.java:85)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.ClassInitializationSupport.ensureClassInitialized(ClassInitializationSupport.java:195)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.AllowAllHostedUsagesClassInitializationSupport.computeInitKindAndMaybeInitializeClass(AllowAllHostedUsagesClassInitializationSupport.java:191)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.AllowAllHostedUsagesClassInitializationSupport.computeInitKindAndMaybeInitializeClass(AllowAllHostedUsagesClassInitializationSupport.java:129)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.ClassInitializationSupport.maybeInitializeAtBuildTime(ClassInitializationSupport.java:161)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.ClassInitializationSupport.maybeInitializeAtBuildTime(ClassInitializationSupport.java:150)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.SVMHost.isInitialized(SVMHost.java:323)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisType.isInitialized(AnalysisType.java:911)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.maybeEagerlyInitialize(BytecodeParser.java:4456)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.genInvokeStatic(BytecodeParser.java:1683)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.genInvokeStatic(BytecodeParser.java:1676)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.processBytecode(BytecodeParser.java:5453)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3443)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase$SharedBytecodeParser.iterateBytecodesForBlock(SharedGraphBuilderPhase.java:727)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.handleBytecodeBlock(BytecodeParser.java:3403)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.processBlock(BytecodeParser.java:3245)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.build(BytecodeParser.java:1136)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase$SharedBytecodeParser.build(SharedGraphBuilderPhase.java:156)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.BytecodeParser.buildRootMethod(BytecodeParser.java:1028)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.java.GraphBuilderPhase$Instance.run(GraphBuilderPhase.java:102)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.phases.SharedGraphBuilderPhase.run(SharedGraphBuilderPhase.java:110)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.phases.Phase.run(Phase.java:49)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.phases.BasePhase.apply(BasePhase.java:435)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.phases.Phase.apply(Phase.java:42)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.phases.Phase.apply(Phase.java:38)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.AnalysisParsedGraph.parseBytecode(AnalysisParsedGraph.java:146)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisMethod.parseGraph(AnalysisMethod.java:892)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisMethod.ensureGraphParsedHelper(AnalysisMethod.java:857)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.meta.AnalysisMethod.ensureGraphParsed(AnalysisMethod.java:840)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.phases.InlineBeforeAnalysisGraphDecoder.lookupEncodedGraph(InlineBeforeAnalysisGraphDecoder.java:175)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.doInline(PEGraphDecoder.java:1213)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.tryInline(PEGraphDecoder.java:1196)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.trySimplifyInvoke(PEGraphDecoder.java:1051)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.handleInvokeWithCallTarget(PEGraphDecoder.java:1003)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.handleInvoke(PEGraphDecoder.java:989)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.nodes.GraphDecoder.processNextNode(GraphDecoder.java:930)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.phases.InlineBeforeAnalysisGraphDecoder.processNextNode(InlineBeforeAnalysisGraphDecoder.java:343)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.nodes.GraphDecoder.decode(GraphDecoder.java:658)\r\n\tat jdk.graal.compiler/jdk.graal.compiler.replacements.PEGraphDecoder.decode(PEGraphDecoder.java:893)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.phases.InlineBeforeAnalysis.decodeGraph(InlineBeforeAnalysis.java:73)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.parse(MethodTypeFlowBuilder.java:194)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.apply(MethodTypeFlowBuilder.java:605)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.createFlowsGraph(MethodTypeFlow.java:167)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.ensureFlowsGraphCreated(MethodTypeFlow.java:152)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.MethodTypeFlow.getOrCreateMethodFlowsGraphInfo(MethodTypeFlow.java:110)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.typestate.DefaultVirtualInvokeTypeFlow.onObservedUpdate(DefaultVirtualInvokeTypeFlow.java:114)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.flow.TypeFlow.update(TypeFlow.java:575)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.PointsToAnalysis$1.run(PointsToAnalysis.java:478)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.executeCommand(CompletionExecutor.java:169)\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.util.CompletionExecutor.lambda$executeService$0(CompletionExecutor.java:154)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.compute(ForkJoinTask.java:1726)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.compute(ForkJoinTask.java:1717)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$InterruptibleTask.exec(ForkJoinTask.java:1641)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:507)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1486)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:2077)\r\n------------------------------------------------------------------------------------------------------------------------\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:2028)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:187)\r\nCaused by: java.lang.ExceptionInInitializerError\r\n\tat java.base/jdk.internal.misc.Unsafe.ensureClassInitialized0(Native Method)\r\n\tat java.base/jdk.internal.misc.Unsafe.ensureClassInitialized(Unsafe.java:1160)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.classinitialization.ClassInitializationSupport.ensureClassInitialized(ClassInitializationSupport.java:177)\r\n\t... 56 more\r\nCaused by: java.time.format.DateTimeParseException: Text '4714-11-24 00:00:00 BC' could not be parsed at index 20\r\n\tat java.base/java.time.format.DateTimeFormatter.parseResolved0(DateTimeFormatter.java:2108)\r\n\tat java.base/java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:2010)\r\n\tat java.base/java.time.LocalDateTime.parse(LocalDateTime.java:494)\r\n\tat io.vertx.pgclient.impl.codec.DataTypeCodec.<clinit>(DataTypeCodec.java:1077)\r\n\t... 59 more\r\n                       6.6s (11.8% of total time) in 126 GCs | Peak RSS: 1.90GB | CPU load: 3.80\r\n------------------------------------------------------------------------------------------------------------------------\r\nProduced artifacts:\r\n /home/runner/work/mandrel/mandrel/quarkus/integration-tests/hibernate-reactive-postgresql/target/quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-native-image-source-jar/quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-runner-build-output-stats.json (build_info)\r\n========================================================================================================================\r\nFinished generating 'quarkus-integration-test-hibernate-reactive-postgresql-999-SNAPSHOT-runner' in 54.8s.\r\n```\r\n\r\nSee:\r\nhttps://github.com/graalvm/mandrel/actions/runs/6924384895/job/18834111016#step:12:865\r\n\r\nRoot cause seems to be:\r\n\r\n```\r\nCaused by: java.time.format.DateTimeParseException: Text '4714-11-24 00:00:00 BC' could not be parsed at index 20\r\n\tat java.base/java.time.format.DateTimeFormatter.parseResolved0(DateTimeFormatter.java:2108)\r\n\tat java.base/java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:2010)\r\n\tat java.base/java.time.LocalDateTime.parse(LocalDateTime.java:494)\r\n\tat io.vertx.pgclient.impl.codec.DataTypeCodec.<clinit>(DataTypeCodec.java:1077)\r\n\t... 59 more\r\n                       6.6s (11.8% of total time) in 1\r\n```\r\n\r\n### Output of `java -version`\r\n\r\n22+24 (ea)\r\n\r\n### Quarkus version or git rev\r\n\r\nmain",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37208/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
