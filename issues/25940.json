{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25940",
  "id": 1259006291,
  "node_id": "I_kwDOCFbutM5LCulT",
  "number": 25940,
  "title": "MP Config `Converter` fails in native build",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/191",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/191",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/191/labels",
    "id": 8076658,
    "node_id": "MI_kwDOCFbutM4Aez1y",
    "number": 191,
    "title": "2.7.7.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 71,
    "state": "closed",
    "created_at": "2022-06-13T14:52:08Z",
    "updated_at": "2023-02-21T15:11:33Z",
    "due_on": null,
    "closed_at": "2023-01-26T12:29:24Z"
  },
  "comments": 3,
  "created_at": "2022-06-02T23:54:00Z",
  "updated_at": "2023-01-13T09:58:39Z",
  "closed_at": "2022-06-09T08:11:57Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nApparently, there's some compatibility issue with using MP config `Converter` and `@WithConverter` with native mode. If there is a property declared in a `@ConfigMapping`-annotated class that uses a value converter, the application compiles cleanly, but fails at bootstrap with `NoSuchMethodError`. See minimal [reproducer](https://github.com/artkonr/converter-native-failure) and stacktrace below:\r\n\r\n```\r\njava.lang.NoSuchMethodError: com.example.Config$BConverter.<init>()\r\n\tat io.smallrye.config.ConfigMappingContext.lambda$getConverterInstance$7(ConfigMappingContext.java:194)\r\n\tat java.util.Map.computeIfAbsent(Map.java:1054)\r\n\tat io.smallrye.config.ConfigMappingContext.getConverterInstance(ConfigMappingContext.java:178)\r\n\tat io.smallrye.config.ConfigMappingContext.getConverter(ConfigMappingContext.java:104)\r\n\tat io.smallrye.config.ConfigMappingContext.lambda$getValueConverter$4(ConfigMappingContext.java:92)\r\n\tat java.util.HashMap.computeIfAbsent(HashMap.java:1220)\r\n\tat io.smallrye.config.ConfigMappingContext.getValueConverter(ConfigMappingContext.java:89)\r\n\tat com.example.Config-888161165Impl.<init>(Unknown Source)\r\n\tat java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:480)\r\n\tat io.smallrye.config.ConfigMappingLoader.configMappingObject(ConfigMappingLoader.java:65)\r\n\tat io.smallrye.config.ConfigMappingContext.constructGroup(ConfigMappingContext.java:80)\r\n\tat io.smallrye.config.ConfigMappingContext.constructRoot(ConfigMappingContext.java:76)\r\n\tat io.smallrye.config.ConfigMappingProvider.mapConfiguration(ConfigMappingProvider.java:811)\r\n\tat io.smallrye.config.ConfigMappingProvider.mapConfiguration(ConfigMappingProvider.java:794)\r\n\tat io.smallrye.config.SmallRyeConfigBuilder.build(SmallRyeConfigBuilder.java:450)\r\n\tat io.quarkus.runtime.generated.Config.readConfig(Unknown Source)\r\n\tat io.quarkus.deployment.steps.RuntimeConfigSetup.deploy(Unknown Source)\r\n\tat io.quarkus.runner.ApplicationImpl.doStart(Unknown Source)\r\n\tat io.quarkus.runtime.Application.start(Application.java:101)\r\n\tat io.quarkus.runtime.ApplicationLifecycleManager.run(ApplicationLifecycleManager.java:103)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:67)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:41)\r\n\tat io.quarkus.runtime.Quarkus.run(Quarkus.java:120)\r\n\tat io.quarkus.runner.GeneratedMain.main(Unknown Source)\r\n```\n\n### Expected behavior\n\nConfiguration values are picked up correctly with `@WithConverter` and work nicely in a native image. \n\n### Actual behavior\n\nNative image builds, but fails at bootstrap.\n\n### How to Reproduce?\n\nHow to reproduce:\r\n\r\n1. Generate a new app, use of any extension in particular doesn't seem to matter.\r\n2. Create a configuration mapping class.\r\n3. Have at least 1 field resolved using `@WithConverter`.\r\n4. Inject the config class.\r\n5. Compile with GraalVM and start.\n\n### Output of `uname -a` or `ver`\n\n21.3.0 Darwin Kernel Version 21.3.0\n\n### Output of `java -version`\n\nopenjdk version \"17.0.3\" 2022-04-19 OpenJDK Runtime Environment GraalVM CE 22.1.0 (build 17.0.3+7-jvmci-22.1-b06) OpenJDK 64-Bit Server VM GraalVM CE 22.1.0 (build 17.0.3+7-jvmci-22.1-b06, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.9.2.Final or 2.8.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nany maven or gradle\n\n### Additional information\n\nFrom the looks of the trace, it seems like there's no constructor to be found, which is odd. \r\n\r\nIn the reproducer, the resolved class is nested, but this has no significance. Also, I had a hypothesis that Graal does not like a `byte[]` in constructor argument or in type parameter of `Converter`, but this is not the case either. The error can be reproduced even with a `String` field.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25940/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
