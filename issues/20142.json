{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/20142",
  "id": 995990005,
  "node_id": "I_kwDOCFbutM47XZn1",
  "number": 20142,
  "title": "Resteasy Reactive response Content-Type string taken from request and cached badly ",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/154",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/154",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/154/labels",
    "id": 7253553,
    "node_id": "MI_kwDOCFbutM4Abq4x",
    "number": 154,
    "title": "2.2.4.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 139,
    "state": "closed",
    "created_at": "2021-10-14T16:59:16Z",
    "updated_at": "2022-02-15T07:24:43Z",
    "due_on": null,
    "closed_at": "2021-12-15T09:41:42Z"
  },
  "comments": 1,
  "created_at": "2021-09-14T12:59:53Z",
  "updated_at": "2021-11-30T14:27:11Z",
  "closed_at": "2021-09-14T18:40:00Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI noticed that resteasy reactive takes the content type string from the request and reuses it for the response if it is the same media type.\r\n\r\nAlso it seems to get cached and reused in subsequent responses.\r\n\r\nFor example consider following content types for a request/response:\r\n\r\nRequest No# | Request | Response\r\n-- | -- | --\r\n1 | application/json | application/json\r\n2 | Application/json | Application/json\r\n3 | application/json | Application/json\r\n4 | aPplication/json | aPplication/json\r\n5 | application/json | aPplication/json\r\n6 | APplication/json | APplication/json\r\n7 | applicatIon/json | applicatIon/json\r\n8 | application/Json | application/Json\r\n9 | Application/json | application/Json\r\n10 | Application/JSon | Application/JSon\r\n11 | APPLICATION/json | APPLICATION/json\r\n12 | application/jsOn | application/jsOn\r\n\r\nIt seems to be related to the caching mechanism in org.jboss.resteasy.reactive.common.headers.MediaTypeHeaderDelegate which just takes the string from the request and caches it for a specific mediatype and reuses it in future responses.\r\n\r\nI made the following reproducer with three test cases which shows the problem:\r\n\r\n[reproducer.zip](https://github.com/quarkusio/quarkus/files/7162079/reproducer.zip)\r\n\r\nI think this is kinda weird behavior and might cause problems for clients. \r\nI think it would be better if the string is consistent.\r\n\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20142/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
