{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/34644",
  "id": 1796392145,
  "node_id": "I_kwDOCFbutM5rEsTR",
  "number": 34644,
  "title": "Rest client running GET requests instead of POST after redirect",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/261",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/261/labels",
    "id": 9620417,
    "node_id": "MI_kwDOCFbutM4AksvB",
    "number": 261,
    "title": "3.2.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 137,
    "state": "closed",
    "created_at": "2023-07-05T15:27:44Z",
    "updated_at": "2023-08-07T13:21:27Z",
    "due_on": null,
    "closed_at": "2023-07-19T13:26:50Z"
  },
  "comments": 14,
  "created_at": "2023-07-10T09:49:17Z",
  "updated_at": "2024-06-26T13:19:30Z",
  "closed_at": "2023-07-18T16:10:21Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI am using a Rest client to run POST requests on an endpoint that redirects to another POST endpoint.\r\n\r\n[Quarkus v3 introduced a way to register a custom redirect handler](https://quarkus.io/guides/rest-client-reactive#redirection) that works fine.\r\nThe problem is that the request done after the redirect is GET and not the origin request type (POST in my case). So all my calls end with HTTP 405 \"Method not allowed\".\r\n\r\n\r\n### Expected behavior\r\n\r\nThe expected behavior is to run a POST request after the redirect.\r\n\r\n- POST /token\r\n- HTTP 307 - /token/2\r\n- **POST** /token/2\r\n- HTTP 200\r\n\r\n\r\nThis is what cURL and Postman do:\r\n\r\n```sh\r\ncurl --location 'http://localhost:8080/token' \\\r\n    --header 'Content-Type: application/json' \\\r\n    --data '{\"value\": \"test\"}' \\\r\n    -v\r\n```\r\n\r\n```\r\n2023-07-10 11:33:42,831 INFO  [io.qua.htt.access-log] (vert.x-eventloop-thread-1) 127.0.0.1 - - 10/Jul/2023:11:33:42 +0200 \"POST /token HTTP/1.1\" 307 -\r\n2023-07-10 11:33:42,847 INFO  [io.qua.htt.access-log] (vert.x-eventloop-thread-1) 127.0.0.1 - - 10/Jul/2023:11:33:42 +0200 \"POST /token/2 HTTP/1.1\" 200 70\r\n```\r\n\r\n\r\n### Actual behavior\r\n\r\nThe actual behavior is buggy, it runs a GET request instead of POST.\r\n\r\n- POST /token\r\n- HTTP 307 - /token/2\r\n- **GET** /token/2\r\n- HTTP 405\r\n\r\n```\r\n2023-07-10 11:32:27,476 INFO  [io.qua.htt.access-log] (vert.x-eventloop-thread-1) 127.0.0.1 - - 10/Jul/2023:11:32:27 +0200 \"POST /token HTTP/1.1\" 307 -\r\n2023-07-10 11:32:27,487 INFO  [io.qua.htt.access-log] (vert.x-eventloop-thread-0) 127.0.0.1 - - 10/Jul/2023:11:32:27 +0200 \"GET /token/2 HTTP/1.1\" 405 -\r\n[...]\r\norg.jboss.resteasy.reactive.ClientWebApplicationException: Received: 'Method Not Allowed, status code 405' when invoking: Rest Client method: 'com.github.jdussouillez.client.TokenServiceApiClient#getToken'\r\n[...]\r\n```\r\n\r\n\r\n### How to Reproduce?\r\n\r\nRepo : https://github.com/jdussouillez/quarkus-rest-client-post-redirect-post\r\n\r\n- Run the server\r\n- Run the client, when it starts it makes a request on the server and fails\r\n\r\nThe important code is here: https://github.com/jdussouillez/quarkus-rest-client-post-redirect-post/blob/master/server/src/main/java/com/github/jdussouillez/server/TokenResource.java#L24\r\nThe \"/token\" endpoint just redirects to \"/token/2\" which is also a POST request.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.2.0\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/34644/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
