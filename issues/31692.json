{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/31692",
  "id": 1615326950,
  "node_id": "I_kwDOCFbutM5gR-7m",
  "number": 31692,
  "title": "RequestScoped context not active when using a ReaderInterceptor with large HTTP requests",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/238",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/238",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/238/labels",
    "id": 9129801,
    "node_id": "MI_kwDOCFbutM4Ai09J",
    "number": 238,
    "title": "2.16.5.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 36,
    "state": "closed",
    "created_at": "2023-03-07T15:04:54Z",
    "updated_at": "2023-05-09T09:46:48Z",
    "due_on": null,
    "closed_at": "2023-03-22T10:34:48Z"
  },
  "comments": 6,
  "created_at": "2023-03-08T14:01:00Z",
  "updated_at": "2023-03-15T18:29:56Z",
  "closed_at": "2023-03-09T11:37:08Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI have a [`ReaderInterceptor`](https://quarkus.io/guides/resteasy-reactive#reader-and-writer-interceptors) to intercept my RestEasy reactive API. This interceptor calls a `@RequestScoped` service to do some actions.\r\n\r\nWith small HTTP requests, it works fine. But if my request is bigger than 10KB then it fails. The source is that the request scoped context is not active, so the request scoped service can't be injected. Which is quite weird because it works with requests lighter than 10KB.\r\n\r\nStacktrace :\r\n\r\n```\r\n2023-03-08 14:40:30,265 ERROR [org.jbo.res.rea.com.cor.AbstractResteasyReactiveContext] (executor-thread-0) Request failed: javax.enterprise.context.ContextNotActiveException: RequestScoped context was not active when trying to obtain a bean instance for a client proxy of CLASS bean [class=org.acme.service.LogService, id=922c737080882371f004038baf0a71f17589d79d]\r\n\t- you can activate the request context for a specific method using the @ActivateRequestContext interceptor binding\r\n\tat io.quarkus.arc.impl.ClientProxies.getDelegate(ClientProxies.java:55)\r\n\tat org.acme.service.LogService_ClientProxy.arc$delegate(Unknown Source)\r\n\tat org.acme.service.LogService_ClientProxy.log(Unknown Source)\r\n\tat org.acme.interceptor.LogInterceptor.aroundReadFrom(LogInterceptor.java:23)\r\n\tat org.jboss.resteasy.reactive.server.jaxrs.ReaderInterceptorContextImpl.proceed(ReaderInterceptorContextImpl.java:54)\r\n\tat org.jboss.resteasy.reactive.server.handlers.RequestDeserializeHandler.handle(RequestDeserializeHandler.java:88)\r\n\tat io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:108)\r\n\tat org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:145)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:576)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\n```\r\n\r\n**Repo to reproduce**: https://github.com/jdussouillez/quarkus-reader-interceptor-req-size\r\n\r\n---\r\n\r\nThe important code :\r\n\r\n```java\r\n@RequestScoped // To make it work for requests bigger than 10KB, use \"@ApplicationScoped\" here\r\npublic class LogService {\r\n\r\n    public void log(final String entity) {\r\n        System.out.println(\"Entity size: \" + entity.length());\r\n    }\r\n}\r\n```\r\n\r\n```java\r\n@Provider\r\n@ConstrainedTo(RuntimeType.SERVER)\r\npublic class LogInterceptor implements ReaderInterceptor {\r\n\r\n    @Inject\r\n    protected LogService logService;\r\n\r\n    @Override\r\n    public Object aroundReadFrom(final ReaderInterceptorContext context) throws IOException, WebApplicationException {\r\n        var entity = context.proceed();\r\n        logService.log((String) entity);\r\n        return entity;\r\n    }\r\n}\r\n```\r\n\r\n```java\r\n@Path(\"/test\")\r\npublic class TestResource {\r\n\r\n    @POST\r\n    @Path(\"\")\r\n    @Consumes(MediaType.TEXT_PLAIN)\r\n    @Produces(MediaType.APPLICATION_JSON)\r\n    public Uni<Boolean> test(final String body) {\r\n        return Uni.createFrom().item(true);\r\n    }\r\n}\r\n```\r\n\n\n### Expected behavior\n\nThe request scoped context is active, no matter the request size.\n\n### Actual behavior\n\nThe request scoped context is not active for requests bigger than 10KB.\n\n### How to Reproduce?\n\nRepo to reproduce: https://github.com/jdussouillez/quarkus-reader-interceptor-req-size\r\n\r\nFollow the steps in the readme.\n\n### Output of `uname -a` or `ver`\n\nLinux frpo245 5.4.0-144-generic #161-Ubuntu SMP Fri Feb 3 14:49:04 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"17.0.6\" 2023-01-17\r\nOpenJDK Runtime Environment (build 17.0.6+10-Ubuntu-0ubuntu120.04.1)\r\nOpenJDK 64-Bit Server VM (build 17.0.6+10-Ubuntu-0ubuntu120.04.1, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.16.4.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\r\nMaven home: /home/junior/.m2/wrapper/dists/apache-maven-3.8.6-bin/1ks0nkde5v1pk9vtc31i9d0lcd/apache-maven-3.8.6\r\nJava version: 17.0.6, vendor: Private Build, runtime: /usr/lib/jvm/java-17-openjdk-amd64\r\nDefault locale: en_US, platform encoding: UTF-8\r\nOS name: \"linux\", version: \"5.4.0-144-generic\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/31692/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
