{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25711",
  "id": 1243913111,
  "node_id": "I_kwDOCFbutM5KJJuX",
  "number": 25711,
  "title": "mongodb dependencies incompartibility in version 2.9.1",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1470336085,
      "node_id": "MDU6TGFiZWwxNDcwMzM2MDg1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/mongodb",
      "name": "area/mongodb",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/188",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/188",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/188/labels",
    "id": 8014110,
    "node_id": "MI_kwDOCFbutM4Aekke",
    "number": 188,
    "title": "2.9.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 21,
    "state": "closed",
    "created_at": "2022-05-24T10:30:38Z",
    "updated_at": "2023-02-21T15:11:33Z",
    "due_on": null,
    "closed_at": "2022-05-25T12:36:21Z"
  },
  "comments": 3,
  "created_at": "2022-05-21T08:19:45Z",
  "updated_at": "2022-05-24T10:33:22Z",
  "closed_at": "2022-05-23T12:09:01Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nCompared to previous release (in my case version 2.7.3) quarkus bom in 2.9.1 updated mongodb-crypt dependency to 1.4.0 (from 1.2.1) while keeping other mongodb dependencies with previous version (4.3.4).\r\nThis results in following error while building native image:\r\n\r\n`Error: Class initialization of com.mongodb.crypt.capi.CAPI failed. Use the option --initialize-at-run-time=com.mongodb.crypt.capi.CAPI to explicitly request delayed initialization of this class.`\r\n\r\nDetailed message:\r\n```\r\ncom.oracle.svm.core.util.UserError$UserException: Class initialization of com.mongodb.crypt.capi.CAPI failed. Use the option --initialize-at-run-time=com.mongodb.crypt.capi.CAPI to explicitly request delayed initialization of this class.\r\nDetailed message:\r\n        at com.oracle.svm.core.util.UserError.abort(UserError.java:84)\r\n        at com.oracle.svm.hosted.FallbackFeature.reportAsFallback(FallbackFeature.java:249)\r\n        at com.oracle.svm.hosted.NativeImageGenerator.runPointsToAnalysis(NativeImageGenerator.java:754)\r\n        at com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:558)\r\n        at com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:515)\r\n        at com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:407)\r\n        at com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:585)\r\n        at com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:128)\r\n        at com.oracle.svm.hosted.NativeImageGeneratorRunner$JDK9Plus.main(NativeImageGeneratorRunner.java:615)\r\nCaused by: com.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Class initialization of com.mongodb.crypt.capi.CAPI failed. Use the option --initialize-at-run-time=com.mongodb.crypt.capi.CAPI to explicitly request delayed initialization of this class.\r\nDetailed message:\r\n        at com.oracle.graal.pointsto.constraints.UnsupportedFeatures.report(UnsupportedFeatures.java:126)\r\n        at com.oracle.svm.hosted.NativeImageGenerator.runPointsToAnalysis(NativeImageGenerator.java:751)\r\n        ... 6 more\r\nCaused by: java.lang.UnsatisfiedLinkError: Error looking up function 'mongocrypt_ctx_provide_kms_providers': The specified procedure could not be found.\r\n        at com.sun.jna.Function.<init>(Function.java:252)\r\n        at com.sun.jna.NativeLibrary.getFunction(NativeLibrary.java:600)\r\n        at com.sun.jna.NativeLibrary.getFunction(NativeLibrary.java:576)\r\n        at com.sun.jna.NativeLibrary.getFunction(NativeLibrary.java:562)\r\n        at com.sun.jna.Native.register(Native.java:1876)\r\n        at com.sun.jna.Native.register(Native.java:1747)\r\n        at com.mongodb.crypt.capi.CAPI.<clinit>(CAPI.java:852)\r\n        at java.base/jdk.internal.misc.Unsafe.ensureClassInitialized0(Native Method)\r\n        at java.base/jdk.internal.misc.Unsafe.ensureClassInitialized(Unsafe.java:1155)\r\n        at com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.ensureClassInitialized(ConfigurableClassInitialization.java:183)\r\n        at com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.computeInitKindAndMaybeInitializeClass(ConfigurableClassInitialization.java:653)\r\n        at com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.computeInitKindAndMaybeInitializeClass(ConfigurableClassInitialization.java:136)\r\n        at com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.shouldInitializeAtRuntime(ConfigurableClassInitialization.java:164)\r\n        at com.oracle.svm.hosted.SVMHost.isInitialized(SVMHost.java:286)\r\n        at com.oracle.graal.pointsto.meta.AnalysisType.isInitialized(AnalysisType.java:728)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.maybeEagerlyInitialize(BytecodeParser.java:4258)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genInvokeStatic(BytecodeParser.java:1646)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.genInvokeStatic(BytecodeParser.java:1639)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBytecode(BytecodeParser.java:5218)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.iterateBytecodesForBlock(BytecodeParser.java:3358)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.handleBytecodeBlock(BytecodeParser.java:3318)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.processBlock(BytecodeParser.java:3163)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.build(BytecodeParser.java:1138)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.BytecodeParser.buildRootMethod(BytecodeParser.java:1030)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.java.GraphBuilderPhase$Instance.run(GraphBuilderPhase.java:84)\r\n        at com.oracle.svm.hosted.phases.SharedGraphBuilderPhase.run(SharedGraphBuilderPhase.java:79)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.run(Phase.java:49)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.BasePhase.apply(BasePhase.java:236)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:42)\r\n        at jdk.internal.vm.compiler/org.graalvm.compiler.phases.Phase.apply(Phase.java:38)\r\n        at com.oracle.graal.pointsto.flow.AnalysisParsedGraph.parseBytecode(AnalysisParsedGraph.java:135)\r\n        at com.oracle.graal.pointsto.meta.AnalysisMethod.ensureGraphParsed(AnalysisMethod.java:586)\r\n        at com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.parse(MethodTypeFlowBuilder.java:166)\r\n        at com.oracle.graal.pointsto.flow.MethodTypeFlowBuilder.apply(MethodTypeFlowBuilder.java:357)\r\n        at com.oracle.graal.pointsto.flow.MethodTypeFlow.createTypeFlow(MethodTypeFlow.java:301)\r\n        at com.oracle.graal.pointsto.flow.MethodTypeFlow.ensureTypeFlowCreated(MethodTypeFlow.java:290)\r\n        at com.oracle.graal.pointsto.flow.MethodTypeFlow.addContext(MethodTypeFlow.java:111)\r\n        at com.oracle.graal.pointsto.DefaultAnalysisPolicy$DefaultVirtualInvokeTypeFlow.onObservedUpdate(DefaultAnalysisPolicy.java:252)\r\n        at com.oracle.graal.pointsto.flow.TypeFlow.update(TypeFlow.java:552)\r\n        at com.oracle.graal.pointsto.PointsToAnalysis$1.run(PointsToAnalysis.java:631)\r\n        at com.oracle.graal.pointsto.util.CompletionExecutor.executeCommand(CompletionExecutor.java:193)\r\n        at com.oracle.graal.pointsto.util.CompletionExecutor.lambda$executeService$0(CompletionExecutor.java:177)\r\n        at java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1395)\r\n        at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373)\r\n        at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)\r\n        at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)\r\n        at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)\r\n        at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)\r\n```\r\n\r\n### Expected behavior\r\n\r\n_No response_\r\n\r\n### Actual behavior\r\n\r\n_No response_\r\n\r\n### How to Reproduce?\r\n\r\n_No response_\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n_No response_\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25711/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
