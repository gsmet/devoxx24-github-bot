{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/32680",
  "id": 1671099837,
  "node_id": "I_kwDOCFbutM5jmvW9",
  "number": 32680,
  "title": "Bouncycastle JSSE native IT test fails with latest Mandrel master",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2260340367,
      "node_id": "MDU6TGFiZWwyMjYwMzQwMzY3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/mandrel",
      "name": "area/mandrel",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 7,
  "created_at": "2023-04-17T12:48:25Z",
  "updated_at": "2023-04-18T18:14:32Z",
  "closed_at": "2023-04-18T18:14:32Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nThe bouncycastle JSSE integration test fails generating the native image due to a filedescriptor leak:\r\n\r\n```\r\n========================================================================================================================\r\nGraalVM Native Image: Generating 'quarkus-integration-test-bouncycastle-jsse-999-SNAPSHOT-runner' (executable)...\r\n========================================================================================================================\r\n10:40:38,794 INFO  [org.bou.jss.pro.PropertyUtils] Found boolean security property [keystore.type.compat]: true\r\n[1/8] Initializing...                                                                                    (9.5s @ 0.22GB)\r\n Java version: 17.0.7-beta+6-202304112331, vendor version: Mandrel-23.1.0-dev52226e97\r\n Graal compiler: optimization level: '2', target machine: 'x86-64-v3'\r\n C compiler: gcc (linux, x86_64, 11.3.0)\r\n Garbage collector: Serial GC (max heap size: 80% of RAM)\r\n 4 user-specific feature(s)\r\n - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions\r\n - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase\r\n - io.quarkus.security.BouncyCastleFeature\r\n - org.eclipse.angus.activation.nativeimage.AngusActivationFeature\r\n10:40:40,333 INFO  [org.bou.jss.pro.PropertyUtils] Found string system property [java.home]: /home/runner/work/mandrel/mandrel/openjdk\r\n10:41:00,986 INFO  [org.bou.jss.pro.PropertyUtils] Found string security property [jdk.tls.disabledAlgorithms]: SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize < 1024, EC keySize < 224, 3DES_EDE_CBC, anon, NULL\r\n10:41:00,987 INFO  [org.bou.jss.pro.PropertyUtils] Found string security property [jdk.certpath.disabledAlgorithms]: MD2, MD5, SHA1 jdkCA & usage TLSServer, RSA keySize < 1024, DSA keySize < 1024, EC keySize < 224, SHA1 usage SignedJAR & denyAfter 2019-01-01\r\n10:41:00,987 WARNING [org.bou.jss.pro.DisabledAlgorithmConstraints] Ignoring unsupported entry in 'jdk.certpath.disabledAlgorithms': SHA1 jdkCA & usage TLSServer\r\n10:41:00,988 WARNING [org.bou.jss.pro.DisabledAlgorithmConstraints] Ignoring unsupported entry in 'jdk.certpath.disabledAlgorithms': SHA1 usage SignedJAR & denyAfter 2019-01-01\r\n10:41:50,938 INFO  [org.bou.jss.pro.PropertyUtils] Found string system property [java.home]: /home/runner/work/mandrel/mandrel/openjdk\r\n10:41:50,995 INFO  [org.bou.jss.pro.PropertyUtils] Found string system property [java.home]: /home/runner/work/mandrel/mandrel/openjdk\r\n10:41:51,054 INFO  [org.bou.jss.pro.PropertyUtils] Found string system property [java.home]: /home/runner/work/mandrel/mandrel/openjdk\r\n[2/8] Performing analysis...  [******]                                                                  (99.7s @ 2.15GB)\r\n  14,875 (88.79%) of 16,753 types reachable\r\n  22,531 (62.50%) of 36,049 fields reachable\r\n  75,322 (59.60%) of 126,371 methods reachable\r\n   5,159 types,   187 fields, and 3,639 methods registered for reflection\r\n      63 types,    68 fields, and    55 methods registered for JNI access\r\n       4 native libraries: dl, pthread, rt, z\r\n\r\nError: Detected a FileDescriptor in the image heap. File descriptors opened during image generation are no longer open at image runtime, and the files might not even be present anymore at image runtime.  To see how this object got instantiated use --trace-object-instantiation=java.io.FileDescriptor. The object was probably created by a class initializer and is reachable from a static field. You can request class initialization at image runtime by using the option --initialize-at-run-time=<class-name>. Or you can write your own initialization methods and call them explicitly from your main entry point.\r\nDetailed message:\r\nTrace: Object was reached by\r\n------------------------------------------------------------------------------------------------------------------------\r\n  reading field java.io.FileInputStream.fd of constant \r\n    java.io.FileInputStream@16df1296: java.io.FileInputStream@16df1296\r\n                        6.6s (6.0% of total time) in 29 GCs | Peak RSS: 3.02GB | CPU load: 1.97\r\n------------------------------------------------------------------------------------------------------------------------\r\nProduced artifacts:\r\n /home/runner/work/mandrel/mandrel/quarkus/integration-tests/bouncycastle-jsse/target/quarkus-integration-test-bouncycastle-jsse-999-SNAPSHOT-native-image-source-jar/quarkus-integration-test-bouncycastle-jsse-999-SNAPSHOT-runner-build-output-stats.json (build_info)\r\n========================================================================================================================\r\nFinished generating 'quarkus-integration-test-bouncycastle-jsse-999-SNAPSHOT-runner' in 1m 49s.\r\n  reading field java.io.FilterInputStream.in of constant \r\n    java.io.BufferedInputStream@293aa06e: java.io.BufferedInputStream@293aa06e\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider.seedStream of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c44a: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c4...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3.this$0 of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e24e4: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer.baseRandom of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer@50530460: org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropy...\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque$Node.item of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f: java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque.tail of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque@251ed6ca: []\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon.tasks of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd: org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd\r\n  reading static field org.bouncycastle.jcajce.provider.drbg.DRBG.entropyDaemon\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source)\r\n  parsing method org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source) reachable via the parsing context\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG$Default.<clinit>(Unknown Source)\r\n    at static root method.(Unknown Source)\r\n\r\n\r\ncom.oracle.svm.core.util.UserError$UserException: Detected a FileDescriptor in the image heap. File descriptors opened during image generation are no longer open at image runtime, and the files might not even be present anymore at image runtime.  To see how this object got instantiated use --trace-object-instantiation=java.io.FileDescriptor. The object was probably created by a class initializer and is reachable from a static field. You can request class initialization at image runtime by using the option --initialize-at-run-time=<class-name>. Or you can write your own initialization methods and call them explicitly from your main entry point.\r\nDetailed message:\r\nTrace: Object was reached by\r\n  reading field java.io.FileInputStream.fd of constant \r\n    java.io.FileInputStream@16df1296: java.io.FileInputStream@16df1296\r\n  reading field java.io.FilterInputStream.in of constant \r\n    java.io.BufferedInputStream@293aa06e: java.io.BufferedInputStream@293aa06e\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider.seedStream of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c44a: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c4...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3.this$0 of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e24e4: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer.baseRandom of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer@50530460: org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropy...\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque$Node.item of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f: java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque.tail of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque@251ed6ca: []\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon.tasks of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd: org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd\r\n  reading static field org.bouncycastle.jcajce.provider.drbg.DRBG.entropyDaemon\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source)\r\n  parsing method org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source) reachable via the parsing context\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG$Default.<clinit>(Unknown Source)\r\n    at static root method.(Unknown Source)\r\n\r\n\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.core.util.UserError.abort(UserError.java:85)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.FallbackFeature.reportAsFallback(FallbackFeature.java:248)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.runPointsToAnalysis(NativeImageGenerator.java:803)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:582)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:539)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:407)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:611)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.start(NativeImageGeneratorRunner.java:133)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:93)\r\nCaused by: com.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Detected a FileDescriptor in the image heap. File descriptors opened during image generation are no longer open at image runtime, and the files might not even be present anymore at image runtime.  To see how this object got instantiated use --trace-object-instantiation=java.io.FileDescriptor. The object was probably created by a class initializer and is reachable from a static field. You can request class initialization at image runtime by using the option --initialize-at-run-time=<class-name>. Or you can write your own initialization methods and call them explicitly from your main entry point.\r\nDetailed message:\r\nTrace: Object was reached by\r\n  reading field java.io.FileInputStream.fd of constant \r\n    java.io.FileInputStream@16df1296: java.io.FileInputStream@16df1296\r\n  reading field java.io.FilterInputStream.in of constant \r\n    java.io.BufferedInputStream@293aa06e: java.io.BufferedInputStream@293aa06e\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider.seedStream of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c44a: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider@1fc5c4...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3.this$0 of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e24e4: org.bouncycastle.jcajce.provider.drbg.DRBG$URLSeededEntropySourceProvider$3@2c8e...\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer.baseRandom of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropySource$EntropyGatherer@50530460: org.bouncycastle.jcajce.provider.drbg.DRBG$HybridEntropySource$SignallingEntropy...\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque$Node.item of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f: java.util.concurrent.ConcurrentLinkedDeque$Node@7acc2c7f\r\n  reading field java.util.concurrent.ConcurrentLinkedDeque.tail of constant \r\n    java.util.concurrent.ConcurrentLinkedDeque@251ed6ca: []\r\n  reading field org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon.tasks of constant \r\n    org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd: org.bouncycastle.jcajce.provider.drbg.DRBG$EntropyDaemon@5234afd\r\n  reading static field org.bouncycastle.jcajce.provider.drbg.DRBG.entropyDaemon\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source)\r\n  parsing method org.bouncycastle.jcajce.provider.drbg.DRBG.createBaseRandom(Unknown Source) reachable via the parsing context\r\n    at org.bouncycastle.jcajce.provider.drbg.DRBG$Default.<clinit>(Unknown Source)\r\n    at static root method.(Unknown Source)\r\n\r\n\r\n\tat org.graalvm.nativeimage.pointsto/com.oracle.graal.pointsto.constraints.UnsupportedFeatures.report(UnsupportedFeatures.java:126)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.runPointsToAnalysis(NativeImageGenerator.java:798)\r\n\t... 6 more\r\n```\n\n### Expected behavior\n\nNative image generation passes\n\n### Actual behavior\n\nFails due to a file descriptor leak\n\n### How to Reproduce?\n\nRun the `bouncycastle-jsse` integration test from quarkus in native mode.\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### GraalVM version (if different from Java)\n\ngraalvm master\n\n### Quarkus version or git rev\n\nmain\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\nSee the CI failure here:\r\nhttps://github.com/graalvm/mandrel/actions/runs/4719124540/jobs/8370028509#step:11:481",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/32680/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
