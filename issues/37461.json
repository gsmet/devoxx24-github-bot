{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/37461",
  "id": 2021246781,
  "node_id": "I_kwDOCFbutM54ecc9",
  "number": 37461,
  "title": "Service binding doesn't work as SERVICE_BINDING_ROOT expression is not expanded",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273030910,
      "node_id": "MDU6TGFiZWwxMjczMDMwOTEw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/config",
      "name": "area/config",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1654772125,
      "node_id": "MDU6TGFiZWwxNjU0NzcyMTI1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kubernetes",
      "name": "area/kubernetes",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/288",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/288/labels",
    "id": 10189838,
    "node_id": "MI_kwDOCFbutM4Am3wO",
    "number": 288,
    "title": "3.7.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 432,
    "state": "closed",
    "created_at": "2023-11-15T08:06:53Z",
    "updated_at": "2024-05-17T12:27:49Z",
    "due_on": null,
    "closed_at": "2024-01-17T13:52:08Z"
  },
  "comments": 17,
  "created_at": "2023-12-01T16:49:48Z",
  "updated_at": "2024-01-03T18:20:22Z",
  "closed_at": "2024-01-03T18:20:18Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nService binding doesn't work as mounted secret is never found as file because config expression is not expanded.\r\nProblem was brought in when trying to fix other problem by this PR: https://github.com/quarkusio/quarkus/pull/34792\n\n### Expected behavior\n\nService binding works.\n\n### Actual behavior\n\nService binding in OCP 4.14 and 4.11 binds secret in following fashion:\r\n\r\n```\r\n...\r\nEnvironment:\r\n  SERVICE_BINDING_ROOT:        /bindings\r\nMounts:\r\n  /bindings/app-postgresql from app-postgresql (rw)\r\n...\r\n```\r\n\r\nand application never starts with:\r\n\r\n```\r\n15:13:04,436 Service Binding root '/deployments/${SERVICE_BINDING_ROOT:}' does not exist\r\n```\r\n\r\nI put some logging to `io.quarkus.kubernetes.service.binding.runtime.KubernetesServiceBindingConfigSourceFactory#getConfigSources(io.smallrye.config.ConfigSourceContext)` and got:\r\n\r\n```\r\n...\r\n17:29:36,283 INFO  [app] source io.smallrye.config.ConfigSourceContext$ConfigSourceContextConfigSource key SERVICE_BINDING_ROOT val /bindings\r\n...\r\n```\r\n\n\n### How to Reproduce?\n\nSteps to reproduce:\r\n\r\n0. be logged in OpenShift, have installed Service Binding and Crunchy PG operator and your user must have rights to list csv etc. (in short, for reproducer only you can use cluster admin)\r\n1. `git clone git@github.com:michalvavrik/quarkus-test-suite.git`\r\n2. `cd quarkus-test-suite/service-binding/postgresql-crunchy-classic`\r\n3. `git checkout feature/fix-and-enable-crunchy-sb-tests`\r\n4. `mvn clean verify -Dopenshift`\n\n### Output of `uname -a` or `ver`\n\nFedora 38\n\n### Output of `java -version`\n\nOpenJDK Runtime Environment Temurin-17.0.7+9\n\n### Quarkus version or git rev\n\n999-SNAPSHOT,\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.3\n\n### Additional information\n\nI have a fix.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/37461/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
