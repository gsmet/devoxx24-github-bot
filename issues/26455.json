{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/26455",
  "id": 1289236111,
  "node_id": "I_kwDOCFbutM5M2C6P",
  "number": 26455,
  "title": "[reactive-pg-client] NullPointerException in PgPoolRecorder.java",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2955124662,
      "node_id": "MDU6TGFiZWwyOTU1MTI0NjYy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/reactive-sql-clients",
      "name": "area/reactive-sql-clients",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/191",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/191",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/191/labels",
    "id": 8076658,
    "node_id": "MI_kwDOCFbutM4Aez1y",
    "number": 191,
    "title": "2.7.7.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 71,
    "state": "closed",
    "created_at": "2022-06-13T14:52:08Z",
    "updated_at": "2023-02-21T15:11:33Z",
    "due_on": null,
    "closed_at": "2023-01-26T12:29:24Z"
  },
  "comments": 4,
  "created_at": "2022-06-29T19:58:47Z",
  "updated_at": "2023-02-23T09:57:44Z",
  "closed_at": "2022-06-30T12:33:03Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWhen migrating from `2.9.2.Final` to `2.10.1.Final` the tests for one of my applications started failing due to a NullPointerException:\r\n```\r\njava.lang.RuntimeException: Failed to start quarkus\r\n\tat io.quarkus.runner.ApplicationImpl.doStart(Unknown Source)\r\n\tat io.quarkus.runtime.Application.start(Application.java:101)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl.run(StartupActionImpl.java:237)\r\n\tat io.quarkus.test.junit.QuarkusTestExtension.doJavaStart(QuarkusTestExtension.java:250)\r\n\tat io.quarkus.test.junit.QuarkusTestExtension.ensureStarted(QuarkusTestExtension.java:609)\r\n\tat io.quarkus.test.junit.QuarkusTestExtension.beforeAll(QuarkusTestExtension.java:647)\r\n\t... 35 more\r\nCaused by: java.lang.NullPointerException\r\n\tat io.quarkus.reactive.pg.client.runtime.PgPoolRecorder.toPgConnectOptions(PgPoolRecorder.java:193)\r\n\tat io.quarkus.reactive.pg.client.runtime.PgPoolRecorder.initialize(PgPoolRecorder.java:68)\r\n\tat io.quarkus.reactive.pg.client.runtime.PgPoolRecorder.configurePgPool(PgPoolRecorder.java:47)\r\n\tat io.quarkus.deployment.steps.ReactivePgClientProcessor$build897843755.deploy_0(Unknown Source)\r\n\tat io.quarkus.deployment.steps.ReactivePgClientProcessor$build897843755.deploy(Unknown Source)\r\n\t... 51 more\r\n```\r\n\r\nThe cause seems to be that `dataSourceReactiveRuntimeConfig.additionalProperties` can be null, so when it hits this line it fails:\r\nhttps://github.com/quarkusio/quarkus/blob/3ad7cd0ec6a2297ccda5759b5acb22741d147d37/extensions/reactive-pg-client/runtime/src/main/java/io/quarkus/reactive/pg/client/runtime/PgPoolRecorder.java#L193\r\n\r\n### Expected behavior\r\n\r\nThe application starts up successfully.\r\n\r\n### Actual behavior\r\n\r\nThe application fails.\r\n\r\n### How to Reproduce?\r\n\r\nI cannot share a reproducer at this time because the code belongs to my company and it would be difficult to recreate.\r\n\r\nHowever, based on my troubleshooting the issue seems to triggered with this configuration:\r\n```yaml\r\n\"%test\":\r\n  quarkus:\r\n    datasource:\r\n      app:\r\n        db-kind: postgresql\r\n        devservices:\r\n          enabled: true\r\n          image-name: postgres:14\r\n        username: \"quarkus\"\r\n        password: \"quarkus\"\r\n      migration:\r\n        db-kind: postgresql\r\n        # This is an awkward workaround to prevent multiple instances of DevServices running.\r\n        jdbc:\r\n          url: \"${quarkus.datasource.\\\"app\\\".jdbc.url}\"\r\n        username: \"quarkus\"\r\n        password: \"quarkus\"\r\n\r\n     flyway:\r\n       migration:\r\n         # settings\r\n```\r\n> **Aside**: Having two separate datasources is an awkward workaround run Flyway migrations as a separate user from the standard application operations. For tests it doesn't matter.\r\n> \r\n> Ideally, it'd be possible to specify different credentials in the URL for reactive and JDBC, or make it so reactive/jdbc can be disabled per data source. I'll probably make a separate issue about this...)\r\n\r\nWhen `PgPoolRecorder.configurePgPool` is called for the \"app\" datasource, `dataSourceReactiveRuntimeConfig.additionalProperties` is empty. However, when it's called for the `migration` datasource,`dataSourceReactiveRuntimeConfig.additionalProperties` is null.\r\n\r\nThe straightforward solution would be to surround this with a null check. But the fact that it's `null` in the first place may be a bug.\r\n\r\n_Edit:_ if it's expected that `additionalProperties` can be null, the null check would need to be added to all pool recorders.\r\nhttps://github.com/quarkusio/quarkus/commit/dccb8d968a1ba9e387439de187e91aca7d2053c8\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n11.0.12\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.10.1.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n3.8.5\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/26455/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
