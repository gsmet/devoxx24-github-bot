{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41020",
  "id": 2337872851,
  "node_id": "I_kwDOCFbutM6LWRvT",
  "number": 41020,
  "title": "Remote Container build does not copy all build artifacts",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/335",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/335/labels",
    "id": 11174659,
    "node_id": "MI_kwDOCFbutM4AqoMD",
    "number": 335,
    "title": "3.13.0.CR1",
    "description": "",
    "creator": {
      "login": "quarkusbot",
      "id": 61254497,
      "node_id": "MDQ6VXNlcjYxMjU0NDk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/61254497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quarkusbot",
      "html_url": "https://github.com/quarkusbot",
      "followers_url": "https://api.github.com/users/quarkusbot/followers",
      "following_url": "https://api.github.com/users/quarkusbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/quarkusbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quarkusbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quarkusbot/subscriptions",
      "organizations_url": "https://api.github.com/users/quarkusbot/orgs",
      "repos_url": "https://api.github.com/users/quarkusbot/repos",
      "events_url": "https://api.github.com/users/quarkusbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quarkusbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 241,
    "state": "closed",
    "created_at": "2024-06-12T08:02:47Z",
    "updated_at": "2024-07-19T11:47:06Z",
    "due_on": null,
    "closed_at": "2024-07-17T11:55:13Z"
  },
  "comments": 6,
  "created_at": "2024-06-06T10:07:34Z",
  "updated_at": "2024-07-10T12:27:35Z",
  "closed_at": "2024-07-10T12:27:31Z",
  "active_lock_reason": null,
  "body": "We are building a Quarkus native image in Gitlab Pipeline using Gradle and \"remote container build\" with Docker. \r\nSince we added https://quarkus.io/extensions/io.quarkiverse.poi/quarkus-poi/ extension and configured the Dockerfile according to Quarkus-POI guidelines (install and copy libraries), we faced java.awt.Font NoClassDefFoundError errors during generation of an Excel sheet.\r\n\r\n> ERROR [io.qua.ver.htt.run.QuarkusErrorHandler] (executor-thread-7) HTTP Request to /reports/api/v1/download?start=2023-01&end=2024-12&source=ALL failed, error id: 6dc1b7cd-0365-4e01-b08c-b18f861228d9-1: java.lang.NoClassDefFoundError: Could not initialize class java.awt.Font\r\n\r\nDebugging has shown the *.so files generated next to the *-runner application files are not copied back to the build output directory from the remote container. Building it locally by using just \"container build\" works as expected and the runtime error did not appear with the required *.so files next to the *-runner application file.\r\n\r\nDebugging the build process confirmed: only the *-runner file is copied back from the container.\r\n![buildstep](https://github.com/quarkusio/quarkus/assets/14999363/334c7535-2fb9-41e4-9db4-1272227b1cf4)\r\n\r\n\r\nDigging into the source we found there is no option to preserve the other produced build artifacts, just the executable will be copied back.\r\n\r\nhttps://github.com/quarkusio/quarkus/blob/20d3c9d576d596ef3cdb90be7ce692afab63a7cb/core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildRemoteContainerRunner.java#L57\r\n\r\nIt would be great to have all build artifacts preserved for further steps in the build process. \r\nFor now we just copy the libs from a different location, but it would be great to just use them from remote container build.\r\n\r\n> $ java --version\r\nopenjdk 17.0.10 2024-01-16\r\nOpenJDK Runtime Environment (build 17.0.10+7-alpine-r0)\r\nOpenJDK 64-Bit Server VM (build 17.0.10+7-alpine-r0, mixed mode, sharing)\r\n\r\n> $ docker version\r\nClient:\r\n Version:           20.10.22\r\n API version:       1.41\r\n Go version:        go1.18.9\r\n Git commit:        3a2c30b\r\n Built:             Thu Dec 15 22:21:58 2022\r\n OS/Arch:           linux/amd64\r\n Context:           default\r\n Experimental:      true\r\nServer: Docker Engine - Community\r\n Engine:\r\n  Version:          20.10.22\r\n  API version:      1.41 (minimum version 1.12)\r\n  Go version:       go1.18.9\r\n  Git commit:       42c8b31\r\n  Built:            Thu Dec 15 22:26:12 2022\r\n  OS/Arch:          linux/amd64\r\n  Experimental:     false\r\n containerd:\r\n  Version:          1.6.15\r\n  GitCommit:        5b842e528e99d4d4c1686467debf2bd4b88ecd86\r\n runc:\r\n  Version:          1.1.4\r\n  GitCommit:        v1.1.4-0-g5fd4c4d\r\n docker-init:\r\n  Version:          0.19.0\r\n  GitCommit:        de40ad0\r\n\r\n\r\nBuild command: \r\n> ./gradlew build -Dquarkus.package.type=native -Dquarkus.native.remote-container-build=true -Dquarkus.native.native-image-xmx=8g -x test`\r\n\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41020/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
