{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/42077",
  "id": 2424967056,
  "node_id": "I_kwDOCFbutM6Qig-Q",
  "number": 42077,
  "title": "Invalid `was not indexed at build time` on application reload",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 9,
  "created_at": "2024-07-23T11:32:28Z",
  "updated_at": "2024-08-28T08:17:42Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nGetting a REST client interface is working on first run, but when reloading the application (by pressing `s` in console), it fail with `REST client interface: interface toto.TotoResource was not indexed at build time`\n\n### Expected behavior\n\nIt should work after reload.\r\nIf not, it should give an adapted error message, because this one does not match the situation.\n\n### Actual behavior\n\nBogus message `REST client interface: interface toto.TotoResource was not indexed at build time`\n\n### How to Reproduce?\n\n\r\n[quarkus-rest-client-restart-issue.zip](https://github.com/user-attachments/files/16347924/quarkus-rest-client-restart-issue.zip)\r\n\r\n\r\nUse the attached project, run `./gradlew :app:quarkusDev`\r\nThen press `s` <Enter>\r\n\r\nyou should have the folowing log :\r\n```\r\nï² ./gradlew :app:quarkusDev\r\nStarting a Gradle Daemon, 2 stopped Daemons could not be reused, use --status for details\r\n\r\n> Task :app:quarkusDev\r\nio.smallrye.common:smallrye-common-net::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-net/2.2.0/261d912ae8bc78a67df97e69a589f998440f6d1c/smallrye-common-net-2.2.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-net/2.3.0/4858c78377802c801d2f9b24141381733b256260/smallrye-common-net-2.3.0.jar\r\nio.smallrye.common:smallrye-common-constraint::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-constraint/2.4.0/9845f428e7ac5ff165dcd03074261f0ee6772f81/smallrye-common-constraint-2.4.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-constraint/2.3.0/1be18f3663dc7e8a5080039cdd10415ae679544/smallrye-common-constraint-2.3.0.jar\r\nio.smallrye.common:smallrye-common-ref::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-ref/2.2.0/3887e9f5b9c6ab21e6f9d5f71d550ecbdafc620a/smallrye-common-ref-2.2.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-ref/2.3.0/8dee03ceb1c5466faaeb5554e045abfffa3df4eb/smallrye-common-ref-2.3.0.jar\r\nio.smallrye.common:smallrye-common-expression::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-expression/2.4.0/3428461f913fd623d0b754eebca44eacd45be42c/smallrye-common-expression-2.4.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-expression/2.3.0/10b4807e36c082607bbd22bd263898c2043bb5f6/smallrye-common-expression-2.3.0.jar\r\nio.smallrye.common:smallrye-common-function::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-function/2.4.0/87c17831e20be35c2b017f06f37a87ed286d5ecd/smallrye-common-function-2.4.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-function/2.3.0/17e2dcd9e238c99a6aaaba0162ba8547bfc8ade3/smallrye-common-function-2.3.0.jar\r\nio.smallrye.common:smallrye-common-cpu::jar classpath entry /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-cpu/2.2.0/b70030308912ce33baafbf9775bba3a5d0c69b00/smallrye-common-cpu-2.2.0.jar was overriden with /Users/ylemoigne/.gradle/caches/modules-2/files-2.1/io.smallrye.common/smallrye-common-cpu/2.3.0/46b679da6b944d7e99fe2c32928978d916770b26/smallrye-common-cpu-2.3.0.jar\r\nListening for transport dt_socket at address: 5005\r\nPress [e] to edit command line args (currently ''), [h] for more options>\r\nTests paused\r\nPress [e] to edit command line args (currently ''), [r] to resume testing, [h] for more options>\r\nPress [e] to edit command line args (currently ''), [r] to resume testing, [o] Toggle test output, [h] for more options>\r\n2024-07-23 13:25:41,938 WARN  [io.qua.arc.dep.SplitPackageProcessor] (build-10) Detected a split package usage which is considered a bad practice and should be avoided. Following packages were detected in multiple archives:\r\n- \"toto\" found in [org.example:api:1.0-SNAPSHOT, org.example:app:1.0-SNAPSHOT]\r\n__  ____  __  _____   ___  __ ____  ______\r\n --/ __ \\/ / / / _ | / _ \\/ //_/ / / / __/\r\n -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\\ \\\r\n--\\___\\_\\____/_/ |_/_/|_/_/|_|\\____/___/\r\n2024-07-23 13:25:42,227 INFO  [io.quarkus] (Quarkus Main Thread) app 1.0-SNAPSHOT on JVM (powered by Quarkus 3.12.0) started in 0.599s.\r\n2024-07-23 13:25:42,227 INFO  [io.quarkus] (Quarkus Main Thread) Profile dev activated. Live Coding activated.\r\n2024-07-23 13:25:42,227 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, rest-client, rest-client-jackson, smallrye-context-propagation, vertx]\r\n2024-07-23 13:25:42.324 java[79882:6290855] WARNING: Secure coding is automatically enabled for restorable state! However, not on all supported macOS versions of this application. Opt-in to secure coding explicitly by implementing NSApplicationDelegate.applicationSupportsSecureRestorableState:.\r\ntoto.TotoResource$$CDIWrapper@4d2eb1ae\r\n<<============-> 93% EXECUTING [12s]\r\n2024-07-23 13:25:51,400 INFO  [io.qua.dep.dev.RuntimeUpdatesProcessor] (Quarkus Terminal Reader) Restarting as requested by the user.\r\n2024-07-23 13:25:51,406 INFO  [io.quarkus] (Quarkus Main Thread) app stopped in 0.005s\r\n2024-07-23 13:25:51,440 WARN  [io.qua.arc.dep.SplitPackageProcessor] (build-21) Detected a split package usage which is considered a bad practice and should be avoided. Following packages were detected in multiple archives:\r\n- \"toto\" found in [org.example:api:1.0-SNAPSHOT, org.example:app:1.0-SNAPSHOT]\r\n     __  ____  __  _____   ___  __ ____  ______\r\n --/ __ \\/ / / / _ | / _ \\/ //_/ / / / __/\r\n -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\\ \\\r\n--\\___\\_\\____/_/ |_/_/|_/_/|_|\\____/___/\r\n2024-07-23 13:25:51,505 INFO  [io.quarkus] (Quarkus Main Thread) app 1.0-SNAPSHOT on JVM (powered by Quarkus 3.12.0) started in 0.099s.\r\n2024-07-23 13:25:51,506 INFO  [io.quarkus] (Quarkus Main Thread) Profile dev activated. Live Coding activated.\r\n2024-07-23 13:25:51,506 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, rest-client, rest-client-jackson, smallrye-context-propagation, vertx]\r\n2024-07-23 13:25:51,506 INFO  [io.qua.dep.dev.RuntimeUpdatesProcessor] (Quarkus Terminal Reader) Live reload total time: 0.110s\r\n\r\nException in thread \"AWT-EventQueue-0\" java.lang.IllegalStateException: REST client interface: interface toto.TotoResource was not indexed at build time. See https://quarkus.io/guides/cdi-reference#bean_discovery for information on how to index the module that contains it.\r\n        at org.jboss.resteasy.reactive.client.impl.ClientProxies.get(ClientProxies.java:35)\r\n        at org.jboss.resteasy.reactive.client.impl.WebTargetImpl.proxy(WebTargetImpl.java:449)\r\n        at io.quarkus.rest.client.reactive.runtime.RestClientBuilderImpl.build(RestClientBuilderImpl.java:521)\r\n        at io.quarkus.rest.client.reactive.runtime.QuarkusRestClientBuilderImpl.build(QuarkusRestClientBuilderImpl.java:267)\r\n        at io.quarkus.rest.client.reactive.runtime.RestClientCDIDelegateBuilder.build(RestClientCDIDelegateBuilder.java:67)\r\n        at io.quarkus.rest.client.reactive.runtime.RestClientCDIDelegateBuilder.createDelegate(RestClientCDIDelegateBuilder.java:49)\r\n        at io.quarkus.rest.client.reactive.runtime.RestClientReactiveCDIWrapperBase.delegate(RestClientReactiveCDIWrapperBase.java:76)\r\n        at io.quarkus.rest.client.reactive.runtime.RestClientReactiveCDIWrapperBase.<init>(RestClientReactiveCDIWrapperBase.java:30)\r\n        at toto.TotoResource$$CDIWrapper.<init>(Unknown Source)\r\n        at toto.TotoResource$$CDIWrapper_ClientProxy.<init>(Unknown Source)\r\n        at toto.TotoResource$$CDIWrapper_Bean.proxy(Unknown Source)\r\n        at toto.TotoResource$$CDIWrapper_Bean.get(Unknown Source)\r\n        at toto.TotoResource$$CDIWrapper_Bean.get(Unknown Source)\r\n        at io.quarkus.arc.impl.InstanceImpl.getBeanInstance(InstanceImpl.java:325)\r\n        at io.quarkus.arc.impl.InstanceImpl.getInternal(InstanceImpl.java:309)\r\n        at io.quarkus.arc.impl.InstanceImpl.get(InstanceImpl.java:190)\r\n        at toto.Application.lambda$run$0(Application.java:17)\r\n        at java.desktop/java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:318)\r\n        at java.desktop/java.awt.EventQueue.dispatchEventImpl(EventQueue.java:773)\r\n        at java.desktop/java.awt.EventQueue$4.run(EventQueue.java:720)\r\n        at java.desktop/java.awt.EventQueue$4.run(EventQueue.java:714)\r\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)\r\n        at java.base/java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:87)\r\n        at java.desktop/java.awt.EventQueue.dispatchEvent(EventQueue.java:742)\r\n        at java.desktop/java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:203)\r\n        at java.desktop/java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:124)\r\n        at java.desktop/java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:113)\r\n        at java.desktop/java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:109)\r\n        at java.desktop/java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)\r\n        at java.desktop/java.awt.EventDispatchThread.run(EventDispatchThread.java:90)\r\n<============-> 93% EXECUTING [20s]\r\n> :app:quarkusDev\r\n```\n\n### Output of `uname -a` or `ver`\n\nDarwin MacBook-Pro-de-Yann.local 23.5.0 Darwin Kernel Version 23.5.0: Wed May  1 20:14:38 PDT 2024; root:xnu-10063.121.3~5/RELEASE_ARM64_T6020 arm64\n\n### Output of `java -version`\n\nopenjdk version \"21.0.3\" 2024-04-16 LTS OpenJDK Runtime Environment Temurin-21.0.3+9 (build 21.0.3+9-LTS) OpenJDK 64-Bit Server VM Temurin-21.0.3+9 (build 21.0.3+9-LTS, mixed mode)\n\n### Quarkus version or git rev\n\n3.12.0\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n ------------------------------------------------------------ Gradle 8.8 ------------------------------------------------------------  Build time:   2024-05-31 21:46:56 UTC Revision:     4bd1b3d3fc3f31db5a26eecb416a165b8cc36082  Kotlin:       1.9.22 Groovy:       3.0.21 Ant:          Apache Ant(TM) version 1.10.13 compiled on January 4 2023 JVM:          21.0.3 (Eclipse Adoptium 21.0.3+9-LTS) OS:           Mac OS X 14.5 aarch64\n\n### Additional information\n\nThis seems to be tied to calling thead and the easiest way to have a reproducer is calling from Swing UI thread. \r\nInternally, the `clazz` parameter of `ClientProxies` doesn't match the one in the map, but the ClientProxies is rebuild at reload, so I don't understand why ; it looks like a classloader issue but not sure.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/42077/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
