{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41717",
  "id": 2393052149,
  "node_id": "I_kwDOCFbutM6OoxP1",
  "number": 41717,
  "title": "quarkus-scheduler trigger getNextFireTime does not consider cron timezone",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1321590926,
      "node_id": "MDU6TGFiZWwxMzIxNTkwOTI2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/scheduler",
      "name": "area/scheduler",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/340",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/340",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/340/labels",
    "id": 11321456,
    "node_id": "MI_kwDOCFbutM4ArMBw",
    "number": 340,
    "title": "3.12.3",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 12,
    "state": "closed",
    "created_at": "2024-07-16T16:13:43Z",
    "updated_at": "2024-08-14T12:46:28Z",
    "due_on": null,
    "closed_at": "2024-07-17T11:17:11Z"
  },
  "comments": 10,
  "created_at": "2024-07-05T19:28:32Z",
  "updated_at": "2024-07-16T16:14:43Z",
  "closed_at": "2024-07-10T07:04:19Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWhen using the Quarkus Scheduler, cron triggering works properly with respect to the configured timezone. However, when interrogating the scheduler for the \"getNextFireTime\", the timezone is not factored in. This results in incorrect behaviour, most problematically, is that it can return a next fire time in the past. \r\n\r\nSee example class which demonstrates the results coming back.\n\n### Expected behavior\n\nWhen calling getNextFireTime from the scheduler, the Instant returned should match the actual nextFireTime defined by the cron AND timezone, not simply the cron as parsed in the local timezone. \n\n### Actual behavior\n\nWhen calling getNextFireTime from the scheduler, the Instant returned treats the cron as if it had the local timezone.\n\n### How to Reproduce?\n\n```\r\npackage org.example;\r\n\r\nimport java.time.Instant;\r\n\r\nimport io.quarkus.runtime.StartupEvent;\r\nimport io.quarkus.scheduler.Scheduler;\r\nimport jakarta.enterprise.context.ApplicationScoped;\r\nimport jakarta.enterprise.event.Observes;\r\nimport jakarta.inject.Inject;\r\n\r\n@ApplicationScoped\r\npublic class TestScheduler {\r\n\r\n  @Inject\r\n  Scheduler scheduler;\r\n\r\n  public void init(@Observes StartupEvent startupEvent) {\r\n\r\n    scheduler.newJob(\"testJob1\")\r\n             .setCron(\"0 30 20 ? * * *\")\r\n             .setTimeZone(\"Europe/Berlin\")\r\n             .setTask(execution -> System.out.println(\"Job has run\"))\r\n             .schedule();\r\n\r\n    scheduler.newJob(\"testJob2\")\r\n             .setCron(\"0 30 20 ? * * *\")\r\n             .setTimeZone(\"Europe/London\")\r\n             .setTask(execution -> System.out.println(\"Job has run\"))\r\n             .schedule();\r\n\r\n    Instant nextFireTime1 = scheduler.getScheduledJob(\"testJob1\").getNextFireTime();\r\n    Instant nextFireTime2 = scheduler.getScheduledJob(\"testJob2\").getNextFireTime();\r\n\r\n    System.out.println(\"=============================================================\");\r\n    System.out.println(\"NextFireTimes:\");\r\n    System.out.println(\"TestJob1(Berlin)=\" + nextFireTime1);\r\n    System.out.println(\"TestJob2(London)=\" + nextFireTime2);\r\n    System.out.println(\"compareTo result=\" + nextFireTime1.compareTo(nextFireTime2) + \"    <-- should be greater than 0\");\r\n    System.out.println(\"=============================================================\");\r\n    // These two times should be different as they are crons with same local time but diff timezone, so UTC time expressed by the Instant should be different.\r\n  }\r\n\r\n}\r\n```\r\n\n\n### Output of `uname -a` or `ver`\n\nLinux alan-test-redis-cacher-56d9f6f6d4-ssstk 5.4.0-42-generic #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"21.0.1\" 2023-10-17 LTS\n\n### Quarkus version or git rev\n\n3.10.0\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41717/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
