{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21345",
  "id": 1049913154,
  "node_id": "I_kwDOCFbutM4-lGdC",
  "number": 21345,
  "title": "REST Client Configuration via Uppercase/Underscore Environment Variables Stopped Working in 2.4.0",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/160",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/160/labels",
    "id": 7427013,
    "node_id": "MI_kwDOCFbutM4AcVPF",
    "number": 160,
    "title": "2.5.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 110,
    "state": "closed",
    "created_at": "2021-11-24T15:28:10Z",
    "updated_at": "2021-12-02T11:14:37Z",
    "due_on": null,
    "closed_at": "2021-12-01T12:26:44Z"
  },
  "comments": 3,
  "created_at": "2021-11-10T14:41:30Z",
  "updated_at": "2021-11-29T16:27:59Z",
  "closed_at": "2021-11-22T22:24:30Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI have the following REST client:\r\n\r\n```\r\npackage com.ionos.cloud.auth.user;\r\n...\r\n@RegisterRestClient(configKey = \"user-api-rest-client\")\r\npublic interface UserApiRestClient { ... }\r\n```\r\n\r\nI used to configure it via the following environment variable (as we can only use uppercase characters and underscores in our environment):\r\n```\r\nUSER_API_REST_CLIENT_MP_REST_URL\r\n```\r\nThis worked perfectly fine up to Quarkus 2.3.1.\r\n\r\nIn Quarkus 2.4.0 + 2.4.1, I get the following error message (I've added line breaks for better readability):\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Unable to determine the proper baseUrl/baseUri.\r\n\r\nConsider registering using @RegisterRestClient(baseUri=\"someuri\"), \r\n                           @RegisterRestClient(configKey=\"orkey\"), \r\nor by adding 'quarkus.rest-config.\"user-api-rest-client\".url' \r\n          or 'quarkus.rest-config.\"user-api-rest-client\".uri' \r\nto your Quarkus configuration\r\n```\r\n\r\nFirst of all, there's an error in that message, it should be \"quarkus.rest-client\", not \"quarkus.rest-config\" (see https://quarkus.io/guides/rest-client#create-the-configuration).\r\n\r\nBut that's not the issue here.\r\n\r\nAs per the documentation, all these configuration keys work fine (in a test environment):\r\n```\r\nuser-api-rest-client/mp-rest/url\r\nquarkus.rest-client.user-api-rest-client.url\r\nquarkus.rest-client.user-api-rest-client.uri\r\nquarkus.rest-client.\"user-api-rest-client\".url\r\nquarkus.rest-client.\"user-api-rest-client\".uri\r\nquarkus.rest-client.\"com.ionos.cloud.auth.user.UserApiRestClient\".url\r\nquarkus.rest-client.\"com.ionos.cloud.auth.user.UserApiRestClient\".uri\r\n```\r\n\r\nHowever, as I said before, in our production environment, I can use only uppercase and underscore.\r\n\r\nBut all these keys do *not* work:\r\n```\r\nUSER_API_REST_CLIENT_MP_REST_URL\r\nQUARKUS_REST_CLIENT_USER_API_REST_CLIENT_URL\r\nQUARKUS_REST_CLIENT_USER_API_REST_CLIENT_URI\r\nQUARKUS_REST_CLIENT__USER_API_REST_CLIENT__URL\r\nQUARKUS_REST_CLIENT__USER_API_REST_CLIENT__URI\r\nQUARKUS_REST_CLIENT__COM_IONOS_CLOUD_AUTH_USER_USERAPIRESTCLIENT__URL\r\nQUARKUS_REST_CLIENT__COM_IONOS_CLOUD_AUTH_USER_USERAPIRESTCLIENT__URI\r\n```\n\n### Expected behavior\n\nUppercase/underscore environment variables - such as the following ones - should be usable for REST client configuration:\r\n```\r\n<CONFIG_KEY>_MP_REST_URL\r\nQUARKUS_REST_CLIENT_<CONFIG_KEY>_URL\r\nQUARKUS_REST_CLIENT_<CONFIG_KEY>_URI\r\nQUARKUS_REST_CLIENT__<CONFIG_KEY>__URL\r\nQUARKUS_REST_CLIENT__<CONFIG_KEY>__URI\r\nQUARKUS_REST_CLIENT__<FULLY_QUALIFIED_CLASS_NAME>__URL\r\nQUARKUS_REST_CLIENT__<FULLY_QUALIFIED_CLASS_NAME>__URI\r\n```\n\n### Actual behavior\n\n*None* of the following uppercase/underscore environment variables are usable for REST client configuration:\r\n```\r\n<CONFIG_KEY>_MP_REST_URL\r\nQUARKUS_REST_CLIENT_<CONFIG_KEY>_URL\r\nQUARKUS_REST_CLIENT_<CONFIG_KEY>_URI\r\nQUARKUS_REST_CLIENT__<CONFIG_KEY>__URL\r\nQUARKUS_REST_CLIENT__<CONFIG_KEY>__URI\r\nQUARKUS_REST_CLIENT__<FULLY_QUALIFIED_CLASS_NAME>__URL\r\nQUARKUS_REST_CLIENT__<FULLY_QUALIFIED_CLASS_NAME>__URI\r\n```\n\n### How to Reproduce?\n\n1. Create a REST client with a config key.\r\n2. Try to configure it via environment variables with only uppercase characters and underscores.\r\n\n\n### Output of `uname -a` or `ver`\n\nLinux debian 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"16.0.1\" 2021-04-20\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.4.0, 2.4.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.6.3\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21345/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
