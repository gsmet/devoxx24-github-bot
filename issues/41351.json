{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/41351",
  "id": 2366161627,
  "node_id": "I_kwDOCFbutM6NCMLb",
  "number": 41351,
  "title": "OpenTelemetry gRPC OTLP traces exporter sometimes throws NPE on app shutdown when HTTP2 connection stream is closed",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283619446,
      "node_id": "MDU6TGFiZWwxMjgzNjE5NDQ2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye",
      "name": "area/smallrye",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2062531368,
      "node_id": "MDU6TGFiZWwyMDYyNTMxMzY4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/grpc",
      "name": "area/grpc",
      "color": "0366d6",
      "default": false,
      "description": "gRPC"
    },
    {
      "id": 2236031412,
      "node_id": "MDU6TGFiZWwyMjM2MDMxNDEy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/tracing",
      "name": "area/tracing",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/334",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334/labels",
    "id": 11163455,
    "node_id": "MI_kwDOCFbutM4Aqlc_",
    "number": 334,
    "title": "3.8.6",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 117,
    "state": "closed",
    "created_at": "2024-06-10T07:54:20Z",
    "updated_at": "2024-08-28T09:33:53Z",
    "due_on": null,
    "closed_at": "2024-08-28T09:33:53Z"
  },
  "comments": 4,
  "created_at": "2024-06-21T09:47:42Z",
  "updated_at": "2024-08-14T12:17:15Z",
  "closed_at": "2024-06-26T07:06:02Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nI have app where I mock OTel collector with a Vert.x gRPC server so that I can avoid running container where I don't need to. I can see exported traces alright, but when Quarkus app is shutting down, **sometimes** can see logged NPE. The NPE doesn't affect me (though it fails my test that checks log), but looking at the error, I'm not really sure how my mock could cause that.\r\n\r\n### Expected behavior\r\n\r\nI wonder if I have a wrongly written this gRPC server, but the error is bit strange. I'd prefer someone to check it. I tried it with a Jaeger container and could not reproduce the issue. On the other hand, as I think there is a race, it's logical that race cannot be reproduced in some scenarios.\r\n\r\n### Actual behavior\r\n\r\n```\r\n2024-06-21 11:35:40,472 INFO  [io.quarkus] (main) app-full-microprofile 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.11.0) started in 1.039s. Listening on: http://0.0.0.0:8080\r\n2024-06-21 11:35:40,479 INFO  [io.quarkus] (main) Profile prod activated. \r\n2024-06-21 11:35:40,479 INFO  [io.quarkus] (main) Installed features: [cdi, micrometer, opentelemetry, rest, rest-client, security, smallrye-context-propagation, smallrye-fault-tolerance, smallrye-health, smallrye-jwt, smallrye-openapi, vertx]\r\n2024-06-21 11:35:43,233 ERROR [io.qua.ver.cor.run.VertxCoreRecorder] (vert.x-eventloop-thread-2) Uncaught exception received by Vert.x [Error Occurred After Shutdown]: java.lang.NullPointerException: Cannot invoke \"io.smallrye.context.SmallRyeContextManager.defaultThreadContext()\" because the return value of \"io.smallrye.context.SmallRyeContextManagerProvider.getManager()\" is null\r\n\tat io.smallrye.context.SmallRyeThreadContext.getCurrentThreadContextOrDefaultContexts(SmallRyeThreadContext.java:160)\r\n\tat io.smallrye.mutiny.context.DefaultContextPropagationInterceptor.getThreadContext(DefaultContextPropagationInterceptor.java:12)\r\n\tat io.smallrye.mutiny.context.BaseContextPropagationInterceptor.decorate(BaseContextPropagationInterceptor.java:24)\r\n\tat io.smallrye.mutiny.infrastructure.Infrastructure.decorate(Infrastructure.java:149)\r\n\tat io.smallrye.mutiny.groups.UniCreate.completionStage(UniCreate.java:140)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter.initiateSend(VertxGrpcExporter.java:112)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:402)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:397)\r\n\tat io.vertx.core.impl.future.FutureImpl$2.onFailure(FutureImpl.java:117)\r\n\tat io.vertx.core.impl.future.FutureImpl$ListenerArray.onFailure(FutureImpl.java:316)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.impl.future.Mapping.onFailure(Mapping.java:45)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.fail(HttpClientRequestBase.java:182)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.handleException(HttpClientRequestBase.java:177)\r\n\tat io.vertx.core.http.impl.HttpClientRequestImpl.handleException(HttpClientRequestImpl.java:90)\r\n\tat io.vertx.core.http.impl.Http2ClientConnection$StreamImpl.handleException(Http2ClientConnection.java:543)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:328)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:321)\r\n\tat io.vertx.core.http.impl.VertxHttp2Stream.onException(VertxHttp2Stream.java:96)\r\n\tat io.vertx.core.http.impl.Http2ConnectionBase.onStreamClosed(Http2ConnectionBase.java:153)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler$1.onStreamClosed(VertxHttp2ConnectionHandler.java:93)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.notifyClosed(DefaultHttp2Connection.java:357)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.removeFromActiveStreams(DefaultHttp2Connection.java:1036)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.deactivate(DefaultHttp2Connection.java:992)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$DefaultStream.close(DefaultHttp2Connection.java:517)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.close(DefaultHttp2Connection.java:153)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$BaseDecoder.channelInactive(Http2ConnectionHandler.java:217)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.channelInactive(Http2ConnectionHandler.java:432)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler.channelInactive(VertxHttp2ConnectionHandler.java:186)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81)\r\n\tat io.netty.handler.timeout.IdleStateHandler.channelInactive(IdleStateHandler.java:280)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1405)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:301)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:901)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$7.run(AbstractChannel.java:813)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n\r\n2024-06-21 11:35:43,234 ERROR [io.qua.ver.cor.run.VertxCoreRecorder] (vert.x-eventloop-thread-2) Uncaught exception received by Vert.x [Error Occurred After Shutdown]: java.lang.NullPointerException: Cannot invoke \"io.smallrye.context.SmallRyeContextManager.defaultThreadContext()\" because the return value of \"io.smallrye.context.SmallRyeContextManagerProvider.getManager()\" is null\r\n\tat io.smallrye.context.SmallRyeThreadContext.getCurrentThreadContextOrDefaultContexts(SmallRyeThreadContext.java:160)\r\n\tat io.smallrye.mutiny.context.DefaultContextPropagationInterceptor.getThreadContext(DefaultContextPropagationInterceptor.java:12)\r\n\tat io.smallrye.mutiny.context.BaseContextPropagationInterceptor.decorate(BaseContextPropagationInterceptor.java:24)\r\n\tat io.smallrye.mutiny.infrastructure.Infrastructure.decorate(Infrastructure.java:149)\r\n\tat io.smallrye.mutiny.groups.UniCreate.completionStage(UniCreate.java:140)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter.initiateSend(VertxGrpcExporter.java:112)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:402)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:397)\r\n\tat io.vertx.core.impl.future.FutureImpl$2.onFailure(FutureImpl.java:117)\r\n\tat io.vertx.core.impl.future.FutureImpl$ListenerArray.onFailure(FutureImpl.java:316)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.impl.future.Mapping.onFailure(Mapping.java:45)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.fail(HttpClientRequestBase.java:182)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.handleException(HttpClientRequestBase.java:177)\r\n\tat io.vertx.core.http.impl.HttpClientRequestImpl.handleException(HttpClientRequestImpl.java:90)\r\n\tat io.vertx.core.http.impl.Http2ClientConnection$StreamImpl.handleException(Http2ClientConnection.java:543)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:328)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:321)\r\n\tat io.vertx.core.http.impl.VertxHttp2Stream.onException(VertxHttp2Stream.java:96)\r\n\tat io.vertx.core.http.impl.Http2ConnectionBase.onStreamClosed(Http2ConnectionBase.java:153)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler$1.onStreamClosed(VertxHttp2ConnectionHandler.java:93)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.notifyClosed(DefaultHttp2Connection.java:357)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.removeFromActiveStreams(DefaultHttp2Connection.java:1036)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.deactivate(DefaultHttp2Connection.java:992)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$DefaultStream.close(DefaultHttp2Connection.java:517)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.close(DefaultHttp2Connection.java:153)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$BaseDecoder.channelInactive(Http2ConnectionHandler.java:217)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.channelInactive(Http2ConnectionHandler.java:432)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler.channelInactive(VertxHttp2ConnectionHandler.java:186)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81)\r\n\tat io.netty.handler.timeout.IdleStateHandler.channelInactive(IdleStateHandler.java:280)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1405)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:301)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:901)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$7.run(AbstractChannel.java:813)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n\r\n2024-06-21 11:35:43,235 ERROR [io.qua.ver.cor.run.VertxCoreRecorder] (vert.x-eventloop-thread-2) Uncaught exception received by Vert.x [Error Occurred After Shutdown]: java.lang.NullPointerException: Cannot invoke \"io.smallrye.context.SmallRyeContextManager.defaultThreadContext()\" because the return value of \"io.smallrye.context.SmallRyeContextManagerProvider.getManager()\" is null\r\n\tat io.smallrye.context.SmallRyeThreadContext.getCurrentThreadContextOrDefaultContexts(SmallRyeThreadContext.java:160)\r\n\tat io.smallrye.mutiny.context.DefaultContextPropagationInterceptor.getThreadContext(DefaultContextPropagationInterceptor.java:12)\r\n\tat io.smallrye.mutiny.context.BaseContextPropagationInterceptor.decorate(BaseContextPropagationInterceptor.java:24)\r\n\tat io.smallrye.mutiny.infrastructure.Infrastructure.decorate(Infrastructure.java:149)\r\n\tat io.smallrye.mutiny.groups.UniCreate.completionStage(UniCreate.java:140)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter.initiateSend(VertxGrpcExporter.java:112)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:402)\r\n\tat io.quarkus.opentelemetry.runtime.exporter.otlp.VertxGrpcExporter$ClientRequestOnSuccessHandler$2.handle(VertxGrpcExporter.java:397)\r\n\tat io.vertx.core.impl.future.FutureImpl$2.onFailure(FutureImpl.java:117)\r\n\tat io.vertx.core.impl.future.FutureImpl$ListenerArray.onFailure(FutureImpl.java:316)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.impl.future.Mapping.onFailure(Mapping.java:45)\r\n\tat io.vertx.core.impl.future.FutureBase.emitFailure(FutureBase.java:81)\r\n\tat io.vertx.core.impl.future.FutureImpl.tryFail(FutureImpl.java:278)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.fail(HttpClientRequestBase.java:182)\r\n\tat io.vertx.core.http.impl.HttpClientRequestBase.handleException(HttpClientRequestBase.java:177)\r\n\tat io.vertx.core.http.impl.HttpClientRequestImpl.handleException(HttpClientRequestImpl.java:90)\r\n\tat io.vertx.core.http.impl.Http2ClientConnection$StreamImpl.handleException(Http2ClientConnection.java:543)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:328)\r\n\tat io.vertx.core.impl.ContextImpl.emit(ContextImpl.java:321)\r\n\tat io.vertx.core.http.impl.VertxHttp2Stream.onException(VertxHttp2Stream.java:96)\r\n\tat io.vertx.core.http.impl.Http2ConnectionBase.onStreamClosed(Http2ConnectionBase.java:153)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler$1.onStreamClosed(VertxHttp2ConnectionHandler.java:93)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.notifyClosed(DefaultHttp2Connection.java:357)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.removeFromActiveStreams(DefaultHttp2Connection.java:1036)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.deactivate(DefaultHttp2Connection.java:992)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection$DefaultStream.close(DefaultHttp2Connection.java:517)\r\n\tat io.netty.handler.codec.http2.DefaultHttp2Connection.close(DefaultHttp2Connection.java:153)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler$BaseDecoder.channelInactive(Http2ConnectionHandler.java:217)\r\n\tat io.netty.handler.codec.http2.Http2ConnectionHandler.channelInactive(Http2ConnectionHandler.java:432)\r\n\tat io.vertx.core.http.impl.VertxHttp2ConnectionHandler.channelInactive(VertxHttp2ConnectionHandler.java:186)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81)\r\n\tat io.netty.handler.timeout.IdleStateHandler.channelInactive(IdleStateHandler.java:280)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1405)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:301)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:901)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$7.run(AbstractChannel.java:813)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\r\n```\r\n\r\n### How to Reproduce?\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. `git clone git@github.com:michalvavrik/quarkus-startstop.git -b feature/make-app-more-real-latest-repro`\r\n2. `cd quarkus-startstop`\r\n3. `mvn clean verify -pl testsuite -Dtest=StartStopTest#fullMicroProfileJVM -Dstart-stop.iterations=25`\r\n\r\nWith branch `feature/make-app-more-real-latest-repro` I reproduced it only once, however I consider it important as there, the use case is very simple, it's just a gRPC server that inspect exported traces. No magic.\r\n\r\nUPDATE: I already managed to reproduce it few times on  the `feature/make-app-more-real-latest-repro` branch.\r\n\r\nI also have a branch where at one point, I reproduced it almost every single time, try `git checkout feature/make-app-real-repro`. In this branch, there is more noise that is unnecessary for my tests.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nFedora 38\r\n\r\n### Output of `java -version`\r\n\r\nOpenJDK 21\r\n\r\n### Quarkus version or git rev\r\n\r\n999-SNAPSHOT\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.9.4\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/41351/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
