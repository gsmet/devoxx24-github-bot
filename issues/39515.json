{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/39515",
  "id": 2191605993,
  "node_id": "I_kwDOCFbutM6CoUDp",
  "number": 39515,
  "title": "Programmatic Cache API does not preserve Vertx Duplicate Context",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1320737519,
      "node_id": "MDU6TGFiZWwxMzIwNzM3NTE5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/vertx",
      "name": "area/vertx",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1808747697,
      "node_id": "MDU6TGFiZWwxODA4NzQ3Njk3",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/cache",
      "name": "area/cache",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/334",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334/labels",
    "id": 11163455,
    "node_id": "MI_kwDOCFbutM4Aqlc_",
    "number": 334,
    "title": "3.8.6",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 117,
    "state": "closed",
    "created_at": "2024-06-10T07:54:20Z",
    "updated_at": "2024-08-28T09:33:53Z",
    "due_on": null,
    "closed_at": "2024-08-28T09:33:53Z"
  },
  "comments": 5,
  "created_at": "2024-03-18T09:04:00Z",
  "updated_at": "2024-08-14T12:37:46Z",
  "closed_at": "2024-07-05T19:04:57Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nWe noticed that using the programmatic cache API via `cache.getAsync()` leads to the Vertx duplicate context being lost. This can lead to undesired behavior, especially when relying on Hibernate Reactive which stores its session in the context. In our application, we frequently saw the exception `java.lang.IllegalStateException: Illegal pop() with non-matching JdbcValuesSourceProcessingState`, but of course this will depend on the specific application.\n\n### Expected behavior\n\nThe context should be preserved.\n\n### Actual behavior\n\nThe context is lost, leading to problems for applications or modules that rely on the context, e.g. Hibernate Reactive.\n\n### How to Reproduce?\n\nhttps://github.com/markusdlugi/cache-context-reproducer/tree/master\r\n\r\n1. Run the `ReproducerTest` and observe that the test fails\r\n2. Remove comment in line 68 in `GreetingResource` and observe that the test now passes\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\nopenjdk version \"21.0.2\" 2024-01-16 LTS\n\n### Quarkus version or git rev\n\n3.8.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.6 (bc0240f3c744dd6b6ec2920b3cd08dcc295161ae)\n\n### Additional information\n\nA similar bug has already been reported and fixed for the annotation-based cache (#37078), so most likely the same treatment is necessary for the programmatic API.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/39515/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
