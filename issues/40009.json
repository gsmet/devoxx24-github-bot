{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/40009",
  "id": 2237143632,
  "node_id": "I_kwDOCFbutM6FWBpQ",
  "number": 40009,
  "title": "Duplicated logs with Elastic APM Agent - Quarkus wrongly importing log4j2 configuration from agent",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283428650,
      "node_id": "MDU6TGFiZWwxMjgzNDI4NjUw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/logging",
      "name": "area/logging",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1341157944,
      "node_id": "MDU6TGFiZWwxMzQxMTU3OTQ0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/triage/upstream",
      "name": "triage/upstream",
      "color": "7db4d8",
      "default": false,
      "description": "Used for issues which are caused by issues in upstream projects/dependency"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/334",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/334/labels",
    "id": 11163455,
    "node_id": "MI_kwDOCFbutM4Aqlc_",
    "number": 334,
    "title": "3.8.6",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 117,
    "state": "closed",
    "created_at": "2024-06-10T07:54:20Z",
    "updated_at": "2024-08-28T09:33:53Z",
    "due_on": null,
    "closed_at": "2024-08-28T09:33:53Z"
  },
  "comments": 5,
  "created_at": "2024-04-11T08:00:27Z",
  "updated_at": "2024-08-07T12:25:07Z",
  "closed_at": "2024-05-02T16:52:38Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nUsing any APM agent starting in version 1.30.0 will make Quarkus to duplicate all its logs. Opened a jira in Elastic and they found the  agent modification that started the behaviour but explain that it's Quarkus responsability to not add any log config from agent to main app:\r\nhttps://github.com/elastic/apm-agent-java/issues/3563\r\n\r\n> My hypothesis of what's happening here is that quarkus wrongly picks up the log4j2 configuration used by the agent internally. The agent runs in its own classloader with it's own isolated copy of log4j2 and an isolated configuration file.\r\n> Quarkus seems to somehow use the thread context-classloaders to pick up logging configurations. It even does so wrongly for elastic apm agent internal threads, which should be none of its business.\r\n> \r\n> The problem doesn't occur anymore if we don't set the thread context classloaders (you can test with https://github.com/elastic/apm-agent-java/pull/3575). However, this is nothing we will change in our agent because we set the context classloader for a reason.\r\n> \r\n> Instead I'd recommend you to open an issue at the Quarkus repo: Quarkus shouldn't care about context-classloaders and their log4j2-configs for javaagents.\r\n\r\n\r\nMaybe related to:\r\nhttps://github.com/quarkusio/quarkus/issues/7640\r\nhttps://github.com/quarkusio/quarkus/issues/2152\n\n### Expected behavior\n\nNormal both quarkus app and agent logs\n\n### Actual behavior\n\nAll app logs get duplicated, second one with different format.\n\n### How to Reproduce?\n\nExplained here:\r\nhttps://github.com/elastic/apm-agent-java/issues/3563\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\n_No response_\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/40009/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
