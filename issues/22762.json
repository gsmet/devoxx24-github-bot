{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/22762",
  "id": 1097663587,
  "node_id": "I_kwDOCFbutM5BbQRj",
  "number": 22762,
  "title": "Server Sent Events delaying 200 response",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1273042002,
      "node_id": "MDU6TGFiZWwxMjczMDQyMDAy",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/reactive",
      "name": "area/reactive",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 2552031458,
      "node_id": "MDU6TGFiZWwyNTUyMDMxNDU4",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest",
      "name": "area/rest",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 3748075115,
      "node_id": "LA_kwDOCFbutM7fZxZr",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/triage/blocking-resteasy-reactive-move",
      "name": "triage/blocking-resteasy-reactive-move",
      "color": "f9d0c4",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/175",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/175/labels",
    "id": 7698730,
    "node_id": "MI_kwDOCFbutM4AdXkq",
    "number": 175,
    "title": "2.7.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 159,
    "state": "closed",
    "created_at": "2022-02-21T12:59:08Z",
    "updated_at": "2022-05-12T16:40:04Z",
    "due_on": null,
    "closed_at": "2022-02-22T17:21:05Z"
  },
  "comments": 29,
  "created_at": "2022-01-10T09:43:37Z",
  "updated_at": "2022-04-04T06:13:27Z",
  "closed_at": "2022-02-21T18:51:45Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nI am on 2.6.1.Final. I have an endpoint that is an SSE endpoint. The status code is only returned after the first element is produced.\r\n\r\nThis was not the case in 1.x and can lead to timeouts on clients.\n\n### Expected behavior\n\nI would expect a 200 to be returned immediately (provided everything worked as expected).\n\n### Actual behavior\n\nThe status code, headers, etc. is not returned until the moment the first item is produced.\n\n### How to Reproduce?\n\n[getting-started.zip](https://github.com/quarkusio/quarkus/files/7837816/getting-started.zip)\r\n\n\n### Output of `uname -a` or `ver`\n\nLinux jose-buguroo 5.11.0-41-generic #45-Ubuntu SMP Fri Nov 5 11:37:01 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk version \"14.0.2\" 2020-07-14 OpenJDK Runtime Environment (build 14.0.2+12-46) OpenJDK 64-Bit Server VM (build 14.0.2+12-46, mixed mode, sharing)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.6.1.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f) Maven home: /home/jose/.m2/wrapper/dists/apache-maven-3.6.3-bin/1iopthnavndlasol9gbrbg6bf2/apache-maven-3.6.3 Java version: 14.0.2, vendor: Oracle Corporation, runtime: /home/jose/.sdkman/candidates/java/14.0.2-open Default locale: en_US, platform encoding: UTF-8 OS name: \"linux\", version: \"5.11.0-41-generic\", arch: \"amd64\", family: \"unix\"\n\n### Additional information\n\nFrom what I see `SseUtil.send` is producing the response the first time an element is produced. Therefore, until the first element is generated, no call to it happens and no response is flushed. I see this could have to do with `PublisherResponseHandler` suspending the context. I wonder if an option could be to have that class handle SSE slightly different and generate a status code.\r\n\r\nI see that adding:\r\n```\r\nrequestContext.serverResponse().setStatusCode(200)\r\nrequestContext.serverResponse().setChunked(true)\r\nrequestContext.serverResponse().write(new byte[]{})\r\n```\r\n\r\nto PublisherResponseHandler works as expected (i.e. we get the status code, headers, etc. and then the events get produced as they come). Any reason you can think of not to do that?",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762/reactions",
    "total_count": 2,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/22762/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
