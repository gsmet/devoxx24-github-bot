{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/21349",
  "id": 1050081458,
  "node_id": "I_kwDOCFbutM4-lviy",
  "number": 21349,
  "title": "Logs spanning several lines end up as separate log events on AWS using quarkus-amazon-lambda",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1283428650,
      "node_id": "MDU6TGFiZWwxMjgzNDI4NjUw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/logging",
      "name": "area/logging",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1326073020,
      "node_id": "MDU6TGFiZWwxMzI2MDczMDIw",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/amazon-lambda",
      "name": "area/amazon-lambda",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "milestone": null,
  "comments": 3,
  "created_at": "2021-11-10T17:00:10Z",
  "updated_at": "2023-05-11T17:00:52Z",
  "closed_at": null,
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nUsing the `quarkus-amazon-lambda` extension to deploy Quarkus functions leads to log entries containing newlines spanning several log events in CloudWatch logs, as the extension relies on the console output to be picked up by the CloudWatch service and does not send CloudWatch events itself. This is especially annoying for stack traces or formatted JSON output.\r\n \r\n```\r\nString event = \"\"\"\r\n{\r\n  \"foo\": \"bar\"\r\n}\r\n\"\"\";\r\nlog.info(\"Event:%n{}, event);\r\n```\r\nConsole:\r\n```\r\n2021-11-10 15:19:08,286 INFO [com.gin.Function] (Lambda Thread (NORMAL)) Event: \r\n{\r\n  \"foo\": \"bar\"\r\n}\r\n```\r\nCloudWatch:\r\n```\r\n2021-11-10 15:19:08,286 INFO [com.gin.Function] (Lambda Thread (NORMAL)) Event: \r\n```\r\n```\r\n{\r\n```\r\n```\r\n  \"foo\": \"bar\"\r\n```\r\n```\r\n}\r\n```\r\n\r\n### Expected behavior\r\n\r\nOne Cloudwatch Logs log event created per logger call issued in quarkus code.\r\n\r\n### Actual behavior\r\n\r\nOne CloudWatch Logs log event created per newline encountered in logger calls issued in Quarkus code.\r\n\r\n### How to Reproduce?\r\n\r\nIt can be reproduced by adding the example above to the default code generated by the `quarkus-amazon-lambda` extension.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\n_No response_\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.4.1\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\nIt might suffice to make the built-in [jboss logging filtering capabilities][1] available in quarkus, as a [workaround may just be to substitute all newlines with carriage returns][2], i.e `quarkus.log.filter.\"filters\".substitute-all=\\n, \\r` (or maybe `quarkus.log.console.filter-spec=substituteAll(\"\\n\",\"\\r\")` to align more to actual jboss logging?). This could then be a configuration added by default by the `quarkus-amazon-lambda` extension.\r\n\r\n[1]: https://docs.jboss.org/author/display/AS72/Logging%20Configuration.html#53117109_LoggingConfiguration-FilterExpressions\r\n[2]: https://github.com/symphoniacloud/lambda-monitoring/issues/4",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/21349/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
