{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36055",
  "id": 1906317723,
  "node_id": "I_kwDOCFbutM5xoBmb",
  "number": 36055,
  "title": "quarkus is not compatible with graalvm 21",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2497075451,
      "node_id": "MDU6TGFiZWwyNDk3MDc1NDUx",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image",
      "name": "area/native-image",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": null,
  "comments": 5,
  "created_at": "2023-09-21T07:37:24Z",
  "updated_at": "2023-09-25T03:12:14Z",
  "closed_at": "2023-09-25T03:05:26Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nOracle released Java 21 and also GraalVM 21 on 2023-09-19, and I switch my app jdk to Oracle GraalVM 21 to do some native-image test.\r\n\r\nbefore I turned to GraalVM 21, I'm with GraalVM 17.0.8+9.1 (build 17.0.8+9-LTS-jvmci-23.0-b14) and everything is right in X86 (ubuntu 2210) and arm (ubuntu 1804 in Qemu) both.\r\n\r\nafter switched, JVM version package goes well. \r\n\r\nthe Native image in X86,compiler complaint the following message:\r\n\r\n``` \r\njava.lang.IllegalAccessError: class io.quarkus.runner.Feature (in unnamed module @0x6cf0a747) cannot access class org.graalvm.nativeimage.impl.RuntimeClassInitializationSupport (in module org.graalvm.nativeimage) because module org.graalvm.nativeimage does not export org.graalvm.nativeimage.impl to unnamed module @0x6cf0a747\r\n```\r\n\r\n**but it do not fail the compile process, and the native-image runner goes well (likely)**\r\n\r\n\r\n\r\nWhen I try to make the native image in ARM, compiler failed  at the last step **\"creating image\"** with message\"\r\n\r\n```\r\njava.lang.RuntimeException: There was an error linking the native image: Linker command exited with 1\r\n\r\nLinker command executed:\r\n/usr/bin/gcc -z noexecstack -Wl,--gc-sections -Wl,--version-script,/tmp/SVM-13567779887183742065/exported_symbols.list -Wl,-x -o /data/cast503/develop/develop/sat-scheduler-edge/edge-command/target/edge-command-1.0.0-SNAPSHOT-native-image-source-jar/edge-command-1.0.0-SNAPSHOT-runner edge-command-1.0.0-SNAPSHOT-runner.o /root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/liblibchelper.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libnet.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libextnet.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libnio.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libmanagement_ext.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libjava.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libzip.a /root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/libjvm.a -Wl,--export-dynamic -v -L/tmp/SVM-13567779887183742065 -L/root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc -L/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64 -lg1gc-cr -ldl -lm -lpthread -lstdc++ -lz -ldl -lpthread -lrt -no-pie\r\n\r\nLinker command output:\r\nUsing built-in specs.\r\nCOLLECT_GCC=/usr/bin/gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/aarch64-linux-gnu/7/lto-wrapper\r\nTarget: aarch64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 7.5.0-3ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=aarch64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-libquadmath --disable-libquadmath-support --enable-plugin --enable-default-pie --with-system-zlib --enable-multiarch --enable-fix-cortex-a53-843419 --disable-werror --enable-checking=release --build=aarch64-linux-gnu --host=aarch64-linux-gnu --target=aarch64-linux-gnu\r\nThread model: posix\r\ngcc version 7.5.0 (Ubuntu/Linaro 7.5.0-3ubuntu1~18.04) \r\nCOMPILER_PATH=/usr/lib/gcc/aarch64-linux-gnu/7/:/usr/lib/gcc/aarch64-linux-gnu/7/:/usr/lib/gcc/aarch64-linux-gnu/:/usr/lib/gcc/aarch64-linux-gnu/7/:/usr/lib/gcc/aarch64-linux-gnu/\r\nLIBRARY_PATH=/usr/lib/gcc/aarch64-linux-gnu/7/:/usr/lib/gcc/aarch64-linux-gnu/7/../../../aarch64-linux-gnu/:/usr/lib/gcc/aarch64-linux-gnu/7/../../../../lib/:/lib/aarch64-linux-gnu/:/lib/../lib/:/usr/lib/aarch64-linux-gnu/:/usr/lib/../lib/:/usr/lib/gcc/aarch64-linux-gnu/7/../../../:/lib/:/usr/lib/\r\nCOLLECT_GCC_OPTIONS='-z' 'noexecstack' '-o' '/data/cast503/develop/develop/sat-scheduler-edge/edge-command/target/edge-command-1.0.0-SNAPSHOT-native-image-source-jar/edge-command-1.0.0-SNAPSHOT-runner' '-v' '-L/tmp/SVM-13567779887183742065' '-L/root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc' '-L/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64' '-no-pie' '-mlittle-endian' '-mabi=lp64'\r\n /usr/lib/gcc/aarch64-linux-gnu/7/collect2 -plugin /usr/lib/gcc/aarch64-linux-gnu/7/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/7/lto-wrapper -plugin-opt=-fresolution=/tmp/ccRS9L0e.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -z relro -o /data/cast503/develop/develop/sat-scheduler-edge/edge-command/target/edge-command-1.0.0-SNAPSHOT-native-image-source-jar/edge-command-1.0.0-SNAPSHOT-runner -z noexecstack /usr/lib/gcc/aarch64-linux-gnu/7/../../../aarch64-linux-gnu/crt1.o /usr/lib/gcc/aarch64-linux-gnu/7/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/7/crtbegin.o -L/tmp/SVM-13567779887183742065 -L/root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc -L/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64 -L/usr/lib/gcc/aarch64-linux-gnu/7 -L/usr/lib/gcc/aarch64-linux-gnu/7/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/7/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/7/../../.. --gc-sections --version-script /tmp/SVM-13567779887183742065/exported_symbols.list -x edge-command-1.0.0-SNAPSHOT-runner.o /root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/liblibchelper.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libnet.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libextnet.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libnio.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libmanagement_ext.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libjava.a /root/graalvm-jdk-21+35.1/lib/static/linux-aarch64/glibc/libzip.a /root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/libjvm.a --export-dynamic -lg1gc-cr -ldl -lm -lpthread -lstdc++ -lz -ldl -lpthread -lrt -lgcc --push-state --as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state /usr/lib/gcc/aarch64-linux-gnu/7/crtend.o /usr/lib/gcc/aarch64-linux-gnu/7/../../../aarch64-linux-gnu/crtn.o\r\n/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/liblibchelper.a(cSunMiscSignal.o): In function `cSunMiscSignal_atomicIncrement':\r\ngraal/substratevm/mxbuild/linux-aarch64/com.oracle.svm.native.libchelper/aarch64/graal/substratevm/src/com.oracle.svm.native.libchelper/src/cSunMiscSignal.c:247: undefined reference to `__aarch64_ldadd8_acq_rel'\r\n/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/liblibchelper.a(cSunMiscSignal.o): In function `cSunMiscSignal_atomicCompareAndSwap_int':\r\ngraal/substratevm/mxbuild/linux-aarch64/com.oracle.svm.native.libchelper/aarch64/graal/substratevm/src/com.oracle.svm.native.libchelper/src/cSunMiscSignal.c:273: undefined reference to `__aarch64_cas4_acq_rel'\r\n/root/graalvm-jdk-21+35.1/lib/svm/clibraries/linux-aarch64/liblibchelper.a(cSunMiscSignal.o): In function `cSunMiscSignal_atomicCompareAndSwap_long':\r\ngraal/substratevm/mxbuild/linux-aarch64/com.oracle.svm.native.libchelper/aarch64/graal/substratevm/src/com.oracle.svm.native.libchelper/src/cSunMiscSignal.c:278: undefined reference to `__aarch64_cas8_acq_rel'\r\ncollect2: error: ld returned 1 exit status\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageViaCC.handleLinkerFailure(NativeImageViaCC.java:202)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageViaCC.runLinkerCommand(NativeImageViaCC.java:152)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageViaCC.write(NativeImageViaCC.java:118)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:742)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:551)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:538)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:720)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.start(NativeImageGeneratorRunner.java:142)\r\n\tat org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:97)\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\ncompitable with graalvm 21\r\n\r\nfinish the build of  native-image runner in x86 and arm, peaceful and quietly,just like GraalVM 17.\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Actual behavior\r\n\r\ngraalvm 21 \r\n\r\n- native image in x86 successed with warn, and goes well(likely)\r\n\r\n- native image in arm failed at last step \"creating image\".\r\n\r\n\r\n\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nx86\r\n6.2.0-33-generic #33~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Thu Sep  7 10:33:52 UTC 2 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\narm by qemu\r\nLinux ubuntu 4.15.0-213-generic #224-Ubuntu SMP Mon Jun 19 13:29:44 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux\r\n\r\n\r\n\r\n### Output of `java -version`\r\n\r\nx86\r\nJava(TM) SE Runtime Environment Oracle GraalVM 21+35.1 (build 21+35-jvmci-23.1-b15)\r\n\r\n\r\narm by qemu\r\nJava(TM) SE Runtime Environment Oracle GraalVM 21+35.1 (build 21+35-jvmci-23.1-b15)\r\n\r\n\r\n\r\n### Quarkus version or git rev\r\nPowered by Quarkus 3.3.3\r\n\r\n\r\n_No response_\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\nApache Maven 3.8.7\r\n\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36055/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
