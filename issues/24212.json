{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/24212",
  "id": 1164270549,
  "node_id": "I_kwDOCFbutM5FZVvV",
  "number": 24212,
  "title": "@Scheduled method invoked both on original bean and @Alternative bean",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1321590926,
      "node_id": "MDU6TGFiZWwxMzIxNTkwOTI2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/scheduler",
      "name": "area/scheduler",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/171",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/171",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/171/labels",
    "id": 7587967,
    "node_id": "MI_kwDOCFbutM4Ac8h_",
    "number": 171,
    "title": "2.8.0.CR1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 371,
    "state": "closed",
    "created_at": "2022-01-19T09:05:12Z",
    "updated_at": "2023-02-21T15:11:02Z",
    "due_on": null,
    "closed_at": "2022-03-23T12:37:30Z"
  },
  "comments": 9,
  "created_at": "2022-03-09T18:04:37Z",
  "updated_at": "2022-03-11T15:58:48Z",
  "closed_at": "2022-03-11T15:58:48Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nIf `@Scheduled` is applied to a function and an `@Alternative` subclass is created for the bean containing the annotated method, the method is invoked twice by the scheduler, once for each bean. This means that when the alternative bean is being used the scheduled method is invoked twice, which is unexpected.\r\n\r\nA reproducer is attached with the minimal changes necessary to show this, applied on the scheduler-quickstart project.\r\n\r\nOur use case is we are creating a bean like `CounterBean` in the attached example that lives inside a library.  This `CounterBean` could be subclassed and customized by providing an alternative like `AlternativeCounterBean` in different projects that use the library, and if that is done at the moment we find multiple invocations of the scheduled method, one immediately after the other.\n\n### Expected behavior\n\nOnly one invocation of the `@Scheduled` method should be performed on the alternative bean; the original bean's invocation should not be performed.  In the given example, only `AlternativeCounterBean#increment()` should be invoked by the scheduler.\n\n### Actual behavior\n\nAs can be seen in the log output, both the `CounterBean#increment()` and the `AlternativeCounterBean#increment()` are invoked by the scheduler.\r\n\r\n> [INFO] Running org.acme.scheduler.CountResourceTest\r\n2022-03-09 12:40:11,111 INFO  [org.jbo.threads] (main) JBoss Threads version 3.4.2.Final\r\n2022-03-09 12:40:12,757 INFO  [io.quarkus] (main) Quarkus 2.7.3.Final on JVM started in 2.108s. Listening on: http://localhost:8081\r\n2022-03-09 12:40:12,758 INFO  [io.quarkus] (main) Profile test activated. \r\n2022-03-09 12:40:12,758 INFO  [io.quarkus] (main) Installed features: [cdi, resteasy, scheduler, smallrye-context-propagation, vertx]\r\n2022-03-09 12:40:13,011 INFO  [org.acm.sch.CounterBean] (executor-thread-1) Invoked from: org.acme.scheduler.CounterBean\r\n2022-03-09 12:40:13,011 INFO  [org.acm.sch.CounterBean] (executor-thread-0) Invoked from: org.acme.scheduler.AlternativeCounterBean\r\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 6.313 s - in org.acme.scheduler.CountResourceTest\r\n2022-03-09 12:40:13,968 INFO  [io.quarkus] (main) Quarkus stopped in 0.048s\n\n### How to Reproduce?\n\n[scheduler-quickstart-reproducer.zip](https://github.com/quarkusio/quarkus/files/8216991/scheduler-quickstart-reproducer.zip)\r\n\n\n### Output of `uname -a` or `ver`\n\nMicrosoft Windows [Version 10.0.19042.1526]\n\n### Output of `java -version`\n\nopenjdk version \"11.0.9.1\" 2020-11-04 LTS OpenJDK Runtime Environment Corretto-11.0.9.12.1 (build 11.0.9.1+12-LTS) OpenJDK 64-Bit Server VM Corretto-11.0.9.12.1 (build 11.0.9.1+12-LTS, mixed mode)\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n2.7.3.Final\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.4 (9b656c72d54e5bacbed989b64718c159fe39b537) Maven home: C:\\ProgramData\\Chocolatey\\lib\\maven\\apache-maven-3.8.4 Java version: 11.0.9.1, vendor: Amazon.com Inc., runtime: C:\\Program Files\\Amazon Corretto\\jdk11.0.9_12 Default locale: en_US, platform encoding: Cp1252 OS name: \"windows 10\", version: \"10.0\", arch: \"amd64\", family: \"windows\"\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/24212/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
