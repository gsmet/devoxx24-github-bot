{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/20896",
  "id": 1031252742,
  "node_id": "I_kwDOCFbutM49d6sG",
  "number": 20896,
  "title": "ClassNotFoundException when injecting REST client in native",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1287515315,
      "node_id": "MDU6TGFiZWwxMjg3NTE1MzE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin",
      "name": "area/kotlin",
      "color": "0366d6",
      "default": false,
      "description": ""
    },
    {
      "id": 1326067509,
      "node_id": "MDU6TGFiZWwxMzI2MDY3NTA5",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/rest-client",
      "name": "area/rest-client",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/157",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/157",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/157/labels",
    "id": 7320620,
    "node_id": "MI_kwDOCFbutM4Ab7Qs",
    "number": 157,
    "title": "2.4.2.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 40,
    "state": "closed",
    "created_at": "2021-11-03T11:17:28Z",
    "updated_at": "2021-11-25T07:41:47Z",
    "due_on": null,
    "closed_at": "2021-11-12T08:45:43Z"
  },
  "comments": 16,
  "created_at": "2021-10-20T10:39:30Z",
  "updated_at": "2021-11-23T02:03:56Z",
  "closed_at": "2021-11-04T20:14:27Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWhen I inject the Resteasy REST client a ClassNotFoundException occurs. But this only happens in a native app.\r\n\r\n### Expected behavior\r\n\r\n_No response_\r\n\r\n### Actual behavior\r\n\r\nThe injection fails with the following exception:\r\n\r\n```\r\norg.jboss.resteasy.spi.UnhandledException: java.lang.RuntimeException: Error injecting me.package.backend.clients.ChVatClient me.package.backend.services.VatService.chVatClient\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleApplicationException(ExceptionHandler.java:106)\r\n        at org.jboss.resteasy.core.ExceptionHandler.handleException(ExceptionHandler.java:372)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.writeException(SynchronousDispatcher.java:218)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:519)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$invoke$4(SynchronousDispatcher.java:261)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.lambda$preprocess$0(SynchronousDispatcher.java:161)\r\n        at org.jboss.resteasy.core.interception.jaxrs.PreMatchContainerRequestContext.filter(PreMatchContainerRequestContext.java:364)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.preprocess(SynchronousDispatcher.java:164)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:247)\r\n        at io.quarkus.resteasy.runtime.standalone.RequestDispatcher.service(RequestDispatcher.java:73)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.dispatch(VertxRequestHandler.java:135)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.handle(VertxRequestHandler.java:81)\r\n        at io.quarkus.resteasy.runtime.standalone.VertxRequestHandler.handle(VertxRequestHandler.java:41)\r\n        at io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1127)\r\n        at io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:151)\r\n        at io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:133)\r\n        at io.quarkus.vertx.http.runtime.StaticResourcesRecorder.lambda$start$1(StaticResourcesRecorder.java:67)\r\n        at io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1127)\r\n        at io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:151)\r\n        at io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:133)\r\n        at io.quarkus.vertx.http.runtime.VertxHttpRecorder$5.handle(VertxHttpRecorder.java:351)\r\n        at io.quarkus.vertx.http.runtime.VertxHttpRecorder$5.handle(VertxHttpRecorder.java:329)\r\n        at io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1127)\r\n        at io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:151)\r\n        at io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:133)\r\n        at io.quarkus.vertx.http.runtime.security.HttpAuthorizer.doPermissionCheck(HttpAuthorizer.java:121)\r\n        at io.quarkus.vertx.http.runtime.security.HttpAuthorizer.checkPermission(HttpAuthorizer.java:104)\r\n        at io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$3.handle(HttpSecurityRecorder.java:218)\r\n        at io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$3.handle(HttpSecurityRecorder.java:210)\r\n        at io.vertx.ext.web.impl.RouteState.handleContext(RouteState.java:1127)\r\n        at io.vertx.ext.web.impl.RoutingContextImplBase.iterateNext(RoutingContextImplBase.java:151)\r\n        at io.vertx.ext.web.impl.RoutingContextImpl.next(RoutingContextImpl.java:133)\r\n        at io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$2$2$1.onItem(HttpSecurityRecorder.java:128)\r\n        at io.quarkus.vertx.http.runtime.security.HttpSecurityRecorder$2$2$1.onItem(HttpSecurityRecorder.java:118)\r\n        at io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:60)\r\n        at io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:60)\r\n        at io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.forward(UniCreateFromKnownItem.java:38)\r\n        at io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem$KnownItemSubscription.access$100(UniCreateFromKnownItem.java:26)\r\n        at io.smallrye.mutiny.operators.uni.builders.UniCreateFromKnownItem.subscribe(UniCreateFromKnownItem.java:23)\r\n        at io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\r\n        at io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.performInnerSubscription(UniOnItemTransformToUni.java:81)\r\n        at io.smallrye.mutiny.operators.uni.UniOnItemTransformToUni$UniOnItemTransformToUniProcessor.onItem(UniOnItemTransformToUni.java:57)\r\n        at io.smallrye.mutiny.operators.uni.builders.DefaultUniEmitter.complete(DefaultUniEmitter.java:36)\r\n        at io.quarkus.security.runtime.QuarkusIdentityProviderManagerImpl$1$1$1$1.run(QuarkusIdentityProviderManagerImpl.java:58)\r\n        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$13.runWith(VertxCoreRecorder.java:543)\r\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2449)\r\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1478)\r\n        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:833)\r\n        at com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:596)\r\n        at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:192)\r\nCaused by: java.lang.RuntimeException: Error injecting me.package.backend.clients.ChVatClient me.package.backend.services.VatService.chVatClient\r\n        at me.package.backend.services.VatService_Bean.create(VatService_Bean.zig:423)\r\n        at me.package.backend.services.VatService_Bean.create(VatService_Bean.zig:618)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:96)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:29)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:26)\r\n        at io.quarkus.arc.impl.LazyValue.get(LazyValue.java:26)\r\n        at io.quarkus.arc.impl.ComputingCache.computeIfAbsent(ComputingCache.java:69)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:26)\r\n        at io.quarkus.arc.impl.ClientProxies.getApplicationScopedDelegate(ClientProxies.java:17)\r\n        at me.package.backend.services.VatService_ClientProxy.arc$delegate(VatService_ClientProxy.zig:67)\r\n        at me.package.backend.services.VatService_ClientProxy.get(VatService_ClientProxy.zig:188)\r\n        at me.package.backend.resources.VatResource.verify(VatResource.java:36)\r\n        at me.package.backend.resources.VatResource_Subclass.verify$$superforward1(VatResource_Subclass.zig:148)\r\n        at me.package.backend.resources.VatResource_Subclass$$function$$1.apply(VatResource_Subclass$$function$$1.zig:33)\r\n        at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:54)\r\n        at io.quarkus.security.runtime.interceptor.SecurityHandler.handle(SecurityHandler.java:21)\r\n        at io.quarkus.security.runtime.interceptor.DenyAllInterceptor.intercept(DenyAllInterceptor.java:30)\r\n        at io.quarkus.security.runtime.interceptor.DenyAllInterceptor_Bean.intercept(DenyAllInterceptor_Bean.zig:378)\r\n        at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:41)\r\n        at io.quarkus.arc.impl.AroundInvokeInvocationContext.proceed(AroundInvokeInvocationContext.java:50)\r\n        at io.quarkus.security.runtime.interceptor.SecurityHandler.handle(SecurityHandler.java:24)\r\n        at io.quarkus.security.runtime.interceptor.PermitAllInterceptor.intercept(PermitAllInterceptor.java:23)\r\n        at io.quarkus.security.runtime.interceptor.PermitAllInterceptor_Bean.intercept(PermitAllInterceptor_Bean.zig:327)\r\n        at io.quarkus.arc.impl.InterceptorInvocation.invoke(InterceptorInvocation.java:41)\r\n        at io.quarkus.arc.impl.AroundInvokeInvocationContext.perform(AroundInvokeInvocationContext.java:41)\r\n        at io.quarkus.arc.impl.InvocationContexts.performAroundInvoke(InvocationContexts.java:32)\r\n        at me.package.backend.resources.VatResource_Subclass.verify(VatResource_Subclass.zig:212)\r\n        at me.package.backend.resources.VatResource_ClientProxy.verify(VatResource_ClientProxy.zig:103)\r\n        at java.lang.reflect.Method.invoke(Method.java:568)\r\n        at org.jboss.resteasy.core.MethodInjectorImpl.invoke(MethodInjectorImpl.java:170)\r\n        at org.jboss.resteasy.core.MethodInjectorImpl.invoke(MethodInjectorImpl.java:130)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.internalInvokeOnTarget(ResourceMethodInvoker.java:660)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.invokeOnTargetAfterFilter(ResourceMethodInvoker.java:524)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.lambda$invokeOnTarget$2(ResourceMethodInvoker.java:474)\r\n        at org.jboss.resteasy.core.interception.jaxrs.PreMatchContainerRequestContext.filter(PreMatchContainerRequestContext.java:364)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.invokeOnTarget(ResourceMethodInvoker.java:476)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:434)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:408)\r\n        at org.jboss.resteasy.core.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:69)\r\n        at org.jboss.resteasy.core.SynchronousDispatcher.invoke(SynchronousDispatcher.java:492)\r\n        ... 49 more\r\nCaused by: org.apache.commons.logging.LogConfigurationException: java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl (Caused by java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl)\r\n        at org.apache.commons.logging.LogFactory.createFactory(LogFactory.java:1158)\r\n        at org.apache.commons.logging.LogFactory$2.run(LogFactory.java:960)\r\n        at java.security.AccessController.doPrivileged(AccessController.java:87)\r\n        at org.apache.commons.logging.LogFactory.newFactory(LogFactory.java:957)\r\n        at org.apache.commons.logging.LogFactory.getFactory(LogFactory.java:624)\r\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:655)\r\n        at org.apache.http.conn.ssl.DefaultHostnameVerifier.<init>(DefaultHostnameVerifier.java:82)\r\n        at org.apache.http.conn.ssl.DefaultHostnameVerifier.<init>(DefaultHostnameVerifier.java:91)\r\n        at org.jboss.resteasy.client.jaxrs.engines.ClientHttpEngineBuilder43.build(ClientHttpEngineBuilder43.java:74)\r\n        at org.jboss.resteasy.client.jaxrs.internal.ResteasyClientBuilderImpl.build(ResteasyClientBuilderImpl.java:415)\r\n        at io.quarkus.restclient.runtime.QuarkusRestClientBuilder.build(QuarkusRestClientBuilder.java:332)\r\n        at io.quarkus.restclient.runtime.RestClientBase.create(RestClientBase.java:69)\r\n        at me.package.backend.clients.ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.create(ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.zig:189)\r\n        at me.package.backend.clients.ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.create(ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.zig:205)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:96)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:29)\r\n        at io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:26)\r\n        at io.quarkus.arc.impl.LazyValue.get(LazyValue.java:26)\r\n        at io.quarkus.arc.impl.ComputingCache.computeIfAbsent(ComputingCache.java:69)\r\n        at io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:26)\r\n        at me.package.backend.clients.ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.get(ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.zig:237)\r\n        at me.package.backend.clients.ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.get(ChVatClient_0a8d71f9d2df9a04b0757deaf2ed6aa0a03a5ff1_Synthetic_Bean.zig:253)\r\n        at me.package.backend.services.VatService_Bean.create(VatService_Bean.zig:406)\r\n        ... 88 more\r\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.logging.impl.LogFactoryImpl\r\n        at jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:53)\r\n        at jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:139)\r\n        at org.apache.commons.logging.LogFactory.createFactory(LogFactory.java:1020)\r\n        ... 110 more\r\n```\r\n\r\n### How to Reproduce?\r\n\r\n_No response_\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin Kernel Version 20.6.0\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"17.0.1\" 2021-10-19 OpenJDK Runtime Environment GraalVM CE 21.3.0 (build 17.0.1+12-jvmci-21.3-b05) OpenJDK 64-Bit Server VM GraalVM CE 21.3.0 (build 17.0.1+12-jvmci-21.3-b05, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n21.3\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n------------------------------------------------------------ Gradle 7.2 ------------------------------------------------------------  Build time:   2021-08-17 09:59:03 UTC Revision:     a773786b58bb28710e3dc96c4d1a7063628952ad  Kotlin:       1.5.21 Groovy:       3.0.8 Ant:          Apache Ant(TM) version 1.10.9 compiled on September 27 2020 JVM:          17.0.1 (GraalVM Community 17.0.1+12-jvmci-21.3-b05) OS:           Mac OS X 11.6 x86_64\r\n\r\n### Additional information\r\n\r\nThe error occurs since Quarkus 2.3.0.Final.\r\nI can also reproduce the error with Java 11 and GraalVM 21.2.",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/20896/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
