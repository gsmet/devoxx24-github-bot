{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/38616",
  "id": 2121330616,
  "node_id": "I_kwDOCFbutM5-cO-4",
  "number": 38616,
  "title": "AppCDS containerized generation runs with UID 1000 which can clash with an existing user with UID 1000 on the host",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/307",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/307",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/307/labels",
    "id": 10499697,
    "node_id": "MI_kwDOCFbutM4AoDZx",
    "number": 307,
    "title": "3.7.2",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 45,
    "state": "closed",
    "created_at": "2024-02-01T11:59:43Z",
    "updated_at": "2024-03-12T13:30:51Z",
    "due_on": null,
    "closed_at": "2024-02-08T11:30:05Z"
  },
  "comments": 6,
  "created_at": "2024-02-06T17:25:58Z",
  "updated_at": "2024-02-12T09:57:48Z",
  "closed_at": "2024-02-07T17:46:20Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nIn my current setup, when creating an AppCDS archive using the property `quarkus.package.create-appcds=true` and executing `mvn package -Dquarkus.container-image.build=true`, the user that is running the mvn command has a UID 1000 and GID 1000.\r\n\r\nTo create the appcds archive, the following command is run:\r\n`podman run -v /devfolder/target:/tmp/quarkus:z --user 1000:1000 -w /tmp/quarkus/quarkus-app --rm registry.access.redhat.com/ubi8/openjdk-21-runtime:1.18 java -XX:ArchiveClassesAtExit=app-cds.jsa -Dquarkus.appcds.generate=true -jar quarkus-run.jar`\r\n\r\nSince the /target folder has 755 permission octal and the user with UID 1000 that exists on the host does not exist in the `/etc/passwd` of the container that podman spawns, the container is unable to write the archive to the folder. The creation fails with the following error:\r\n\r\n`[9.824s][error  ][cds] Unable to create shared archive file app-cds.jsa: (Permission denied).`\r\n\r\nI was able to fix this by adding the argument argument `--userns=keep-id` to the `podman run` command. As you can see [here](https://docs.podman.io/en/v4.4/markdown/options/userns.container.html) this argument ensures that the current user in my host also exists in the `/etc/passwd` of the container. However, I didn't find any way to pass this command in the current AppCDS flow.\r\n\r\nAs I mentioned in #38020, albeit in a different context, I feel like the best solution here would be to allow the dev to add arguments or modify the command that gets called, since that fixes not just my issue but any other that may arise.\r\n\r\n### Expected behavior\r\n\r\n_No response_\r\n\r\n### Actual behavior\r\n\r\n_No response_\r\n\r\n### How to Reproduce?\r\n\r\n_No response_\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\nDarwin <computer_name> 23.2.0 Darwin Kernel Version 23.2.0: Wed Nov 15 21:53:18 PST 2023; root:xnu-10002.61.3~2/RELEASE_ARM64_T6000 arm64 arm Darwin\r\n\r\n### Output of `java -version`\r\n\r\nopenjdk version \"21.0.1\" 2023-10-17 OpenJDK Runtime Environment (build 21.0.1+12-29) OpenJDK 64-Bit Server VM (build 21.0.1+12-29, mixed mode, sharing)\r\n\r\n### Quarkus version or git rev\r\n\r\nQuarkus 3.7.1\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\nApache Maven 3.8.6\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/38616/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
