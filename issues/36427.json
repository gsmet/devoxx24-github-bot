{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/36427",
  "id": 1938717810,
  "node_id": "I_kwDOCFbutM5zjnxy",
  "number": 36427,
  "title": "Keycloak admin client fail with \"authHeader\" is null when using classic extensions",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 3289887215,
      "node_id": "MDU6TGFiZWwzMjg5ODg3MjE1",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/keycloak",
      "name": "area/keycloak",
      "color": "0366d6",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/312",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/312",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/312/labels",
    "id": 10606558,
    "node_id": "MI_kwDOCFbutM4Aodfe",
    "number": 312,
    "title": "3.8.1",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 44,
    "state": "closed",
    "created_at": "2024-02-26T16:57:35Z",
    "updated_at": "2024-02-28T11:29:26Z",
    "due_on": null,
    "closed_at": "2024-02-28T11:29:26Z"
  },
  "comments": 6,
  "created_at": "2023-10-11T20:54:51Z",
  "updated_at": "2024-02-26T17:00:32Z",
  "closed_at": "2024-02-21T06:58:33Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nHere is a previous issue which seems to be fixed and closed, could be related: https://github.com/quarkusio/quarkus/issues/30089.\r\n\r\nWhen I inject org.keycloak.admin.client.Keycloak and try to call some method (e.g. keycloak.serverInfo().getInfo()) it is giving me the following error:\r\n```\r\nCaused by: java.lang.NullPointerException: Cannot invoke \"String.startsWith(String)\" because \"authHeader\" is null\r\n        at org.keycloak.admin.client.resource.BearerAuthFilter.filter(BearerAuthFilter.java:53)\r\n        at org.jboss.resteasy.client.jaxrs.internal.ClientInvocation.filterRequest(ClientInvocation.java:644)\r\n```\r\n\r\nIt is only happening when using classic extensions, when using reactive extensions it is working fine.\r\nFor the test I'm using latest Quarkus (3.4.2) and latest LTS version (3.2.6.Final), with these extensions it is not working:\r\n```\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-resteasy</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-resteasy-jsonb</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-keycloak-admin-client</artifactId>\r\n</dependency>\r\n```\r\n\r\nBut if I use reactive extensions it is working fine:\r\n```\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-resteasy-reactive</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-resteasy-reactive-jsonb</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.quarkus</groupId>\r\n    <artifactId>quarkus-keycloak-admin-client-reactive</artifactId>\r\n</dependency>\r\n```\r\n\r\n### Expected behavior\r\n\r\nBehaviour should be the same as when using reactive extensions.\r\n\r\n### Actual behavior\r\n\r\nIt is throwing NPE error.\r\n\r\n### How to Reproduce?\r\n\r\n[code-with-quarkus.zip](https://github.com/quarkusio/quarkus/files/12874488/code-with-quarkus.zip)\r\n\r\nHere is a minimum reproduction case (freshly generated Quarkus project).\r\nIn pom there are classic extensions and commented out reactive extension.\r\nAlso in the application properties there are basic properties for keycloak admin client.\r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\njava version \"1.8.0_381\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_381-b09)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.381-b09, mixed mode)\r\n\r\nand\r\n\r\nopenjdk version \"17.0.8\" 2023-07-18\r\nOpenJDK Runtime Environment Temurin-17.0.8+7 (build 17.0.8+7)\r\nOpenJDK 64-Bit Server VM Temurin-17.0.8+7 (build 17.0.8+7, mixed mode, sharing)\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n3.4.2 and 3.2.6.Final\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\napache-maven-3.9.5\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/36427/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
