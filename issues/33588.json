{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/33588",
  "id": 1724707488,
  "node_id": "I_kwDOCFbutM5mzPKg",
  "number": 33588,
  "title": "Failed to stop Quarkus [Error Occurred After Shutdown] error when adjusting configuration through Dev UI",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2715669984,
      "node_id": "MDU6TGFiZWwyNzE1NjY5OTg0",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/dev-ui",
      "name": "area/dev-ui",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/253",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/253",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/253/labels",
    "id": 9468628,
    "node_id": "MI_kwDOCFbutM4AkHrU",
    "number": 253,
    "title": "3.1.1.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 83,
    "state": "closed",
    "created_at": "2023-05-31T16:27:01Z",
    "updated_at": "2023-06-28T14:05:39Z",
    "due_on": null,
    "closed_at": "2023-06-07T11:17:31Z"
  },
  "comments": 3,
  "created_at": "2023-05-24T20:43:16Z",
  "updated_at": "2023-06-06T15:54:14Z",
  "closed_at": "2023-06-01T01:27:37Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\n`Failed to stop Quarkus [Error Occurred After Shutdown]` error when adjusting configuration through Dev UI\r\n\r\nChanges in `application.properties` file are detected, but the restart is not seamless, there is `Error Occurred After Shutdown` error in the log\r\n\r\nThere is no error in the log when adjusting `application.properties` file manually and accessing the rest endpoint to trigger the app restart.\r\n\r\nI suspect, that the error during the restart is related to the websocket connection or to the \"background ping\" so the user doesn't need to access the app to trigger the restart.\r\n\r\nConsole log:\r\n```\r\n2023-05-24 22:23:56,363 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, resteasy-reactive, smallrye-context-propagation, vertx]\r\n2023-05-24 22:28:46,401 INFO  [io.qua.dep.dev.RuntimeUpdatesProcessor] (executor-thread-1) File change detected: /Users/rsvoboda/Downloads/code-with-quarkus/src/main/resources/application.properties\r\n2023-05-24 22:28:46,405 INFO  [io.qua.dep.dev.RuntimeUpdatesProcessor] (executor-thread-1) Restarting quarkus due to changes in application.properties.\r\n2023-05-24 22:28:46,432 INFO  [io.quarkus] (Quarkus Main Thread) code-with-quarkus-abcx stopped in 0.025s\r\n2023-05-24 22:28:46,433 ERROR [io.qua.run.boo.StartupActionImpl] (executor-thread-1) Failed to stop Quarkus [Error Occurred After Shutdown]: java.lang.reflect.InvocationTargetException\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl.doClose(StartupActionImpl.java:164)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl$2.close(StartupActionImpl.java:142)\r\n\tat io.quarkus.runner.bootstrap.RunningQuarkusApplicationImpl.close(RunningQuarkusApplicationImpl.java:35)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.stop(IsolatedDevModeMain.java:298)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartApp(IsolatedDevModeMain.java:212)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartCallback(IsolatedDevModeMain.java:203)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:541)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:441)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.preventKill(ConfigEditorProcessor.java:285)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.updateConfig(ConfigEditorProcessor.java:258)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.lambda$registerJsonRpcService$1(ConfigEditorProcessor.java:161)\r\n\tat io.quarkus.dev.console.DevConsoleManager.invoke(DevConsoleManager.java:135)\r\n\tat io.quarkus.devui.runtime.config.ConfigJsonRPCService.updateProperty(ConfigJsonRPCService.java:17)\r\n\tat io.quarkus.devui.runtime.config.ConfigJsonRPCService_ClientProxy.updateProperty(Unknown Source)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat io.quarkus.devui.runtime.comms.JsonRpcRouter.lambda$invoke$0(JsonRpcRouter.java:100)\r\n\tat io.smallrye.mutiny.unchecked.UncheckedSupplier.lambda$toSupplier$0(UncheckedSupplier.java:41)\r\n\tat io.smallrye.context.impl.wrappers.SlowContextualSupplier.get(SlowContextualSupplier.java:21)\r\n\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromItemSupplier.subscribe(UniCreateFromItemSupplier.java:28)\r\n\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\r\n\tat io.smallrye.mutiny.operators.uni.UniRunSubscribeOn.lambda$subscribe$0(UniRunSubscribeOn.java:27)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:576)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: java.lang.IllegalStateException: Interrupted while waiting for another thread to stop the application\r\n\tat io.quarkus.runtime.Application.interruptedOnAwaitStop(Application.java:249)\r\n\tat io.quarkus.runtime.Application.awaitShutdown(Application.java:264)\r\n\tat io.quarkus.runtime.Quarkus.blockingExit(Quarkus.java:192)\r\n\t... 35 more\r\n\r\n\r\n2023-05-24 22:28:46,434 ERROR [io.qua.run.boo.ForkJoinClassLoading] (executor-thread-1) Failed to set fork join ClassLoader [Error Occurred After Shutdown]: java.lang.InterruptedException\r\n\tat java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.tryAcquireSharedNanos(AbstractQueuedSynchronizer.java:1081)\r\n\tat java.base/java.util.concurrent.CountDownLatch.await(CountDownLatch.java:276)\r\n\tat io.quarkus.runner.bootstrap.ForkJoinClassLoading.setForkJoinClassLoader(ForkJoinClassLoading.java:40)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl.doClose(StartupActionImpl.java:169)\r\n\tat io.quarkus.runner.bootstrap.StartupActionImpl$2.close(StartupActionImpl.java:142)\r\n\tat io.quarkus.runner.bootstrap.RunningQuarkusApplicationImpl.close(RunningQuarkusApplicationImpl.java:35)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.stop(IsolatedDevModeMain.java:298)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartApp(IsolatedDevModeMain.java:212)\r\n\tat io.quarkus.deployment.dev.IsolatedDevModeMain.restartCallback(IsolatedDevModeMain.java:203)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:541)\r\n\tat io.quarkus.deployment.dev.RuntimeUpdatesProcessor.doScan(RuntimeUpdatesProcessor.java:441)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.preventKill(ConfigEditorProcessor.java:285)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.updateConfig(ConfigEditorProcessor.java:258)\r\n\tat io.quarkus.vertx.http.deployment.devmode.console.ConfigEditorProcessor.lambda$registerJsonRpcService$1(ConfigEditorProcessor.java:161)\r\n\tat io.quarkus.dev.console.DevConsoleManager.invoke(DevConsoleManager.java:135)\r\n\tat io.quarkus.devui.runtime.config.ConfigJsonRPCService.updateProperty(ConfigJsonRPCService.java:17)\r\n\tat io.quarkus.devui.runtime.config.ConfigJsonRPCService_ClientProxy.updateProperty(Unknown Source)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\r\n\tat io.quarkus.devui.runtime.comms.JsonRpcRouter.lambda$invoke$0(JsonRpcRouter.java:100)\r\n\tat io.smallrye.mutiny.unchecked.UncheckedSupplier.lambda$toSupplier$0(UncheckedSupplier.java:41)\r\n\tat io.smallrye.context.impl.wrappers.SlowContextualSupplier.get(SlowContextualSupplier.java:21)\r\n\tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromItemSupplier.subscribe(UniCreateFromItemSupplier.java:28)\r\n\tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\r\n\tat io.smallrye.mutiny.operators.uni.UniRunSubscribeOn.lambda$subscribe$0(UniRunSubscribeOn.java:27)\r\n\tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:576)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\r\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\r\n\tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\r\n\tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:833)\r\n\r\n\r\n__  ____  __  _____   ___  __ ____  ______\r\n --/ __ \\/ / / / _ | / _ \\/ //_/ / / / __/\r\n -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\\ \\\r\n--\\___\\_\\____/_/ |_/_/|_/_/|_|\\____/___/\r\n2023-05-24 22:28:46,745 INFO  [io.quarkus] (Quarkus Main Thread) code-with-quarkus-abc 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.1.0.Final) started in 0.307s. Listening on: http://0.0.0.0:8080\r\n\r\n2023-05-24 22:28:46,746 INFO  [io.quarkus] (Quarkus Main Thread) Profile dev activated. Live Coding activated.\r\n2023-05-24 22:28:46,746 INFO  [io.quarkus] (Quarkus Main Thread) Installed features: [cdi, resteasy-reactive, smallrye-context-propagation, vertx]\r\n2023-05-24 22:28:46,747 INFO  [io.qua.dep.dev.RuntimeUpdatesProcessor] (executor-thread-1) Live reload total time: 0.348s\r\n```\n\n### Expected behavior\n\nNo error stacktrace in the log\n\n### Actual behavior\n\nError stacktrace in the log\n\n### How to Reproduce?\n\n - Get app from https://code.quarkus.io/\r\n - Run it in dev mode\r\n - Access http://127.0.0.1:8080/q/dev-ui/configuration-form-editor\r\n - Adjust ` quarkus.application.name` to `code-with-quarkus-abc`\r\n - Check the terminal where dev mode was started\n\n### Output of `uname -a` or `ver`\n\nmacOS\n\n### Output of `java -version`\n\nJava 17\n\n### GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.0.3.Final / Quarkus main 071a89c\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n_No response_\n\n### Additional information\n\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/33588/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
