{
  "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029",
  "repository_url": "https://api.github.com/repos/quarkusio/quarkus",
  "labels_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029/labels{/name}",
  "comments_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029/comments",
  "events_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029/events",
  "html_url": "https://github.com/quarkusio/quarkus/issues/25029",
  "id": 1209371638,
  "node_id": "I_kwDOCFbutM5IFYv2",
  "number": 25029,
  "title": "REST Reactive Client when retried, Authorization header is multiplied by OidcClientRequestReactiveFilter ",
  "labels": [
    {
      "id": 985346620,
      "node_id": "MDU6TGFiZWw5ODUzNDY2MjA=",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug",
      "name": "kind/bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1479557456,
      "node_id": "MDU6TGFiZWwxNDc5NTU3NDU2",
      "url": "https://api.github.com/repos/quarkusio/quarkus/labels/area/oidc",
      "name": "area/oidc",
      "color": "0366d6",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "milestone": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/milestones/184",
    "html_url": "https://github.com/quarkusio/quarkus/milestone/184",
    "labels_url": "https://api.github.com/repos/quarkusio/quarkus/milestones/184/labels",
    "id": 7922797,
    "node_id": "MI_kwDOCFbutM4AeORt",
    "number": 184,
    "title": "2.7.6.Final",
    "description": "",
    "creator": {
      "login": "gsmet",
      "id": 1279749,
      "node_id": "MDQ6VXNlcjEyNzk3NDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1279749?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsmet",
      "html_url": "https://github.com/gsmet",
      "followers_url": "https://api.github.com/users/gsmet/followers",
      "following_url": "https://api.github.com/users/gsmet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsmet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsmet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsmet/subscriptions",
      "organizations_url": "https://api.github.com/users/gsmet/orgs",
      "repos_url": "https://api.github.com/users/gsmet/repos",
      "events_url": "https://api.github.com/users/gsmet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsmet/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 171,
    "state": "closed",
    "created_at": "2022-04-28T08:08:41Z",
    "updated_at": "2022-05-30T11:25:22Z",
    "due_on": null,
    "closed_at": "2022-05-30T11:25:22Z"
  },
  "comments": 6,
  "created_at": "2022-04-20T08:45:42Z",
  "updated_at": "2022-05-18T08:11:14Z",
  "closed_at": "2022-04-20T10:59:58Z",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nWhen we have a REST Reactive Client with OidcClientRequestReactiveFilter, and we retry the requests through Mutiny, the Authorization header gets multiplied with each new retry.\r\n\r\nThis results in AWS API Gateway to immediately reject the requests with Bad Request.\r\n\r\nIs there a configuration or something we can do to change this behaviour or is this something that needs to be fixed ?\r\n\r\n\r\n### Expected behavior\r\n\r\nOnly a single Authorization header in the retried requests.\r\n\r\n### Actual behavior\r\n\r\nAuthorization headers keep increasing with each retry request.\r\n\r\n### How to Reproduce?\r\n\r\nGiven the rest client;\r\n\r\n```\r\n@RegisterRestClient(configKey = \"my-api\")\r\n@RegisterProvider(OidcClientRequestReactiveFilter.class)\r\n@Path(\"/api/v1\")\r\npublic interface MyApi {\r\n    @POST\r\n    @Path(\"/something\")\r\n    Uni<SomethingResponse> postSomething(Something body);\r\n}\r\n```\r\n\r\nWhen;\r\n\r\n```\r\nmyApi.postSomething(body).onFailure().retry().indefinitely();\r\n```\r\n\r\nThen each retry keeps appending a new Authorization header to the request. \r\n\r\n### Output of `uname -a` or `ver`\r\n\r\n_No response_\r\n\r\n### Output of `java -version`\r\n\r\nJava 11\r\n\r\n### GraalVM version (if different from Java)\r\n\r\n_No response_\r\n\r\n### Quarkus version or git rev\r\n\r\n2.8.1\r\n\r\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\r\n\r\n_No response_\r\n\r\n### Additional information\r\n\r\n_No response_",
  "reactions": {
    "url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/quarkusio/quarkus/issues/25029/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
